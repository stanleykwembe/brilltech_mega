{"file_contents":{"manage.py":{"content":"#!/usr/bin/env python\n\"\"\"Django's command-line utility for administrative tasks.\"\"\"\nimport os\nimport sys\n\n\ndef main():\n    \"\"\"Run administrative tasks.\"\"\"\n    os.environ.setdefault('DJANGO_SETTINGS_MODULE', 'django_project.settings')\n    try:\n        from django.core.management import execute_from_command_line\n    except ImportError as exc:\n        raise ImportError(\n            \"Couldn't import Django. Are you sure it's installed and \"\n            \"available on your PYTHONPATH environment variable? Did you \"\n            \"forget to activate a virtual environment?\"\n        ) from exc\n    execute_from_command_line(sys.argv)\n\n\nif __name__ == '__main__':\n    main()\n","path":null,"size_bytes":670,"size_tokens":null},"core/migrations/0008_userprofile_bio_userprofile_email_notifications_and_more.py":{"content":"# Generated by Django 5.0.2 on 2025-10-02 21:45\n\nfrom django.db import migrations, models\n\n\nclass Migration(migrations.Migration):\n\n    dependencies = [\n        ('core', '0007_subscriptionplan_usersubscription_payfastpayment'),\n    ]\n\n    operations = [\n        migrations.AddField(\n            model_name='userprofile',\n            name='bio',\n            field=models.TextField(blank=True),\n        ),\n        migrations.AddField(\n            model_name='userprofile',\n            name='email_notifications',\n            field=models.BooleanField(default=True),\n        ),\n        migrations.AddField(\n            model_name='userprofile',\n            name='institution',\n            field=models.CharField(blank=True, max_length=200),\n        ),\n    ]\n","path":null,"size_bytes":755,"size_tokens":null},"app.py":{"content":"import streamlit as st\nimport os\nimport django\nfrom pathlib import Path\n\n# Set up Django\nBASE_DIR = Path(__file__).resolve().parent\nos.environ.setdefault('DJANGO_SETTINGS_MODULE', 'django_project.settings')\n\ntry:\n    django.setup()\n    from core.models import Subject, Grade, ExamBoard, UserProfile, UploadedDocument, GeneratedAssignment, UsageQuota\n    from django.contrib.auth.models import User\nexcept Exception as e:\n    st.error(f\"Django setup error: {e}\")\n\nst.set_page_config(\n    page_title=\"EduTech Freemium Teacher Platform\",\n    page_icon=\"üìö\",\n    layout=\"wide\"\n)\n\ndef main():\n    st.title(\"üìö EduTech Freemium Teacher Platform\")\n    st.write(\"Welcome to the MVP for freemium teacher edtech application!\")\n    \n    # Sidebar for navigation\n    st.sidebar.title(\"Navigation\")\n    page = st.sidebar.selectbox(\"Choose a page\", [\n        \"Dashboard\",\n        \"Lesson Plans\",\n        \"Homework/Assignments\",\n        \"Question Generator\",\n        \"Document Upload\",\n        \"Subscription\"\n    ])\n    \n    if page == \"Dashboard\":\n        show_dashboard()\n    elif page == \"Lesson Plans\":\n        show_lesson_plans()\n    elif page == \"Homework/Assignments\":\n        show_assignments()\n    elif page == \"Question Generator\":\n        show_question_generator()\n    elif page == \"Document Upload\":\n        show_document_upload()\n    elif page == \"Subscription\":\n        show_subscription()\n\ndef show_dashboard():\n    st.header(\"üìä Dashboard\")\n    \n    col1, col2, col3 = st.columns(3)\n    \n    with col1:\n        st.metric(\"Lesson Plans Created\", \"0/5\", \"Free Tier\")\n    \n    with col2:\n        st.metric(\"Assignments Generated\", \"0/5\", \"Free Tier\")\n    \n    with col3:\n        st.metric(\"Documents Uploaded\", \"0\")\n    \n    st.subheader(\"Quick Actions\")\n    col1, col2, col3 = st.columns(3)\n    \n    with col1:\n        if st.button(\"üìù Create Lesson Plan\"):\n            st.info(\"Navigate to Lesson Plans to create new lesson plans\")\n    \n    with col2:\n        if st.button(\"üìã Generate Assignment\"):\n            st.info(\"Navigate to Homework/Assignments to generate new assignments\")\n    \n    with col3:\n        if st.button(\"‚ùì Create Questions\"):\n            st.info(\"Navigate to Question Generator to create questions\")\n\ndef show_lesson_plans():\n    st.header(\"üìù Lesson Plan Management\")\n    \n    tab1, tab2 = st.tabs([\"Generate AI Lesson Plan\", \"Upload Lesson Plan\"])\n    \n    with tab1:\n        st.subheader(\"AI Lesson Plan Generator\")\n        \n        col1, col2 = st.columns(2)\n        with col1:\n            subject = st.selectbox(\"Subject\", [\"Mathematics\", \"English\", \"Science\", \"History\"])\n            grade = st.selectbox(\"Grade\", [\"1\", \"2\", \"3\", \"4\", \"5\", \"6\", \"7\", \"8\", \"9\", \"10\", \"11\", \"12\"])\n        \n        with col2:\n            topic = st.text_input(\"Topic\")\n            exam_board = st.selectbox(\"Exam Board\", [\"Cambridge International (CIE)\", \"Edexcel\", \"AQA\"])\n        \n        if st.button(\"Generate Lesson Plan\"):\n            with st.spinner(\"Generating AI lesson plan...\"):\n                st.success(\"Lesson plan generated successfully! (MVP - AI integration pending)\")\n                \n                # Mock lesson plan structure\n                st.subheader(\"Generated Lesson Plan\")\n                st.write(f\"**Subject:** {subject}\")\n                st.write(f\"**Grade:** {grade}\")\n                st.write(f\"**Topic:** {topic}\")\n                st.write(f\"**Exam Board:** {exam_board}\")\n                \n                st.write(\"**Objectives:**\")\n                st.write(\"- Students will understand the key concepts\")\n                st.write(\"- Students will be able to apply knowledge practically\")\n                \n                st.write(\"**Activities:**\")\n                st.write(\"- Introduction and warm-up (10 mins)\")\n                st.write(\"- Main lesson content (25 mins)\")\n                st.write(\"- Practice activities (10 mins)\")\n                st.write(\"- Summary and homework (5 mins)\")\n    \n    with tab2:\n        st.subheader(\"Upload Your Own Lesson Plan\")\n        uploaded_file = st.file_uploader(\"Choose a file\", type=['pdf', 'docx'])\n        \n        if uploaded_file is not None:\n            st.success(\"File uploaded successfully! (MVP - file processing pending)\")\n\ndef show_assignments():\n    st.header(\"üìã Homework & Assignment Management\")\n    \n    tab1, tab2 = st.tabs([\"Generate Assignment\", \"View Assignments\"])\n    \n    with tab1:\n        st.subheader(\"Generate New Assignment\")\n        \n        col1, col2 = st.columns(2)\n        with col1:\n            title = st.text_input(\"Assignment Title\")\n            subject = st.selectbox(\"Subject\", [\"Mathematics\", \"English\", \"Science\", \"History\"], key=\"assign_subject\")\n            grade = st.selectbox(\"Grade\", [\"1\", \"2\", \"3\", \"4\", \"5\", \"6\", \"7\", \"8\", \"9\", \"10\", \"11\", \"12\"], key=\"assign_grade\")\n        \n        with col2:\n            due_date = st.date_input(\"Due Date\")\n            exam_board = st.selectbox(\"Exam Board\", [\"Cambridge International (CIE)\", \"Edexcel\", \"AQA\"], key=\"assign_board\")\n            instructions = st.text_area(\"Instructions\")\n        \n        if st.button(\"Generate Assignment\"):\n            st.success(\"Assignment generated successfully!\")\n            \n            # Mock shareable link\n            share_link = f\"https://example.com/assignment/{title.lower().replace(' ', '-')}\"\n            st.write(f\"**Shareable Link:** {share_link}\")\n            \n            col1, col2, col3 = st.columns(3)\n            with col1:\n                st.button(\"üì± Share on WhatsApp\")\n            with col2:\n                st.button(\"üè´ Share on Google Classroom\")\n            with col3:\n                st.button(\"‚úâÔ∏è Share via Email\")\n    \n    with tab2:\n        st.subheader(\"Your Assignments\")\n        st.info(\"No assignments created yet. Generate your first assignment!\")\n\ndef show_question_generator():\n    st.header(\"‚ùì AI Question Generator\")\n    \n    col1, col2 = st.columns(2)\n    \n    with col1:\n        question_type = st.selectbox(\"Question Type\", [\n            \"Multiple Choice (MCQ)\",\n            \"Structured/Short Answer\",\n            \"Free Response/Essay\",\n            \"Cambridge-style Structured\"\n        ])\n        \n        subject = st.selectbox(\"Subject\", [\"Mathematics\", \"English\", \"Science\", \"History\"], key=\"q_subject\")\n        grade = st.selectbox(\"Grade\", [\"1\", \"2\", \"3\", \"4\", \"5\", \"6\", \"7\", \"8\", \"9\", \"10\", \"11\", \"12\"], key=\"q_grade\")\n    \n    with col2:\n        exam_board = st.selectbox(\"Exam Board\", [\"Cambridge International (CIE)\", \"Edexcel\", \"AQA\"], key=\"q_board\")\n        difficulty = st.selectbox(\"Difficulty\", [\"Easy\", \"Medium\", \"Hard\"])\n        topic = st.text_input(\"Specific Topic\", key=\"q_topic\")\n    \n    if st.button(\"Generate Questions\"):\n        with st.spinner(\"Generating questions using AI...\"):\n            st.success(\"Questions generated successfully! (MVP - AI integration pending)\")\n            \n            # Mock generated question based on type\n            st.subheader(\"Generated Question\")\n            \n            if question_type == \"Multiple Choice (MCQ)\":\n                st.write(f\"**Question:** What is the main concept in {topic}?\")\n                st.write(\"A) Option 1\")\n                st.write(\"B) Option 2\")\n                st.write(\"C) Option 3\")\n                st.write(\"D) Option 4\")\n                st.write(\"**Answer:** B\")\n            \n            elif question_type == \"Cambridge-style Structured\":\n                st.write(f\"**Question:** Analyze the following concept in {topic}:\")\n                st.write(\"a) Define the key terms (2 marks)\")\n                st.write(\"b) Explain the main principles (4 marks)\")\n                st.write(\"c) Evaluate the applications (6 marks)\")\n            \n            else:\n                st.write(f\"**Question:** Discuss the importance of {topic} in {subject}.\")\n                st.write(\"**Answer Guidelines:** Students should mention key concepts, examples, and real-world applications.\")\n\ndef show_document_upload():\n    st.header(\"üìÅ Document Upload & Management\")\n    \n    col1, col2 = st.columns(2)\n    \n    with col1:\n        st.subheader(\"Upload New Document\")\n        doc_type = st.selectbox(\"Document Type\", [\n            \"Lesson Plan\",\n            \"Homework\",\n            \"Past Paper\",\n            \"Sample Questions\"\n        ])\n        \n        subject = st.selectbox(\"Subject\", [\"Mathematics\", \"English\", \"Science\", \"History\"], key=\"doc_subject\")\n        grade = st.selectbox(\"Grade\", [\"1\", \"2\", \"3\", \"4\", \"5\", \"6\", \"7\", \"8\", \"9\", \"10\", \"11\", \"12\"], key=\"doc_grade\")\n        exam_board = st.selectbox(\"Exam Board\", [\"Cambridge International (CIE)\", \"Edexcel\", \"AQA\"], key=\"doc_board\")\n        \n        uploaded_file = st.file_uploader(\"Choose a file\", type=['pdf', 'docx'], key=\"doc_upload\")\n        \n        if uploaded_file is not None:\n            if st.button(\"Upload Document\"):\n                st.success(\"Document uploaded successfully!\")\n    \n    with col2:\n        st.subheader(\"Filter Documents\")\n        filter_subject = st.selectbox(\"Filter by Subject\", [\"All\", \"Mathematics\", \"English\", \"Science\", \"History\"])\n        filter_grade = st.selectbox(\"Filter by Grade\", [\"All\", \"1\", \"2\", \"3\", \"4\", \"5\", \"6\", \"7\", \"8\", \"9\", \"10\", \"11\", \"12\"])\n        filter_board = st.selectbox(\"Filter by Exam Board\", [\"All\", \"Cambridge International (CIE)\", \"Edexcel\", \"AQA\"])\n        \n        st.info(\"No documents uploaded yet.\")\n\ndef show_subscription():\n    st.header(\"üíé Subscription Management\")\n    \n    col1, col2 = st.columns(2)\n    \n    with col1:\n        st.subheader(\"Current Plan: Free Tier\")\n        st.write(\"**Features:**\")\n        st.write(\"‚úÖ 5 lesson plans per subject\")\n        st.write(\"‚úÖ 5 homework/assignments per subject\")\n        st.write(\"‚úÖ Basic question generation\")\n        st.write(\"‚ùå Unlimited access\")\n        st.write(\"‚ùå Advanced AI features\")\n        st.write(\"‚ùå Priority support\")\n        \n        st.subheader(\"Usage This Month\")\n        st.progress(0.0, \"Lesson Plans: 0/5 per subject\")\n        st.progress(0.0, \"Assignments: 0/5 per subject\")\n    \n    with col2:\n        st.subheader(\"Upgrade to Premium\")\n        st.write(\"**Premium Features:**\")\n        st.write(\"‚úÖ Unlimited lesson plans\")\n        st.write(\"‚úÖ Unlimited assignments\")\n        st.write(\"‚úÖ Advanced AI question generation\")\n        st.write(\"‚úÖ Priority support\")\n        st.write(\"‚úÖ Export to multiple formats\")\n        st.write(\"‚úÖ Advanced analytics\")\n        \n        st.write(\"**Price:** $29.99/month\")\n        \n        if st.button(\"Upgrade to Premium\"):\n            st.info(\"Payment integration coming soon! (Stripe integration pending)\")\n\nif __name__ == \"__main__\":\n    main()","path":null,"size_bytes":10686,"size_tokens":null},"core/urls.py":{"content":"from django.urls import path\nfrom . import views\n\nurlpatterns = [\n    # Landing pages\n    path('welcome/teacher/', views.teacher_landing, name='teacher_landing'),\n    path('welcome/student/', views.student_landing, name='student_landing'),\n    \n    # Authentication\n    path('login/', views.login_view, name='login'),\n    path('logout/', views.logout_view, name='logout'),\n    path('signup/', views.signup_view, name='signup'),\n    path('register/', views.signup_view, name='register'),  # Alias for landing page links\n    path('verify-email/<str:token>/', views.verify_email, name='verify_email'),\n    path('resend-verification/', views.resend_verification, name='resend_verification'),\n    path('forgot-password/', views.forgot_password, name='forgot_password'),\n    path('reset-password/<str:token>/', views.reset_password, name='reset_password'),\n    path('account/settings/', views.account_settings, name='account_settings'),\n    path('', views.dashboard_view, name='dashboard'),\n    path('lesson-plans/', views.lesson_plans_view, name='lesson_plans'),\n    path('classwork/', views.classwork_view, name='classwork'),\n    path('homework/', views.homework_view, name='homework'),\n    path('tests/', views.tests_view, name='tests'),\n    path('exams/', views.exams_view, name='exams'),\n    path('assignments/', views.assignments_view, name='assignments'),\n    path('questions/', views.questions_view, name='questions'),\n    path('documents/', views.documents_view, name='documents'),\n    path('documents/upload/', views.upload_document, name='upload_document'),\n    path('subscription/', views.subscription_view, name='subscription'),\n    path('classes/', views.classes_view, name='classes'),\n    path('classes/create/', views.create_class, name='create_class'),\n    path('classes/<int:class_id>/edit/', views.edit_class, name='edit_class'),\n    path('classes/<int:class_id>/delete/', views.delete_class, name='delete_class'),\n    # File operations\n    path('document/<int:doc_id>/delete/', views.delete_document, name='delete_document'),\n    path('document/<int:doc_id>/download/', views.download_document, name='download_document'),\n    path('document/<int:doc_id>/view/', views.view_document, name='view_document'),\n    path('document/<int:doc_id>/inline/', views.view_document_inline, name='view_document_inline'),\n    # AI generation endpoints\n    path('generate-assignment/', views.generate_assignment_ai, name='generate_assignment'),\n    path('generate-questions/', views.generate_questions_ai, name='generate_questions'),\n    # Assignment sharing endpoints\n    path('assignments/share/create/', views.create_share, name='create_share'),\n    path('assignments/share/<int:share_id>/revoke/', views.revoke_share, name='revoke_share'),\n    # Public access endpoints (no login required)\n    path('share/a/<str:token>/', views.public_assignment_view, name='public_assignment'),\n    path('share/a/<str:token>/download/', views.public_assignment_download, name='public_assignment_download'),\n    # Payment and subscription endpoints\n    path('subscription/dashboard/', views.subscription_dashboard, name='subscription_dashboard'),\n    path('subscription/initiate/<int:plan_id>/', views.initiate_subscription, name='initiate_subscription'),\n    path('payfast/notify/', views.payfast_notify, name='payfast_notify'),\n    path('payment/success/', views.payment_success, name='payment_success'),\n    path('payment/cancelled/', views.payment_cancelled, name='payment_cancelled'),\n    # Admin panel endpoints (using /panel/ to avoid conflict with Django's /admin/)\n    path('panel/', views.admin_dashboard, name='admin_dashboard'),\n    path('panel/users/', views.admin_users, name='admin_users'),\n    path('panel/users/<int:user_id>/change-subscription/', views.admin_change_subscription, name='admin_change_subscription'),\n    path('panel/users/<int:user_id>/toggle-status/', views.admin_toggle_user_status, name='admin_toggle_user_status'),\n    path('panel/subscriptions/', views.admin_subscriptions, name='admin_subscriptions'),\n    path('panel/api-test/', views.admin_api_test, name='admin_api_test'),\n    path('panel/features/', views.admin_features, name='admin_features'),\n    path('panel/features/exam-boards/', views.admin_exam_boards, name='admin_exam_boards'),\n    path('panel/features/subjects/', views.admin_subjects, name='admin_subjects'),\n    path('panel/features/grades/', views.admin_grades, name='admin_grades'),\n    path('panel/features/teachers/plans/', views.admin_teacher_subscription_plans, name='admin_teacher_subscription_plans'),\n    path('panel/features/student/plans/', views.admin_student_subscription_plans, name='admin_student_subscription_plans'),\n    path('panel/communications/', views.admin_communications, name='admin_communications'),\n    path('panel/communications/announcements/', views.admin_announcements, name='admin_announcements'),\n    path('panel/communications/announcements/<int:announcement_id>/dismiss/', views.dismiss_announcement, name='dismiss_announcement'),\n    path('panel/communications/emails/', views.admin_email_blasts, name='admin_email_blasts'),\n    path('panel/communications/emails/send/', views.send_email_blast, name='send_email_blast'),\n    # Content manager endpoints\n    path('content/', views.content_dashboard, name='content_dashboard'),\n    path('content/papers/', views.content_papers, name='content_papers'),\n    path('content/papers/upload/', views.content_upload_paper, name='content_upload_paper'),\n    path('content/papers/<int:paper_id>/reformat/', views.content_reformat_paper, name='content_reformat_paper'),\n    path('content/formatted-papers/', views.content_formatted_papers, name='content_formatted_papers'),\n    path('content/formatted-papers/<int:paper_id>/review/', views.content_review_formatted_paper, name='content_review_formatted_paper'),\n    path('content/quizzes/', views.content_quizzes, name='content_quizzes'),\n    path('content/quizzes/create/', views.content_create_quiz, name='content_create_quiz'),\n    path('content/bulk-upload/', views.content_bulk_upload, name='content_bulk_upload'),\n    path('content/papers/official-bulk-upload/', views.official_papers_bulk_upload, name='official_papers_bulk_upload'),\n    # Student content management endpoints\n    path('content/interactive-question/create/', views.create_interactive_question, name='create_interactive_question'),\n    path('content/interactive-questions/', views.manage_interactive_questions, name='manage_interactive_questions'),\n    path('content/interactive-question/<int:question_id>/edit/', views.edit_interactive_question, name='edit_interactive_question'),\n    path('content/interactive-question/<int:question_id>/delete/', views.delete_interactive_question, name='delete_interactive_question'),\n    path('content/student-quiz/create/', views.create_student_quiz, name='create_student_quiz'),\n    path('content/student-quizzes/', views.manage_student_quizzes, name='manage_student_quizzes'),\n    path('content/student-quiz/<int:quiz_id>/delete/', views.delete_student_quiz, name='delete_student_quiz'),\n    path('content/note/create/', views.create_note, name='create_note'),\n    path('content/notes/', views.manage_notes, name='manage_notes'),\n    path('content/note/<int:note_id>/delete/', views.delete_note, name='delete_note'),\n    path('content/flashcard/create/', views.create_flashcard, name='create_flashcard'),\n    path('content/flashcards/', views.manage_flashcards, name='manage_flashcards'),\n    path('content/flashcard/<int:flashcard_id>/delete/', views.delete_flashcard, name='delete_flashcard'),\n    path('content/exam-paper/create/', views.upload_exam_paper, name='upload_exam_paper'),\n    path('content/exam-papers/', views.manage_exam_papers, name='manage_exam_papers'),\n    path('content/exam-paper/<int:paper_id>/delete/', views.delete_exam_paper, name='delete_exam_paper'),\n    path('content/syllabi/', views.manage_syllabi, name='manage_syllabi'),\n    path('content/syllabus/create/', views.create_syllabus, name='create_syllabus'),\n    path('content/syllabus/<int:syllabus_id>/delete/', views.delete_syllabus, name='delete_syllabus'),\n    path('content/ajax/get-questions/', views.get_questions_ajax, name='get_questions_ajax'),\n    \n    # Teacher Assessment Builder\n    path('create/', views.create_assessment, name='create_assessment'),\n    path('assessment/save/', views.save_assessment, name='save_assessment'),\n    path('assessment/<int:assessment_id>/edit/', views.edit_assessment, name='edit_assessment'),\n    path('assessment/<int:assessment_id>/delete/', views.delete_assessment, name='delete_assessment'),\n    path('assessment/<int:assessment_id>/', views.view_assessment, name='view_assessment'),\n    \n    # Public exam papers browse (no login required)\n    path('papers/', views.public_papers_browse, name='public_papers_browse'),\n    path('papers/api/', views.public_papers_api, name='public_papers_api'),\n    path('papers/filters/', views.public_papers_filters, name='public_papers_filters'),\n    path('papers/view/<int:paper_id>/', views.public_paper_view, name='public_paper_view'),\n    path('papers/download/<int:paper_id>/', views.public_paper_download, name='public_paper_download'),\n    \n    # BrillTech corporate pages (no login required)\n    path('brilltech/', views.brilltech_landing, name='brilltech_landing'),\n    path('brilltech/services/', views.brilltech_services, name='brilltech_services'),\n    path('brilltech/learning/', views.brilltech_learning, name='brilltech_learning'),\n    path('brilltech/store/', views.brilltech_store, name='brilltech_store'),\n    path('brilltech/dashboard/', views.brilltech_dashboard, name='brilltech_dashboard'),\n    path('brilltech/apps/', views.brilltech_apps, name='brilltech_apps'),\n    path('brilltech/about/', views.brilltech_about, name='brilltech_about'),\n    path('brilltech/contact/', views.brilltech_contact, name='brilltech_contact'),\n    \n    # BrillTech Admin Portal (separate from EduTech admin)\n    path('brilltech/admin/', views.brilltech_admin_dashboard, name='brilltech_admin_dashboard'),\n    path('brilltech/admin/login/', views.brilltech_admin_login, name='brilltech_admin_login'),\n    path('brilltech/admin/logout/', views.brilltech_admin_logout, name='brilltech_admin_logout'),\n    path('brilltech/admin/submissions/', views.brilltech_admin_submissions, name='brilltech_admin_submissions'),\n    path('brilltech/admin/submissions/<int:submission_id>/', views.brilltech_admin_submission_detail, name='brilltech_admin_submission_detail'),\n    path('brilltech/admin/change-password/', views.brilltech_admin_change_password, name='brilltech_admin_change_password'),\n    \n    # BrillTech CRM - Tasks\n    path('brilltech/admin/crm/tasks/', views.crm_tasks_list, name='crm_tasks_list'),\n    path('brilltech/admin/crm/tasks/create/', views.crm_task_create, name='crm_task_create'),\n    path('brilltech/admin/crm/tasks/<int:task_id>/edit/', views.crm_task_edit, name='crm_task_edit'),\n    path('brilltech/admin/crm/tasks/<int:task_id>/delete/', views.crm_task_delete, name='crm_task_delete'),\n    \n    # BrillTech CRM - Leads\n    path('brilltech/admin/crm/leads/', views.crm_leads_list, name='crm_leads_list'),\n    path('brilltech/admin/crm/leads/create/', views.crm_lead_create, name='crm_lead_create'),\n    path('brilltech/admin/crm/leads/<int:lead_id>/', views.crm_lead_detail, name='crm_lead_detail'),\n    path('brilltech/admin/crm/leads/<int:lead_id>/edit/', views.crm_lead_edit, name='crm_lead_edit'),\n    path('brilltech/admin/crm/leads/<int:lead_id>/delete/', views.crm_lead_delete, name='crm_lead_delete'),\n    path('brilltech/admin/crm/leads/<int:lead_id>/activity/', views.crm_activity_add, name='crm_activity_add'),\n    \n    # BrillTech CRM - Mailing\n    path('brilltech/admin/crm/mailing/', views.crm_mailing_lists, name='crm_mailing_lists'),\n    path('brilltech/admin/crm/mailing/create/', views.crm_mailing_list_create, name='crm_mailing_list_create'),\n    path('brilltech/admin/crm/mailing/<int:list_id>/', views.crm_mailing_list_detail, name='crm_mailing_list_detail'),\n    path('brilltech/admin/crm/mailing/<int:list_id>/subscriber/', views.crm_subscriber_add, name='crm_subscriber_add'),\n    path('brilltech/admin/crm/campaigns/', views.crm_email_campaigns, name='crm_email_campaigns'),\n    path('brilltech/admin/crm/campaigns/create/', views.crm_email_campaign_create, name='crm_email_campaign_create'),\n    \n    # Content Manager - Topics/Subtopics/Concepts/Video Lessons Management\n    path('content/topics/', views.manage_topics, name='manage_topics'),\n    path('content/topics/add/', views.add_topic, name='add_topic'),\n    path('content/topics/<int:topic_id>/edit/', views.edit_topic, name='edit_topic'),\n    path('content/topics/<int:topic_id>/delete/', views.delete_topic, name='delete_topic'),\n    path('content/subtopics/', views.manage_subtopics, name='manage_subtopics'),\n    path('content/subtopics/add/', views.add_subtopic, name='add_subtopic'),\n    path('content/subtopics/<int:subtopic_id>/edit/', views.edit_subtopic, name='edit_subtopic'),\n    path('content/subtopics/<int:subtopic_id>/delete/', views.delete_subtopic, name='delete_subtopic'),\n    path('content/concepts/', views.manage_concepts, name='manage_concepts'),\n    path('content/concepts/add/', views.add_concept, name='add_concept'),\n    path('content/concepts/<int:concept_id>/edit/', views.edit_concept, name='edit_concept'),\n    path('content/concepts/<int:concept_id>/delete/', views.delete_concept, name='delete_concept'),\n    path('content/video-lessons/', views.manage_video_lessons, name='manage_video_lessons'),\n    path('content/video-lessons/add/', views.add_video_lesson, name='add_video_lesson'),\n    path('content/video-lessons/<int:video_id>/edit/', views.edit_video_lesson, name='edit_video_lesson'),\n    path('content/video-lessons/<int:video_id>/delete/', views.delete_video_lesson, name='delete_video_lesson'),\n    \n    # Public share links for students (token-based, no login required)\n    path('share/<str:token>/', views.share_content_view, name='share_content_view'),\n    \n    # Create share link (requires teacher login)\n    path('api/create-share/', views.create_share_link, name='create_share_link'),\n]","path":null,"size_bytes":14186,"size_tokens":null},"replit.md":{"content":"# EduTech Freemium Multi-Portal Platform\n\n## Overview\n\nThis project is a comprehensive freemium educational technology platform designed to serve four distinct user groups: Teachers, Admins, Students, and Content Managers. It facilitates content creation, interactive learning, and curriculum management with AI-powered features. The platform utilizes a freemium model with separate subscription tiers for teachers and students, offering extensive free access alongside premium features to enhance educational experiences.\n\n## Recent Changes (December 2025)\n\n- **Performance Optimization**: Added WhiteNoise for static file compression, Tailwind CSS build system, caching configuration, lazy loading for images\n- **CRM System**: Added full CRM system to BrillTech Admin Portal with Tasks, Leads, Sales Pipeline, Mailing Lists, and Email Campaigns\n- **Social Login**: Added Google and Facebook social login via django-allauth for both Teacher and Student portals\n- **Admin Panel Reorganization**: Separated subscription management into Teacher Plans (`/panel/features/teachers/plans/`) and Student Plans (`/panel/features/student/plans/`)\n- **Admin Signup**: Added admin signup page at `/brilltech/signup/` for creating new administrator accounts\n- **URL Restructure**: Custom BrillTech Admin Portal at `/brilltech/admin/`, Django admin moved to `/django-admin/`\n- **Student Pricing Model**: Implemented single-row configuration for all student subscription tiers (per-subject, multi-subject bundle, all-access, tutor add-on)\n\n## Performance Optimization\n\n### Static Files\n- **WhiteNoise**: Serves compressed static files with proper caching headers\n- **Django Compressor**: Minifies CSS and JavaScript files\n- **Build command**: `npm run build:css` to generate optimized Tailwind CSS\n\n### Caching\n- **Development**: Local memory cache (no configuration needed)\n- **Production**: Set `REDIS_URL` environment variable for Redis caching\n\n### Images\n- All images use `loading=\"lazy\"` for deferred loading\n\n### Database\n- PostgreSQL connections use connection pooling (10-minute keep-alive)\n- Enable via `DATABASE_URL` or `POSTGRES_*` environment variables\n\n## User Preferences\n\nPreferred communication style: Simple, everyday language.\n\n## Test Accounts\n\n| Portal | Username | Password |\n|--------|----------|----------|\n| Admin (Django) | superadmin | Super123! |\n| Admin (Django) | admin | admin123 |\n| Teacher | test_teacher | teacher123 |\n| Student | test_student | student123 |\n\n## URL Structure\n\n### Public Pages\n- `/` - Home/Dashboard (redirects to login if not authenticated)\n- `/login/` - Teacher/Admin login\n- `/signup/` - Teacher registration\n- `/welcome/teacher/` - Teacher landing page\n- `/welcome/student/` - Student landing page\n\n### Admin Portals\n- `/panel/` - Custom admin dashboard (for platform management)\n- `/panel/features/` - Feature management (exam boards, subjects, grades)\n- `/panel/features/teachers/plans/` - Teacher subscription plans management\n- `/panel/features/student/plans/` - Student pricing configuration\n- `/panel/users/` - User management\n- `/panel/communications/` - Announcements and email blasts\n- `/django-admin/` - Django admin (for database-level access)\n- `/brilltech/signup/` - Admin account signup\n\n### BrillTech Admin Portal (CRM)\n- `/brilltech/admin/` - BrillTech admin dashboard (dark theme)\n- `/brilltech/admin/crm/tasks/` - Task management (CRUD, priorities, statuses)\n- `/brilltech/admin/crm/leads/` - Lead management with sales pipeline\n- `/brilltech/admin/crm/mailing/` - Mailing lists and subscribers\n- `/brilltech/admin/crm/campaigns/` - Email campaign management\n\n### Student Portal\n- `/student/login/` - Student login\n- `/student/signup/` - Student registration\n- `/student/dashboard/` - Student dashboard\n- `/student/study/` - Study page with collapsible navigation\n\n### Teacher Portal\n- `/` - Teacher dashboard\n- `/lesson-plans/` - Lesson plan management\n- `/assignments/` - Assignment management\n- `/documents/` - Document management\n\n### Content Manager Portal\n- `/content/` - Content manager dashboard\n- `/content/papers/` - Exam paper management\n\n## System Architecture\n\n### UI/UX Design\nThe platform features a modern design inspired by Windows 11 and iPhone aesthetics, incorporating glassmorphism, gradient backgrounds, smooth animations, and multi-layer shadows. It utilizes an 8px radius for cards, 4px for buttons, and 12px for modals, with 200-300ms transitions. Color themes are portal-specific: purple/indigo for Admin, orange/teal for Content Management, gray with indigo/purple accents for Teacher, and green/blue for Student. Frontend is built with Django templates, Tailwind CSS, Alpine.js for interactivity, and GSAP for animations.\n\n### Technical Implementation\nThe backend is powered by Django 5.0, structured as a monolithic 'core' Django app. It features distinct authentication systems for Teachers/Admins and Students, with role-based access control for `admin`, `content_manager`, and `teacher` roles. A robust portal redirection system ensures users are routed to their appropriate dashboards. Key features include:\n\n- **Landing Pages**: Dedicated marketing pages for teachers and students with dynamic content and animations.\n- **Public Papers Page**: Offers free access to exam papers with AJAX filters, lazy-loading, and ad integration.\n- **Content Management Portal**: Allows content managers to upload and manage various educational materials, including official exam papers, interactive questions (MCQ, True-False, Fill-blank, Matching, Essay), notes, and flashcards. Supports bulk uploads and parsing for multiple exam boards (Cambridge, Edexcel, CAPS, ZIMSEC, IEB, AQA, OCR).\n- **Teacher Portal**: Enables teachers to create and share content, with AI integration for generating lesson plans and assignments from PDFs.\n- **Student Portal**: Provides an interactive learning environment with quizzes, notes, flashcards, and exam preparation. Features a multi-step onboarding process, progress tracking, and a pathway-based navigation system for studying, revising, and accessing information. Quizzes support auto-marking for MCQs and AI-assisted marking for structured questions.\n- **AI Integration**: A dedicated service layer (`core/openai_service.py`) handles all AI interactions, supporting content generation for lesson plans, homework, and various question types, with model selection based on subscription tiers (GPT-3.5-turbo, GPT-4). AI-generated content is returned in structured JSON format.\n- **REST API**: A comprehensive Django REST Framework API is provided for mobile applications, offering endpoints for students (authentication, quizzes, notes, flashcards, exam papers, progress tracking) and teachers (content access, document sharing), including offline support and Swagger/ReDoc documentation.\n- **Feature Management**: An admin interface manages exam boards, subjects, grades, and subscription plans (separate for teachers and students).\n- **Communications**: Platform-wide announcements and email blast functionality.\n\n### Subscription Systems\n\n#### Teacher Subscriptions (SubscriptionPlan model)\nManaged at `/panel/features/teachers/plans/`\n- Free, Starter, Growth, Premium tiers\n- Configurable: price, AI generations quota, subject limits\n\n#### Student Subscriptions (StudentSubscriptionPricing model)\nManaged at `/panel/features/student/plans/`\n- Per-subject pricing (R100/subject for 1-3 subjects)\n- Multi-subject bundle (R200 flat for 4-5 subjects)\n- All-access (R300 for unlimited subjects)\n- Tutor add-on (+R500 for email support)\n- All prices and bounds are admin-configurable\n\n### Data Storage\n- **Database**: SQLite for development, designed for PostgreSQL compatibility.\n- **Models**: Comprehensive models cover Teacher and Student systems, Official Exam Papers, and shared entities like Subject, Grade, ExamBoard.\n- **File Storage**: Local file system, organized by content type (documents, notes, flashcards, exam papers) and date.\n\n## Key Files\n\n- `core/views.py` - Main teacher and admin views\n- `core/student_views.py` - Student portal views\n- `core/models.py` - Database models\n- `core/urls.py` - URL routing for core app\n- `core/student_urls.py` - URL routing for student portal\n- `core/admin_signup_views.py` - Admin signup functionality\n- `core/openai_service.py` - AI integration service\n- `django_project/urls.py` - Root URL configuration\n- `django_project/settings.py` - Django settings\n\n## External Dependencies\n\n### Third-Party Services\n- **OpenAI API**: For AI content generation (GPT-3.5-turbo, GPT-4).\n- **PayFast**: Payment gateway for subscription management.\n- **Google Forms**: Used for teacher quizzes integration.\n\n### Frontend Libraries\n- **Tailwind CSS**: Utility-first CSS framework for styling.\n- **Alpine.js**: Lightweight JavaScript framework for UI interactivity.\n- **Font Awesome**: Icon library.\n- **GSAP**: JavaScript animation library.\n\n### Python Packages\n- **Django**: Web framework.\n- **OpenAI Python SDK**: Python client for the OpenAI API.\n- **Django REST Framework**: For building RESTful APIs.\n- **PyPDF2**: For PDF text extraction.\n- **python-docx**: For Word document handling.\n- **Pillow**: Image processing.\n- **psycopg2-binary**: PostgreSQL adapter.\n\n## Database Configuration\n\nThe application supports both SQLite (default) and PostgreSQL:\n\n### SQLite (Default - No Configuration Needed)\n- Database file: `db.sqlite3` in project root\n- Perfect for development and small deployments\n- No environment variables required\n\n### Switching to PostgreSQL\nWhen you need to scale, set ONE of these options:\n\n**Option 1: DATABASE_URL (Recommended)**\n```\nDATABASE_URL=postgresql://username:password@host:5432/dbname\n```\n\n**Option 2: Individual Variables**\n```\nPOSTGRES_DB=edutech\nPOSTGRES_USER=your_username\nPOSTGRES_PASSWORD=your_password\nPOSTGRES_HOST=localhost\nPOSTGRES_PORT=5432\n```\n\nAfter setting credentials:\n1. Run migrations: `python manage.py migrate`\n2. Create superuser: `python manage.py createsuperuser`\n\n**PostgreSQL Schema Script:** See `setup_postgres.sql` for database structure reference.\n\n## Environment Variables\n\nRequired secrets (set in Replit Secrets):\n- `OPENAI_API_KEY` - OpenAI API key for AI features\n- `EMAIL_HOST_USER` - Email sending (SMTP username)\n- `EMAIL_HOST_PASSWORD` - Email sending (SMTP password)\n\n### Social Login (Optional)\nTo enable Google/Facebook login, add these secrets:\n- `GOOGLE_CLIENT_ID` - Google OAuth client ID (from Google Cloud Console)\n- `GOOGLE_CLIENT_SECRET` - Google OAuth client secret\n- `FACEBOOK_APP_ID` - Facebook App ID (from Facebook Developer Console)\n- `FACEBOOK_APP_SECRET` - Facebook App Secret\n\n**Setup Instructions:**\n1. **Google**: Go to [Google Cloud Console](https://console.cloud.google.com/) ‚Üí APIs & Services ‚Üí Credentials ‚Üí Create OAuth 2.0 Client ID\n   - Add authorized redirect URI: `https://your-domain/accounts/google/login/callback/`\n2. **Facebook**: Go to [Facebook Developers](https://developers.facebook.com/) ‚Üí Create App ‚Üí Facebook Login\n   - Add valid OAuth redirect URI: `https://your-domain/accounts/facebook/login/callback/`\n","path":null,"size_bytes":11087,"size_tokens":null},"core/migrations/0001_initial.py":{"content":"# Generated by Django 5.0.2 on 2025-09-21 22:10\n\nimport django.db.models.deletion\nfrom django.conf import settings\nfrom django.db import migrations, models\n\n\nclass Migration(migrations.Migration):\n\n    initial = True\n\n    dependencies = [\n        migrations.swappable_dependency(settings.AUTH_USER_MODEL),\n    ]\n\n    operations = [\n        migrations.CreateModel(\n            name='ExamBoard',\n            fields=[\n                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),\n                ('name_full', models.CharField(max_length=200)),\n                ('abbreviation', models.CharField(max_length=10)),\n            ],\n        ),\n        migrations.CreateModel(\n            name='Grade',\n            fields=[\n                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),\n                ('number', models.IntegerField()),\n            ],\n        ),\n        migrations.CreateModel(\n            name='Subject',\n            fields=[\n                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),\n                ('name', models.CharField(max_length=100)),\n            ],\n        ),\n        migrations.CreateModel(\n            name='GeneratedAssignment',\n            fields=[\n                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),\n                ('title', models.CharField(max_length=200)),\n                ('question_type', models.CharField(choices=[('MCQ', 'Multiple Choice'), ('Structured', 'Structured/Short Answer'), ('Free Response', 'Free Response/Essay'), ('Cambridge-style', 'Cambridge-style Structured')], max_length=20)),\n                ('due_date', models.DateTimeField()),\n                ('file_url', models.URLField(blank=True)),\n                ('shared_link', models.CharField(max_length=500, unique=True)),\n                ('created_at', models.DateTimeField(auto_now_add=True)),\n                ('content', models.JSONField()),\n                ('board', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, to='core.examboard')),\n                ('teacher', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, to=settings.AUTH_USER_MODEL)),\n                ('grade', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, to='core.grade')),\n                ('subject', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, to='core.subject')),\n            ],\n        ),\n        migrations.CreateModel(\n            name='UploadedDocument',\n            fields=[\n                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),\n                ('title', models.CharField(max_length=200)),\n                ('type', models.CharField(choices=[('lesson_plan', 'Lesson Plan'), ('homework', 'Homework'), ('past_paper', 'Past Paper'), ('sample_questions', 'Sample Questions')], max_length=20)),\n                ('file_url', models.URLField()),\n                ('created_at', models.DateTimeField(auto_now_add=True)),\n                ('tags', models.TextField(blank=True)),\n                ('board', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, to='core.examboard')),\n                ('grade', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, to='core.grade')),\n                ('subject', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, to='core.subject')),\n                ('uploaded_by', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, to=settings.AUTH_USER_MODEL)),\n            ],\n        ),\n        migrations.CreateModel(\n            name='UsageQuota',\n            fields=[\n                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),\n                ('lesson_plans_used', models.JSONField(default=dict)),\n                ('assignments_used', models.JSONField(default=dict)),\n                ('user', models.OneToOneField(on_delete=django.db.models.deletion.CASCADE, to=settings.AUTH_USER_MODEL)),\n            ],\n        ),\n        migrations.CreateModel(\n            name='UserProfile',\n            fields=[\n                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),\n                ('role', models.CharField(choices=[('teacher', 'Teacher'), ('admin', 'Admin')], default='teacher', max_length=10)),\n                ('subscription', models.CharField(default='free', max_length=20)),\n                ('user', models.OneToOneField(on_delete=django.db.models.deletion.CASCADE, to=settings.AUTH_USER_MODEL)),\n            ],\n        ),\n    ]\n","path":null,"size_bytes":4752,"size_tokens":null},"django_project/core/models.py":{"content":"from django.db import models\n\n# Create your models here.\n","path":null,"size_bytes":57,"size_tokens":null},"django_project/settings.py":{"content":"\"\"\"\nDjango settings for django_project project.\n\nGenerated by 'django-admin startproject' using Django 5.0.1.\n\nFor more information on this file, see\nhttps://docs.djangoproject.com/en/5.0/topics/settings/\n\nFor the full list of settings and their values, see\nhttps://docs.djangoproject.com/en/5.0/ref/settings/\n\"\"\"\n\nimport os\nfrom pathlib import Path\n\n# Build paths inside the project like this: BASE_DIR / 'subdir'.\nBASE_DIR = Path(__file__).resolve().parent.parent\n\n# Quick-start development settings - unsuitable for production\n# See https://docs.djangoproject.com/en/5.0/howto/deployment/checklist/\n\n# SECURITY WARNING: keep the secret key used in production secret!\nSECRET_KEY = 'django-insecure-4ju2n@$f9d0c=h)_g0lbb%k9&@rf(xa$d$g$&5ri$uf)*gev^4'\n\n# SECURITY WARNING: don't run with debug turned on in production!\nDEBUG = True\n\n# Allowed hosts configuration\n# Works both on Replit and external hosting\nreplit_domains = os.environ.get(\"REPLIT_DOMAINS\", \"\").split(',') if os.environ.get(\"REPLIT_DOMAINS\") else []\ncustom_domain = os.environ.get(\"CUSTOM_DOMAIN\", \"\")  # e.g., \"yourdomain.com\"\nallowed_hosts_env = os.environ.get(\"ALLOWED_HOSTS\", \"\")  # Comma-separated list for external hosting\n\nALLOWED_HOSTS = ['127.0.0.1', 'localhost']\n\n# Add Replit domains (if running on Replit)\nif replit_domains:\n    ALLOWED_HOSTS.extend(replit_domains)\n\n# Add custom domain\nif custom_domain:\n    ALLOWED_HOSTS.append(custom_domain)\n    ALLOWED_HOSTS.append(f\"www.{custom_domain}\")\n\n# Add any additional hosts from ALLOWED_HOSTS env var (for external hosting)\nif allowed_hosts_env:\n    ALLOWED_HOSTS.extend([h.strip() for h in allowed_hosts_env.split(',')])\n\n# CSRF trusted origins\nCSRF_TRUSTED_ORIGINS = [\n    \"http://127.0.0.1:5000\",\n    \"http://localhost:5000\",\n    \"http://127.0.0.1:8000\",\n    \"http://localhost:8000\",\n]\n\n# Add Replit domains to CSRF\nfor domain in replit_domains:\n    CSRF_TRUSTED_ORIGINS.append(f\"https://{domain}\")\n    CSRF_TRUSTED_ORIGINS.append(f\"https://{domain}:5000\")\n\n# Add custom domain to CSRF\nif custom_domain:\n    CSRF_TRUSTED_ORIGINS.append(f\"https://{custom_domain}\")\n    CSRF_TRUSTED_ORIGINS.append(f\"https://www.{custom_domain}\")\n\n# Application definition\n\nINSTALLED_APPS = [\n    'django.contrib.admin',\n    'django.contrib.auth',\n    'django.contrib.contenttypes',\n    'django.contrib.sessions',\n    'django.contrib.messages',\n    'django.contrib.staticfiles',\n    'django.contrib.sites',\n    'compressor',\n    'rest_framework',\n    'rest_framework.authtoken',\n    'corsheaders',\n    'django_filters',\n    'drf_yasg',\n    'allauth',\n    'allauth.account',\n    'allauth.socialaccount',\n    'allauth.socialaccount.providers.google',\n    'allauth.socialaccount.providers.facebook',\n    'core',\n]\n\nSITE_ID = 1\n\nMIDDLEWARE = [\n    'django.middleware.security.SecurityMiddleware',\n    'whitenoise.middleware.WhiteNoiseMiddleware',\n    'django.contrib.sessions.middleware.SessionMiddleware',\n    'corsheaders.middleware.CorsMiddleware',\n    'django.middleware.common.CommonMiddleware',\n    'django.middleware.csrf.CsrfViewMiddleware',\n    'django.contrib.auth.middleware.AuthenticationMiddleware',\n    'django.contrib.messages.middleware.MessageMiddleware',\n    'allauth.account.middleware.AccountMiddleware',\n]\n\nAUTHENTICATION_BACKENDS = [\n    'django.contrib.auth.backends.ModelBackend',\n    'allauth.account.auth_backends.AuthenticationBackend',\n]\n\n# Only use clickjacking protection in deployments because the Development Web View uses\n# iframes and needs to be a cross origin.\nif (\"REPLIT_DEPLOYMENT\" in os.environ):\n    MIDDLEWARE.append('django.middleware.clickjacking.XFrameOptionsMiddleware')\n\nROOT_URLCONF = 'django_project.urls'\n\nTEMPLATES = [\n    {\n        'BACKEND': 'django.template.backends.django.DjangoTemplates',\n        'DIRS': [],\n        'APP_DIRS': True,\n        'OPTIONS': {\n            'context_processors': [\n                'django.template.context_processors.debug',\n                'django.template.context_processors.request',\n                'django.contrib.auth.context_processors.auth',\n                'django.contrib.messages.context_processors.messages',\n                'core.context_processors.announcements',\n            ],\n        },\n    },\n]\n\nWSGI_APPLICATION = 'django_project.wsgi.application'\n\n# Database\n# https://docs.djangoproject.com/en/5.0/ref/settings/#databases\n#\n# DATABASE CONFIGURATION:\n# -----------------------\n# By default, the app uses SQLite (no configuration needed).\n# To switch to PostgreSQL, set these environment variables:\n#   - DATABASE_URL: Full PostgreSQL connection string (recommended)\n#     OR set individual variables:\n#   - POSTGRES_DB: Database name\n#   - POSTGRES_USER: Database username\n#   - POSTGRES_PASSWORD: Database password\n#   - POSTGRES_HOST: Database host (default: localhost)\n#   - POSTGRES_PORT: Database port (default: 5432)\n\n# Check for PostgreSQL configuration\nDATABASE_URL = os.environ.get('DATABASE_URL')\nPOSTGRES_DB = os.environ.get('POSTGRES_DB')\n\nif DATABASE_URL:\n    # Use DATABASE_URL if provided (e.g., from Heroku, Railway, Render, etc.)\n    import re\n    # Parse DATABASE_URL: postgres://user:password@host:port/dbname\n    match = re.match(r'postgres(?:ql)?://([^:]+):([^@]+)@([^:]+):(\\d+)/(.+)', DATABASE_URL)\n    if match:\n        DATABASES = {\n            'default': {\n                'ENGINE': 'django.db.backends.postgresql',\n                'USER': match.group(1),\n                'PASSWORD': match.group(2),\n                'HOST': match.group(3),\n                'PORT': match.group(4),\n                'NAME': match.group(5),\n            }\n        }\n    else:\n        # Fallback to SQLite if URL parsing fails\n        DATABASES = {\n            'default': {\n                'ENGINE': 'django.db.backends.sqlite3',\n                'NAME': BASE_DIR / 'db.sqlite3',\n            }\n        }\nelif POSTGRES_DB:\n    # Use individual PostgreSQL environment variables\n    DATABASES = {\n        'default': {\n            'ENGINE': 'django.db.backends.postgresql',\n            'NAME': POSTGRES_DB,\n            'USER': os.environ.get('POSTGRES_USER', 'postgres'),\n            'PASSWORD': os.environ.get('POSTGRES_PASSWORD', ''),\n            'HOST': os.environ.get('POSTGRES_HOST', 'localhost'),\n            'PORT': os.environ.get('POSTGRES_PORT', '5432'),\n        }\n    }\nelse:\n    # Default: Use SQLite for local development\n    DATABASES = {\n        'default': {\n            'ENGINE': 'django.db.backends.sqlite3',\n            'NAME': BASE_DIR / 'db.sqlite3',\n        }\n    }\n\n# Password validation\n# https://docs.djangoproject.com/en/5.0/ref/settings/#auth-password-validators\n\nAUTH_PASSWORD_VALIDATORS = [\n    {\n        'NAME':\n        'django.contrib.auth.password_validation.UserAttributeSimilarityValidator',\n    },\n    {\n        'NAME':\n        'django.contrib.auth.password_validation.MinimumLengthValidator',\n    },\n    {\n        'NAME':\n        'django.contrib.auth.password_validation.CommonPasswordValidator',\n    },\n    {\n        'NAME':\n        'django.contrib.auth.password_validation.NumericPasswordValidator',\n    },\n]\n\n# Internationalization\n# https://docs.djangoproject.com/en/5.0/topics/i18n/\n\nLANGUAGE_CODE = 'en-us'\n\nTIME_ZONE = 'UTC'\n\nUSE_I18N = True\n\nUSE_TZ = True\n\n# Static files (CSS, JavaScript, Images)\n# https://docs.djangoproject.com/en/5.0/howto/static-files/\n\nSTATIC_URL = 'static/'\nSTATIC_ROOT = BASE_DIR / 'staticfiles'\nSTATICFILES_DIRS = [BASE_DIR / 'static'] if (BASE_DIR / 'static').exists() else []\n\n# WhiteNoise configuration for serving static files with compression\nSTATICFILES_STORAGE = 'whitenoise.storage.CompressedManifestStaticFilesStorage'\n\n# Django Compressor settings\nSTATICFILES_FINDERS = [\n    'django.contrib.staticfiles.finders.FileSystemFinder',\n    'django.contrib.staticfiles.finders.AppDirectoriesFinder',\n    'compressor.finders.CompressorFinder',\n]\n\nCOMPRESS_ENABLED = True\nCOMPRESS_OFFLINE = True\nCOMPRESS_CSS_FILTERS = ['compressor.filters.css_default.CssAbsoluteFilter', 'compressor.filters.cssmin.CSSMinFilter']\nCOMPRESS_JS_FILTERS = ['compressor.filters.jsmin.JSMinFilter']\n\n# Media files (uploaded content)\nMEDIA_URL = '/media/'\nMEDIA_ROOT = BASE_DIR / 'media'\n\n# File upload settings - Increase limits for bulk uploads\nDATA_UPLOAD_MAX_NUMBER_FILES = 5000  # Allow up to 5000 files in a single upload\nDATA_UPLOAD_MAX_MEMORY_SIZE = None  # No limit on total request size (handles 600+ GB uploads)\nFILE_UPLOAD_MAX_MEMORY_SIZE = 2621440  # 2.5 MB - files larger than this stream to disk (not memory)\n\n# Email configuration\nEMAIL_BACKEND = 'django.core.mail.backends.smtp.EmailBackend'\nEMAIL_HOST = 'smtp.gmail.com'\nEMAIL_PORT = 587\nEMAIL_USE_TLS = True\nEMAIL_HOST_USER = os.environ.get('EMAIL_HOST_USER')\nEMAIL_HOST_PASSWORD = os.environ.get('EMAIL_HOST_PASSWORD')\nDEFAULT_FROM_EMAIL = EMAIL_HOST_USER\n\n# Default primary key field type\n# https://docs.djangoproject.com/en/5.0/ref/settings/#default-auto-field\n\nDEFAULT_AUTO_FIELD = 'django.db.models.BigAutoField'\n\n# Authentication URLs\nLOGIN_URL = '/login/'\nLOGIN_REDIRECT_URL = '/'\nLOGOUT_REDIRECT_URL = '/login/'\n\n# PayFast Payment Configuration\n# Get these credentials from https://www.payfast.co.za after signing up\n# For testing, use the sandbox credentials from PayFast developer portal\nPAYFAST_MERCHANT_ID = os.environ.get('PAYFAST_MERCHANT_ID', '10000100')  # Sandbox merchant ID\nPAYFAST_MERCHANT_KEY = os.environ.get('PAYFAST_MERCHANT_KEY', '46f0cd694581a')  # Sandbox merchant key\nPAYFAST_PASSPHRASE = os.environ.get('PAYFAST_PASSPHRASE', 'jt7NOE43FZPn')  # Your passphrase for signature generation\n\n# PayFast URLs\nPAYFAST_USE_SANDBOX = os.environ.get('PAYFAST_USE_SANDBOX', 'True').lower() == 'true'\nPAYFAST_URL = 'https://sandbox.payfast.co.za/eng/process' if PAYFAST_USE_SANDBOX else 'https://www.payfast.co.za/eng/process'\nPAYFAST_VALIDATE_URL = 'https://sandbox.payfast.co.za/eng/query/validate' if PAYFAST_USE_SANDBOX else 'https://www.payfast.co.za/eng/query/validate'\n\n# Site URL for PayFast callbacks\nSITE_URL = f\"https://{os.environ.get('REPLIT_DEV_DOMAIN', 'localhost:5000')}\"\n\n# Django REST Framework Configuration\nREST_FRAMEWORK = {\n    'DEFAULT_AUTHENTICATION_CLASSES': [\n        'rest_framework.authentication.TokenAuthentication',\n        'rest_framework.authentication.SessionAuthentication',\n    ],\n    'DEFAULT_PERMISSION_CLASSES': [\n        'rest_framework.permissions.IsAuthenticated',\n    ],\n    'DEFAULT_FILTER_BACKENDS': [\n        'django_filters.rest_framework.DjangoFilterBackend',\n        'rest_framework.filters.SearchFilter',\n        'rest_framework.filters.OrderingFilter',\n    ],\n    'DEFAULT_PAGINATION_CLASS': 'rest_framework.pagination.PageNumberPagination',\n    'PAGE_SIZE': 50,\n}\n\n# CORS Configuration for Mobile Apps\nCORS_ALLOW_ALL_ORIGINS = True  # For development - restrict this in production\nCORS_ALLOW_CREDENTIALS = True\nCORS_ALLOWED_ORIGINS = [\n    \"http://localhost:3000\",\n    \"http://127.0.0.1:3000\",\n]\n\n# Django-allauth Configuration\nACCOUNT_LOGIN_METHODS = {'email', 'username'}\nACCOUNT_SIGNUP_FIELDS = ['email*', 'username*', 'password1*', 'password2*']\nACCOUNT_EMAIL_VERIFICATION = 'optional'\nACCOUNT_LOGIN_ON_GET = True\nSOCIALACCOUNT_AUTO_SIGNUP = True\nSOCIALACCOUNT_LOGIN_ON_GET = True\n\nSOCIALACCOUNT_PROVIDERS = {\n    'google': {\n        'SCOPE': ['profile', 'email'],\n        'AUTH_PARAMS': {'access_type': 'online'},\n        'APP': {\n            'client_id': os.environ.get('GOOGLE_CLIENT_ID', ''),\n            'secret': os.environ.get('GOOGLE_CLIENT_SECRET', ''),\n        }\n    },\n    'facebook': {\n        'METHOD': 'oauth2',\n        'SCOPE': ['email', 'public_profile'],\n        'FIELDS': ['id', 'email', 'name', 'first_name', 'last_name'],\n        'VERSION': 'v19.0',\n        'APP': {\n            'client_id': os.environ.get('FACEBOOK_APP_ID', ''),\n            'secret': os.environ.get('FACEBOOK_APP_SECRET', ''),\n        }\n    }\n}\n\n# =============================================================================\n# PERFORMANCE OPTIMIZATION SETTINGS\n# =============================================================================\n\n# Caching Configuration\n# Uses local memory cache for development, can switch to Redis for production\nREDIS_URL = os.environ.get('REDIS_URL')\nif REDIS_URL:\n    CACHES = {\n        'default': {\n            'BACKEND': 'django.core.cache.backends.redis.RedisCache',\n            'LOCATION': REDIS_URL,\n        }\n    }\nelse:\n    CACHES = {\n        'default': {\n            'BACKEND': 'django.core.cache.backends.locmem.LocMemCache',\n            'LOCATION': 'unique-snowflake',\n        }\n    }\n\n# Cache timeouts (in seconds)\nCACHE_MIDDLEWARE_SECONDS = 300  # 5 minutes\nCACHE_MIDDLEWARE_KEY_PREFIX = 'edutech'\n\n# Session configuration for performance\nSESSION_ENGINE = 'django.contrib.sessions.backends.cached_db'\nSESSION_CACHE_ALIAS = 'default'\n\n# Database query optimization\n# Enable connection pooling for PostgreSQL\nif DATABASE_URL or POSTGRES_DB:\n    DATABASES['default']['CONN_MAX_AGE'] = 600  # Keep connections open for 10 minutes\n    DATABASES['default']['CONN_HEALTH_CHECKS'] = True\n\n# Security headers (also improves perceived performance)\nSECURE_BROWSER_XSS_FILTER = True\nSECURE_CONTENT_TYPE_NOSNIFF = True\n\n# GZip compression for responses\nGIT_COMPRESSION_MIDDLEWARE = True\n","path":null,"size_bytes":13204,"size_tokens":null},"django_project/core/__init__.py":{"content":"","path":null,"size_bytes":0,"size_tokens":null},"core/views.py":{"content":"from django.shortcuts import render, redirect, get_object_or_404\nfrom django.contrib.auth import authenticate, login, logout, update_session_auth_hash\nfrom django.contrib.auth.decorators import login_required\nfrom django.contrib.auth.models import User\nfrom django.contrib import messages\nfrom django.http import JsonResponse, HttpResponse, Http404\nfrom django.views.decorators.csrf import csrf_exempt\nfrom django.views.decorators.http import require_http_methods\nfrom django.core.files.storage import default_storage\nfrom django.core.mail import send_mail\nfrom django.conf import settings\nfrom django.urls import reverse\nfrom django.utils import timezone\nfrom django.db import IntegrityError\nfrom django.db.models import Q\nimport json\nimport uuid\nimport os\nimport mimetypes\nimport secrets\nfrom datetime import timedelta\nfrom .models import Subject, Grade, ExamBoard, UserProfile, UploadedDocument, GeneratedAssignment, UsageQuota, ClassGroup, AssignmentShare, PasswordResetToken, SubscribedSubject, SubscriptionPlan\nfrom .openai_service import generate_lesson_plan, generate_homework, generate_questions\nfrom .subscription_utils import require_premium, get_user_subscription\n\ndef teacher_landing(request):\n    \"\"\"Teacher portal landing page with animations\"\"\"\n    return render(request, 'core/teacher_landing.html')\n\ndef student_landing(request):\n    \"\"\"Student portal landing page with animations\"\"\"\n    return render(request, 'core/student_landing.html')\n\ndef login_view(request):\n    if request.method == 'POST':\n        username_or_email = request.POST['username']\n        password = request.POST['password']\n        \n        # Determine if input is email or username\n        username = username_or_email\n        if '@' in username_or_email:\n            # Input might be email - try to look up username\n            try:\n                user_by_email = User.objects.get(email=username_or_email)\n                username = user_by_email.username\n            except User.DoesNotExist:\n                # Email not found - treat as username (in case username contains @)\n                username = username_or_email\n        \n        # Check if user exists and is inactive (unverified)\n        try:\n            existing_user = User.objects.get(username=username)\n            if not existing_user.is_active:\n                messages.error(request, 'Please verify your email address before signing in. Check your inbox for the verification link.')\n                return render(request, 'core/login.html')\n        except User.DoesNotExist:\n            pass\n        \n        # Authenticate active user\n        user = authenticate(request, username=username, password=password)\n        if user is not None:\n            # Check if this is a student account\n            if hasattr(user, 'student_profile'):\n                messages.error(request, 'This is a student account. Please use the student login page.')\n                return render(request, 'core/login.html', {'show_student_link': True})\n            \n            login(request, user)\n            # Redirect based on user role (3-way routing)\n            if user.is_superuser or user.is_staff:\n                # Admins go to admin panel\n                return redirect('admin_dashboard')\n            elif hasattr(user, 'userprofile') and user.userprofile.role == 'content_manager':\n                # Content managers go to content portal\n                return redirect('content_dashboard')\n            else:\n                # Teachers go to teacher dashboard\n                return redirect('dashboard')\n        else:\n            messages.error(request, 'Invalid credentials. Please check your username/email and password.')\n    return render(request, 'core/login.html')\n\ndef logout_view(request):\n    logout(request)\n    return redirect('login')\n\ndef require_teacher(view_func):\n    \"\"\"Decorator to ensure user is a teacher (not admin, content manager, or student)\"\"\"\n    @login_required\n    def wrapper(request, *args, **kwargs):\n        # Redirect students to their own portal (no message to avoid accumulation)\n        if hasattr(request.user, 'student_profile'):\n            if not request.user.student_profile.onboarding_completed:\n                return redirect('student_onboarding')\n            return redirect('student_dashboard')\n        \n        # Redirect admins to admin panel\n        if request.user.is_superuser or request.user.is_staff:\n            return redirect('admin_dashboard')\n        \n        # Redirect content managers to content portal\n        if hasattr(request.user, 'userprofile') and request.user.userprofile.role == 'content_manager':\n            return redirect('content_dashboard')\n        \n        # Proceed with teacher view\n        return view_func(request, *args, **kwargs)\n    return wrapper\n\n@require_teacher\ndef dashboard_view(request):\n    # All role checks passed - safe to run teacher-specific queries\n    profile = UserProfile.objects.get_or_create(user=request.user)[0]\n    quota = UsageQuota.objects.get_or_create(user=request.user)[0]\n    \n    context = {\n        'user_profile': profile,\n        'quota': quota,\n        'total_documents': UploadedDocument.objects.filter(uploaded_by=request.user).count(),\n        'total_assignments': GeneratedAssignment.objects.filter(teacher=request.user).count(),\n    }\n    return render(request, 'core/dashboard.html', context)\n\n@login_required\ndef lesson_plans_view(request):\n    subscribed_subjects = SubscribedSubject.objects.filter(user=request.user).select_related('subject')\n    grades = Grade.objects.all().order_by('number')\n    boards = ExamBoard.objects.all().order_by('name_full')\n    \n    my_documents = UploadedDocument.objects.filter(\n        uploaded_by=request.user,\n        type='lesson_plan'\n    ).order_by('-created_at')\n    \n    shared_documents = AssignmentShare.objects.filter(\n        teacher=request.user,\n        uploaded_document__type='lesson_plan',\n        revoked_at__isnull=True\n    ).select_related('class_group', 'uploaded_document').order_by('-shared_at')\n    \n    context = {\n        'document_type': 'lesson_plan',\n        'document_type_display': 'Lesson Plans',\n        'subscribed_subjects': subscribed_subjects,\n        'grades': grades,\n        'boards': boards,\n        'my_documents': my_documents,\n        'shared_documents': shared_documents,\n    }\n    \n    return render(request, 'core/document_type_base.html', context)\n\n@login_required\ndef classwork_view(request):\n    from .models import TeacherAssessment, ContentShare\n    subscribed_subjects = SubscribedSubject.objects.filter(user=request.user).select_related('subject')\n    grades = Grade.objects.all().order_by('number')\n    boards = ExamBoard.objects.all().order_by('name_full')\n    \n    my_documents = UploadedDocument.objects.filter(\n        uploaded_by=request.user,\n        type='classwork'\n    ).order_by('-created_at')\n    \n    shared_documents = AssignmentShare.objects.filter(\n        teacher=request.user,\n        uploaded_document__type='classwork',\n        revoked_at__isnull=True\n    ).select_related('class_group', 'uploaded_document').order_by('-shared_at')\n    \n    # Get teacher-created assessments\n    my_assessments = TeacherAssessment.objects.filter(\n        teacher=request.user,\n        category='classwork'\n    ).order_by('-created_at')\n    \n    # Get shared content (via ContentShare tokens)\n    shared_assessments = ContentShare.objects.filter(\n        teacher=request.user,\n        assessment__isnull=False,\n        assessment__category='classwork',\n        is_active=True\n    ).select_related('assessment', 'assessment__subject', 'assessment__grade').order_by('-created_at')\n    \n    shared_docs = ContentShare.objects.filter(\n        teacher=request.user,\n        document__isnull=False,\n        document__type='classwork',\n        is_active=True\n    ).select_related('document').order_by('-created_at')\n    \n    # Add has_share flag to assessments and documents\n    shared_assessment_ids = set(shared_assessments.values_list('assessment_id', flat=True))\n    shared_doc_ids = set(shared_docs.values_list('document_id', flat=True))\n    \n    for assessment in my_assessments:\n        assessment.has_share = assessment.id in shared_assessment_ids\n    \n    for doc in my_documents:\n        doc.has_share = doc.id in shared_doc_ids\n    \n    context = {\n        'document_type': 'classwork',\n        'document_type_display': 'Classwork',\n        'subscribed_subjects': subscribed_subjects,\n        'grades': grades,\n        'boards': boards,\n        'my_documents': my_documents,\n        'shared_documents': shared_documents,\n        'my_assessments': my_assessments,\n        'shared_assessments': shared_assessments,\n        'shared_docs': shared_docs,\n    }\n    \n    return render(request, 'core/document_type_base.html', context)\n\n@login_required\ndef homework_view(request):\n    from .models import TeacherAssessment, ContentShare\n    subscribed_subjects = SubscribedSubject.objects.filter(user=request.user).select_related('subject')\n    grades = Grade.objects.all().order_by('number')\n    boards = ExamBoard.objects.all().order_by('name_full')\n    \n    my_documents = UploadedDocument.objects.filter(\n        uploaded_by=request.user,\n        type='homework'\n    ).order_by('-created_at')\n    \n    shared_documents = AssignmentShare.objects.filter(\n        teacher=request.user,\n        uploaded_document__type='homework',\n        revoked_at__isnull=True\n    ).select_related('class_group', 'uploaded_document').order_by('-shared_at')\n    \n    # Get teacher-created assessments\n    my_assessments = TeacherAssessment.objects.filter(\n        teacher=request.user,\n        category='homework'\n    ).order_by('-created_at')\n    \n    # Get shared content (via ContentShare tokens)\n    shared_assessments = ContentShare.objects.filter(\n        teacher=request.user,\n        assessment__isnull=False,\n        assessment__category='homework',\n        is_active=True\n    ).select_related('assessment', 'assessment__subject', 'assessment__grade').order_by('-created_at')\n    \n    shared_docs = ContentShare.objects.filter(\n        teacher=request.user,\n        document__isnull=False,\n        document__type='homework',\n        is_active=True\n    ).select_related('document').order_by('-created_at')\n    \n    # Add has_share flag to assessments and documents\n    shared_assessment_ids = set(shared_assessments.values_list('assessment_id', flat=True))\n    shared_doc_ids = set(shared_docs.values_list('document_id', flat=True))\n    \n    for assessment in my_assessments:\n        assessment.has_share = assessment.id in shared_assessment_ids\n    \n    for doc in my_documents:\n        doc.has_share = doc.id in shared_doc_ids\n    \n    context = {\n        'document_type': 'homework',\n        'document_type_display': 'Homework',\n        'subscribed_subjects': subscribed_subjects,\n        'grades': grades,\n        'boards': boards,\n        'my_documents': my_documents,\n        'shared_documents': shared_documents,\n        'my_assessments': my_assessments,\n        'shared_assessments': shared_assessments,\n        'shared_docs': shared_docs,\n    }\n    \n    return render(request, 'core/document_type_base.html', context)\n\n@login_required\ndef tests_view(request):\n    from .models import TeacherAssessment, ContentShare\n    subscribed_subjects = SubscribedSubject.objects.filter(user=request.user).select_related('subject')\n    grades = Grade.objects.all().order_by('number')\n    boards = ExamBoard.objects.all().order_by('name_full')\n    \n    my_documents = UploadedDocument.objects.filter(\n        uploaded_by=request.user,\n        type='test'\n    ).order_by('-created_at')\n    \n    shared_documents = AssignmentShare.objects.filter(\n        teacher=request.user,\n        uploaded_document__type='test',\n        revoked_at__isnull=True\n    ).select_related('class_group', 'uploaded_document').order_by('-shared_at')\n    \n    # Get teacher-created assessments\n    my_assessments = TeacherAssessment.objects.filter(\n        teacher=request.user,\n        category='test'\n    ).order_by('-created_at')\n    \n    # Get shared content (via ContentShare tokens)\n    shared_assessments = ContentShare.objects.filter(\n        teacher=request.user,\n        assessment__isnull=False,\n        assessment__category='test',\n        is_active=True\n    ).select_related('assessment', 'assessment__subject', 'assessment__grade').order_by('-created_at')\n    \n    shared_docs = ContentShare.objects.filter(\n        teacher=request.user,\n        document__isnull=False,\n        document__type='test',\n        is_active=True\n    ).select_related('document').order_by('-created_at')\n    \n    # Add has_share flag to assessments and documents\n    shared_assessment_ids = set(shared_assessments.values_list('assessment_id', flat=True))\n    shared_doc_ids = set(shared_docs.values_list('document_id', flat=True))\n    \n    for assessment in my_assessments:\n        assessment.has_share = assessment.id in shared_assessment_ids\n    \n    for doc in my_documents:\n        doc.has_share = doc.id in shared_doc_ids\n    \n    context = {\n        'document_type': 'test',\n        'document_type_display': 'Tests',\n        'subscribed_subjects': subscribed_subjects,\n        'grades': grades,\n        'boards': boards,\n        'my_documents': my_documents,\n        'shared_documents': shared_documents,\n        'my_assessments': my_assessments,\n        'shared_assessments': shared_assessments,\n        'shared_docs': shared_docs,\n    }\n    \n    return render(request, 'core/document_type_base.html', context)\n\n@login_required\ndef exams_view(request):\n    from .models import TeacherAssessment, ContentShare\n    subscribed_subjects = SubscribedSubject.objects.filter(user=request.user).select_related('subject')\n    grades = Grade.objects.all().order_by('number')\n    boards = ExamBoard.objects.all().order_by('name_full')\n    \n    my_documents = UploadedDocument.objects.filter(\n        uploaded_by=request.user,\n        type='exam'\n    ).order_by('-created_at')\n    \n    shared_documents = AssignmentShare.objects.filter(\n        teacher=request.user,\n        uploaded_document__type='exam',\n        revoked_at__isnull=True\n    ).select_related('class_group', 'uploaded_document').order_by('-shared_at')\n    \n    # Get teacher-created assessments\n    my_assessments = TeacherAssessment.objects.filter(\n        teacher=request.user,\n        category='exam'\n    ).order_by('-created_at')\n    \n    # Get shared content (via ContentShare tokens)\n    shared_assessments = ContentShare.objects.filter(\n        teacher=request.user,\n        assessment__isnull=False,\n        assessment__category='exam',\n        is_active=True\n    ).select_related('assessment', 'assessment__subject', 'assessment__grade').order_by('-created_at')\n    \n    shared_docs = ContentShare.objects.filter(\n        teacher=request.user,\n        document__isnull=False,\n        document__type='exam',\n        is_active=True\n    ).select_related('document').order_by('-created_at')\n    \n    # Add has_share flag to assessments and documents\n    shared_assessment_ids = set(shared_assessments.values_list('assessment_id', flat=True))\n    shared_doc_ids = set(shared_docs.values_list('document_id', flat=True))\n    \n    for assessment in my_assessments:\n        assessment.has_share = assessment.id in shared_assessment_ids\n    \n    for doc in my_documents:\n        doc.has_share = doc.id in shared_doc_ids\n    \n    context = {\n        'document_type': 'exam',\n        'document_type_display': 'Exams',\n        'subscribed_subjects': subscribed_subjects,\n        'grades': grades,\n        'boards': boards,\n        'my_documents': my_documents,\n        'shared_documents': shared_documents,\n        'my_assessments': my_assessments,\n        'shared_assessments': shared_assessments,\n        'shared_docs': shared_docs,\n    }\n    \n    return render(request, 'core/document_type_base.html', context)\n\n@login_required\ndef assignments_view(request):\n    if request.method == 'POST' and 'upload_file' in request.POST:\n        # Handle file upload for assignments\n        from core.models import SubscribedSubject\n        title = request.POST.get('title')\n        subject_id = request.POST.get('subject')\n        grade_id = request.POST.get('grade')\n        board_id = request.POST.get('board')\n        uploaded_file = request.FILES.get('file')\n        \n        if all([title, subject_id, grade_id, board_id, uploaded_file]):\n            # Validate subject is subscribed\n            if not SubscribedSubject.objects.filter(user=request.user, subject_id=subject_id).exists():\n                messages.error(request, 'You can only upload assignments for your subscribed subjects.')\n                return redirect('assignments')\n            \n            document = UploadedDocument(\n                uploaded_by=request.user,\n                title=title,\n                subject_id=subject_id,\n                grade_id=grade_id,\n                board_id=board_id,\n                type='homework',\n                file=uploaded_file\n            )\n            document.save()\n            messages.success(request, 'Assignment uploaded successfully!')\n        else:\n            messages.error(request, 'Please fill all required fields.')\n    \n    # Get user's subscribed subjects\n    from core.models import SubscribedSubject\n    user_subject_ids = SubscribedSubject.objects.filter(user=request.user).values_list('subject_id', flat=True)\n    \n    # Filter assignments by subscribed subjects\n    assignments = GeneratedAssignment.objects.filter(\n        teacher=request.user,\n        subject_id__in=user_subject_ids\n    ).order_by('-created_at')\n    \n    uploaded_assignments = UploadedDocument.objects.filter(\n        uploaded_by=request.user,\n        type='homework',\n        subject_id__in=user_subject_ids\n    ).order_by('-created_at')\n    \n    # Add sharing status to assignments for visual indicators\n    for assignment in assignments:\n        assignment.active_shares = AssignmentShare.objects.filter(\n            generated_assignment=assignment,\n            revoked_at__isnull=True\n        ).count()\n        assignment.is_shared = assignment.active_shares > 0\n    \n    for document in uploaded_assignments:\n        document.active_shares = AssignmentShare.objects.filter(\n            uploaded_document=document,\n            revoked_at__isnull=True\n        ).count()\n        document.is_shared = document.active_shares > 0\n    \n    # Get shared assignments for the shared assignments tab\n    shared_assignments = AssignmentShare.objects.filter(\n        teacher=request.user\n    ).select_related(\n        'class_group', 'generated_assignment', 'uploaded_document'\n    ).order_by('-shared_at')\n    \n    # Get teacher's classes for sharing modal\n    teacher_classes = ClassGroup.objects.filter(teacher=request.user, is_active=True).order_by('name')\n    \n    # Only show subscribed subjects in the dropdown\n    available_subjects = Subject.objects.filter(id__in=user_subject_ids)\n    \n    # Get teacher-created assessments\n    from .models import TeacherAssessment, ContentShare\n    my_assessments = TeacherAssessment.objects.filter(\n        teacher=request.user,\n        category='assignment'\n    ).order_by('-created_at')\n    \n    # Get shared content (via ContentShare tokens)\n    shared_assessments_content = ContentShare.objects.filter(\n        teacher=request.user,\n        assessment__isnull=False,\n        assessment__category='assignment',\n        is_active=True\n    ).select_related('assessment', 'assessment__subject', 'assessment__grade').order_by('-created_at')\n    \n    shared_docs = ContentShare.objects.filter(\n        teacher=request.user,\n        document__isnull=False,\n        document__type='assignment',\n        is_active=True\n    ).select_related('document').order_by('-created_at')\n    \n    context = {\n        'assignments': assignments,\n        'uploaded_assignments': uploaded_assignments,\n        'documents': uploaded_assignments,  # For backward compatibility with template\n        'shared_assignments': shared_assignments,\n        'subjects': available_subjects,\n        'grades': Grade.objects.all(),\n        'exam_boards': ExamBoard.objects.all(),\n        'teacher_classes': teacher_classes,\n        'my_assessments': my_assessments,\n        'shared_assessments': shared_assessments_content,\n        'shared_docs': shared_docs,\n    }\n    return render(request, 'core/assignments.html', context)\n\n@login_required\ndef questions_view(request):\n    # Get user's subscribed subjects\n    from core.models import SubscribedSubject\n    user_subject_ids = SubscribedSubject.objects.filter(user=request.user).values_list('subject_id', flat=True)\n    \n    # Only show subscribed subjects in the dropdown\n    available_subjects = Subject.objects.filter(id__in=user_subject_ids)\n    \n    context = {\n        'subjects': available_subjects,\n        'grades': Grade.objects.all(),\n        'exam_boards': ExamBoard.objects.all(),\n    }\n    return render(request, 'core/questions.html', context)\n\n@login_required\ndef documents_view(request):\n    # Get user's subscribed subjects\n    subscribed_subjects = SubscribedSubject.objects.filter(user=request.user).select_related('subject')\n    user_subject_ids = subscribed_subjects.values_list('subject_id', flat=True)\n    \n    # Filter documents by subscribed subjects\n    documents = UploadedDocument.objects.filter(\n        uploaded_by=request.user,\n        subject_id__in=user_subject_ids\n    ).select_related('subject', 'grade', 'board').order_by('-created_at')\n    \n    context = {\n        'documents': documents,\n        'subscribed_subjects': subscribed_subjects,\n        'subjects': Subject.objects.filter(id__in=user_subject_ids),  # for backward compatibility\n        'grades': Grade.objects.all().order_by('number'),\n        'boards': ExamBoard.objects.all().order_by('name_full'),\n        'exam_boards': ExamBoard.objects.all().order_by('name_full'),  # for backward compatibility\n    }\n    return render(request, 'core/documents.html', context)\n\n@login_required\ndef upload_document(request):\n    \"\"\"Handle document upload from My Documents page or specific document type pages\"\"\"\n    if request.method == 'POST':\n        try:\n            title = request.POST.get('title')\n            doc_type = request.POST.get('type') or request.POST.get('document_type', 'general')\n            subject_id = request.POST.get('subject')\n            grade_id = request.POST.get('grade')\n            board_id = request.POST.get('board')\n            tags = request.POST.get('tags', '')\n            file = request.FILES.get('file')\n            \n            # Validate required fields\n            if not all([title, subject_id, grade_id, board_id, file]):\n                messages.error(request, 'All fields are required.')\n                return redirect(request.META.get('HTTP_REFERER', 'documents'))\n            \n            # Validate user has access to this subject\n            if not SubscribedSubject.objects.filter(user=request.user, subject_id=subject_id).exists():\n                messages.error(request, 'You do not have access to this subject. Please check your subscription.')\n                return redirect(request.META.get('HTTP_REFERER', 'documents'))\n            \n            # Create document\n            document = UploadedDocument(\n                uploaded_by=request.user,\n                title=title,\n                type=doc_type,\n                subject_id=subject_id,\n                grade_id=grade_id,\n                board_id=board_id,\n                tags=tags,\n                file=file\n            )\n            document.save()\n            \n            messages.success(request, f'Document \"{title}\" uploaded successfully!')\n            \n            # Redirect back to referring page or documents view\n            return redirect(request.META.get('HTTP_REFERER', 'documents'))\n            \n        except Exception as e:\n            messages.error(request, f'Error uploading document: {str(e)}')\n            return redirect(request.META.get('HTTP_REFERER', 'documents'))\n    \n    return redirect('documents')\n\n@login_required\ndef subscription_view(request):\n    profile = UserProfile.objects.get_or_create(user=request.user)[0]\n    quota = UsageQuota.objects.get_or_create(user=request.user)[0]\n    \n    context = {\n        'user_profile': profile,\n        'quota': quota,\n    }\n    return render(request, 'core/subscription.html', context)\n\n@login_required\ndef classes_view(request):\n    \"\"\"View for managing teacher's classes\"\"\"\n    classes = ClassGroup.objects.filter(teacher=request.user, is_active=True).order_by('name')\n    subjects = Subject.objects.all()\n    grades = Grade.objects.all()\n    \n    context = {\n        'classes': classes,\n        'subjects': subjects,\n        'grades': grades,\n    }\n    return render(request, 'core/classes.html', context)\n\n@login_required\ndef create_class(request):\n    \"\"\"Create a new class\"\"\"\n    if request.method == 'POST':\n        try:\n            name = request.POST.get('name', '').strip()\n            description = request.POST.get('description', '').strip()\n            subject_id = request.POST.get('subject')\n            grade_id = request.POST.get('grade')\n            \n            if not name:\n                messages.error(request, 'Class name is required.')\n                return redirect('classes')\n            \n            # Check for duplicate class name\n            if ClassGroup.objects.filter(teacher=request.user, name=name, is_active=True).exists():\n                messages.error(request, f'You already have a class named \"{name}\".')\n                return redirect('classes')\n            \n            # Create the class\n            class_group = ClassGroup(\n                teacher=request.user,\n                name=name,\n                description=description\n            )\n            \n            if subject_id:\n                try:\n                    class_group.subject = Subject.objects.get(id=subject_id)\n                except Subject.DoesNotExist:\n                    pass\n            \n            if grade_id:\n                try:\n                    class_group.grade = Grade.objects.get(id=grade_id)\n                except Grade.DoesNotExist:\n                    pass\n            \n            class_group.save()\n            messages.success(request, f'Class \"{name}\" created successfully!')\n            \n        except Exception as e:\n            messages.error(request, f'Error creating class: {str(e)}')\n    \n    return redirect('classes')\n\n@login_required\ndef edit_class(request, class_id):\n    \"\"\"Edit an existing class\"\"\"\n    try:\n        class_group = ClassGroup.objects.get(id=class_id, teacher=request.user, is_active=True)\n        \n        if request.method == 'POST':\n            name = request.POST.get('name', '').strip()\n            description = request.POST.get('description', '').strip()\n            subject_id = request.POST.get('subject')\n            grade_id = request.POST.get('grade')\n            \n            if not name:\n                messages.error(request, 'Class name is required.')\n                return redirect('classes')\n            \n            # Check for duplicate class name (excluding current class)\n            if ClassGroup.objects.filter(teacher=request.user, name=name, is_active=True).exclude(id=class_id).exists():\n                messages.error(request, f'You already have a class named \"{name}\".')\n                return redirect('classes')\n            \n            # Update the class\n            class_group.name = name\n            class_group.description = description\n            \n            if subject_id:\n                try:\n                    class_group.subject = Subject.objects.get(id=subject_id)\n                except Subject.DoesNotExist:\n                    class_group.subject = None\n            else:\n                class_group.subject = None\n            \n            if grade_id:\n                try:\n                    class_group.grade = Grade.objects.get(id=grade_id)\n                except Grade.DoesNotExist:\n                    class_group.grade = None\n            else:\n                class_group.grade = None\n            \n            class_group.save()\n            messages.success(request, f'Class \"{name}\" updated successfully!')\n            \n    except ClassGroup.DoesNotExist:\n        messages.error(request, 'Class not found or you do not have permission to edit it.')\n    except Exception as e:\n        messages.error(request, f'Error updating class: {str(e)}')\n    \n    return redirect('classes')\n\n@login_required\ndef delete_class(request, class_id):\n    \"\"\"Delete (deactivate) a class\"\"\"\n    if request.method == 'POST':\n        try:\n            class_group = ClassGroup.objects.get(id=class_id, teacher=request.user, is_active=True)\n            \n            # Check if class has active shares\n            active_shares = AssignmentShare.objects.filter(class_group=class_group, revoked_at__isnull=True).count()\n            if active_shares > 0:\n                messages.error(request, f'Cannot delete class \"{class_group.name}\" because it has {active_shares} active shared assignments. Please revoke all shares first.')\n                return redirect('classes')\n            \n            # Soft delete by marking as inactive\n            class_group.is_active = False\n            class_group.save()\n            messages.success(request, f'Class \"{class_group.name}\" deleted successfully!')\n            \n        except ClassGroup.DoesNotExist:\n            messages.error(request, 'Class not found or you do not have permission to delete it.')\n        except Exception as e:\n            messages.error(request, f'Error deleting class: {str(e)}')\n    \n    return redirect('classes')\n\n@login_required\ndef delete_document(request, doc_id):\n    \"\"\"Delete a document\"\"\"\n    if request.method == 'POST':\n        document = get_object_or_404(UploadedDocument, id=doc_id, uploaded_by=request.user)\n        doc_type = document.type\n        document.delete()\n        messages.success(request, 'Document deleted successfully!')\n        \n        # Redirect based on document type\n        if doc_type == 'lesson_plan':\n            return redirect('lesson_plans')\n        else:\n            return redirect('documents')\n    \n    return redirect('documents')\n\n@login_required\ndef download_document(request, doc_id):\n    \"\"\"Securely download a document file with owner authorization\"\"\"\n    document = get_object_or_404(UploadedDocument, id=doc_id, uploaded_by=request.user)\n    \n    if document.file and os.path.exists(document.file.path):\n        # Get proper content type\n        content_type, _ = mimetypes.guess_type(document.file.name)\n        if not content_type:\n            content_type = 'application/octet-stream'\n        \n        # Secure file serving\n        with open(document.file.path, 'rb') as f:\n            response = HttpResponse(f.read(), content_type=content_type)\n            # Get file extension for proper filename\n            filename = f\"{document.title}{os.path.splitext(document.file.name)[1]}\"\n            response['Content-Disposition'] = f'attachment; filename=\"{filename}\"'\n            return response\n    else:\n        raise Http404(\"File not found\")\n\n@login_required\ndef view_document_inline(request, doc_id):\n    \"\"\"Serve document file inline for browser preview (mainly PDFs)\"\"\"\n    document = get_object_or_404(UploadedDocument, id=doc_id, uploaded_by=request.user)\n    \n    if document.file and os.path.exists(document.file.path):\n        # Get proper content type\n        content_type, _ = mimetypes.guess_type(document.file.name)\n        if not content_type:\n            content_type = 'application/octet-stream'\n        \n        # For PDFs, serve inline\n        file_extension = os.path.splitext(document.file.name)[1].lower()\n        if file_extension == '.pdf':\n            content_type = 'application/pdf'\n        \n        # Serve file inline for browser preview\n        with open(document.file.path, 'rb') as f:\n            response = HttpResponse(f.read(), content_type=content_type)\n            filename = f\"{document.title}{os.path.splitext(document.file.name)[1]}\"\n            response['Content-Disposition'] = f'inline; filename=\"{filename}\"'\n            response['Content-Security-Policy'] = \"frame-ancestors 'self'\"\n            return response\n    else:\n        raise Http404(\"File not found\")\n\n@login_required\ndef view_document(request, doc_id):\n    \"\"\"View document content (for AI generated content or PDF preview)\"\"\"\n    document = get_object_or_404(UploadedDocument, id=doc_id, uploaded_by=request.user)\n    \n    # Get AI content from database\n    ai_content = document.ai_content\n    \n    # Check if document is a PDF for preview\n    is_pdf = False\n    if document.file:\n        file_extension = os.path.splitext(document.file.name)[1].lower()\n        is_pdf = file_extension == '.pdf'\n    \n    context = {\n        'document': document,\n        'ai_content': ai_content,\n        'is_pdf': is_pdf\n    }\n    return render(request, 'core/view_document.html', context)\n\n@login_required\n@require_premium\ndef generate_assignment_ai(request):\n    \"\"\"Generate homework assignment using AI\"\"\"\n    if request.method == 'POST':\n        try:\n            # Get user's AI model\n            profile = UserProfile.objects.get(user=request.user)\n            ai_model = profile.get_ai_model()\n            \n            subject = Subject.objects.get(id=request.POST.get('subject'))\n            grade = Grade.objects.get(id=request.POST.get('grade'))\n            board = ExamBoard.objects.get(id=request.POST.get('board'))\n            topic = request.POST.get('topic')\n            question_type = request.POST.get('question_type')\n            num_questions = int(request.POST.get('num_questions', 5))\n            due_date = request.POST.get('due_date')\n            \n            ai_content = generate_homework(\n                subject.name, f\"Grade {grade.number}\", \n                board.abbreviation, topic, question_type, num_questions, model=ai_model\n            )\n            \n            # Create assignment\n            assignment = GeneratedAssignment(\n                teacher=request.user,\n                title=f\"AI Generated: {topic}\",\n                subject=subject,\n                grade=grade,\n                board=board,\n                question_type=question_type,\n                due_date=due_date,\n                shared_link=str(uuid.uuid4()),\n                content=ai_content\n            )\n            assignment.save()\n            \n            messages.success(request, 'Assignment generated successfully!')\n            return redirect('assignments')\n            \n        except Exception as e:\n            messages.error(request, f'Failed to generate assignment: {str(e)}')\n            return redirect('assignments')\n    \n    return redirect('assignments')\n\n@login_required\n@require_premium\ndef generate_questions_ai(request):\n    \"\"\"Generate practice questions using AI\"\"\"\n    if request.method == 'POST':\n        try:\n            # Get user's AI model\n            profile = UserProfile.objects.get(user=request.user)\n            ai_model = profile.get_ai_model()\n            \n            subject = Subject.objects.get(id=request.POST.get('subject'))\n            grade = Grade.objects.get(id=request.POST.get('grade'))\n            board = ExamBoard.objects.get(id=request.POST.get('board'))\n            topic = request.POST.get('topic')\n            question_type = request.POST.get('question_type')\n            difficulty = request.POST.get('difficulty', 'medium')\n            \n            ai_content = generate_questions(\n                subject.name, f\"Grade {grade.number}\", \n                board.abbreviation, topic, question_type, difficulty, model=ai_model\n            )\n            \n            return JsonResponse({\n                'success': True,\n                'content': ai_content\n            })\n            \n        except Exception as e:\n            return JsonResponse({\n                'success': False,\n                'error': str(e)\n            })\n    \n    return JsonResponse({'success': False, 'error': 'Invalid request'})\n\ndef signup_view(request):\n    \"\"\"Teacher signup with email verification and subject selection\"\"\"\n    from core.models import Subject, SubscribedSubject\n    \n    subjects = Subject.objects.all().order_by('name')\n    \n    if request.method == 'POST':\n        username = request.POST.get('username')\n        email = request.POST.get('email')\n        password = request.POST.get('password')\n        password_confirm = request.POST.get('password_confirm')\n        first_name = request.POST.get('first_name')\n        last_name = request.POST.get('last_name')\n        selected_subject_ids = request.POST.getlist('subjects')\n        \n        # Validation\n        if not all([username, email, password, password_confirm, first_name, last_name]):\n            messages.error(request, 'All fields are required.')\n            return render(request, 'core/signup.html', {'subjects': subjects})\n        \n        if not selected_subject_ids:\n            messages.error(request, 'Please select at least one subject to get started.')\n            return render(request, 'core/signup.html', {'subjects': subjects})\n        \n        if len(selected_subject_ids) > 1:\n            messages.error(request, 'Free plan allows 1 subject only. Upgrade after signup for more.')\n            return render(request, 'core/signup.html', {'subjects': subjects})\n        \n        if password != password_confirm:\n            messages.error(request, 'Passwords do not match.')\n            return render(request, 'core/signup.html', {'subjects': subjects})\n        \n        if len(password) < 8:\n            messages.error(request, 'Password must be at least 8 characters long.')\n            return render(request, 'core/signup.html', {'subjects': subjects})\n        \n        if User.objects.filter(username=username).exists():\n            messages.error(request, 'Username already taken. Try logging in instead.')\n            return render(request, 'core/signup.html', {'subjects': subjects})\n        \n        if User.objects.filter(email=email).exists():\n            messages.error(request, 'This email is already registered. Try logging in or reset your password.')\n            return render(request, 'core/signup.html', {'subjects': subjects})\n        \n        try:\n            # Create user (active but unverified)\n            user = User.objects.create_user(\n                username=username,\n                email=email,\n                password=password,\n                first_name=first_name,\n                last_name=last_name,\n                is_active=True\n            )\n            \n            # Create profile with verification token and teacher code\n            verification_token = secrets.token_urlsafe(50)\n            import random\n            import string\n            \n            # Generate unique teacher code\n            while True:\n                teacher_code = ''.join(random.choices(string.ascii_uppercase + string.digits, k=6))\n                if not UserProfile.objects.filter(teacher_code=teacher_code).exists():\n                    break\n            \n            profile = UserProfile.objects.create(\n                user=user,\n                role='teacher',\n                verification_token=verification_token,\n                verification_token_created=timezone.now(),\n                teacher_code=teacher_code\n            )\n            \n            # Create subscribed subject entries\n            for subject_id in selected_subject_ids:\n                SubscribedSubject.objects.create(\n                    user=user,\n                    subject_id=subject_id\n                )\n            \n            # Send verification email\n            # Build proper verification URL using Replit domain\n            verification_path = reverse('verify_email', kwargs={'token': verification_token})\n            \n            # Get the proper domain from environment or request\n            import os\n            replit_domain = os.environ.get('REPLIT_DEV_DOMAIN')\n            if replit_domain:\n                verification_url = f\"https://{replit_domain}{verification_path}\"\n            else:\n                verification_url = request.build_absolute_uri(verification_path)\n            \n            send_mail(\n                subject='Welcome to EduTech Platform - Verify Your Email',\n                message=f'''Hi {first_name},\n\nWelcome to EduTech Platform! Please click the link below to verify your email address:\n\n{verification_url}\n\nThis link will expire in 24 hours.\n\nBest regards,\nEduTech Team''',\n                from_email=settings.DEFAULT_FROM_EMAIL,\n                recipient_list=[email],\n                fail_silently=False,\n            )\n            \n            # Auto-login the user\n            login(request, user)\n            \n            messages.success(request, 'Welcome! Please verify your email to access all features.')\n            return redirect('dashboard')\n            \n        except Exception as e:\n            messages.error(request, f'Error creating account: {str(e)}')\n            return render(request, 'core/signup.html', {'subjects': subjects})\n    \n    return render(request, 'core/signup.html', {'subjects': subjects})\n\ndef verify_email(request, token):\n    \"\"\"Verify email address with token\"\"\"\n    try:\n        # Find profile with matching token\n        profile = UserProfile.objects.get(verification_token=token)\n        \n        # Check if token is expired (24 hours)\n        if profile.verification_token_created and timezone.now() > profile.verification_token_created + timedelta(hours=24):\n            messages.error(request, 'Verification link has expired. Please request a new one.')\n            return redirect('login')\n        \n        # Activate user and clear token\n        user = profile.user\n        user.is_active = True\n        user.save()\n        \n        profile.email_verified = True\n        profile.verification_token = ''\n        profile.verification_token_created = None\n        profile.save()\n        \n        # Create usage quota\n        UsageQuota.objects.get_or_create(user=user)\n        \n        messages.success(request, 'Email verified successfully! You can now sign in.')\n        return redirect('login')\n        \n    except UserProfile.DoesNotExist:\n        messages.error(request, 'Invalid verification link.')\n        return redirect('login')\n\ndef resend_verification(request):\n    \"\"\"Resend verification email\"\"\"\n    if request.method == 'POST':\n        email = request.POST.get('email')\n        \n        try:\n            user = User.objects.get(email=email, is_active=False)\n            profile = user.userprofile\n            \n            # Generate new token\n            verification_token = secrets.token_urlsafe(50)\n            profile.verification_token = verification_token\n            profile.verification_token_created = timezone.now()\n            profile.save()\n            \n            # Send verification email\n            verification_url = request.build_absolute_uri(\n                reverse('verify_email', kwargs={'token': verification_token})\n            )\n            \n            send_mail(\n                subject='EduTech Platform - New Verification Link',\n                message=f'''Hi {user.first_name},\n\nHere is your new verification link:\n\n{verification_url}\n\nThis link will expire in 24 hours.\n\nBest regards,\nEduTech Team''',\n                from_email=settings.DEFAULT_FROM_EMAIL,\n                recipient_list=[email],\n                fail_silently=False,\n            )\n            \n            messages.success(request, 'Verification email sent! Please check your inbox.')\n            \n        except User.DoesNotExist:\n            messages.error(request, 'No unverified account found with this email address.')\n    \n    return render(request, 'core/resend_verification.html')\n\ndef forgot_password(request):\n    \"\"\"Forgot password - send reset link\"\"\"\n    if request.method == 'POST':\n        email = request.POST.get('email')\n        \n        try:\n            user = User.objects.get(email=email)\n            \n            # Generate reset token\n            reset_token = secrets.token_urlsafe(50)\n            expires_at = timezone.now() + timedelta(hours=1)\n            \n            # Create password reset token\n            PasswordResetToken.objects.create(\n                user=user,\n                token=reset_token,\n                expires_at=expires_at\n            )\n            \n            # Build reset URL\n            reset_path = reverse('reset_password', kwargs={'token': reset_token})\n            \n            # Get the proper domain from environment or request\n            replit_domain = os.environ.get('REPLIT_DEV_DOMAIN')\n            if replit_domain:\n                reset_url = f\"https://{replit_domain}{reset_path}\"\n            else:\n                reset_url = request.build_absolute_uri(reset_path)\n            \n            # Send reset email\n            send_mail(\n                subject='Reset Your EduTech Password',\n                message=f'''Hi {user.first_name},\n\nWe received a request to reset your password. Click the link below to reset it:\n\n{reset_url}\n\nThis link will expire in 1 hour.\n\nIf you didn't request this, you can safely ignore this email.\n\nNeed help? Contact us at support@edutech.com\n\nBest regards,\nEduTech Team''',\n                from_email=settings.DEFAULT_FROM_EMAIL,\n                recipient_list=[email],\n                fail_silently=False,\n            )\n            \n        except User.DoesNotExist:\n            pass\n        \n        # Always show success message for security\n        messages.success(request, 'If an account with that email exists, we have sent password reset instructions.')\n        return redirect('login')\n    \n    return render(request, 'core/forgot_password.html')\n\ndef reset_password(request, token):\n    \"\"\"Reset password with token\"\"\"\n    # Validate token on GET request\n    try:\n        reset_token = PasswordResetToken.objects.get(token=token)\n        \n        if not reset_token.is_valid():\n            messages.error(request, 'This password reset link has expired or has already been used. Please request a new one.')\n            return redirect('forgot_password')\n        \n        if request.method == 'POST':\n            password = request.POST.get('password')\n            password_confirm = request.POST.get('password_confirm')\n            \n            # Validate passwords\n            if not password or not password_confirm:\n                messages.error(request, 'Please fill in all fields.')\n                return render(request, 'core/reset_password.html', {'token': token})\n            \n            if password != password_confirm:\n                messages.error(request, 'Passwords do not match.')\n                return render(request, 'core/reset_password.html', {'token': token})\n            \n            if len(password) < 8:\n                messages.error(request, 'Password must be at least 8 characters long.')\n                return render(request, 'core/reset_password.html', {'token': token})\n            \n            # Validate token again\n            if not reset_token.is_valid():\n                messages.error(request, 'This password reset link has expired or has already been used.')\n                return redirect('forgot_password')\n            \n            # Update password\n            user = reset_token.user\n            user.set_password(password)\n            user.save()\n            \n            # Mark token as used\n            reset_token.used = True\n            reset_token.save()\n            \n            messages.success(request, 'Your password has been reset successfully! You can now sign in with your new password.')\n            return redirect('login')\n        \n        return render(request, 'core/reset_password.html', {'token': token})\n        \n    except PasswordResetToken.DoesNotExist:\n        messages.error(request, 'Invalid password reset link. Please request a new one.')\n        return redirect('forgot_password')\n\n@login_required\ndef account_settings(request):\n    \"\"\"User account settings page with profile, security, and notifications\"\"\"\n    from core.models import Subject, SubscribedSubject\n    \n    profile = UserProfile.objects.get_or_create(user=request.user)[0]\n    subjects = Subject.objects.all().order_by('name')\n    user_subjects = SubscribedSubject.objects.filter(user=request.user).values_list('subject_id', flat=True)\n    \n    if request.method == 'POST':\n        action = request.POST.get('action')\n        \n        if action == 'update_subjects':\n            try:\n                selected_subject_ids = request.POST.getlist('subjects')\n                max_subjects = profile.get_subject_limit()\n                \n                if not selected_subject_ids:\n                    messages.error(request, 'Please select at least one subject.')\n                    return redirect('account_settings')\n                \n                if len(selected_subject_ids) > max_subjects:\n                    messages.error(request, f'Your {profile.get_subscription_display()} plan allows up to {max_subjects} subject(s). Upgrade to add more.')\n                    return redirect('account_settings')\n                \n                # Remove old subjects and add new ones\n                SubscribedSubject.objects.filter(user=request.user).delete()\n                for subject_id in selected_subject_ids:\n                    SubscribedSubject.objects.create(\n                        user=request.user,\n                        subject_id=subject_id\n                    )\n                \n                messages.success(request, f'Successfully updated your subjects! You now have {len(selected_subject_ids)} subject(s) selected.')\n                \n            except Exception as e:\n                messages.error(request, f'Error updating subjects: {str(e)}')\n        \n        elif action == 'update_profile':\n            try:\n                first_name = request.POST.get('first_name', '').strip()\n                last_name = request.POST.get('last_name', '').strip()\n                email = request.POST.get('email', '').strip()\n                bio = request.POST.get('bio', '').strip()\n                institution = request.POST.get('institution', '').strip()\n                email_notifications = request.POST.get('email_notifications') == 'on'\n                \n                if not all([first_name, last_name, email]):\n                    messages.error(request, 'First name, last name, and email are required.')\n                    return redirect('account_settings')\n                \n                if email != request.user.email:\n                    if User.objects.filter(email=email).exclude(id=request.user.id).exists():\n                        messages.error(request, 'Email address is already in use.')\n                        return redirect('account_settings')\n                    request.user.email = email\n                    profile.email_verified = False\n                \n                request.user.first_name = first_name\n                request.user.last_name = last_name\n                request.user.save()\n                \n                profile.bio = bio\n                profile.institution = institution\n                profile.email_notifications = email_notifications\n                profile.save()\n                \n                messages.success(request, 'Profile updated successfully!')\n                \n            except Exception as e:\n                messages.error(request, f'Error updating profile: {str(e)}')\n        \n        elif action == 'change_password':\n            try:\n                current_password = request.POST.get('current_password', '')\n                new_password = request.POST.get('new_password', '')\n                confirm_password = request.POST.get('confirm_password', '')\n                \n                if not request.user.check_password(current_password):\n                    messages.error(request, 'Current password is incorrect.')\n                    return redirect('account_settings')\n                \n                if len(new_password) < 8:\n                    messages.error(request, 'New password must be at least 8 characters long.')\n                    return redirect('account_settings')\n                \n                if new_password != confirm_password:\n                    messages.error(request, 'New passwords do not match.')\n                    return redirect('account_settings')\n                \n                request.user.set_password(new_password)\n                request.user.save()\n                \n                update_session_auth_hash(request, request.user)\n                \n                messages.success(request, 'Password changed successfully!')\n                \n            except Exception as e:\n                messages.error(request, f'Error changing password: {str(e)}')\n        \n        elif action == 'resend_verification':\n            try:\n                if profile.email_verified:\n                    messages.info(request, 'Your email is already verified.')\n                    return redirect('account_settings')\n                \n                verification_token = secrets.token_urlsafe(50)\n                profile.verification_token = verification_token\n                profile.verification_token_created = timezone.now()\n                profile.save()\n                \n                verification_url = request.build_absolute_uri(\n                    reverse('verify_email', kwargs={'token': verification_token})\n                )\n                \n                send_mail(\n                    subject='EduTech Platform - Verify Your Email',\n                    message=f'''Hi {request.user.first_name},\n                    \nPlease verify your email address by clicking the link below:\n\n{verification_url}\n\nThis link will expire in 24 hours.\n\nBest regards,\nEduTech Team''',\n                    from_email=settings.DEFAULT_FROM_EMAIL,\n                    recipient_list=[request.user.email],\n                    fail_silently=False,\n                )\n                \n                messages.success(request, 'Verification email sent! Please check your inbox.')\n                \n            except Exception as e:\n                messages.error(request, f'Error sending verification email: {str(e)}')\n        \n        return redirect('account_settings')\n    \n    ai_generations = UsageQuota.objects.get_or_create(user=request.user)[0]\n    total_ai_gens = sum(ai_generations.lesson_plans_used.values()) + sum(ai_generations.assignments_used.values())\n    \n    documents_count = UploadedDocument.objects.filter(uploaded_by=request.user).count()\n    assignments_count = GeneratedAssignment.objects.filter(teacher=request.user).count()\n    shared_count = AssignmentShare.objects.filter(teacher=request.user, revoked_at__isnull=True).count()\n    \n    context = {\n        'user_profile': profile,\n        'total_ai_generations': total_ai_gens,\n        'documents_count': documents_count,\n        'assignments_count': assignments_count,\n        'shared_count': shared_count,\n        'subjects': subjects,\n        'user_subjects': list(user_subjects),\n        'max_subjects': profile.get_subject_limit(),\n    }\n    \n    return render(request, 'core/account_settings.html', context)\n\n@login_required\ndef revoke_share(request, share_id):\n    \"\"\"Revoke access to a shared assignment\"\"\"\n    if request.method == 'POST':\n        try:\n            share = AssignmentShare.objects.get(\n                id=share_id,\n                teacher=request.user  # Ensure teacher owns the share\n            )\n            from django.utils import timezone\n            share.revoked_at = timezone.now()\n            share.save()\n            messages.success(request, f'Access to \"{share.assignment_title}\" has been revoked.')\n        except AssignmentShare.DoesNotExist:\n            messages.error(request, 'Share not found or you do not have permission to revoke it.')\n        except Exception as e:\n            messages.error(request, f'Error revoking share: {str(e)}')\n    \n    return redirect('assignments')\n\n@login_required\ndef create_share(request):\n    \"\"\"Create a new assignment share\"\"\"\n    if request.method == 'POST':\n        try:\n            assignment_type = request.POST.get('assignment_type')  # 'generated' or 'uploaded'\n            assignment_id = request.POST.get('assignment_id')\n            class_name = request.POST.get('class_name')  # For now, just use class name directly\n            due_date_str = request.POST.get('due_date')\n            expiry_date_str = request.POST.get('expiry_date')\n            \n            # Parse due date if provided\n            due_date = None\n            if due_date_str:\n                from django.utils.dateparse import parse_datetime, parse_date\n                from django.utils import timezone\n                try:\n                    # Try to parse as date first, then datetime\n                    parsed_date = parse_date(due_date_str)\n                    if parsed_date:\n                        # Convert date to datetime at end of day\n                        from datetime import datetime, time\n                        due_date = timezone.make_aware(\n                            datetime.combine(parsed_date, time.max.replace(microsecond=0))\n                        )\n                    else:\n                        due_date = parse_datetime(due_date_str)\n                        # Make naive datetimes timezone-aware\n                        if due_date and timezone.is_naive(due_date):\n                            due_date = timezone.make_aware(due_date)\n                except (ValueError, TypeError):\n                    pass  # Leave due_date as None if parsing fails\n            \n            # Parse expiry date if provided\n            expiry_date = None\n            if expiry_date_str:\n                from django.utils.dateparse import parse_datetime, parse_date\n                from django.utils import timezone\n                try:\n                    # Try to parse as date first, then datetime\n                    parsed_date = parse_date(expiry_date_str)\n                    if parsed_date:\n                        # Convert date to datetime at end of day\n                        from datetime import datetime, time\n                        expiry_date = timezone.make_aware(\n                            datetime.combine(parsed_date, time.max.replace(microsecond=0))\n                        )\n                    else:\n                        expiry_date = parse_datetime(expiry_date_str)\n                        # Make naive datetimes timezone-aware\n                        if expiry_date and timezone.is_naive(expiry_date):\n                            expiry_date = timezone.make_aware(expiry_date)\n                except (ValueError, TypeError):\n                    pass  # Leave expiry_date as None if parsing fails\n            \n            # Get or create class group\n            class_group, created = ClassGroup.objects.get_or_create(\n                teacher=request.user,\n                name=class_name,\n                defaults={'description': f'Class for {class_name}'}\n            )\n            \n            # Validate assignment ownership and create share\n            share = None\n            if assignment_type == 'generated':\n                assignment = GeneratedAssignment.objects.get(\n                    id=assignment_id, \n                    teacher=request.user\n                )\n                try:\n                    share = AssignmentShare.objects.create(\n                        teacher=request.user,\n                        class_group=class_group,\n                        generated_assignment=assignment,\n                        due_date=due_date,\n                        expires_at=expiry_date\n                    )\n                except IntegrityError:\n                    # Handle duplicate active share\n                    messages.error(request, f'Assignment \"{assignment.title}\" is already shared with {class_name}.')\n                    return redirect('assignments')\n                    \n            elif assignment_type == 'uploaded':\n                document = UploadedDocument.objects.get(\n                    id=assignment_id,\n                    uploaded_by=request.user\n                )\n                try:\n                    share = AssignmentShare.objects.create(\n                        teacher=request.user,\n                        class_group=class_group,\n                        uploaded_document=document,\n                        due_date=due_date,\n                        expires_at=expiry_date\n                    )\n                except IntegrityError:\n                    # Handle duplicate active share\n                    messages.error(request, f'Assignment \"{document.title}\" is already shared with {class_name}.')\n                    return redirect('assignments')\n            else:\n                raise ValueError(\"Invalid assignment type\")\n            \n            if share:\n                # Generate share URL using reverse\n                from django.urls import reverse\n                share_url = request.build_absolute_uri(reverse('public_assignment', args=[share.token]))\n                \n                messages.success(request, f'Assignment shared successfully! Share URL: {share_url}')\n                \n                # Return the share URL in response (for AJAX if needed)\n                if request.headers.get('Accept') == 'application/json':\n                    import json\n                    return HttpResponse(json.dumps({\n                        'success': True,\n                        'share_url': share_url,\n                        'token': share.token\n                    }), content_type='application/json')\n            \n        except (GeneratedAssignment.DoesNotExist, UploadedDocument.DoesNotExist):\n            messages.error(request, 'Assignment not found or you do not have permission to share it.')\n        except Exception as e:\n            messages.error(request, f'Error creating share: {str(e)}')\n    \n    return redirect('assignments')\n\ndef public_assignment_view(request, token):\n    \"\"\"Public view for students to access shared assignments without login\"\"\"\n    try:\n        share = AssignmentShare.objects.select_related(\n            'generated_assignment', 'uploaded_document', 'class_group'\n        ).get(token=token)\n        \n        # Check if share is still active\n        if not share.is_active:\n            return render(request, 'core/share_expired.html', {\n                'share': share,\n                'reason': 'revoked' if share.revoked_at else 'expired'\n            })\n        \n        # Update access tracking\n        from django.utils import timezone\n        share.view_count += 1\n        share.last_accessed = timezone.now()\n        share.save()\n        \n        # Determine content type and render appropriate template\n        if share.generated_assignment:\n            context = {\n                'share': share,\n                'assignment': share.generated_assignment,\n                'content': share.generated_assignment.content,\n                'assignment_type': 'generated'\n            }\n            return render(request, 'core/public_assignment.html', context)\n        else:\n            # For uploaded documents, we'll serve the file directly\n            context = {\n                'share': share,\n                'document': share.uploaded_document,\n                'assignment_type': 'uploaded'\n            }\n            return render(request, 'core/public_document.html', context)\n            \n    except AssignmentShare.DoesNotExist:\n        return render(request, 'core/share_not_found.html')\n\ndef public_assignment_download(request, token):\n    \"\"\"Download endpoint for public shared assignments\"\"\"\n    try:\n        share = AssignmentShare.objects.select_related(\n            'uploaded_document'\n        ).get(token=token)\n        \n        # Check if share is still active\n        if not share.is_active:\n            return HttpResponse('This share has expired or been revoked.', status=403)\n        \n        # Only uploaded documents can be downloaded\n        if not share.uploaded_document:\n            return HttpResponse('This assignment cannot be downloaded.', status=400)\n        \n        # Update access tracking\n        from django.utils import timezone\n        share.view_count += 1\n        share.last_accessed = timezone.now()\n        share.save()\n        \n        # Serve the file\n        document = share.uploaded_document\n        file_path = document.file.path\n        \n        if os.path.exists(file_path):\n            # Get the original file extension\n            file_extension = os.path.splitext(document.file.name)[1]\n            filename = f\"{document.title}{file_extension}\"\n            \n            # Get proper content type\n            content_type, _ = mimetypes.guess_type(document.file.name)\n            if not content_type:\n                content_type = 'application/octet-stream'\n            \n            with open(file_path, 'rb') as f:\n                response = HttpResponse(f.read(), content_type=content_type)\n                # Use inline for PDFs so they can be previewed in the browser\n                if file_extension.lower() == '.pdf':\n                    response['Content-Disposition'] = f'inline; filename=\"{filename}\"'\n                else:\n                    response['Content-Disposition'] = f'attachment; filename=\"{filename}\"'\n                return response\n        else:\n            return HttpResponse('File not found.', status=404)\n            \n    except AssignmentShare.DoesNotExist:\n        return HttpResponse('Share not found.', status=404)\n\n@login_required\ndef subscription_dashboard(request):\n    \"\"\"View current subscription and manage upgrades\"\"\"\n    from .models import SubscriptionPlan, SubscribedSubject, UserSubscription, PayFastPayment\n    \n    # Get user profile with subscription info\n    profile = UserProfile.objects.get(user=request.user)\n    \n    # Get active subscription if exists\n    try:\n        active_subscription = UserSubscription.objects.get(user=request.user, status='active')\n    except UserSubscription.DoesNotExist:\n        active_subscription = None\n    \n    # Get user's subscribed subjects\n    subscribed_subjects = SubscribedSubject.objects.filter(user=request.user).select_related('subject')\n    \n    # Get all available plans\n    available_plans = SubscriptionPlan.objects.filter(is_active=True).order_by('price')\n    \n    # Get all subjects for selection\n    all_subjects = Subject.objects.all().order_by('name')\n    \n    # Get usage quota info\n    try:\n        quota = UsageQuota.objects.get(user=request.user)\n    except UsageQuota.DoesNotExist:\n        quota = None\n    \n    # Calculate quota usage per subject\n    subject_quotas = []\n    for sub in subscribed_subjects:\n        subject_id = str(sub.subject.id)\n        used = quota.lesson_plans_used.get(subject_id, 0) if quota else 0\n        limit = profile.get_lesson_plan_limit_per_subject()\n        subject_quotas.append({\n            'subject': sub.subject,\n            'used': used,\n            'limit': limit,\n            'percentage': (used / limit * 100) if limit > 0 else 0\n        })\n    \n    # Get payment history\n    payment_history = PayFastPayment.objects.filter(\n        user=request.user,\n        status='complete'\n    ).select_related('plan').order_by('-completed_at')[:10]\n    \n    context = {\n        'profile': profile,\n        'active_subscription': active_subscription,\n        'subscribed_subjects': subscribed_subjects,\n        'available_plans': available_plans,\n        'all_subjects': all_subjects,\n        'subject_quotas': subject_quotas,\n        'subject_limit': profile.get_subject_limit(),\n        'can_add_subjects': subscribed_subjects.count() < profile.get_subject_limit(),\n        'payment_history': payment_history,\n    }\n    \n    return render(request, 'core/subscription.html', context)\n\n@login_required\ndef initiate_subscription(request, plan_id):\n    \"\"\"Initiate a subscription upgrade\"\"\"\n    from .models import SubscriptionPlan, UserSubscription\n    from .payfast_service import PayFastService\n    from django.utils import timezone\n    from datetime import timedelta\n    \n    plan = get_object_or_404(SubscriptionPlan, id=plan_id, is_active=True)\n    \n    if plan.plan_type == 'free':\n        messages.info(request, 'You are already on the free plan.')\n        return redirect('subscription_dashboard')\n    \n    try:\n        user_subscription = UserSubscription.objects.get(user=request.user)\n        user_subscription.plan = plan\n        user_subscription.status = 'pending'\n        user_subscription.save()\n    except UserSubscription.DoesNotExist:\n        user_subscription = UserSubscription.objects.create(\n            user=request.user,\n            plan=plan,\n            status='pending',\n            current_period_start=timezone.now(),\n            current_period_end=timezone.now() + timedelta(days=30)\n        )\n    \n    if request.method == 'POST':\n        selected_subject_id = request.POST.get('selected_subject')\n        if plan.plan_type == 'growth' and selected_subject_id:\n            subject = get_object_or_404(Subject, id=selected_subject_id)\n            user_subscription.selected_subject = subject\n            user_subscription.save()\n    \n    payment_data = PayFastService.generate_payment_form_data(\n        user=request.user,\n        plan=plan,\n        subscription=user_subscription\n    )\n    \n    payfast_url = PayFastService.get_payfast_url()\n    \n    context = {\n        'payment_data': payment_data,\n        'payfast_url': payfast_url,\n        'plan': plan,\n        'subscription': user_subscription,\n    }\n    \n    return render(request, 'core/initiate_payment.html', context)\n\n@csrf_exempt\ndef payfast_notify(request):\n    \"\"\"Handle PayFast ITN (Instant Transaction Notification)\"\"\"\n    from .models import UserSubscription, SubscriptionPlan, PayFastPayment\n    from .payfast_service import PayFastService\n    from django.utils import timezone\n    from datetime import timedelta\n    import logging\n    \n    logger = logging.getLogger(__name__)\n    \n    if request.method != 'POST':\n        return HttpResponse('Method not allowed', status=405)\n    \n    logger.info(f'PayFast ITN received: {request.POST}')\n    \n    if not PayFastService.validate_itn_signature(request.POST):\n        logger.error('Invalid PayFast signature')\n        return HttpResponse('Invalid signature', status=400)\n    \n    if not PayFastService.verify_payment_with_payfast(request.POST):\n        logger.error('PayFast server validation failed')\n        return HttpResponse('Payment verification failed', status=400)\n    \n    if not PayFastService.validate_merchant_id(request.POST):\n        logger.error('Invalid merchant ID')\n        return HttpResponse('Invalid merchant', status=400)\n    \n    payment_status = request.POST.get('payment_status')\n    user_id = request.POST.get('custom_str1')\n    plan_id = request.POST.get('custom_str2')\n    subscription_id = request.POST.get('custom_str3')\n    payment_id = request.POST.get('pf_payment_id')\n    amount_gross = request.POST.get('amount_gross')\n    amount_fee = request.POST.get('amount_fee', 0)\n    amount_net = request.POST.get('amount_net')\n    merchant_id = request.POST.get('merchant_id')\n    \n    try:\n        user = User.objects.get(id=user_id)\n        plan = SubscriptionPlan.objects.get(id=plan_id)\n        \n        if not PayFastService.validate_payment_amount(request.POST, plan.price):\n            logger.error(f'Payment amount mismatch: received {amount_gross}, expected {plan.price}')\n            return HttpResponse('Payment amount mismatch', status=400)\n        \n        payment, created = PayFastPayment.objects.get_or_create(\n            payfast_payment_id=payment_id,\n            defaults={\n                'user': user,\n                'plan': plan,\n                'merchant_id': merchant_id,\n                'amount_gross': amount_gross,\n                'amount_fee': amount_fee,\n                'amount_net': amount_net,\n                'status': 'pending',\n                'payment_status_text': payment_status,\n                'itn_data': dict(request.POST)\n            }\n        )\n        \n        if subscription_id:\n            try:\n                subscription = UserSubscription.objects.get(id=subscription_id)\n                payment.subscription = subscription\n            except UserSubscription.DoesNotExist:\n                logger.warning(f'Subscription {subscription_id} not found')\n        \n        if payment_status == 'COMPLETE':\n            payment.status = 'complete'\n            payment.completed_at = timezone.now()\n            payment.save()\n            \n            subscription, created = UserSubscription.objects.get_or_create(\n                user=user,\n                defaults={\n                    'plan': plan,\n                    'status': 'active',\n                    'current_period_start': timezone.now(),\n                    'current_period_end': timezone.now() + timedelta(days=30)\n                }\n            )\n            \n            if not created:\n                subscription.plan = plan\n                subscription.status = 'active'\n                subscription.current_period_start = timezone.now()\n                subscription.current_period_end = timezone.now() + timedelta(days=30)\n                subscription.save()\n            \n            # Update UserProfile subscription field\n            try:\n                profile = UserProfile.objects.get(user=user)\n                profile.subscription = plan.plan_type\n                profile.save()\n                logger.info(f'Updated UserProfile subscription to {plan.plan_type} for user {user.username}')\n            except UserProfile.DoesNotExist:\n                logger.error(f'UserProfile not found for user {user.username}')\n            \n            logger.info(f'Payment complete for user {user.username}, plan {plan.name}')\n        else:\n            payment.status = 'failed'\n            payment.save()\n            logger.warning(f'Payment failed with status: {payment_status}')\n        \n        return HttpResponse('OK', status=200)\n        \n    except Exception as e:\n        logger.error(f'Error processing PayFast ITN: {str(e)}')\n        return HttpResponse('Error processing payment', status=500)\n\ndef payment_success(request):\n    \"\"\"Redirect after successful payment\"\"\"\n    from .models import UserSubscription, SubscriptionPlan, UserProfile, PayFastPayment\n    from django.utils import timezone\n    from datetime import timedelta\n    from django.conf import settings\n    \n    # In sandbox mode, PayFast might not send ITN immediately\n    # So we activate the subscription here as a fallback for testing\n    if hasattr(settings, 'PAYFAST_MERCHANT_ID') and settings.PAYFAST_MERCHANT_ID == '10000100':\n        try:\n            # Get the latest pending subscription for this user\n            subscription = UserSubscription.objects.filter(\n                user=request.user,\n                status='pending'\n            ).order_by('-created_at').first()\n            \n            if subscription and subscription.plan.price > 0:\n                # Activate the subscription\n                subscription.status = 'active'\n                subscription.current_period_start = timezone.now()\n                subscription.current_period_end = timezone.now() + timedelta(days=30)\n                subscription.save()\n                \n                # Update UserProfile subscription field\n                profile = UserProfile.objects.get(user=request.user)\n                profile.subscription = subscription.plan.plan_type\n                profile.save()\n                \n                # Create payment record\n                PayFastPayment.objects.create(\n                    user=request.user,\n                    subscription=subscription,\n                    plan=subscription.plan,\n                    payfast_payment_id=f'sandbox_{timezone.now().timestamp()}',\n                    merchant_id=settings.PAYFAST_MERCHANT_ID,\n                    amount_gross=subscription.plan.price,\n                    amount_fee=0,\n                    amount_net=subscription.plan.price,\n                    status='complete',\n                    payment_status_text='COMPLETE',\n                    completed_at=timezone.now(),\n                    itn_data={'sandbox': True}\n                )\n                \n                messages.success(request, f'üéâ Subscription activated! You now have {subscription.plan.name} access.')\n                return redirect('subscription_dashboard')\n        except Exception as e:\n            # Don't fail if this doesn't work - ITN will handle it\n            logger.error(f'Error activating subscription in payment_success: {str(e)}')\n            pass\n    \n    messages.success(request, 'Payment received! Your subscription is being activated.')\n    return redirect('subscription_dashboard')\n\ndef payment_cancelled(request):\n    \"\"\"Redirect after cancelled payment\"\"\"\n    messages.warning(request, 'Payment was cancelled. You can try again anytime.')\n    return redirect('subscription_dashboard')\n\n# ===== ADMIN VIEWS =====\n\ndef require_admin(view_func):\n    \"\"\"Decorator to require admin/staff privileges\"\"\"\n    def wrapper(request, *args, **kwargs):\n        if not request.user.is_authenticated:\n            return redirect('login')\n        if not (request.user.is_superuser or request.user.is_staff):\n            messages.error(request, 'Access denied. Admin privileges required.')\n            return redirect('dashboard')\n        return view_func(request, *args, **kwargs)\n    return wrapper\n\ndef require_content_manager(view_func):\n    \"\"\"Decorator to require content manager or admin privileges\"\"\"\n    def wrapper(request, *args, **kwargs):\n        if not request.user.is_authenticated:\n            return redirect('login')\n        # Allow admins and content managers\n        is_admin = request.user.is_superuser or request.user.is_staff\n        is_content_manager = hasattr(request.user, 'userprofile') and request.user.userprofile.role == 'content_manager'\n        if not (is_admin or is_content_manager):\n            messages.error(request, 'Access denied. Content manager privileges required.')\n            return redirect('dashboard')\n        return view_func(request, *args, **kwargs)\n    return wrapper\n\n@require_admin\ndef admin_dashboard(request):\n    \"\"\"Admin dashboard with analytics\"\"\"\n    \n    from .models import UserSubscription, PayFastPayment, SubscriptionPlan\n    from django.db.models import Count, Sum, Q\n    \n    # Get analytics data\n    total_users = User.objects.count()\n    verified_users = User.objects.filter(is_active=True).count()\n    total_teachers = UserProfile.objects.filter(role='teacher').count()\n    \n    # Subscription breakdown\n    free_users = UserProfile.objects.filter(subscription='free').count()\n    starter_users = UserProfile.objects.filter(subscription='starter').count()\n    growth_users = UserProfile.objects.filter(subscription='growth').count()\n    premium_users = UserProfile.objects.filter(subscription='premium').count()\n    \n    # Revenue calculations\n    active_subscriptions = UserSubscription.objects.filter(status='active').select_related('plan')\n    total_mrr = sum(sub.plan.price for sub in active_subscriptions)\n    \n    completed_payments = PayFastPayment.objects.filter(status='complete')\n    total_revenue = completed_payments.aggregate(Sum('amount_gross'))['amount_gross__sum'] or 0\n    \n    # Recent signups (last 7 days)\n    from datetime import timedelta\n    week_ago = timezone.now() - timedelta(days=7)\n    recent_signups = User.objects.filter(date_joined__gte=week_ago).count()\n    \n    # Recent users\n    latest_users = User.objects.select_related('userprofile').order_by('-date_joined')[:10]\n    \n    # Recent payments\n    recent_payments = PayFastPayment.objects.filter(\n        status='complete'\n    ).select_related('user', 'plan').order_by('-completed_at')[:10]\n    \n    context = {\n        'total_users': total_users,\n        'verified_users': verified_users,\n        'total_teachers': total_teachers,\n        'free_users': free_users,\n        'starter_users': starter_users,\n        'growth_users': growth_users,\n        'premium_users': premium_users,\n        'total_mrr': total_mrr,\n        'total_revenue': total_revenue,\n        'recent_signups': recent_signups,\n        'latest_users': latest_users,\n        'recent_payments': recent_payments,\n    }\n    \n    return render(request, 'core/admin/dashboard.html', context)\n\n@require_admin\ndef admin_users(request):\n    \"\"\"User management interface\"\"\"\n    \n    # Get search and filter parameters\n    search_query = request.GET.get('search', '')\n    subscription_filter = request.GET.get('subscription', '')\n    status_filter = request.GET.get('status', '')\n    \n    # Base queryset\n    users = User.objects.select_related('userprofile').order_by('-date_joined')\n    \n    # Apply filters\n    if search_query:\n        users = users.filter(\n            Q(username__icontains=search_query) |\n            Q(email__icontains=search_query) |\n            Q(first_name__icontains=search_query) |\n            Q(last_name__icontains=search_query)\n        )\n    \n    if subscription_filter:\n        users = users.filter(userprofile__subscription=subscription_filter)\n    \n    if status_filter == 'active':\n        users = users.filter(is_active=True)\n    elif status_filter == 'inactive':\n        users = users.filter(is_active=False)\n    \n    context = {\n        'users': users,\n        'search_query': search_query,\n        'subscription_filter': subscription_filter,\n        'status_filter': status_filter,\n    }\n    \n    return render(request, 'core/admin/users.html', context)\n\n@require_admin\ndef admin_change_subscription(request, user_id):\n    \"\"\"Change user's subscription tier\"\"\"\n    \n    if request.method == 'POST':\n        from .models import UserSubscription, SubscriptionPlan\n        \n        user = get_object_or_404(User, id=user_id)\n        new_subscription = request.POST.get('subscription')\n        \n        if new_subscription in ['free', 'starter', 'growth', 'premium']:\n            profile = UserProfile.objects.get(user=user)\n            profile.subscription = new_subscription\n            profile.save()\n            \n            # Update or create UserSubscription\n            plan = SubscriptionPlan.objects.get(plan_type=new_subscription)\n            subscription, created = UserSubscription.objects.get_or_create(\n                user=user,\n                defaults={\n                    'plan': plan,\n                    'status': 'active',\n                    'current_period_start': timezone.now(),\n                    'current_period_end': timezone.now() + timedelta(days=30)\n                }\n            )\n            \n            if not created:\n                subscription.plan = plan\n                subscription.status = 'active'\n                subscription.current_period_start = timezone.now()\n                subscription.current_period_end = timezone.now() + timedelta(days=30)\n                subscription.save()\n            \n            messages.success(request, f'Updated {user.username} to {new_subscription.title()} plan.')\n        else:\n            messages.error(request, 'Invalid subscription tier.')\n    \n    return redirect('admin_users')\n\n@require_admin\ndef admin_toggle_user_status(request, user_id):\n    \"\"\"Activate or deactivate user account\"\"\"\n    \n    if request.method == 'POST':\n        user = get_object_or_404(User, id=user_id)\n        \n        if user.id == request.user.id:\n            messages.error(request, 'You cannot deactivate your own account.')\n        else:\n            user.is_active = not user.is_active\n            user.save()\n            status = 'activated' if user.is_active else 'deactivated'\n            messages.success(request, f'User {user.username} has been {status}.')\n    \n    return redirect('admin_users')\n\n@require_admin\ndef admin_subscriptions(request):\n    \"\"\"Subscription management view\"\"\"\n    \n    from .models import UserSubscription, SubscriptionPlan, PayFastPayment\n    from django.db.models import Sum\n    \n    # Get all active subscriptions\n    active_subscriptions = UserSubscription.objects.filter(\n        status='active'\n    ).select_related('user', 'plan').order_by('-current_period_end')\n    \n    # Get all subscription plans\n    plans = SubscriptionPlan.objects.all().order_by('price')\n    \n    # Calculate revenue per plan\n    plan_revenue = {}\n    for plan in plans:\n        plan_subs = active_subscriptions.filter(plan=plan)\n        plan_revenue[plan.id] = {\n            'plan': plan,\n            'count': plan_subs.count(),\n            'mrr': plan_subs.count() * plan.price\n        }\n    \n    # Payment history\n    payments = PayFastPayment.objects.filter(\n        status='complete'\n    ).select_related('user', 'plan').order_by('-completed_at')[:50]\n    \n    context = {\n        'active_subscriptions': active_subscriptions,\n        'plan_revenue': plan_revenue.values(),\n        'payments': payments,\n    }\n    \n    return render(request, 'core/admin/subscriptions.html', context)\n\n@require_admin\ndef admin_api_test(request):\n    \"\"\"API Testing Dashboard\"\"\"\n    \n    # Define all available endpoints\n    endpoints = [\n        {\n            'name': 'Exam Boards',\n            'url': '/api/exam-boards/',\n            'method': 'GET',\n            'description': 'List all exam boards (IEB, CAPS, Cambridge, etc.) - PUBLIC ACCESS',\n            'filters': ['search (name_full, abbreviation, region)'],\n            'example_params': '?search=IEB'\n        },\n        {\n            'name': 'Subjects',\n            'url': '/api/subjects/',\n            'method': 'GET',\n            'description': 'List all subjects - PUBLIC ACCESS',\n            'filters': ['search (name)'],\n            'example_params': '?search=Mathematics'\n        },\n        {\n            'name': 'Grades',\n            'url': '/api/grades/',\n            'method': 'GET',\n            'description': 'List all grades - PUBLIC ACCESS',\n            'filters': ['ordering (number)'],\n            'example_params': '?ordering=number'\n        },\n        {\n            'name': 'Past Papers',\n            'url': '/api/past-papers/',\n            'method': 'GET',\n            'description': 'List all government exam papers with PDFs - PUBLIC ACCESS',\n            'filters': [\n                'exam_board (text)',\n                'subject (ID)',\n                'grade (ID)',\n                'year (number)',\n                'search (title, chapter, section)'\n            ],\n            'example_params': '?exam_board=1&year=2023&subject=1'\n        },\n        {\n            'name': 'Formatted Papers',\n            'url': '/api/formatted-papers/',\n            'method': 'GET',\n            'description': 'List AI-formatted papers with questions and memos in JSON - REQUIRES AUTHENTICATION',\n            'filters': [\n                'exam_board (text)',\n                'subject (ID)',\n                'grade (ID)',\n                'year (number)',\n                'processing_status (pending, processing, completed, failed)',\n                'is_published (true, false)',\n                'search (title)'\n            ],\n            'example_params': '?is_published=true&year=2023'\n        },\n        {\n            'name': 'Quizzes',\n            'url': '/api/quizzes/',\n            'method': 'GET',\n            'description': 'List quizzes with Google Forms links - PUBLIC for free quizzes, AUTH for premium',\n            'filters': [\n                'exam_board (text)',\n                'subject (ID)',\n                'grade (ID)',\n                'is_premium (true, false)',\n                'search (title, topic)'\n            ],\n            'example_params': '?is_premium=false&subject=1'\n        },\n        {\n            'name': 'Assignments',\n            'url': '/api/assignments/',\n            'method': 'GET',\n            'description': 'List all assignments - REQUIRES AUTHENTICATION',\n            'filters': [\n                'subject (ID)',\n                'grade (ID)',\n                'assignment_type (text)',\n                'search (topic, content)'\n            ],\n            'example_params': '?subject=1&grade=2'\n        },\n        {\n            'name': 'Get Auth Token',\n            'url': '/api/auth/token/',\n            'method': 'POST',\n            'description': 'Get authentication token for API access (send username and password)',\n            'filters': [],\n            'example_params': 'POST body: {\"username\": \"your_username\", \"password\": \"your_password\"}'\n        },\n    ]\n    \n    # Get subjects and grades for filter dropdowns\n    subjects = Subject.objects.all()\n    grades = Grade.objects.all()\n    \n    context = {\n        'endpoints': endpoints,\n        'subjects': subjects,\n        'grades': grades,\n    }\n    \n    return render(request, 'core/admin/api_test.html', context)\n\n@require_admin\ndef admin_features(request):\n    \"\"\"Feature Management dashboard\"\"\"\n    \n    from .models import SubscriptionPlan, StudentSubscriptionPricing\n    \n    # Get counts for each feature type\n    exam_boards_count = ExamBoard.objects.count()\n    subjects_count = Subject.objects.count()\n    grades_count = Grade.objects.count()\n    teacher_plans_count = SubscriptionPlan.objects.count()\n    # Student pricing is a single config row, show 4 for the 4 pricing tiers\n    student_plans_count = 4 if StudentSubscriptionPricing.objects.filter(is_active=True).exists() else 0\n    \n    context = {\n        'exam_boards_count': exam_boards_count,\n        'subjects_count': subjects_count,\n        'grades_count': grades_count,\n        'teacher_plans_count': teacher_plans_count,\n        'student_plans_count': student_plans_count,\n    }\n    \n    return render(request, 'core/admin/features.html', context)\n\n@require_admin\ndef admin_exam_boards(request):\n    \"\"\"Exam Boards CRUD interface\"\"\"\n    \n    if request.method == 'POST':\n        action = request.POST.get('action')\n        \n        if action == 'create':\n            ExamBoard.objects.create(\n                name_full=request.POST.get('name_full'),\n                abbreviation=request.POST.get('abbreviation'),\n                region=request.POST.get('region', '')\n            )\n            messages.success(request, 'Exam board created successfully.')\n        \n        elif action == 'update':\n            board_id = request.POST.get('board_id')\n            board = get_object_or_404(ExamBoard, id=board_id)\n            board.name_full = request.POST.get('name_full')\n            board.abbreviation = request.POST.get('abbreviation')\n            board.region = request.POST.get('region', '')\n            board.save()\n            messages.success(request, 'Exam board updated successfully.')\n        \n        elif action == 'delete':\n            board_id = request.POST.get('board_id')\n            board = get_object_or_404(ExamBoard, id=board_id)\n            board.delete()\n            messages.success(request, 'Exam board deleted successfully.')\n        \n        return redirect('admin_exam_boards')\n    \n    exam_boards = ExamBoard.objects.all().order_by('abbreviation')\n    \n    context = {\n        'exam_boards': exam_boards,\n    }\n    \n    return render(request, 'core/admin/exam_boards.html', context)\n\n@require_admin\ndef admin_subjects(request):\n    \"\"\"Subjects CRUD interface\"\"\"\n    \n    if request.method == 'POST':\n        action = request.POST.get('action')\n        \n        if action == 'create':\n            Subject.objects.create(name=request.POST.get('name'))\n            messages.success(request, 'Subject created successfully.')\n        \n        elif action == 'update':\n            subject_id = request.POST.get('subject_id')\n            subject = get_object_or_404(Subject, id=subject_id)\n            subject.name = request.POST.get('name')\n            subject.save()\n            messages.success(request, 'Subject updated successfully.')\n        \n        elif action == 'delete':\n            subject_id = request.POST.get('subject_id')\n            subject = get_object_or_404(Subject, id=subject_id)\n            subject.delete()\n            messages.success(request, 'Subject deleted successfully.')\n        \n        return redirect('admin_subjects')\n    \n    subjects = Subject.objects.all().order_by('name')\n    \n    context = {\n        'subjects': subjects,\n    }\n    \n    return render(request, 'core/admin/subjects.html', context)\n\n@require_admin\ndef admin_grades(request):\n    \"\"\"Grades CRUD interface\"\"\"\n    \n    if request.method == 'POST':\n        action = request.POST.get('action')\n        \n        if action == 'create':\n            Grade.objects.create(number=request.POST.get('number'))\n            messages.success(request, 'Grade created successfully.')\n        \n        elif action == 'update':\n            grade_id = request.POST.get('grade_id')\n            grade = get_object_or_404(Grade, id=grade_id)\n            grade.number = request.POST.get('number')\n            grade.save()\n            messages.success(request, 'Grade updated successfully.')\n        \n        elif action == 'delete':\n            grade_id = request.POST.get('grade_id')\n            grade = get_object_or_404(Grade, id=grade_id)\n            grade.delete()\n            messages.success(request, 'Grade deleted successfully.')\n        \n        return redirect('admin_grades')\n    \n    grades = Grade.objects.all().order_by('number')\n    \n    context = {\n        'grades': grades,\n    }\n    \n    return render(request, 'core/admin/grades.html', context)\n\n@require_admin\ndef admin_teacher_subscription_plans(request):\n    \"\"\"Teacher Subscription Plans management interface\"\"\"\n    \n    if request.method == 'POST':\n        action = request.POST.get('action')\n        \n        if action == 'update':\n            plan_id = request.POST.get('plan_id')\n            plan = get_object_or_404(SubscriptionPlan, id=plan_id)\n            plan.price = request.POST.get('price')\n            plan.allowed_subjects_count = request.POST.get('allowed_subjects_count', 0)\n            plan.monthly_ai_generations = request.POST.get('monthly_ai_generations', 0)\n            plan.can_use_ai = request.POST.get('can_use_ai') == 'on'\n            plan.save()\n            messages.success(request, f'{plan.name} plan updated successfully.')\n        \n        return redirect('admin_teacher_subscription_plans')\n    \n    plans = SubscriptionPlan.objects.all().order_by('price')\n    \n    context = {\n        'plans': plans,\n    }\n    \n    return render(request, 'core/admin/teacher_subscription_plans.html', context)\n\n\n@require_admin\ndef admin_student_subscription_plans(request):\n    \"\"\"Student Subscription Pricing management interface\"\"\"\n    from .models import StudentSubscriptionPricing\n    \n    # Get or create the single pricing record\n    pricing = StudentSubscriptionPricing.get_current()\n    \n    if request.method == 'POST':\n        action = request.POST.get('action')\n        \n        if action == 'update':\n            pricing.per_subject_price = request.POST.get('per_subject_price', 100)\n            pricing.multi_subject_price = request.POST.get('multi_subject_price', 200)\n            pricing.all_access_price = request.POST.get('all_access_price', 300)\n            pricing.tutor_addon_price = request.POST.get('tutor_addon_price', 500)\n            pricing.per_subject_max = request.POST.get('per_subject_max', 3)\n            pricing.multi_subject_min = request.POST.get('multi_subject_min', 4)\n            pricing.multi_subject_max = request.POST.get('multi_subject_max', 5)\n            pricing.is_active = request.POST.get('is_active') == 'on'\n            pricing.save()\n            messages.success(request, 'Student subscription pricing updated successfully.')\n        \n        return redirect('admin_student_subscription_plans')\n    \n    context = {\n        'pricing': pricing,\n    }\n    \n    return render(request, 'core/admin/student_subscription_plans.html', context)\n\n@require_admin\ndef admin_communications(request):\n    \"\"\"Communications dashboard\"\"\"\n    \n    from .models import Announcement, EmailBlast\n    \n    # Get counts\n    active_announcements_count = Announcement.objects.filter(is_active=True).count()\n    total_announcements_count = Announcement.objects.count()\n    sent_emails_count = EmailBlast.objects.filter(status='sent').count()\n    draft_emails_count = EmailBlast.objects.filter(status='draft').count()\n    \n    context = {\n        'active_announcements_count': active_announcements_count,\n        'total_announcements_count': total_announcements_count,\n        'sent_emails_count': sent_emails_count,\n        'draft_emails_count': draft_emails_count,\n    }\n    \n    return render(request, 'core/admin/communications.html', context)\n\n@require_admin\ndef admin_announcements(request):\n    \"\"\"Announcements CRUD interface\"\"\"\n    \n    from .models import Announcement\n    from django.utils import timezone\n    \n    if request.method == 'POST':\n        action = request.POST.get('action')\n        \n        if action == 'create':\n            announcement = Announcement.objects.create(\n                title=request.POST.get('title'),\n                message=request.POST.get('message'),\n                target_audience=request.POST.get('target_audience'),\n                priority=request.POST.get('priority'),\n                display_type=request.POST.get('display_type'),\n                created_by=request.user,\n                is_active=True\n            )\n            \n            # Set start time if provided\n            starts_at = request.POST.get('starts_at')\n            if starts_at:\n                announcement.starts_at = starts_at\n            \n            # Set expiry if provided\n            expires_at = request.POST.get('expires_at')\n            if expires_at:\n                announcement.expires_at = expires_at\n            \n            announcement.save()\n            \n            messages.success(request, 'Announcement created successfully.')\n        \n        elif action == 'update':\n            announcement_id = request.POST.get('announcement_id')\n            announcement = get_object_or_404(Announcement, id=announcement_id)\n            announcement.title = request.POST.get('title')\n            announcement.message = request.POST.get('message')\n            announcement.target_audience = request.POST.get('target_audience')\n            announcement.priority = request.POST.get('priority')\n            announcement.display_type = request.POST.get('display_type')\n            \n            # Only update schedule if provided (preserve existing if empty)\n            starts_at = request.POST.get('starts_at')\n            if starts_at:\n                announcement.starts_at = starts_at\n            \n            expires_at = request.POST.get('expires_at')\n            if expires_at:\n                announcement.expires_at = expires_at\n            \n            announcement.save()\n            messages.success(request, 'Announcement updated successfully.')\n        \n        elif action == 'toggle':\n            announcement_id = request.POST.get('announcement_id')\n            announcement = get_object_or_404(Announcement, id=announcement_id)\n            announcement.is_active = not announcement.is_active\n            announcement.save()\n            status = 'activated' if announcement.is_active else 'deactivated'\n            messages.success(request, f'Announcement {status}.')\n        \n        elif action == 'delete':\n            announcement_id = request.POST.get('announcement_id')\n            announcement = get_object_or_404(Announcement, id=announcement_id)\n            announcement.delete()\n            messages.success(request, 'Announcement deleted successfully.')\n        \n        return redirect('admin_announcements')\n    \n    announcements = Announcement.objects.all().order_by('-created_at')\n    \n    context = {\n        'announcements': announcements,\n    }\n    \n    return render(request, 'core/admin/announcements.html', context)\n\n@login_required\ndef dismiss_announcement(request, announcement_id):\n    \"\"\"Dismiss an announcement for the current user\"\"\"\n    from .models import Announcement\n    \n    if request.method == 'POST':\n        announcement = get_object_or_404(Announcement, id=announcement_id)\n        announcement.dismissed_by.add(request.user)\n        return JsonResponse({'status': 'success'})\n    \n    return JsonResponse({'status': 'error'}, status=400)\n\n@require_admin\ndef admin_email_blasts(request):\n    \"\"\"Email blast management interface\"\"\"\n    \n    from .models import EmailBlast\n    \n    email_blasts = EmailBlast.objects.all().order_by('-created_at')\n    \n    context = {\n        'email_blasts': email_blasts,\n    }\n    \n    return render(request, 'core/admin/email_blasts.html', context)\n\n@require_admin\ndef send_email_blast(request):\n    \"\"\"Send or schedule an email blast\"\"\"\n    \n    from .models import EmailBlast\n    from django.core.mail import send_mail\n    from django.conf import settings\n    from django.utils import timezone\n    \n    if request.method == 'POST':\n        subject = request.POST.get('subject')\n        message = request.POST.get('message')\n        target_audience = request.POST.get('target_audience')\n        \n        # Create email blast record\n        email_blast = EmailBlast.objects.create(\n            subject=subject,\n            message=message,\n            target_audience=target_audience,\n            created_by=request.user,\n            status='sending'\n        )\n        \n        # Get recipient list\n        recipients = []\n        if target_audience == 'all':\n            recipients = User.objects.filter(is_active=True).values_list('email', flat=True)\n        elif target_audience == 'teachers':\n            recipients = User.objects.filter(is_active=True, is_staff=False).values_list('email', flat=True)\n        elif target_audience == 'content_managers':\n            recipients = User.objects.filter(is_active=True, groups__name='content_manager').values_list('email', flat=True)\n        \n        email_blast.recipient_count = len(recipients)\n        email_blast.save()\n        \n        # Send emails\n        sent_count = 0\n        failed_count = 0\n        \n        for recipient_email in recipients:\n            try:\n                send_mail(\n                    subject=subject,\n                    message=message,\n                    from_email=settings.EMAIL_HOST_USER,\n                    recipient_list=[recipient_email],\n                    fail_silently=False,\n                )\n                sent_count += 1\n            except Exception as e:\n                failed_count += 1\n        \n        # Update email blast status\n        email_blast.sent_count = sent_count\n        email_blast.failed_count = failed_count\n        email_blast.status = 'sent' if failed_count == 0 else 'failed'\n        email_blast.sent_at = timezone.now()\n        email_blast.save()\n        \n        if failed_count == 0:\n            messages.success(request, f'Email sent to {sent_count} recipients successfully.')\n        else:\n            messages.warning(request, f'Email sent to {sent_count} recipients. {failed_count} failed.')\n        \n        return redirect('admin_email_blasts')\n    \n    return render(request, 'core/admin/send_email.html')\n\n# ===== CONTENT MANAGER VIEWS =====\n\n@require_content_manager\ndef content_dashboard(request):\n    \"\"\"Content manager dashboard with analytics\"\"\"\n    \n    from .models import PastPaper, Quiz\n    from django.db.models import Count\n    \n    # Analytics\n    total_papers = PastPaper.objects.count()\n    total_quizzes = Quiz.objects.count()\n    premium_quizzes = Quiz.objects.filter(is_premium=True).count()\n    free_quizzes = Quiz.objects.filter(is_premium=False).count()\n    \n    # Recent uploads\n    recent_papers = PastPaper.objects.all().order_by('-uploaded_at')[:10]\n    recent_quizzes = Quiz.objects.all().order_by('-created_at')[:10]\n    \n    context = {\n        'total_papers': total_papers,\n        'total_quizzes': total_quizzes,\n        'premium_quizzes': premium_quizzes,\n        'free_quizzes': free_quizzes,\n        'recent_papers': recent_papers,\n        'recent_quizzes': recent_quizzes,\n    }\n    \n    return render(request, 'core/content/dashboard.html', context)\n\n@require_content_manager\ndef content_papers(request):\n    \"\"\"Past paper management view\"\"\"\n    \n    from .models import PastPaper, ExamBoard, Subject, Grade\n    \n    # Get search and filter parameters\n    search_query = request.GET.get('search', '')\n    board_filter = request.GET.get('board', '')\n    subject_filter = request.GET.get('subject', '')\n    grade_filter = request.GET.get('grade', '')\n    \n    # Filter papers\n    papers = PastPaper.objects.all()\n    \n    if search_query:\n        papers = papers.filter(title__icontains=search_query)\n    if board_filter:\n        papers = papers.filter(exam_board=board_filter)\n    if subject_filter:\n        papers = papers.filter(subject_id=subject_filter)\n    if grade_filter:\n        papers = papers.filter(grade_id=grade_filter)\n    \n    papers = papers.order_by('-uploaded_at')\n    \n    # Get filters for dropdowns\n    boards = ExamBoard.objects.all()\n    subjects = Subject.objects.all()\n    grades = Grade.objects.all()\n    \n    context = {\n        'papers': papers,\n        'boards': boards,\n        'subjects': subjects,\n        'grades': grades,\n        'search_query': search_query,\n        'board_filter': board_filter,\n        'subject_filter': subject_filter,\n        'grade_filter': grade_filter,\n    }\n    \n    return render(request, 'core/content/papers.html', context)\n\n@require_content_manager\ndef content_upload_paper(request):\n    \"\"\"Upload new past paper\"\"\"\n    \n    from .models import PastPaper, ExamBoard, Subject, Grade\n    \n    if request.method == 'POST':\n        title = request.POST.get('title')\n        exam_board = request.POST.get('exam_board')\n        grade_id = request.POST.get('grade')\n        subject_id = request.POST.get('subject')\n        paper_type = request.POST.get('paper_type', 'paper1')\n        paper_code = request.POST.get('paper_code', '')\n        year = request.POST.get('year')\n        chapter = request.POST.get('chapter', '')\n        section = request.POST.get('section', '')\n        notes = request.POST.get('notes', '')\n        file = request.FILES.get('file')\n        \n        # Validation\n        if not all([title, exam_board, grade_id, subject_id, year, file]):\n            messages.error(request, 'Please fill in all required fields and upload a file.')\n            return redirect('content_upload_paper')\n        \n        # Create past paper\n        paper = PastPaper.objects.create(\n            title=title,\n            exam_board=exam_board,\n            grade_id=grade_id,\n            subject_id=subject_id,\n            paper_type=paper_type,\n            paper_code=paper_code if paper_code else f\"{title}_{year}\",\n            year=int(year),\n            chapter=chapter,\n            section=section,\n            notes=notes,\n            file=file,\n            uploaded_by=request.user\n        )\n        \n        messages.success(request, f'Past paper \"{title}\" uploaded successfully!')\n        return redirect('content_papers')\n    \n    # GET request - show form\n    boards = ExamBoard.objects.all()\n    subjects = Subject.objects.all()\n    grades = Grade.objects.all()\n    \n    context = {\n        'boards': boards,\n        'subjects': subjects,\n        'grades': grades,\n    }\n    \n    return render(request, 'core/content/upload_paper.html', context)\n\n@require_content_manager\ndef content_quizzes(request):\n    \"\"\"Quiz management view\"\"\"\n    \n    from .models import Quiz, Subject, Grade\n    \n    # Get filter parameters\n    status_filter = request.GET.get('status', '')  # free or premium\n    subject_filter = request.GET.get('subject', '')\n    grade_filter = request.GET.get('grade', '')\n    \n    # Filter quizzes\n    quizzes = Quiz.objects.all()\n    \n    if status_filter == 'free':\n        quizzes = quizzes.filter(is_premium=False)\n    elif status_filter == 'premium':\n        quizzes = quizzes.filter(is_premium=True)\n    if subject_filter:\n        quizzes = quizzes.filter(subject_id=subject_filter)\n    if grade_filter:\n        quizzes = quizzes.filter(grade_id=grade_filter)\n    \n    quizzes = quizzes.order_by('-created_at')\n    \n    # Get filters for dropdowns\n    subjects = Subject.objects.all()\n    grades = Grade.objects.all()\n    \n    context = {\n        'quizzes': quizzes,\n        'subjects': subjects,\n        'grades': grades,\n        'status_filter': status_filter,\n        'subject_filter': subject_filter,\n        'grade_filter': grade_filter,\n    }\n    \n    return render(request, 'core/content/quizzes.html', context)\n\n@require_content_manager\ndef content_create_quiz(request):\n    \"\"\"Create new quiz\"\"\"\n    \n    from .models import Quiz, Subject, Grade, PastPaper\n    \n    if request.method == 'POST':\n        title = request.POST.get('title')\n        subject_id = request.POST.get('subject')\n        grade_id = request.POST.get('grade')\n        is_premium = request.POST.get('is_premium') == 'on'\n        questions_json = request.POST.get('questions_json', '[]')\n        \n        # Validation\n        if not all([title, subject_id, grade_id]):\n            messages.error(request, 'Please fill in all required fields.')\n            return redirect('content_create_quiz')\n        \n        # Create quiz\n        quiz = Quiz.objects.create(\n            title=title,\n            subject_id=subject_id,\n            grade_id=grade_id,\n            is_premium=is_premium,\n            questions=questions_json,\n            created_by=request.user\n        )\n        \n        messages.success(request, f'Quiz \"{title}\" created successfully!')\n        return redirect('content_quizzes')\n    \n    # GET request - show form\n    subjects = Subject.objects.all()\n    grades = Grade.objects.all()\n    papers = PastPaper.objects.all().order_by('-uploaded_at')[:20]  # Recent papers for AI generation\n    \n    context = {\n        'subjects': subjects,\n        'grades': grades,\n        'papers': papers,\n    }\n    \n    return render(request, 'core/content/create_quiz.html', context)\n\n@require_content_manager  \ndef content_formatted_papers(request):\n    \"\"\"View and manage AI-formatted papers\"\"\"\n    from .models import FormattedPaper, Subject, Grade, ExamBoard\n    \n    # Get filter parameters\n    subject_filter = request.GET.get('subject', '')\n    grade_filter = request.GET.get('grade', '')\n    status_filter = request.GET.get('status', '')  # pending, completed, failed\n    \n    # Filter formatted papers\n    papers = FormattedPaper.objects.select_related('source_paper', 'subject', 'grade', 'created_by')\n    \n    if subject_filter:\n        papers = papers.filter(subject_id=subject_filter)\n    if grade_filter:\n        papers = papers.filter(grade_id=grade_filter)\n    if status_filter:\n        papers = papers.filter(processing_status=status_filter)\n    \n    papers = papers.order_by('-created_at')\n    \n    # Get filters for dropdowns\n    subjects = Subject.objects.all()\n    grades = Grade.objects.all()\n    \n    context = {\n        'formatted_papers': papers,\n        'subjects': subjects,\n        'grades': grades,\n        'subject_filter': subject_filter,\n        'grade_filter': grade_filter,\n        'status_filter': status_filter,\n    }\n    \n    return render(request, 'core/content/formatted_papers.html', context)\n\n@require_content_manager\ndef content_reformat_paper(request, paper_id):\n    \"\"\"AI reformat a past paper - select paper and initiate AI processing\"\"\"\n    from .models import PastPaper, FormattedPaper\n    from .openai_service import extract_questions_from_paper\n    from django.conf import settings\n    import os\n    \n    paper = get_object_or_404(PastPaper, id=paper_id)\n    \n    if request.method == 'POST':\n        try:\n            # Create FormattedPaper record with pending status\n            formatted_paper = FormattedPaper.objects.create(\n                source_paper=paper,\n                title=f\"Formatted: {paper.title}\",\n                subject=paper.subject,\n                grade=paper.grade,\n                exam_board=paper.exam_board,\n                year=paper.year,\n                questions_json={},\n                memo_json={},\n                processing_status='processing',\n                created_by=request.user\n            )\n            \n            # Get the file path\n            file_path = paper.file.path\n            \n            # Call AI service to extract questions\n            result = extract_questions_from_paper(\n                file_path=file_path,\n                subject=paper.subject.name,\n                grade=paper.grade.number,\n                exam_board=paper.exam_board,\n                paper_type=paper.paper_type,\n                model='gpt-4'  # Use best model for accuracy\n            )\n            \n            # Update formatted paper with results\n            formatted_paper.questions_json = result['questions_json']\n            formatted_paper.memo_json = result['memo_json']\n            formatted_paper.total_questions = result['total_questions']\n            formatted_paper.total_marks = result['total_marks']\n            formatted_paper.question_type = result['question_type']\n            formatted_paper.ai_model_used = result['ai_model_used']\n            formatted_paper.processing_status = 'completed'\n            formatted_paper.save()\n            \n            messages.success(request, f'Successfully extracted {result[\"total_questions\"]} questions from the paper!')\n            return redirect('content_review_formatted_paper', paper_id=formatted_paper.id)\n            \n        except Exception as e:\n            # Update status to failed\n            if 'formatted_paper' in locals():\n                formatted_paper.processing_status = 'failed'\n                formatted_paper.error_message = str(e)\n                formatted_paper.save()\n            \n            messages.error(request, f'Failed to process paper: {str(e)}')\n            return redirect('content_papers')\n    \n    # GET request - show confirmation\n    context = {\n        'paper': paper,\n    }\n    return render(request, 'core/content/reformat_paper.html', context)\n\n@require_content_manager\ndef content_review_formatted_paper(request, paper_id):\n    \"\"\"Review and edit AI-extracted questions and memo\"\"\"\n    from .models import FormattedPaper\n    import json\n    \n    formatted_paper = get_object_or_404(FormattedPaper, id=paper_id)\n    \n    if request.method == 'POST':\n        # Handle save of edited questions and memo\n        action = request.POST.get('action')\n        \n        if action == 'save':\n            try:\n                # Get updated JSON from form\n                questions_json = json.loads(request.POST.get('questions_json', '{}'))\n                memo_json = json.loads(request.POST.get('memo_json', '{}'))\n                \n                # Update formatted paper\n                formatted_paper.questions_json = questions_json\n                formatted_paper.memo_json = memo_json\n                formatted_paper.total_questions = len(questions_json.get('questions', []))\n                formatted_paper.reviewed = True\n                formatted_paper.save()\n                \n                messages.success(request, 'Changes saved successfully!')\n                return redirect('content_review_formatted_paper', paper_id=paper_id)\n                \n            except json.JSONDecodeError:\n                messages.error(request, 'Invalid JSON format. Please check your edits.')\n        \n        elif action == 'publish':\n            formatted_paper.is_published = True\n            formatted_paper.reviewed = True\n            formatted_paper.save()\n            messages.success(request, 'Formatted paper published successfully!')\n            return redirect('content_formatted_papers')\n    \n    # Format JSON for display in textarea\n    questions_json_str = json.dumps(formatted_paper.questions_json, indent=2)\n    memo_json_str = json.dumps(formatted_paper.memo_json, indent=2)\n    \n    context = {\n        'formatted_paper': formatted_paper,\n        'questions_json_str': questions_json_str,\n        'memo_json_str': memo_json_str,\n        'source_paper': formatted_paper.source_paper,\n    }\n    \n    return render(request, 'core/content/review_formatted_paper.html', context)\n\n@require_content_manager\ndef content_bulk_upload(request):\n    \"\"\"Bulk upload of past papers, quizzes, or assignments\"\"\"\n    from .models import PastPaper, Quiz, GeneratedAssignment\n    \n    if request.method == 'POST':\n        upload_type = request.POST.get('upload_type')\n        files = request.FILES.getlist('files')\n        \n        if not files:\n            return JsonResponse({'success': False, 'error': 'No files provided'})\n        \n        # Validate file sizes and types\n        MAX_FILE_SIZE = 10 * 1024 * 1024  # 10MB\n        ALLOWED_EXTENSIONS = {'.pdf', '.docx', '.txt'}\n        \n        for file in files:\n            if file.size > MAX_FILE_SIZE:\n                return JsonResponse({\n                    'success': False,\n                    'error': f'File {file.name} exceeds 10MB limit'\n                })\n            \n            file_ext = os.path.splitext(file.name)[1].lower()\n            if file_ext not in ALLOWED_EXTENSIONS:\n                return JsonResponse({\n                    'success': False,\n                    'error': f'File {file.name} has unsupported format. Only PDF, DOCX, and TXT allowed.'\n                })\n        \n        results = {\n            'success': True,\n            'uploaded_count': 0,\n            'failed_count': 0,\n            'details': []\n        }\n        \n        try:\n            if upload_type == 'pastpaper':\n                # Get shared metadata for past papers\n                exam_board_id = request.POST.get('exam_board_id')\n                year = request.POST.get('year')\n                subject_id = request.POST.get('subject_id')\n                grade_id = request.POST.get('grade_id')\n                chapter = request.POST.get('chapter', '')\n                section = request.POST.get('section', '')\n                \n                exam_board = get_object_or_404(ExamBoard, id=exam_board_id)\n                subject = get_object_or_404(Subject, id=subject_id)\n                grade = get_object_or_404(Grade, id=grade_id)\n                \n                for file in files:\n                    try:\n                        # Auto-generate title from filename\n                        title = os.path.splitext(file.name)[0]\n                        \n                        # Create past paper (exam_board is CharField, use abbreviation)\n                        paper = PastPaper.objects.create(\n                            title=title,\n                            exam_board=exam_board.abbreviation,\n                            year=year,\n                            subject=subject,\n                            grade=grade,\n                            chapter=chapter,\n                            section=section,\n                            file=file,\n                            uploaded_by=request.user\n                        )\n                        \n                        results['uploaded_count'] += 1\n                        results['details'].append({\n                            'filename': file.name,\n                            'success': True\n                        })\n                        \n                    except Exception as e:\n                        results['failed_count'] += 1\n                        results['details'].append({\n                            'filename': file.name,\n                            'success': False,\n                            'error': str(e)\n                        })\n            \n            elif upload_type == 'quiz':\n                # Get shared metadata for quizzes\n                exam_board_id = request.POST.get('exam_board_id')\n                grade_id = request.POST.get('grade_id')\n                subject_id = request.POST.get('subject_id')\n                topic = request.POST.get('topic')\n                is_premium = request.POST.get('is_premium') == 'true'\n                \n                exam_board = get_object_or_404(ExamBoard, id=exam_board_id)\n                grade = get_object_or_404(Grade, id=grade_id)\n                subject = get_object_or_404(Subject, id=subject_id)\n                \n                for file in files:\n                    try:\n                        # Auto-generate title from filename\n                        title = os.path.splitext(file.name)[0]\n                        \n                        # Expect files to be text files with Google Forms links\n                        # Or create quizzes without links if PDFs\n                        google_form_link = ''\n                        if file.name.endswith('.txt'):\n                            google_form_link = file.read().decode('utf-8').strip()\n                        \n                        # Create quiz (exam_board is CharField, use abbreviation)\n                        quiz = Quiz.objects.create(\n                            title=title,\n                            exam_board=exam_board.abbreviation,\n                            grade=grade,\n                            subject=subject,\n                            topic=topic,\n                            is_premium=is_premium,\n                            google_form_link=google_form_link,\n                            created_by=request.user\n                        )\n                        \n                        results['uploaded_count'] += 1\n                        results['details'].append({\n                            'filename': file.name,\n                            'success': True\n                        })\n                        \n                    except Exception as e:\n                        results['failed_count'] += 1\n                        results['details'].append({\n                            'filename': file.name,\n                            'success': False,\n                            'error': str(e)\n                        })\n            \n            elif upload_type == 'assignment':\n                # Get shared metadata for assignments\n                subject_id = request.POST.get('subject_id')\n                grade_id = request.POST.get('grade_id')\n                topic = request.POST.get('topic')\n                \n                subject = get_object_or_404(Subject, id=subject_id)\n                grade = get_object_or_404(Grade, id=grade_id)\n                \n                for file in files:\n                    try:\n                        # Auto-generate title from filename\n                        title = os.path.splitext(file.name)[0]\n                        \n                        # Create assignment\n                        assignment = GeneratedAssignment.objects.create(\n                            user=request.user,\n                            subject=subject,\n                            grade=grade,\n                            topic=topic,\n                            assignment_type='worksheet',\n                            content=f'Uploaded: {title}',\n                            file=file\n                        )\n                        \n                        results['uploaded_count'] += 1\n                        results['details'].append({\n                            'filename': file.name,\n                            'success': True\n                        })\n                        \n                    except Exception as e:\n                        results['failed_count'] += 1\n                        results['details'].append({\n                            'filename': file.name,\n                            'success': False,\n                            'error': str(e)\n                        })\n            \n            else:\n                return JsonResponse({'success': False, 'error': 'Invalid upload type'})\n        \n        except Exception as e:\n            return JsonResponse({'success': False, 'error': str(e)})\n        \n        return JsonResponse(results)\n    \n    # GET request - show form\n    subjects = Subject.objects.all()\n    grades = Grade.objects.all()\n    exam_boards = ExamBoard.objects.all()\n    \n    context = {\n        'subjects': subjects,\n        'grades': grades,\n        'exam_boards': exam_boards,\n    }\n    \n    return render(request, 'core/content/bulk_upload.html', context)\n\n\n@require_content_manager\ndef official_papers_bulk_upload(request):\n    \"\"\"Bulk upload official exam papers via folder structure with 2-step flow\"\"\"\n    from .models import OfficialExamPaper\n    from django.db import IntegrityError\n    import re\n    from datetime import datetime\n    from pathlib import PurePosixPath\n    \n    # Security: Sanitize file paths to prevent directory traversal\n    # Max depth is 4 to support optional session subfolder: Subject Name (CODE)/YEAR/[Session]/filename.pdf\n    def sanitize_file_path(path, max_depth=4):\n        \"\"\"\n        Sanitize and validate file paths to prevent security issues.\n        Returns the sanitized path or raises ValueError.\n        \"\"\"\n        try:\n            safe_path = PurePosixPath(path)\n            \n            # Check for directory traversal attempts\n            if '..' in safe_path.parts:\n                raise ValueError(\"Path contains invalid '..' component\")\n            \n            # Check for absolute paths\n            if safe_path.is_absolute():\n                raise ValueError(\"Absolute paths not allowed\")\n            \n            # Check path depth\n            if len(safe_path.parts) > max_depth:\n                raise ValueError(f\"Path depth exceeds maximum of {max_depth} levels\")\n            \n            # Check for dangerous characters\n            path_str = str(safe_path)\n            dangerous_chars = ['\\\\', '\\x00', '\\n', '\\r']\n            if any(char in path_str for char in dangerous_chars):\n                raise ValueError(\"Path contains invalid characters\")\n            \n            return path_str\n        except Exception as e:\n            raise ValueError(f\"Invalid path: {str(e)}\")\n    \n    # Improved parser that handles multiple board formats\n    def parse_filename(filename, file_path=''):\n        \"\"\"\n        Parse different exam paper filename formats from various boards.\n        Supports Cambridge, Edexcel, CAPS, ZIMSEC, IEB, and generic formats.\n        Returns dict with parsed metadata and any warnings.\n        \"\"\"\n        filename_lower = filename.lower()\n        warnings = []\n        \n        parsed = {\n            'session': 'other',\n            'paper_number': '',\n            'variant': '',\n            'paper_type': 'qp',\n            'year': None,\n            'subject_name': '',\n        }\n        \n        # === YEAR EXTRACTION ===\n        # Try to extract year from filename or path\n        year_match = re.search(r'(20[0-2]\\d)', filename)\n        if year_match:\n            parsed['year'] = int(year_match.group(1))\n        elif file_path:\n            year_match = re.search(r'(20[0-2]\\d)', file_path)\n            if year_match:\n                parsed['year'] = int(year_match.group(1))\n        \n        # If no year found, try 2-digit year format\n        if not parsed['year']:\n            year_match = re.search(r'[_\\s](\\d{2})[_\\s.]', filename_lower)\n            if year_match:\n                year_2digit = int(year_match.group(1))\n                # Assume 20xx for years < 50, 19xx otherwise\n                parsed['year'] = 2000 + year_2digit if year_2digit < 50 else 1900 + year_2digit\n        \n        # === SESSION DETECTION ===\n        # Cambridge style: _s23, _w23, _m23, _y23\n        if re.search(r'_s\\d{2}', filename_lower):\n            parsed['session'] = 'june'\n        elif re.search(r'_w\\d{2}', filename_lower):\n            parsed['session'] = 'november'\n        elif re.search(r'_m\\d{2}', filename_lower):\n            parsed['session'] = 'may'\n        elif re.search(r'_y\\d{2}', filename_lower):\n            parsed['session'] = 'february'\n        # Word-based detection\n        elif 'june' in filename_lower:\n            parsed['session'] = 'june'\n        elif 'november' in filename_lower or 'nov' in filename_lower:\n            parsed['session'] = 'november'\n        elif 'may' in filename_lower:\n            parsed['session'] = 'may'\n        elif 'feb' in filename_lower or 'march' in filename_lower:\n            parsed['session'] = 'february'\n        elif 'oct' in filename_lower or 'october' in filename_lower:\n            parsed['session'] = 'october'\n        elif 'summer' in filename_lower:\n            parsed['session'] = 'summer'\n        elif 'winter' in filename_lower:\n            parsed['session'] = 'winter'\n        else:\n            warnings.append(\"Could not determine session - defaulting to 'other'\")\n        \n        # === PAPER TYPE DETECTION ===\n        if '_ms' in filename_lower or 'marking' in filename_lower or 'memo' in filename_lower or 'mark scheme' in filename_lower:\n            parsed['paper_type'] = 'ms'\n        elif '_qp' in filename_lower or 'question' in filename_lower or '_que_' in filename_lower:\n            parsed['paper_type'] = 'qp'\n        elif 'examiner' in filename_lower or '_er' in filename_lower or 'exam report' in filename_lower:\n            parsed['paper_type'] = 'er'\n        elif 'grade' in filename_lower and 'threshold' in filename_lower:\n            parsed['paper_type'] = 'gt'\n        elif 'insert' in filename_lower or 'resource' in filename_lower:\n            parsed['paper_type'] = 'ir'\n        elif 'specimen' in filename_lower:\n            parsed['paper_type'] = 'specimen'\n        \n        # === PAPER NUMBER & VARIANT EXTRACTION ===\n        # Cambridge style: _21, _42 (paper 2 variant 1, paper 4 variant 2)\n        cambridge_match = re.search(r'_([1-9])([1-9])', filename_lower)\n        if cambridge_match:\n            parsed['paper_number'] = cambridge_match.group(1)\n            parsed['variant'] = cambridge_match.group(2)\n        else:\n            # Edexcel style: Paper 1, Paper 2, etc.\n            paper_match = re.search(r'(?:paper|p)[\\s_]?(\\d+[hlfm]?)', filename_lower)\n            if paper_match:\n                parsed['paper_number'] = paper_match.group(1).upper()\n            \n            # CAPS/IEB style: \"P1\", \"P2\" \n            if not parsed['paper_number']:\n                caps_match = re.search(r'\\bp(\\d+)\\b', filename_lower)\n                if caps_match:\n                    parsed['paper_number'] = caps_match.group(1)\n            \n            # Variant detection (separate from paper number)\n            variant_match = re.search(r'(?:variant|v)[\\s_]?(\\d+)', filename_lower)\n            if variant_match:\n                parsed['variant'] = variant_match.group(1)\n        \n        # === SUBJECT NAME EXTRACTION (for generic formats) ===\n        # Look for common subject names in filename\n        subjects = {\n            'mathematics': 'Mathematics',\n            'math': 'Mathematics',\n            'physics': 'Physics',\n            'chemistry': 'Chemistry',\n            'biology': 'Biology',\n            'english': 'English',\n            'history': 'History',\n            'geography': 'Geography',\n            'science': 'Science',\n        }\n        \n        for key, value in subjects.items():\n            if key in filename_lower:\n                parsed['subject_name'] = value\n                break\n        \n        # Validate critical fields\n        if not parsed['paper_number']:\n            warnings.append(\"Could not extract paper number - defaulting to '1'\")\n            parsed['paper_number'] = '1'\n        \n        if not parsed['year']:\n            warnings.append(f\"Could not extract year from filename or path\")\n        \n        return parsed, warnings\n    \n    if request.method == 'POST':\n        action = request.POST.get('action', 'preview')  # 'preview' or 'confirm'\n        board_name = request.POST.get('board')\n        \n        if not board_name:\n            return JsonResponse({'success': False, 'error': 'No exam board provided'})\n        \n        # Get ExamBoard by name (name_full, abbreviation, or common aliases)\n        # Common aliases map to database names\n        board_aliases = {\n            'cambridge': ['Cambridge International', 'CIE', 'CAIE', 'Cambridge'],\n            'edexcel': ['Edexcel', 'EDX', 'Pearson Edexcel'],\n            'caps': ['Department of Basic Education (CAPS)', 'CAPS', 'DBE'],\n            'zimsec': ['Zimbabwe School Examinations Council', 'ZIMSEC'],\n            'ieb': ['Independent Examinations Board', 'IEB'],\n            'aqa': ['AQA'],\n            'ocr': ['OCR'],\n        }\n        \n        try:\n            # First try exact match on name_full or abbreviation\n            exam_board = ExamBoard.objects.filter(\n                Q(name_full__iexact=board_name) | Q(abbreviation__iexact=board_name)\n            ).first()\n            \n            # If not found, try common aliases\n            if not exam_board:\n                board_name_lower = board_name.lower()\n                if board_name_lower in board_aliases:\n                    for alias in board_aliases[board_name_lower]:\n                        exam_board = ExamBoard.objects.filter(\n                            Q(name_full__iexact=alias) | Q(abbreviation__iexact=alias)\n                        ).first()\n                        if exam_board:\n                            break\n            \n            # Also try partial match on name_full (e.g., \"Cambridge\" matches \"Cambridge International\")\n            if not exam_board:\n                exam_board = ExamBoard.objects.filter(\n                    name_full__icontains=board_name\n                ).first()\n            \n            if not exam_board:\n                # List available boards to help user\n                available_boards = ExamBoard.objects.values_list('name_full', flat=True)\n                return JsonResponse({\n                    'success': False, \n                    'error': f'Exam board \"{board_name}\" not found. Available boards: {\", \".join(available_boards)}'\n                })\n        except Exception as e:\n            return JsonResponse({'success': False, 'error': f'Error finding exam board: {str(e)}'})\n        \n        # === STEP 1: PREVIEW & PARSE ===\n        if action == 'preview':\n            files = request.FILES.getlist('files')\n            file_paths = request.POST.getlist('file_paths')\n            \n            if not files:\n                return JsonResponse({'success': False, 'error': 'No files provided'})\n            \n            results = {\n                'success': True,\n                'action': 'preview',\n                'total_files': len(files),\n                'parseable_count': 0,\n                'ready_count': 0,  # New papers to upload\n                'existing_count': 0,  # Papers already in database (will skip)\n                'warning_count': 0,\n                'error_count': 0,\n                'failed_count': 0,\n                'papers': []\n            }\n            \n            for idx, file in enumerate(files):\n                file_path = file_paths[idx] if idx < len(file_paths) else file.name\n                paper_result = {\n                    'filename': file.name,\n                    'file_path': file_path,\n                    'status': 'error',\n                    'warnings': [],\n                    'errors': []\n                }\n                \n                try:\n                    # Sanitize file path\n                    try:\n                        safe_path = sanitize_file_path(file_path)\n                        paper_result['safe_path'] = safe_path\n                    except ValueError as e:\n                        paper_result['errors'].append(f\"Path validation failed: {str(e)}\")\n                        results['failed_count'] += 1\n                        results['error_count'] += 1\n                        results['papers'].append(paper_result)\n                        continue\n                    \n                    # Parse folder structure: Subject Name (CODE)/YEAR/filename.pdf\n                    # Example: Chemistry (0620)/2011/0620_s11_qp_11.pdf\n                    path_parts = safe_path.split('/')\n                    subject_code = ''\n                    subject_name = ''\n                    year_from_path = None\n                    \n                    if len(path_parts) >= 3:\n                        # Expected format: \"Subject Name (CODE)/YEAR/filename.pdf\"\n                        subject_folder = path_parts[0]\n                        year_folder = path_parts[1]\n                        \n                        # Extract subject name and code from \"Subject Name (CODE)\"\n                        subject_match = re.match(r'^(.+?)\\s*\\(([^)]+)\\)$', subject_folder)\n                        if subject_match:\n                            subject_name = subject_match.group(1).strip()\n                            subject_code = subject_match.group(2).strip()\n                        else:\n                            # MANDATORY FORMAT: Reject if format doesn't match\n                            paper_result['errors'].append(f\"Subject folder must be in format 'Subject Name (CODE)', got: '{subject_folder}'\")\n                            results['failed_count'] += 1\n                            results['error_count'] += 1\n                            results['papers'].append(paper_result)\n                            continue\n                        \n                        # Extract year from folder - flexible matching (allows \"2023\", \"2023 June\", etc.)\n                        year_match = re.search(r'([12]\\d{3})', year_folder)\n                        if year_match:\n                            year_from_path = int(year_match.group(1))\n                            # Warn if folder name isn't exactly a year\n                            if year_folder != year_match.group(1):\n                                paper_result['warnings'].append(\n                                    f\"Year folder '{year_folder}' contains extra text; using year {year_from_path}\"\n                                )\n                        else:\n                            paper_result['errors'].append(\n                                f\"Year folder must contain a 4-digit year (e.g., '2011', '2023'), got: '{year_folder}'\"\n                            )\n                            results['failed_count'] += 1\n                            results['error_count'] += 1\n                            results['papers'].append(paper_result)\n                            continue\n                    \n                    elif len(path_parts) < 3:\n                        # MANDATORY 3-LEVEL STRUCTURE: Reject if not properly organized\n                        paper_result['errors'].append(\n                            f\"Invalid folder structure. Expected: 'Subject Name (CODE)/YEAR/filename.pdf' \"\n                            f\"(3 levels), but got {len(path_parts)} level(s). \"\n                            f\"Please organize files correctly.\"\n                        )\n                        results['failed_count'] += 1\n                        results['error_count'] += 1\n                        results['papers'].append(paper_result)\n                        continue\n                    \n                    # Parse filename\n                    parsed, parse_warnings = parse_filename(file.name, safe_path)\n                    paper_result['warnings'].extend(parse_warnings)\n                    \n                    # Use year from path if available, otherwise use parsed year\n                    year = year_from_path or parsed['year'] or datetime.now().year\n                    \n                    # Validate year\n                    current_year = datetime.now().year\n                    if year < 1990 or year > current_year + 1:\n                        paper_result['warnings'].append(f\"Unusual year detected: {year}\")\n                    \n                    # Build paper data\n                    # Prioritize subject_name from folder structure, fallback to filename parsing\n                    final_subject_name = subject_name or parsed.get('subject_name', '')\n                    \n                    # Check if this paper already exists in the database\n                    existing_paper = OfficialExamPaper.objects.filter(\n                        exam_board=exam_board,\n                        subject_code=subject_code,\n                        year=year,\n                        session=parsed['session'],\n                        paper_number=parsed['paper_number'],\n                        variant=parsed['variant'] or '',\n                        paper_type=parsed['paper_type']\n                    ).first()\n                    \n                    if existing_paper:\n                        # Paper already exists - mark for skipping\n                        paper_result.update({\n                            'status': 'exists',\n                            'board': exam_board.name_full,\n                            'board_id': exam_board.id,\n                            'subject_code': subject_code,\n                            'subject_name': final_subject_name,\n                            'original_filename': file.name,\n                            'year': year,\n                            'session': parsed['session'],\n                            'paper_number': parsed['paper_number'],\n                            'variant': parsed['variant'],\n                            'paper_type': parsed['paper_type'],\n                            'file_size': file.size,\n                            'existing_id': existing_paper.id,\n                        })\n                        results['existing_count'] += 1\n                        results['parseable_count'] += 1\n                    else:\n                        # New paper - ready to upload\n                        paper_result.update({\n                            'status': 'ready',\n                            'board': exam_board.name_full,\n                            'board_id': exam_board.id,\n                            'subject_code': subject_code,\n                            'subject_name': final_subject_name,\n                            'original_filename': file.name,\n                            'year': year,\n                            'session': parsed['session'],\n                            'paper_number': parsed['paper_number'],\n                            'variant': parsed['variant'],\n                            'paper_type': parsed['paper_type'],\n                            'file_size': file.size,\n                        })\n                        results['parseable_count'] += 1\n                        results['ready_count'] += 1\n                    \n                    if paper_result['warnings']:\n                        results['warning_count'] += 1\n                    \n                except Exception as e:\n                    paper_result['status'] = 'error'\n                    paper_result['errors'].append(f\"Parsing error: {str(e)}\")\n                    results['failed_count'] += 1\n                    results['error_count'] += 1\n                \n                results['papers'].append(paper_result)\n            \n            return JsonResponse(results)\n        \n        # === STEP 2: CONFIRM & SAVE ===\n        elif action == 'confirm':\n            import json\n            \n            files = request.FILES.getlist('files')\n            file_paths = request.POST.getlist('file_paths')\n            papers_data_json = request.POST.get('papers_data')\n            \n            if not files or not papers_data_json:\n                return JsonResponse({'success': False, 'error': 'Missing files or paper data'})\n            \n            try:\n                papers_data = json.loads(papers_data_json)\n            except json.JSONDecodeError:\n                return JsonResponse({'success': False, 'error': 'Invalid paper data format'})\n            \n            results = {\n                'success': True,\n                'action': 'confirm',\n                'uploaded_count': 0,\n                'success_count': 0,  # Alias for frontend compatibility\n                'skipped_count': 0,\n                'existing_skipped': 0,  # Papers skipped because they already exist\n                'failed_count': 0,\n                'details': []\n            }\n            \n            for idx, file in enumerate(files):\n                try:\n                    # Get corresponding paper data\n                    if idx >= len(papers_data):\n                        continue\n                    \n                    paper_data = papers_data[idx]\n                    \n                    # Skip if parsing failed (status is 'error')\n                    if paper_data.get('status') == 'error':\n                        results['skipped_count'] += 1\n                        results['details'].append({\n                            'filename': file.name,\n                            'status': 'skipped',\n                            'reason': 'Parsing error'\n                        })\n                        continue\n                    \n                    # Skip if paper already exists in database\n                    if paper_data.get('status') == 'exists':\n                        results['skipped_count'] += 1\n                        results['existing_skipped'] += 1\n                        results['details'].append({\n                            'filename': file.name,\n                            'status': 'skipped',\n                            'reason': 'Already exists in database'\n                        })\n                        continue\n                    \n                    # SECURITY: Re-validate file path before saving (don't trust frontend data)\n                    file_path = file_paths[idx] if idx < len(file_paths) else file.name\n                    try:\n                        safe_path = sanitize_file_path(file_path)\n                    except ValueError as e:\n                        results['failed_count'] += 1\n                        results['details'].append({\n                            'filename': file.name,\n                            'status': 'error',\n                            'error': f\"Path validation failed: {str(e)}\"\n                        })\n                        continue\n                    \n                    # Try to create official exam paper - database will reject duplicates\n                    try:\n                        paper = OfficialExamPaper.objects.create(\n                            exam_board=exam_board,\n                            subject_code=paper_data['subject_code'],\n                            subject_name=paper_data.get('subject_name', ''),\n                            year=paper_data['year'],\n                            session=paper_data['session'],\n                            paper_number=paper_data['paper_number'],\n                            variant=paper_data.get('variant', ''),\n                            paper_type=paper_data['paper_type'],\n                            original_filename=file.name,\n                            file=file,  # Django handles secure storage automatically\n                            metadata_json={\n                                'parsed_data': paper_data,\n                                'upload_date': datetime.now().isoformat(),\n                                'warnings': paper_data.get('warnings', [])\n                            },\n                            uploaded_by=request.user\n                        )\n                        \n                        results['uploaded_count'] += 1\n                        results['success_count'] += 1  # Alias for frontend\n                        results['details'].append({\n                            'filename': file.name,\n                            'status': 'success',\n                            'paper_id': paper.id,\n                            'display_name': paper.get_display_name()\n                        })\n                    \n                    except IntegrityError:\n                        # Database rejected duplicate - this is expected\n                        results['skipped_count'] += 1\n                        results['details'].append({\n                            'filename': file.name,\n                            'status': 'skipped',\n                            'reason': 'Duplicate paper already exists'\n                        })\n                    \n                except Exception as e:\n                    results['failed_count'] += 1\n                    results['details'].append({\n                        'filename': file.name,\n                        'status': 'error',\n                        'error': str(e)\n                    })\n            \n            return JsonResponse(results)\n        \n        else:\n            return JsonResponse({'success': False, 'error': 'Invalid action'})\n    \n    # GET request - show form\n    exam_boards = ExamBoard.objects.all().order_by('name_full')\n    context = {\n        'exam_boards': exam_boards,\n    }\n    return render(request, 'core/content/official_papers_upload.html', context)\n\n\n# ===== STUDENT CONTENT MANAGEMENT VIEWS =====\n\n@require_content_manager\ndef create_interactive_question(request):\n    \"\"\"Create new interactive question\"\"\"\n    from .models import InteractiveQuestion\n    import json\n    \n    if request.method == 'POST':\n        subject_id = request.POST.get('subject')\n        exam_board_id = request.POST.get('exam_board')\n        grade_id = request.POST.get('grade')\n        topic = request.POST.get('topic')\n        question_type = request.POST.get('question_type')\n        difficulty = request.POST.get('difficulty')\n        question_text = request.POST.get('question_text')\n        explanation = request.POST.get('explanation', '')\n        points = request.POST.get('points', 1)\n        question_image = request.FILES.get('question_image')\n        \n        # Validation\n        if not all([subject_id, exam_board_id, grade_id, topic, question_type, difficulty, question_text]):\n            messages.error(request, 'Please fill in all required fields.')\n            return redirect('create_interactive_question')\n        \n        # Get correct answer and options based on question type\n        correct_answer = ''\n        options = None\n        matching_pairs = None\n        \n        if question_type == 'mcq':\n            # Get options and correct answer\n            option_count = int(request.POST.get('option_count', 4))\n            options = []\n            for i in range(option_count):\n                option_text = request.POST.get(f'option_{i}')\n                if option_text:\n                    options.append(option_text)\n            correct_answer = request.POST.get('correct_answer_mcq', '')\n            \n        elif question_type == 'true_false':\n            correct_answer = request.POST.get('correct_answer_tf', '')\n            \n        elif question_type == 'fill_blank':\n            correct_answer = request.POST.get('correct_answer_fill', '')\n            \n        elif question_type == 'matching':\n            # Get matching pairs\n            pair_count = int(request.POST.get('pair_count', 4))\n            matching_pairs = []\n            for i in range(pair_count):\n                left = request.POST.get(f'pair_left_{i}')\n                right = request.POST.get(f'pair_right_{i}')\n                if left and right:\n                    matching_pairs.append({'left': left, 'right': right})\n            correct_answer = json.dumps(matching_pairs)\n            \n        elif question_type == 'essay':\n            correct_answer = ''  # No correct answer for essay questions\n        \n        # Create question\n        question = InteractiveQuestion.objects.create(\n            subject_id=subject_id,\n            exam_board_id=exam_board_id,\n            grade_id=grade_id,\n            topic=topic,\n            question_type=question_type,\n            difficulty=difficulty,\n            question_text=question_text,\n            question_image=question_image,\n            options=options,\n            correct_answer=correct_answer,\n            matching_pairs=matching_pairs,\n            explanation=explanation,\n            points=int(points),\n            created_by=request.user\n        )\n        \n        messages.success(request, f'Question created successfully!')\n        return redirect('manage_interactive_questions')\n    \n    # GET request - show form\n    subjects = Subject.objects.all()\n    grades = Grade.objects.all()\n    exam_boards = ExamBoard.objects.all()\n    \n    context = {\n        'subjects': subjects,\n        'grades': grades,\n        'exam_boards': exam_boards,\n    }\n    \n    return render(request, 'core/content/interactive_question_form.html', context)\n\n\n@require_content_manager\ndef manage_interactive_questions(request):\n    \"\"\"List and manage interactive questions\"\"\"\n    from .models import InteractiveQuestion\n    \n    # Get filter parameters\n    subject_filter = request.GET.get('subject', '')\n    grade_filter = request.GET.get('grade', '')\n    question_type_filter = request.GET.get('question_type', '')\n    difficulty_filter = request.GET.get('difficulty', '')\n    search_query = request.GET.get('search', '')\n    \n    # Filter questions\n    questions = InteractiveQuestion.objects.all().select_related('subject', 'grade', 'exam_board')\n    \n    if subject_filter:\n        questions = questions.filter(subject_id=subject_filter)\n    if grade_filter:\n        questions = questions.filter(grade_id=grade_filter)\n    if question_type_filter:\n        questions = questions.filter(question_type=question_type_filter)\n    if difficulty_filter:\n        questions = questions.filter(difficulty=difficulty_filter)\n    if search_query:\n        questions = questions.filter(\n            Q(question_text__icontains=search_query) |\n            Q(topic__icontains=search_query)\n        )\n    \n    questions = questions.order_by('-created_at')\n    \n    # Get filters for dropdowns\n    subjects = Subject.objects.all()\n    grades = Grade.objects.all()\n    \n    context = {\n        'questions': questions,\n        'subjects': subjects,\n        'grades': grades,\n        'subject_filter': subject_filter,\n        'grade_filter': grade_filter,\n        'question_type_filter': question_type_filter,\n        'difficulty_filter': difficulty_filter,\n        'search_query': search_query,\n    }\n    \n    return render(request, 'core/content/interactive_questions_list.html', context)\n\n\n@require_content_manager\ndef edit_interactive_question(request, question_id):\n    \"\"\"Edit interactive question\"\"\"\n    from .models import InteractiveQuestion\n    import json\n    \n    question = get_object_or_404(InteractiveQuestion, id=question_id)\n    \n    if request.method == 'POST':\n        question.subject_id = request.POST.get('subject')\n        question.exam_board_id = request.POST.get('exam_board')\n        question.grade_id = request.POST.get('grade')\n        question.topic = request.POST.get('topic')\n        question.question_type = request.POST.get('question_type')\n        question.difficulty = request.POST.get('difficulty')\n        question.question_text = request.POST.get('question_text')\n        question.explanation = request.POST.get('explanation', '')\n        question.points = int(request.POST.get('points', 1))\n        \n        if request.FILES.get('question_image'):\n            question.question_image = request.FILES.get('question_image')\n        \n        # Update correct answer and options based on question type\n        if question.question_type == 'mcq':\n            option_count = int(request.POST.get('option_count', 4))\n            options = []\n            for i in range(option_count):\n                option_text = request.POST.get(f'option_{i}')\n                if option_text:\n                    options.append(option_text)\n            question.options = options\n            question.correct_answer = request.POST.get('correct_answer_mcq', '')\n            \n        elif question.question_type == 'true_false':\n            question.correct_answer = request.POST.get('correct_answer_tf', '')\n            \n        elif question.question_type == 'fill_blank':\n            question.correct_answer = request.POST.get('correct_answer_fill', '')\n            \n        elif question.question_type == 'matching':\n            pair_count = int(request.POST.get('pair_count', 4))\n            matching_pairs = []\n            for i in range(pair_count):\n                left = request.POST.get(f'pair_left_{i}')\n                right = request.POST.get(f'pair_right_{i}')\n                if left and right:\n                    matching_pairs.append({'left': left, 'right': right})\n            question.matching_pairs = matching_pairs\n            question.correct_answer = json.dumps(matching_pairs)\n        \n        question.save()\n        messages.success(request, 'Question updated successfully!')\n        return redirect('manage_interactive_questions')\n    \n    # GET request - show form\n    subjects = Subject.objects.all()\n    grades = Grade.objects.all()\n    exam_boards = ExamBoard.objects.all()\n    \n    context = {\n        'question': question,\n        'subjects': subjects,\n        'grades': grades,\n        'exam_boards': exam_boards,\n        'editing': True,\n    }\n    \n    return render(request, 'core/content/interactive_question_form.html', context)\n\n\n@require_content_manager\ndef delete_interactive_question(request, question_id):\n    \"\"\"Delete interactive question\"\"\"\n    from .models import InteractiveQuestion\n    \n    if request.method == 'POST':\n        question = get_object_or_404(InteractiveQuestion, id=question_id)\n        question.delete()\n        messages.success(request, 'Question deleted successfully!')\n    \n    return redirect('manage_interactive_questions')\n\n\n@require_content_manager\ndef create_student_quiz(request):\n    \"\"\"Create new student quiz with multi-step builder\"\"\"\n    from .models import StudentQuiz, InteractiveQuestion\n    import json\n    \n    if request.method == 'POST':\n        # Check which step we're on\n        step = request.POST.get('step', '1')\n        \n        if step == 'final':\n            # Final step - create quiz\n            title = request.POST.get('title')\n            subject_id = request.POST.get('subject')\n            exam_board_id = request.POST.get('exam_board')\n            grade_id = request.POST.get('grade')\n            topic = request.POST.get('topic')\n            difficulty = request.POST.get('difficulty')\n            length = int(request.POST.get('length', 10))\n            is_pro_content = request.POST.get('is_pro_content') == 'on'\n            selected_questions = json.loads(request.POST.get('selected_questions', '[]'))\n            \n            # Validation\n            if not all([title, subject_id, exam_board_id, grade_id, topic, difficulty]):\n                messages.error(request, 'Please fill in all required fields.')\n                return redirect('create_student_quiz')\n            \n            # Create quiz\n            quiz = StudentQuiz.objects.create(\n                title=title,\n                subject_id=subject_id,\n                exam_board_id=exam_board_id,\n                grade_id=grade_id,\n                topic=topic,\n                difficulty=difficulty,\n                length=length,\n                is_pro_content=is_pro_content,\n                created_by=request.user\n            )\n            \n            # Add questions to quiz\n            for question_id in selected_questions:\n                try:\n                    question = InteractiveQuestion.objects.get(id=question_id)\n                    quiz.questions.add(question)\n                except InteractiveQuestion.DoesNotExist:\n                    pass\n            \n            messages.success(request, f'Quiz \"{title}\" created successfully with {len(selected_questions)} questions!')\n            return redirect('manage_student_quizzes')\n    \n    # GET request - show multi-step form\n    subjects = Subject.objects.all()\n    grades = Grade.objects.all()\n    exam_boards = ExamBoard.objects.all()\n    \n    context = {\n        'subjects': subjects,\n        'grades': grades,\n        'exam_boards': exam_boards,\n    }\n    \n    return render(request, 'core/content/student_quiz_form.html', context)\n\n\n@require_content_manager\ndef manage_student_quizzes(request):\n    \"\"\"List and manage student quizzes\"\"\"\n    from .models import StudentQuiz\n    \n    # Get filter parameters\n    subject_filter = request.GET.get('subject', '')\n    grade_filter = request.GET.get('grade', '')\n    status_filter = request.GET.get('status', '')  # free or pro\n    search_query = request.GET.get('search', '')\n    \n    # Filter quizzes\n    quizzes = StudentQuiz.objects.all().select_related('subject', 'grade', 'exam_board').prefetch_related('questions')\n    \n    if subject_filter:\n        quizzes = quizzes.filter(subject_id=subject_filter)\n    if grade_filter:\n        quizzes = quizzes.filter(grade_id=grade_filter)\n    if status_filter == 'free':\n        quizzes = quizzes.filter(is_pro_content=False)\n    elif status_filter == 'pro':\n        quizzes = quizzes.filter(is_pro_content=True)\n    if search_query:\n        quizzes = quizzes.filter(\n            Q(title__icontains=search_query) |\n            Q(topic__icontains=search_query)\n        )\n    \n    quizzes = quizzes.order_by('-created_at')\n    \n    # Get filters for dropdowns\n    subjects = Subject.objects.all()\n    grades = Grade.objects.all()\n    \n    context = {\n        'quizzes': quizzes,\n        'subjects': subjects,\n        'grades': grades,\n        'subject_filter': subject_filter,\n        'grade_filter': grade_filter,\n        'status_filter': status_filter,\n        'search_query': search_query,\n    }\n    \n    return render(request, 'core/content/student_quizzes_list.html', context)\n\n\n@require_content_manager\ndef delete_student_quiz(request, quiz_id):\n    \"\"\"Delete student quiz\"\"\"\n    from .models import StudentQuiz\n    \n    if request.method == 'POST':\n        quiz = get_object_or_404(StudentQuiz, id=quiz_id)\n        quiz.delete()\n        messages.success(request, 'Quiz deleted successfully!')\n    \n    return redirect('manage_student_quizzes')\n\n\n@require_content_manager\ndef create_note(request):\n    \"\"\"Create new study note\"\"\"\n    from .models import Note\n    \n    if request.method == 'POST':\n        title = request.POST.get('title')\n        subject_id = request.POST.get('subject')\n        exam_board_id = request.POST.get('exam_board')\n        grade_id = request.POST.get('grade')\n        topic = request.POST.get('topic')\n        \n        full_version_file = request.FILES.get('full_version')\n        summary_version_file = request.FILES.get('summary_version')\n        full_version_text = request.POST.get('full_version_text', '')\n        summary_version_text = request.POST.get('summary_version_text', '')\n        \n        # Validation\n        if not all([title, subject_id, exam_board_id, grade_id, topic]):\n            messages.error(request, 'Please fill in all required fields.')\n            return redirect('create_note')\n        \n        # Create note\n        note = Note.objects.create(\n            title=title,\n            subject_id=subject_id,\n            exam_board_id=exam_board_id,\n            grade_id=grade_id,\n            topic=topic,\n            full_version=full_version_file,\n            summary_version=summary_version_file,\n            full_version_text=full_version_text,\n            summary_version_text=summary_version_text,\n            created_by=request.user\n        )\n        \n        messages.success(request, f'Note \"{title}\" created successfully!')\n        return redirect('manage_notes')\n    \n    # GET request - show form\n    subjects = Subject.objects.all()\n    grades = Grade.objects.all()\n    exam_boards = ExamBoard.objects.all()\n    \n    context = {\n        'subjects': subjects,\n        'grades': grades,\n        'exam_boards': exam_boards,\n    }\n    \n    return render(request, 'core/content/note_form.html', context)\n\n\n@require_content_manager\ndef manage_notes(request):\n    \"\"\"List and manage study notes\"\"\"\n    from .models import Note\n    \n    # Get filter parameters\n    subject_filter = request.GET.get('subject', '')\n    grade_filter = request.GET.get('grade', '')\n    search_query = request.GET.get('search', '')\n    \n    # Filter notes\n    notes = Note.objects.all().select_related('subject', 'grade', 'exam_board')\n    \n    if subject_filter:\n        notes = notes.filter(subject_id=subject_filter)\n    if grade_filter:\n        notes = notes.filter(grade_id=grade_filter)\n    if search_query:\n        notes = notes.filter(\n            Q(title__icontains=search_query) |\n            Q(topic__icontains=search_query)\n        )\n    \n    notes = notes.order_by('-created_at')\n    \n    # Get filters for dropdowns\n    subjects = Subject.objects.all()\n    grades = Grade.objects.all()\n    \n    context = {\n        'notes': notes,\n        'subjects': subjects,\n        'grades': grades,\n        'subject_filter': subject_filter,\n        'grade_filter': grade_filter,\n        'search_query': search_query,\n    }\n    \n    return render(request, 'core/content/notes_list.html', context)\n\n\n@require_content_manager\ndef delete_note(request, note_id):\n    \"\"\"Delete study note\"\"\"\n    from .models import Note\n    \n    if request.method == 'POST':\n        note = get_object_or_404(Note, id=note_id)\n        note.delete()\n        messages.success(request, 'Note deleted successfully!')\n    \n    return redirect('manage_notes')\n\n\n@require_content_manager\ndef create_flashcard(request):\n    \"\"\"Create new flashcard\"\"\"\n    from .models import Flashcard\n    \n    if request.method == 'POST':\n        subject_id = request.POST.get('subject')\n        exam_board_id = request.POST.get('exam_board')\n        grade_id = request.POST.get('grade')\n        topic = request.POST.get('topic')\n        front_text = request.POST.get('front_text')\n        back_text = request.POST.get('back_text')\n        image_front = request.FILES.get('image_front')\n        image_back = request.FILES.get('image_back')\n        \n        # Validation\n        if not all([subject_id, exam_board_id, grade_id, topic, front_text, back_text]):\n            messages.error(request, 'Please fill in all required fields.')\n            return redirect('create_flashcard')\n        \n        # Create flashcard\n        flashcard = Flashcard.objects.create(\n            subject_id=subject_id,\n            exam_board_id=exam_board_id,\n            grade_id=grade_id,\n            topic=topic,\n            front_text=front_text,\n            back_text=back_text,\n            image_front=image_front,\n            image_back=image_back,\n            created_by=request.user\n        )\n        \n        messages.success(request, 'Flashcard created successfully!')\n        return redirect('manage_flashcards')\n    \n    # GET request - show form\n    subjects = Subject.objects.all()\n    grades = Grade.objects.all()\n    exam_boards = ExamBoard.objects.all()\n    \n    context = {\n        'subjects': subjects,\n        'grades': grades,\n        'exam_boards': exam_boards,\n    }\n    \n    return render(request, 'core/content/flashcard_form.html', context)\n\n\n@require_content_manager\ndef manage_flashcards(request):\n    \"\"\"List and manage flashcards\"\"\"\n    from .models import Flashcard\n    \n    # Get filter parameters\n    subject_filter = request.GET.get('subject', '')\n    grade_filter = request.GET.get('grade', '')\n    topic_filter = request.GET.get('topic', '')\n    \n    # Filter flashcards\n    flashcards = Flashcard.objects.all().select_related('subject', 'grade', 'exam_board')\n    \n    if subject_filter:\n        flashcards = flashcards.filter(subject_id=subject_filter)\n    if grade_filter:\n        flashcards = flashcards.filter(grade_id=grade_filter)\n    if topic_filter:\n        flashcards = flashcards.filter(topic__icontains=topic_filter)\n    \n    flashcards = flashcards.order_by('subject', 'topic', '-created_at')\n    \n    # Get filters for dropdowns\n    subjects = Subject.objects.all()\n    grades = Grade.objects.all()\n    \n    context = {\n        'flashcards': flashcards,\n        'subjects': subjects,\n        'grades': grades,\n        'subject_filter': subject_filter,\n        'grade_filter': grade_filter,\n        'topic_filter': topic_filter,\n    }\n    \n    return render(request, 'core/content/flashcards_list.html', context)\n\n\n@require_content_manager\ndef delete_flashcard(request, flashcard_id):\n    \"\"\"Delete flashcard\"\"\"\n    from .models import Flashcard\n    \n    if request.method == 'POST':\n        flashcard = get_object_or_404(Flashcard, id=flashcard_id)\n        flashcard.delete()\n        messages.success(request, 'Flashcard deleted successfully!')\n    \n    return redirect('manage_flashcards')\n\n\n@require_content_manager\ndef upload_exam_paper(request):\n    \"\"\"Upload new exam paper\"\"\"\n    from .models import ExamPaper, InteractiveQuestion\n    \n    if request.method == 'POST':\n        title = request.POST.get('title')\n        subject_id = request.POST.get('subject')\n        exam_board_id = request.POST.get('exam_board')\n        grade_id = request.POST.get('grade')\n        year = request.POST.get('year')\n        paper_file = request.FILES.get('paper_file')\n        marking_scheme = request.FILES.get('marking_scheme')\n        is_pro_content = request.POST.get('is_pro_content') == 'on'\n        interactive_questions = request.POST.getlist('interactive_questions')\n        \n        # Validation\n        if not all([title, subject_id, exam_board_id, grade_id, paper_file]):\n            messages.error(request, 'Please fill in all required fields and upload the paper file.')\n            return redirect('upload_exam_paper')\n        \n        # Create exam paper\n        exam_paper = ExamPaper.objects.create(\n            title=title,\n            subject_id=subject_id,\n            exam_board_id=exam_board_id,\n            grade_id=grade_id,\n            year=int(year) if year else None,\n            paper_file=paper_file,\n            marking_scheme=marking_scheme,\n            has_interactive_version=bool(interactive_questions),\n            is_pro_content=is_pro_content,\n            created_by=request.user\n        )\n        \n        # Link interactive questions if provided\n        if interactive_questions:\n            for question_id in interactive_questions:\n                try:\n                    question = InteractiveQuestion.objects.get(id=question_id)\n                    exam_paper.interactive_questions.add(question)\n                except InteractiveQuestion.DoesNotExist:\n                    pass\n        \n        messages.success(request, f'Exam paper \"{title}\" uploaded successfully!')\n        return redirect('manage_exam_papers')\n    \n    # GET request - show form\n    subjects = Subject.objects.all()\n    grades = Grade.objects.all()\n    exam_boards = ExamBoard.objects.all()\n    \n    context = {\n        'subjects': subjects,\n        'grades': grades,\n        'exam_boards': exam_boards,\n    }\n    \n    return render(request, 'core/content/exam_paper_form.html', context)\n\n\n@require_content_manager\ndef manage_exam_papers(request):\n    \"\"\"List and manage exam papers\"\"\"\n    from .models import ExamPaper\n    \n    # Get filter parameters\n    subject_filter = request.GET.get('subject', '')\n    grade_filter = request.GET.get('grade', '')\n    status_filter = request.GET.get('status', '')\n    search_query = request.GET.get('search', '')\n    \n    # Filter exam papers\n    papers = ExamPaper.objects.all().select_related('subject', 'grade', 'exam_board')\n    \n    if subject_filter:\n        papers = papers.filter(subject_id=subject_filter)\n    if grade_filter:\n        papers = papers.filter(grade_id=grade_filter)\n    if status_filter == 'free':\n        papers = papers.filter(is_pro_content=False)\n    elif status_filter == 'pro':\n        papers = papers.filter(is_pro_content=True)\n    if search_query:\n        papers = papers.filter(title__icontains=search_query)\n    \n    papers = papers.order_by('-year', '-created_at')\n    \n    # Get filters for dropdowns\n    subjects = Subject.objects.all()\n    grades = Grade.objects.all()\n    \n    context = {\n        'papers': papers,\n        'subjects': subjects,\n        'grades': grades,\n        'subject_filter': subject_filter,\n        'grade_filter': grade_filter,\n        'status_filter': status_filter,\n        'search_query': search_query,\n    }\n    \n    return render(request, 'core/content/exam_papers_list.html', context)\n\n\n@require_content_manager\ndef delete_exam_paper(request, paper_id):\n    \"\"\"Delete exam paper\"\"\"\n    from .models import ExamPaper\n    \n    if request.method == 'POST':\n        paper = get_object_or_404(ExamPaper, id=paper_id)\n        paper.delete()\n        messages.success(request, 'Exam paper deleted successfully!')\n    \n    return redirect('manage_exam_papers')\n\n\n@require_content_manager\ndef manage_syllabi(request):\n    \"\"\"List and manage syllabi\"\"\"\n    from .models import Syllabus\n    \n    subject_filter = request.GET.get('subject', '')\n    board_filter = request.GET.get('board', '')\n    search_query = request.GET.get('search', '')\n    \n    syllabi = Syllabus.objects.all().select_related('subject', 'exam_board', 'grade')\n    \n    if subject_filter:\n        syllabi = syllabi.filter(subject_id=subject_filter)\n    if board_filter:\n        syllabi = syllabi.filter(exam_board_id=board_filter)\n    if search_query:\n        syllabi = syllabi.filter(title__icontains=search_query)\n    \n    syllabi = syllabi.order_by('-year', 'exam_board', 'subject')\n    \n    subjects = Subject.objects.all()\n    exam_boards = ExamBoard.objects.all()\n    \n    context = {\n        'syllabi': syllabi,\n        'subjects': subjects,\n        'exam_boards': exam_boards,\n        'subject_filter': subject_filter,\n        'board_filter': board_filter,\n        'search_query': search_query,\n    }\n    \n    return render(request, 'core/content/syllabi_list.html', context)\n\n\n@require_content_manager\ndef create_syllabus(request):\n    \"\"\"Create a new syllabus\"\"\"\n    from .models import Syllabus\n    \n    if request.method == 'POST':\n        title = request.POST.get('title')\n        subject_id = request.POST.get('subject')\n        exam_board_id = request.POST.get('exam_board')\n        grade_id = request.POST.get('grade')\n        year = request.POST.get('year')\n        description = request.POST.get('description', '')\n        external_url = request.POST.get('external_url', '')\n        syllabus_file = request.FILES.get('file')\n        \n        syllabus = Syllabus.objects.create(\n            title=title,\n            subject_id=subject_id,\n            exam_board_id=exam_board_id,\n            grade_id=grade_id if grade_id else None,\n            year=int(year) if year else None,\n            description=description,\n            external_url=external_url,\n            file=syllabus_file,\n            created_by=request.user\n        )\n        \n        messages.success(request, f'Syllabus \"{title}\" created successfully!')\n        return redirect('manage_syllabi')\n    \n    subjects = Subject.objects.all()\n    grades = Grade.objects.all()\n    exam_boards = ExamBoard.objects.all()\n    \n    context = {\n        'subjects': subjects,\n        'grades': grades,\n        'exam_boards': exam_boards,\n    }\n    \n    return render(request, 'core/content/syllabus_form.html', context)\n\n\n@require_content_manager\ndef delete_syllabus(request, syllabus_id):\n    \"\"\"Delete syllabus\"\"\"\n    from .models import Syllabus\n    \n    if request.method == 'POST':\n        syllabus = get_object_or_404(Syllabus, id=syllabus_id)\n        syllabus.delete()\n        messages.success(request, 'Syllabus deleted successfully!')\n    \n    return redirect('manage_syllabi')\n\n\n@require_content_manager\ndef get_questions_ajax(request):\n    \"\"\"AJAX endpoint to get filtered questions for quiz builder\"\"\"\n    from .models import InteractiveQuestion\n    import json\n    \n    subject_id = request.GET.get('subject')\n    grade_id = request.GET.get('grade')\n    topic = request.GET.get('topic')\n    difficulty = request.GET.get('difficulty')\n    question_type = request.GET.get('question_type')\n    \n    questions = InteractiveQuestion.objects.all()\n    \n    if subject_id:\n        questions = questions.filter(subject_id=subject_id)\n    if grade_id:\n        questions = questions.filter(grade_id=grade_id)\n    if topic:\n        questions = questions.filter(topic__icontains=topic)\n    if difficulty:\n        questions = questions.filter(difficulty=difficulty)\n    if question_type:\n        questions = questions.filter(question_type=question_type)\n    \n    questions = questions.select_related('subject', 'grade').order_by('-created_at')[:50]\n    \n    # Serialize questions\n    questions_data = []\n    for q in questions:\n        questions_data.append({\n            'id': q.id,\n            'question_text': q.question_text[:100],\n            'question_type': q.get_question_type_display(),\n            'difficulty': q.get_difficulty_display(),\n            'topic': q.topic,\n            'points': q.points,\n        })\n    \n    return JsonResponse({'questions': questions_data})\n\n\n# ===== PUBLIC EXAM PAPERS BROWSE VIEWS =====\n\ndef public_papers_browse(request):\n    \"\"\"Public page to browse official exam papers - no login required\"\"\"\n    from .models import OfficialExamPaper, ExamBoard\n    \n    exam_boards = ExamBoard.objects.all().order_by('name_full')\n    \n    context = {\n        'exam_boards': exam_boards,\n    }\n    return render(request, 'core/public/papers_browse.html', context)\n\n\ndef public_papers_api(request):\n    \"\"\"AJAX API for getting papers with cascading filters\"\"\"\n    from .models import OfficialExamPaper, ExamBoard\n    from django.core.paginator import Paginator\n    \n    board_id = request.GET.get('board')\n    subject_code = request.GET.get('subject')\n    year = request.GET.get('year')\n    session = request.GET.get('session')\n    paper_type = request.GET.get('paper_type')\n    page = int(request.GET.get('page', 1))\n    per_page = int(request.GET.get('per_page', 20))\n    \n    papers = OfficialExamPaper.objects.all().order_by('-year', 'subject_code', 'paper_number')\n    \n    if board_id:\n        papers = papers.filter(exam_board_id=board_id)\n    if subject_code:\n        papers = papers.filter(subject_code=subject_code)\n    if year:\n        papers = papers.filter(year=year)\n    if session:\n        papers = papers.filter(session=session)\n    if paper_type:\n        papers = papers.filter(paper_type=paper_type)\n    \n    paginator = Paginator(papers, per_page)\n    page_obj = paginator.get_page(page)\n    \n    papers_data = []\n    for paper in page_obj:\n        papers_data.append({\n            'id': paper.id,\n            'subject_code': paper.subject_code,\n            'subject_name': paper.subject_name,\n            'year': paper.year,\n            'session': paper.get_session_display(),\n            'paper_number': paper.paper_number,\n            'variant': paper.variant,\n            'paper_type': paper.get_paper_type_display(),\n            'paper_type_code': paper.paper_type,\n            'display_name': paper.get_display_name(),\n            'file_url': paper.file.url if paper.file else None,\n        })\n    \n    return JsonResponse({\n        'success': True,\n        'papers': papers_data,\n        'total': paginator.count,\n        'page': page,\n        'pages': paginator.num_pages,\n        'has_next': page_obj.has_next(),\n        'has_prev': page_obj.has_previous(),\n    })\n\n\ndef public_papers_filters(request):\n    \"\"\"AJAX API for getting filter options based on current selection\"\"\"\n    from .models import OfficialExamPaper\n    \n    board_id = request.GET.get('board')\n    subject_code = request.GET.get('subject')\n    filter_type = request.GET.get('filter_type', 'subjects')\n    \n    papers = OfficialExamPaper.objects.all()\n    \n    if board_id:\n        papers = papers.filter(exam_board_id=board_id)\n    if subject_code and filter_type != 'subjects':\n        papers = papers.filter(subject_code=subject_code)\n    \n    if filter_type == 'subjects':\n        # Get unique subjects for selected board\n        subjects = papers.values('subject_code', 'subject_name').distinct().order_by('subject_name')\n        return JsonResponse({\n            'success': True,\n            'options': [{'code': s['subject_code'], 'name': s['subject_name'] or s['subject_code']} for s in subjects]\n        })\n    \n    elif filter_type == 'years':\n        # Get unique years for selected board/subject\n        years = papers.values_list('year', flat=True).distinct().order_by('-year')\n        return JsonResponse({\n            'success': True,\n            'options': list(years)\n        })\n    \n    elif filter_type == 'sessions':\n        # Get unique sessions for selected filters\n        sessions = papers.values_list('session', flat=True).distinct()\n        session_choices = dict(OfficialExamPaper.SESSION_CHOICES)\n        return JsonResponse({\n            'success': True,\n            'options': [{'code': s, 'name': session_choices.get(s, s)} for s in sessions]\n        })\n    \n    elif filter_type == 'paper_types':\n        # Get unique paper types\n        paper_types = papers.values_list('paper_type', flat=True).distinct()\n        type_choices = dict(OfficialExamPaper.PAPER_TYPE_CHOICES)\n        return JsonResponse({\n            'success': True,\n            'options': [{'code': t, 'name': type_choices.get(t, t)} for t in paper_types]\n        })\n    \n    return JsonResponse({'success': False, 'error': 'Invalid filter type'})\n\n\ndef public_paper_view(request, paper_id):\n    \"\"\"Individual paper view/download page with ad placeholders\"\"\"\n    from .models import OfficialExamPaper\n    \n    paper = get_object_or_404(OfficialExamPaper, id=paper_id)\n    \n    # Get related papers (same subject, different years)\n    related_papers = OfficialExamPaper.objects.filter(\n        exam_board=paper.exam_board,\n        subject_code=paper.subject_code\n    ).exclude(id=paper.id).order_by('-year')[:10]\n    \n    context = {\n        'paper': paper,\n        'related_papers': related_papers,\n    }\n    return render(request, 'core/public/paper_view.html', context)\n\n\ndef public_paper_download(request, paper_id):\n    \"\"\"Download paper file - tracks downloads for analytics\"\"\"\n    from .models import OfficialExamPaper\n    from django.http import FileResponse\n    import os\n    \n    paper = get_object_or_404(OfficialExamPaper, id=paper_id)\n    \n    if not paper.file:\n        raise Http404(\"Paper file not found\")\n    \n    response = FileResponse(paper.file.open('rb'), as_attachment=True)\n    response['Content-Disposition'] = f'attachment; filename=\"{paper.original_filename}\"'\n    \n    return response\n\n\n# ============================================================================\n# TEACHER ASSESSMENT BUILDER\n# ============================================================================\n\n@require_teacher\ndef create_assessment(request):\n    \"\"\"Google Forms-style assessment builder for teachers\"\"\"\n    from .models import SubscribedSubject, Grade, TeacherAssessment\n    \n    category = request.GET.get('category', 'test')\n    \n    # Category icons for display\n    category_icons = {\n        'exam': 'fa-graduation-cap',\n        'test': 'fa-file-alt',\n        'assignment': 'fa-tasks',\n        'homework': 'fa-home',\n        'classwork': 'fa-book-open',\n    }\n    \n    subjects = SubscribedSubject.objects.filter(user=request.user).select_related('subject')\n    grades = Grade.objects.all().order_by('number')\n    \n    context = {\n        'category': category,\n        'category_icon': category_icons.get(category, 'fa-file-alt'),\n        'subjects': subjects,\n        'grades': grades,\n    }\n    return render(request, 'core/teacher/create_assessment.html', context)\n\n\n@require_teacher\ndef save_assessment(request):\n    \"\"\"Save assessment and questions\"\"\"\n    from .models import TeacherAssessment, TeacherQuestion, TeacherQuestionOption, Subject, Grade\n    import json\n    \n    if request.method != 'POST':\n        return JsonResponse({'success': False, 'error': 'Invalid method'})\n    \n    try:\n        assessment_data = json.loads(request.POST.get('assessment', '{}'))\n        questions_data = json.loads(request.POST.get('questions', '[]'))\n        \n        # Create assessment\n        assessment = TeacherAssessment(\n            teacher=request.user,\n            title=assessment_data.get('title', 'Untitled'),\n            description=assessment_data.get('description', ''),\n            category=assessment_data.get('category', 'test'),\n            instructions=assessment_data.get('instructions', ''),\n            status=assessment_data.get('status', 'draft'),\n        )\n        \n        # Handle optional fields\n        if assessment_data.get('subject_id'):\n            assessment.subject = Subject.objects.filter(id=assessment_data['subject_id']).first()\n        if assessment_data.get('grade_id'):\n            assessment.grade = Grade.objects.filter(id=assessment_data['grade_id']).first()\n        if assessment_data.get('time_limit'):\n            assessment.time_limit = int(assessment_data['time_limit'])\n        \n        assessment.save()\n        \n        # Create questions\n        total_marks = 0\n        for i, q_data in enumerate(questions_data):\n            question = TeacherQuestion(\n                assessment=assessment,\n                question_type=q_data.get('type', 'mcq'),\n                question_text=q_data.get('text', ''),\n                marks=int(q_data.get('marks', 1)),\n                order=i,\n                is_required=True,\n            )\n            \n            # Handle correct answer based on type\n            if q_data.get('type') in ['short_answer', 'long_answer']:\n                question.correct_answer = q_data.get('expected_answer', '')\n            elif q_data.get('type') == 'true_false':\n                question.correct_answer = q_data.get('correct_answer', 'true')\n            elif q_data.get('type') == 'fill_blank':\n                question.correct_answer = q_data.get('correct_answer', '')\n            \n            # Handle explanation\n            question.explanation = q_data.get('explanation', '')\n            \n            # Handle image upload\n            image_key = f'question_image_{i}'\n            if image_key in request.FILES:\n                question.question_image = request.FILES[image_key]\n            \n            question.save()\n            total_marks += question.marks\n            \n            # Create options for MCQ\n            if q_data.get('type') in ['mcq', 'mcq_multi']:\n                correct_option = q_data.get('correct_option')\n                for j, opt in enumerate(q_data.get('options', [])):\n                    if opt.get('text'):\n                        TeacherQuestionOption.objects.create(\n                            question=question,\n                            option_text=opt['text'],\n                            is_correct=(j == correct_option) if q_data.get('type') == 'mcq' else opt.get('is_correct', False),\n                            order=j\n                        )\n            \n            # Create matching pairs\n            elif q_data.get('type') == 'matching':\n                for j, pair in enumerate(q_data.get('pairs', [])):\n                    if pair.get('left'):\n                        TeacherQuestionOption.objects.create(\n                            question=question,\n                            option_text=pair['left'],\n                            match_pair=pair.get('right', ''),\n                            order=j\n                        )\n        \n        # Update total marks\n        assessment.total_marks = total_marks\n        assessment.save()\n        \n        # Redirect based on category\n        category_urls = {\n            'exam': 'exams',\n            'test': 'tests',\n            'assignment': 'assignments',\n            'homework': 'homework',\n            'classwork': 'classwork',\n        }\n        redirect_url = reverse(category_urls.get(assessment.category, 'dashboard'))\n        \n        return JsonResponse({\n            'success': True,\n            'assessment_id': assessment.id,\n            'redirect_url': redirect_url\n        })\n        \n    except Exception as e:\n        import traceback\n        traceback.print_exc()\n        return JsonResponse({'success': False, 'error': str(e)})\n\n\n@require_teacher\ndef edit_assessment(request, assessment_id):\n    \"\"\"Edit existing assessment\"\"\"\n    from .models import TeacherAssessment, SubscribedSubject, Grade\n    \n    assessment = get_object_or_404(TeacherAssessment, id=assessment_id, teacher=request.user)\n    subjects = SubscribedSubject.objects.filter(user=request.user).select_related('subject')\n    grades = Grade.objects.all().order_by('number')\n    \n    # Prepare questions data for the editor\n    questions_json = []\n    for q in assessment.questions.all().prefetch_related('options'):\n        q_dict = {\n            'id': q.id,\n            'type': q.question_type,\n            'text': q.question_text,\n            'marks': q.marks,\n            'explanation': q.explanation,\n            'showExplanation': bool(q.explanation),\n            'showImageUpload': bool(q.question_image),\n            'imagePreview': q.question_image.url if q.question_image else None,\n        }\n        \n        if q.question_type in ['mcq', 'mcq_multi']:\n            q_dict['options'] = [{'text': o.option_text, 'is_correct': o.is_correct} for o in q.options.all()]\n            correct_idx = next((i for i, o in enumerate(q.options.all()) if o.is_correct), None)\n            q_dict['correct_option'] = correct_idx\n        elif q.question_type == 'matching':\n            q_dict['pairs'] = [{'left': o.option_text, 'right': o.match_pair} for o in q.options.all()]\n        elif q.question_type in ['short_answer', 'long_answer']:\n            q_dict['expected_answer'] = q.correct_answer\n        else:\n            q_dict['correct_answer'] = q.correct_answer\n            \n        questions_json.append(q_dict)\n    \n    category_icons = {\n        'exam': 'fa-graduation-cap',\n        'test': 'fa-file-alt',\n        'assignment': 'fa-tasks',\n        'homework': 'fa-home',\n        'classwork': 'fa-book-open',\n    }\n    \n    context = {\n        'assessment': assessment,\n        'category': assessment.category,\n        'category_icon': category_icons.get(assessment.category, 'fa-file-alt'),\n        'subjects': subjects,\n        'grades': grades,\n        'questions_json': json.dumps(questions_json),\n        'editing': True,\n    }\n    return render(request, 'core/teacher/create_assessment.html', context)\n\n\n@require_teacher\ndef delete_assessment(request, assessment_id):\n    \"\"\"Delete an assessment\"\"\"\n    from .models import TeacherAssessment\n    \n    assessment = get_object_or_404(TeacherAssessment, id=assessment_id, teacher=request.user)\n    category = assessment.category\n    assessment.delete()\n    \n    messages.success(request, f'{category.title()} deleted successfully.')\n    \n    category_urls = {\n        'exam': 'exams',\n        'test': 'tests',\n        'assignment': 'assignments',\n        'homework': 'homework',\n        'classwork': 'classwork',\n    }\n    return redirect(category_urls.get(category, 'dashboard'))\n\n\n@require_teacher\ndef view_assessment(request, assessment_id):\n    \"\"\"View assessment details and questions\"\"\"\n    from .models import TeacherAssessment\n    \n    assessment = get_object_or_404(TeacherAssessment, id=assessment_id, teacher=request.user)\n    questions = assessment.questions.all().prefetch_related('options')\n    \n    category_icons = {\n        'exam': 'fa-graduation-cap',\n        'test': 'fa-file-alt',\n        'assignment': 'fa-tasks',\n        'homework': 'fa-home',\n        'classwork': 'fa-book-open',\n    }\n    \n    context = {\n        'assessment': assessment,\n        'questions': questions,\n        'category_icon': category_icons.get(assessment.category, 'fa-file-alt'),\n    }\n    return render(request, 'core/teacher/view_assessment.html', context)\n\n\n# ============================================================================\n# BRILLTECH CORPORATE PAGES\n# ============================================================================\n\ndef brilltech_landing(request):\n    \"\"\"BrillTech main landing page with hero and service summaries\"\"\"\n    return render(request, 'core/brilltech/landing.html')\n\n\ndef brilltech_services(request):\n    \"\"\"BrillTech detailed services page with 6 service cards\"\"\"\n    services = [\n        {\n            'icon': 'fa-globe',\n            'title': 'Website Development',\n            'description': 'Custom-built, responsive websites that captivate your audience. From sleek portfolios to complex e-commerce platforms, we craft digital experiences that drive results.',\n            'color': 'from-blue-500 to-cyan-400'\n        },\n        {\n            'icon': 'fa-mobile-alt',\n            'title': 'Mobile App Development',\n            'description': 'Native and cross-platform mobile applications that users love. iOS, Android, or both - we build apps that perform flawlessly and scale effortlessly.',\n            'color': 'from-purple-500 to-pink-400'\n        },\n        {\n            'icon': 'fa-headset',\n            'title': 'IT Support & Maintenance',\n            'description': 'Round-the-clock technical support to keep your systems running smoothly. Proactive monitoring, rapid response, and expert troubleshooting.',\n            'color': 'from-green-500 to-emerald-400'\n        },\n        {\n            'icon': 'fa-network-wired',\n            'title': 'Network Installation',\n            'description': 'Enterprise-grade network infrastructure designed for speed, security, and reliability. From small offices to large campuses, we connect your world.',\n            'color': 'from-orange-500 to-amber-400'\n        },\n        {\n            'icon': 'fa-chalkboard-teacher',\n            'title': 'Training & Digital Skills',\n            'description': 'Empower your team with cutting-edge digital skills. Customized training programs that transform beginners into tech-savvy professionals.',\n            'color': 'from-red-500 to-rose-400'\n        },\n        {\n            'icon': 'fa-cloud-upload-alt',\n            'title': 'Cloud & Data Backup',\n            'description': 'Secure cloud solutions that protect your data and enable seamless collaboration. Automated backups, disaster recovery, and infinite scalability.',\n            'color': 'from-indigo-500 to-violet-400'\n        },\n    ]\n    return render(request, 'core/brilltech/services.html', {'services': services})\n\n\ndef brilltech_learning(request):\n    \"\"\"BrillTech learning platform page\"\"\"\n    return render(request, 'core/brilltech/learning.html')\n\n\ndef brilltech_store(request):\n    \"\"\"BrillTech store page\"\"\"\n    return render(request, 'core/brilltech/store.html')\n\n\ndef brilltech_dashboard(request):\n    \"\"\"BrillTech dashboard overview page\"\"\"\n    return render(request, 'core/brilltech/dashboard.html')\n\n\n# ============================================================================\n# PUBLIC SHARE VIEWS FOR STUDENTS\n# ============================================================================\n\ndef share_content_view(request, token):\n    \"\"\"Public view for shared content - accessible by students via token\"\"\"\n    from .models import ContentShare\n    from django.utils import timezone\n    \n    share = get_object_or_404(ContentShare, token=token)\n    \n    if not share.is_valid:\n        return render(request, 'core/shared/share_expired.html')\n    \n    share.view_count += 1\n    share.last_accessed = timezone.now()\n    share.save()\n    \n    if share.assessment:\n        questions = share.assessment.questions.all().prefetch_related('options')\n        \n        category_icons = {\n            'exam': 'fa-graduation-cap',\n            'test': 'fa-file-alt',\n            'assignment': 'fa-tasks',\n            'homework': 'fa-home',\n            'classwork': 'fa-book-open',\n        }\n        \n        context = {\n            'assessment': share.assessment,\n            'questions': questions,\n            'category_icon': category_icons.get(share.assessment.category, 'fa-file-alt'),\n            'is_shared_view': True,\n            'share': share,\n        }\n        return render(request, 'core/shared/assessment_view.html', context)\n    \n    elif share.document:\n        context = {\n            'document': share.document,\n            'is_shared_view': True,\n            'share': share,\n        }\n        return render(request, 'core/shared/document_view.html', context)\n    \n    return HttpResponse(\"Content not found\", status=404)\n\n\n@require_teacher\ndef create_share_link(request):\n    \"\"\"Create a shareable link for an assessment or document\"\"\"\n    from .models import ContentShare, TeacherAssessment, UploadedDocument\n    import json\n    \n    if request.method != 'POST':\n        return JsonResponse({'error': 'POST required'}, status=405)\n    \n    try:\n        data = json.loads(request.body)\n        content_type = data.get('type')\n        content_id = data.get('id')\n    except (json.JSONDecodeError, ValueError):\n        return JsonResponse({'error': 'Invalid JSON payload'}, status=400)\n    \n    if not content_type or not content_id:\n        return JsonResponse({'error': 'Missing type or id'}, status=400)\n    \n    if content_type == 'assessment':\n        assessment = get_object_or_404(TeacherAssessment, id=content_id, teacher=request.user)\n        share, created = ContentShare.objects.get_or_create(\n            teacher=request.user,\n            assessment=assessment,\n            is_active=True,\n            defaults={'document': None}\n        )\n    elif content_type == 'document':\n        document = get_object_or_404(UploadedDocument, id=content_id, uploaded_by=request.user)\n        share, created = ContentShare.objects.get_or_create(\n            teacher=request.user,\n            document=document,\n            is_active=True,\n            defaults={'assessment': None}\n        )\n    else:\n        return JsonResponse({'error': 'Invalid content type'}, status=400)\n    \n    share_url = request.build_absolute_uri(f'/share/{share.token}/')\n    \n    return JsonResponse({\n        'token': share.token,\n        'url': share_url,\n        'created': created\n    })\n\n\n# ============================================================================\n# BRILLTECH CORPORATE PAGES - Apps, About, Contact\n# ============================================================================\n\ndef brilltech_apps(request):\n    \"\"\"BrillTech apps/products showcase page\"\"\"\n    apps = [\n        {\n            'name': 'EduTech Portal',\n            'tagline': 'AI-Powered Education Platform',\n            'description': 'A comprehensive learning management system for teachers and students. Create lessons, generate AI content, track progress, and manage classrooms with ease.',\n            'icon': 'fa-graduation-cap',\n            'color': 'from-purple-500 to-indigo-600',\n            'features': ['AI Lesson Plans', 'Student Portal', 'Quiz Builder', 'Progress Tracking'],\n            'demo_link': '/welcome/teacher/',\n            'status': 'Live'\n        },\n        {\n            'name': 'ExamPrep Pro',\n            'tagline': 'Smart Exam Preparation',\n            'description': 'Access thousands of past papers, practice questions, and AI-generated quizzes. Perfect for Cambridge, Edexcel, CAPS, and other major exam boards.',\n            'icon': 'fa-file-alt',\n            'color': 'from-emerald-500 to-teal-600',\n            'features': ['Past Papers Library', 'Interactive Quizzes', 'Flashcards', 'Study Notes'],\n            'demo_link': '/welcome/student/',\n            'status': 'Live'\n        },\n        {\n            'name': 'SchoolSync',\n            'tagline': 'School Management System',\n            'description': 'Complete school administration solution. Manage admissions, attendance, fees, timetables, and parent communication all in one place.',\n            'icon': 'fa-school',\n            'color': 'from-blue-500 to-cyan-600',\n            'features': ['Admissions', 'Fee Management', 'Timetables', 'Parent Portal'],\n            'demo_link': '#',\n            'status': 'Coming Soon'\n        },\n        {\n            'name': 'TutorMatch',\n            'tagline': 'Connect with Expert Tutors',\n            'description': 'Find qualified tutors for any subject. Book sessions, track progress, and manage payments seamlessly. Perfect for students seeking personalized learning.',\n            'icon': 'fa-users',\n            'color': 'from-orange-500 to-amber-600',\n            'features': ['Tutor Discovery', 'Online Sessions', 'Progress Reports', 'Secure Payments'],\n            'demo_link': '#',\n            'status': 'Coming Soon'\n        },\n        {\n            'name': 'ContentForge',\n            'tagline': 'AI Content Creation Studio',\n            'description': 'Generate educational content at scale. Create worksheets, quizzes, lesson plans, and assessments using advanced AI technology.',\n            'icon': 'fa-magic',\n            'color': 'from-pink-500 to-rose-600',\n            'features': ['AI Generation', 'Template Library', 'Bulk Export', 'Multi-format Support'],\n            'demo_link': '#',\n            'status': 'Beta'\n        },\n        {\n            'name': 'ClassroomLive',\n            'tagline': 'Virtual Classroom Solution',\n            'description': 'Host live classes, webinars, and interactive sessions. Features whiteboard, screen sharing, breakout rooms, and recording capabilities.',\n            'icon': 'fa-video',\n            'color': 'from-red-500 to-pink-600',\n            'features': ['Live Streaming', 'Interactive Whiteboard', 'Breakout Rooms', 'Recording'],\n            'demo_link': '#',\n            'status': 'Coming Soon'\n        },\n    ]\n    return render(request, 'core/brilltech/apps.html', {'apps': apps})\n\n\ndef brilltech_about(request):\n    \"\"\"BrillTech about us page\"\"\"\n    team = [\n        {\n            'name': 'Alex Johnson',\n            'role': 'CEO & Founder',\n            'bio': 'Passionate about leveraging technology to transform education. 15+ years in EdTech.',\n            'image': 'https://randomuser.me/api/portraits/men/32.jpg',\n        },\n        {\n            'name': 'Sarah Chen',\n            'role': 'CTO',\n            'bio': 'Full-stack developer with expertise in AI/ML. Building the future of learning.',\n            'image': 'https://randomuser.me/api/portraits/women/44.jpg',\n        },\n        {\n            'name': 'Michael Okonkwo',\n            'role': 'Head of Product',\n            'bio': 'Former teacher turned product leader. Ensuring every feature serves real needs.',\n            'image': 'https://randomuser.me/api/portraits/men/52.jpg',\n        },\n        {\n            'name': 'Emma Williams',\n            'role': 'Lead Designer',\n            'bio': 'Creating beautiful, intuitive interfaces that make learning enjoyable.',\n            'image': 'https://randomuser.me/api/portraits/women/68.jpg',\n        },\n    ]\n    \n    milestones = [\n        {'year': '2020', 'title': 'BrillTech Founded', 'description': 'Started with a vision to democratize quality education through technology.'},\n        {'year': '2021', 'title': 'EduTech Portal Launch', 'description': 'Released our flagship AI-powered education platform to teachers across Africa.'},\n        {'year': '2022', 'title': '10,000 Users', 'description': 'Reached our first major milestone of 10,000 active educators on the platform.'},\n        {'year': '2023', 'title': 'Student Portal Launch', 'description': 'Expanded with a dedicated student learning portal and mobile app.'},\n        {'year': '2024', 'title': 'AI Integration', 'description': 'Integrated GPT-4 for intelligent content generation and personalized learning.'},\n        {'year': '2025', 'title': 'Pan-African Expansion', 'description': 'Expanding operations across 15 African countries with localized content.'},\n    ]\n    \n    stats = [\n        {'number': '50,000+', 'label': 'Active Users'},\n        {'number': '1M+', 'label': 'Lessons Created'},\n        {'number': '15', 'label': 'Countries'},\n        {'number': '99.9%', 'label': 'Uptime'},\n    ]\n    \n    return render(request, 'core/brilltech/about.html', {\n        'team': team,\n        'milestones': milestones,\n        'stats': stats\n    })\n\n\ndef brilltech_contact(request):\n    \"\"\"BrillTech contact page with working form\"\"\"\n    from .models import ContactSubmission\n    from django.core.mail import send_mail\n    from django.conf import settings\n    import os\n    \n    success_message = None\n    error_message = None\n    \n    if request.method == 'POST':\n        name = request.POST.get('name', '').strip()\n        email = request.POST.get('email', '').strip()\n        phone = request.POST.get('phone', '').strip()\n        company = request.POST.get('company', '').strip()\n        subject = request.POST.get('subject', '').strip()\n        message = request.POST.get('message', '').strip()\n        \n        if not name or not email or not message:\n            error_message = 'Please fill in all required fields (Name, Email, Message).'\n        else:\n            try:\n                submission = ContactSubmission.objects.create(\n                    name=name,\n                    email=email,\n                    phone=phone,\n                    company=company,\n                    subject=subject or 'Website Contact',\n                    message=message\n                )\n                \n                try:\n                    email_host_user = os.environ.get('EMAIL_HOST_USER')\n                    if email_host_user:\n                        send_mail(\n                            subject=f'[BrillTech Contact] {subject or \"New Inquiry\"} from {name}',\n                            message=f\"\"\"New contact form submission from BrillTech website:\n\nName: {name}\nEmail: {email}\nPhone: {phone or 'Not provided'}\nCompany: {company or 'Not provided'}\n\nMessage:\n{message}\n\n---\nView all submissions at: /brilltech/admin/\n\"\"\",\n                            from_email=email_host_user,\n                            recipient_list=[email_host_user],\n                            fail_silently=True,\n                        )\n                except Exception as e:\n                    pass\n                \n                success_message = 'Thank you for your message! We will get back to you within 24 hours.'\n                \n            except Exception as e:\n                error_message = 'There was an error submitting your message. Please try again.'\n    \n    contact_info = {\n        'email': 'info@brilltech.com',\n        'phone': '+27 11 123 4567',\n        'whatsapp': '+27 82 123 4567',\n        'address': 'Johannesburg, South Africa',\n        'hours': 'Monday - Friday: 8:00 AM - 5:00 PM SAST'\n    }\n    \n    return render(request, 'core/brilltech/contact.html', {\n        'success_message': success_message,\n        'error_message': error_message,\n        'contact_info': contact_info\n    })\n\n\n# ============================================================================\n# BRILLTECH ADMIN PORTAL (Separate from EduTech Admin)\n# ============================================================================\n\ndef brilltech_admin_required(view_func):\n    \"\"\"Decorator to check if user is logged in to BrillTech admin\"\"\"\n    def wrapper(request, *args, **kwargs):\n        if not request.session.get('brilltech_admin_id'):\n            return redirect('brilltech_admin_login')\n        return view_func(request, *args, **kwargs)\n    return wrapper\n\n\ndef brilltech_admin_login(request):\n    \"\"\"BrillTech admin login page\"\"\"\n    from .models import BrillTechAdmin\n    from django.utils import timezone\n    \n    error = None\n    \n    if request.method == 'POST':\n        username = request.POST.get('username', '').strip()\n        password = request.POST.get('password', '')\n        \n        try:\n            admin = BrillTechAdmin.objects.get(username=username, is_active=True)\n            if admin.check_password(password):\n                request.session['brilltech_admin_id'] = admin.id\n                request.session['brilltech_admin_username'] = admin.username\n                admin.last_login = timezone.now()\n                admin.save()\n                return redirect('brilltech_admin_dashboard')\n            else:\n                error = 'Invalid username or password'\n        except BrillTechAdmin.DoesNotExist:\n            error = 'Invalid username or password'\n    \n    return render(request, 'core/brilltech/admin/login.html', {'error': error})\n\n\ndef brilltech_admin_logout(request):\n    \"\"\"Logout from BrillTech admin\"\"\"\n    request.session.pop('brilltech_admin_id', None)\n    request.session.pop('brilltech_admin_username', None)\n    return redirect('brilltech_admin_login')\n\n\n@brilltech_admin_required\ndef brilltech_admin_dashboard(request):\n    \"\"\"BrillTech admin dashboard with stats\"\"\"\n    from .models import ContactSubmission, CRMTask, CRMLead\n    \n    total_submissions = ContactSubmission.objects.count()\n    new_submissions = ContactSubmission.objects.filter(status='new').count()\n    read_submissions = ContactSubmission.objects.filter(status='read').count()\n    replied_submissions = ContactSubmission.objects.filter(status='replied').count()\n    \n    recent_submissions = ContactSubmission.objects.all()[:5]\n    \n    total_leads = CRMLead.objects.count()\n    pending_tasks = CRMTask.objects.filter(status__in=['pending', 'in_progress']).count()\n    \n    return render(request, 'core/brilltech/admin/dashboard.html', {\n        'total_submissions': total_submissions,\n        'new_submissions': new_submissions,\n        'read_submissions': read_submissions,\n        'replied_submissions': replied_submissions,\n        'recent_submissions': recent_submissions,\n        'total_leads': total_leads,\n        'pending_tasks': pending_tasks,\n    })\n\n\n@brilltech_admin_required\ndef brilltech_admin_submissions(request):\n    \"\"\"View all contact submissions\"\"\"\n    from .models import ContactSubmission\n    \n    status_filter = request.GET.get('status', '')\n    submissions = ContactSubmission.objects.all()\n    \n    if status_filter:\n        submissions = submissions.filter(status=status_filter)\n    \n    return render(request, 'core/brilltech/admin/submissions.html', {\n        'submissions': submissions,\n        'status_filter': status_filter,\n    })\n\n\n@brilltech_admin_required\ndef brilltech_admin_submission_detail(request, submission_id):\n    \"\"\"View single submission detail\"\"\"\n    from .models import ContactSubmission\n    from django.utils import timezone\n    \n    submission = get_object_or_404(ContactSubmission, id=submission_id)\n    \n    if not submission.is_read:\n        submission.is_read = True\n        submission.read_at = timezone.now()\n        if submission.status == 'new':\n            submission.status = 'read'\n        submission.save()\n    \n    if request.method == 'POST':\n        action = request.POST.get('action')\n        if action == 'mark_replied':\n            submission.status = 'replied'\n            submission.replied_at = timezone.now()\n            submission.save()\n        elif action == 'archive':\n            submission.status = 'archived'\n            submission.save()\n        elif action == 'save_notes':\n            submission.admin_notes = request.POST.get('notes', '')\n            submission.save()\n        return redirect('brilltech_admin_submission_detail', submission_id=submission_id)\n    \n    return render(request, 'core/brilltech/admin/submission_detail.html', {\n        'submission': submission,\n    })\n\n\n@brilltech_admin_required\ndef brilltech_admin_change_password(request):\n    \"\"\"Change BrillTech admin password\"\"\"\n    from .models import BrillTechAdmin\n    \n    success = False\n    error = None\n    \n    admin_id = request.session.get('brilltech_admin_id')\n    admin = get_object_or_404(BrillTechAdmin, id=admin_id)\n    \n    if request.method == 'POST':\n        current_password = request.POST.get('current_password', '')\n        new_password = request.POST.get('new_password', '')\n        confirm_password = request.POST.get('confirm_password', '')\n        \n        if not admin.check_password(current_password):\n            error = 'Current password is incorrect'\n        elif len(new_password) < 6:\n            error = 'New password must be at least 6 characters'\n        elif new_password != confirm_password:\n            error = 'New passwords do not match'\n        else:\n            admin.set_password(new_password)\n            admin.save()\n            success = True\n    \n    return render(request, 'core/brilltech/admin/change_password.html', {\n        'success': success,\n        'error': error,\n        'admin': admin,\n    })\n\n\n# ============================================\n# CONTENT MANAGER - Topic/Subtopic/Concept/VideoLesson Management\n# ============================================\n\n@require_content_manager\ndef manage_topics(request):\n    \"\"\"List all topics with filters by subject\"\"\"\n    from .models import Topic, Subject\n    \n    topics = Topic.objects.select_related('subject').all()\n    subjects = Subject.objects.all().order_by('name')\n    \n    # Filter by subject\n    subject_id = request.GET.get('subject')\n    if subject_id:\n        topics = topics.filter(subject_id=subject_id)\n    \n    # Filter by active status\n    status = request.GET.get('status')\n    if status == 'active':\n        topics = topics.filter(is_active=True)\n    elif status == 'inactive':\n        topics = topics.filter(is_active=False)\n    \n    # Search by name\n    search = request.GET.get('search', '').strip()\n    if search:\n        topics = topics.filter(Q(name__icontains=search) | Q(description__icontains=search))\n    \n    topics = topics.order_by('subject__name', 'order', 'name')\n    \n    return render(request, 'core/content/topics_list.html', {\n        'topics': topics,\n        'subjects': subjects,\n        'selected_subject': subject_id,\n        'selected_status': status,\n        'search': search,\n    })\n\n\n@require_content_manager\ndef add_topic(request):\n    \"\"\"Add a new topic\"\"\"\n    from .models import Topic, Subject\n    \n    subjects = Subject.objects.all().order_by('name')\n    \n    if request.method == 'POST':\n        subject_id = request.POST.get('subject')\n        name = request.POST.get('name', '').strip()\n        description = request.POST.get('description', '').strip()\n        order = request.POST.get('order', 0)\n        is_active = request.POST.get('is_active') == 'on'\n        \n        if not subject_id or not name:\n            messages.error(request, 'Subject and name are required.')\n            return render(request, 'core/content/topic_form.html', {\n                'subjects': subjects,\n                'form_data': request.POST,\n            })\n        \n        try:\n            subject = Subject.objects.get(id=subject_id)\n            Topic.objects.create(\n                subject=subject,\n                name=name,\n                description=description,\n                order=int(order) if order else 0,\n                is_active=is_active,\n            )\n            messages.success(request, f'Topic \"{name}\" created successfully.')\n            return redirect('manage_topics')\n        except Subject.DoesNotExist:\n            messages.error(request, 'Invalid subject selected.')\n        except IntegrityError:\n            messages.error(request, 'A topic with this name already exists for this subject.')\n        except Exception as e:\n            messages.error(request, f'Error creating topic: {str(e)}')\n    \n    return render(request, 'core/content/topic_form.html', {\n        'subjects': subjects,\n    })\n\n\n@require_content_manager\ndef edit_topic(request, topic_id):\n    \"\"\"Edit an existing topic\"\"\"\n    from .models import Topic, Subject\n    \n    topic = get_object_or_404(Topic, id=topic_id)\n    subjects = Subject.objects.all().order_by('name')\n    \n    if request.method == 'POST':\n        subject_id = request.POST.get('subject')\n        name = request.POST.get('name', '').strip()\n        description = request.POST.get('description', '').strip()\n        order = request.POST.get('order', 0)\n        is_active = request.POST.get('is_active') == 'on'\n        \n        if not subject_id or not name:\n            messages.error(request, 'Subject and name are required.')\n            return render(request, 'core/content/topic_form.html', {\n                'subjects': subjects,\n                'topic': topic,\n                'is_edit': True,\n            })\n        \n        try:\n            subject = Subject.objects.get(id=subject_id)\n            topic.subject = subject\n            topic.name = name\n            topic.description = description\n            topic.order = int(order) if order else 0\n            topic.is_active = is_active\n            topic.save()\n            messages.success(request, f'Topic \"{name}\" updated successfully.')\n            return redirect('manage_topics')\n        except Subject.DoesNotExist:\n            messages.error(request, 'Invalid subject selected.')\n        except IntegrityError:\n            messages.error(request, 'A topic with this name already exists for this subject.')\n        except Exception as e:\n            messages.error(request, f'Error updating topic: {str(e)}')\n    \n    return render(request, 'core/content/topic_form.html', {\n        'subjects': subjects,\n        'topic': topic,\n        'is_edit': True,\n    })\n\n\n@require_content_manager\ndef delete_topic(request, topic_id):\n    \"\"\"Delete a topic\"\"\"\n    from .models import Topic\n    \n    topic = get_object_or_404(Topic, id=topic_id)\n    \n    if request.method == 'POST':\n        name = topic.name\n        topic.delete()\n        messages.success(request, f'Topic \"{name}\" deleted successfully.')\n    \n    return redirect('manage_topics')\n\n\n@require_content_manager\ndef manage_subtopics(request):\n    \"\"\"List all subtopics with filters\"\"\"\n    from .models import Subtopic, Topic, Subject\n    \n    subtopics = Subtopic.objects.select_related('topic', 'topic__subject').all()\n    subjects = Subject.objects.all().order_by('name')\n    topics = Topic.objects.select_related('subject').all().order_by('subject__name', 'name')\n    \n    # Filter by subject\n    subject_id = request.GET.get('subject')\n    if subject_id:\n        subtopics = subtopics.filter(topic__subject_id=subject_id)\n        topics = topics.filter(subject_id=subject_id)\n    \n    # Filter by topic\n    topic_id = request.GET.get('topic')\n    if topic_id:\n        subtopics = subtopics.filter(topic_id=topic_id)\n    \n    # Filter by active status\n    status = request.GET.get('status')\n    if status == 'active':\n        subtopics = subtopics.filter(is_active=True)\n    elif status == 'inactive':\n        subtopics = subtopics.filter(is_active=False)\n    \n    # Search by name\n    search = request.GET.get('search', '').strip()\n    if search:\n        subtopics = subtopics.filter(Q(name__icontains=search) | Q(description__icontains=search))\n    \n    subtopics = subtopics.order_by('topic__subject__name', 'topic__name', 'order', 'name')\n    \n    return render(request, 'core/content/subtopics_list.html', {\n        'subtopics': subtopics,\n        'subjects': subjects,\n        'topics': topics,\n        'selected_subject': subject_id,\n        'selected_topic': topic_id,\n        'selected_status': status,\n        'search': search,\n    })\n\n\n@require_content_manager\ndef add_subtopic(request):\n    \"\"\"Add a new subtopic\"\"\"\n    from .models import Subtopic, Topic, Subject\n    \n    subjects = Subject.objects.all().order_by('name')\n    topics = Topic.objects.select_related('subject').all().order_by('subject__name', 'name')\n    \n    if request.method == 'POST':\n        topic_id = request.POST.get('topic')\n        name = request.POST.get('name', '').strip()\n        description = request.POST.get('description', '').strip()\n        order = request.POST.get('order', 0)\n        is_active = request.POST.get('is_active') == 'on'\n        \n        if not topic_id or not name:\n            messages.error(request, 'Topic and name are required.')\n            return render(request, 'core/content/subtopic_form.html', {\n                'subjects': subjects,\n                'topics': topics,\n                'form_data': request.POST,\n            })\n        \n        try:\n            topic = Topic.objects.get(id=topic_id)\n            Subtopic.objects.create(\n                topic=topic,\n                name=name,\n                description=description,\n                order=int(order) if order else 0,\n                is_active=is_active,\n            )\n            messages.success(request, f'Subtopic \"{name}\" created successfully.')\n            return redirect('manage_subtopics')\n        except Topic.DoesNotExist:\n            messages.error(request, 'Invalid topic selected.')\n        except IntegrityError:\n            messages.error(request, 'A subtopic with this name already exists for this topic.')\n        except Exception as e:\n            messages.error(request, f'Error creating subtopic: {str(e)}')\n    \n    return render(request, 'core/content/subtopic_form.html', {\n        'subjects': subjects,\n        'topics': topics,\n    })\n\n\n@require_content_manager\ndef edit_subtopic(request, subtopic_id):\n    \"\"\"Edit an existing subtopic\"\"\"\n    from .models import Subtopic, Topic, Subject\n    \n    subtopic = get_object_or_404(Subtopic, id=subtopic_id)\n    subjects = Subject.objects.all().order_by('name')\n    topics = Topic.objects.select_related('subject').all().order_by('subject__name', 'name')\n    \n    if request.method == 'POST':\n        topic_id = request.POST.get('topic')\n        name = request.POST.get('name', '').strip()\n        description = request.POST.get('description', '').strip()\n        order = request.POST.get('order', 0)\n        is_active = request.POST.get('is_active') == 'on'\n        \n        if not topic_id or not name:\n            messages.error(request, 'Topic and name are required.')\n            return render(request, 'core/content/subtopic_form.html', {\n                'subjects': subjects,\n                'topics': topics,\n                'subtopic': subtopic,\n                'is_edit': True,\n            })\n        \n        try:\n            topic = Topic.objects.get(id=topic_id)\n            subtopic.topic = topic\n            subtopic.name = name\n            subtopic.description = description\n            subtopic.order = int(order) if order else 0\n            subtopic.is_active = is_active\n            subtopic.save()\n            messages.success(request, f'Subtopic \"{name}\" updated successfully.')\n            return redirect('manage_subtopics')\n        except Topic.DoesNotExist:\n            messages.error(request, 'Invalid topic selected.')\n        except IntegrityError:\n            messages.error(request, 'A subtopic with this name already exists for this topic.')\n        except Exception as e:\n            messages.error(request, f'Error updating subtopic: {str(e)}')\n    \n    return render(request, 'core/content/subtopic_form.html', {\n        'subjects': subjects,\n        'topics': topics,\n        'subtopic': subtopic,\n        'is_edit': True,\n    })\n\n\n@require_content_manager\ndef delete_subtopic(request, subtopic_id):\n    \"\"\"Delete a subtopic\"\"\"\n    from .models import Subtopic\n    \n    subtopic = get_object_or_404(Subtopic, id=subtopic_id)\n    \n    if request.method == 'POST':\n        name = subtopic.name\n        subtopic.delete()\n        messages.success(request, f'Subtopic \"{name}\" deleted successfully.')\n    \n    return redirect('manage_subtopics')\n\n\n@require_content_manager\ndef manage_concepts(request):\n    \"\"\"List all concepts with filters\"\"\"\n    from .models import Concept, Subtopic, Topic, Subject\n    \n    concepts = Concept.objects.select_related('subtopic', 'subtopic__topic', 'subtopic__topic__subject').all()\n    subjects = Subject.objects.all().order_by('name')\n    topics = Topic.objects.select_related('subject').all().order_by('subject__name', 'name')\n    subtopics = Subtopic.objects.select_related('topic', 'topic__subject').all().order_by('topic__subject__name', 'topic__name', 'name')\n    \n    # Filter by subject\n    subject_id = request.GET.get('subject')\n    if subject_id:\n        concepts = concepts.filter(subtopic__topic__subject_id=subject_id)\n        topics = topics.filter(subject_id=subject_id)\n        subtopics = subtopics.filter(topic__subject_id=subject_id)\n    \n    # Filter by topic\n    topic_id = request.GET.get('topic')\n    if topic_id:\n        concepts = concepts.filter(subtopic__topic_id=topic_id)\n        subtopics = subtopics.filter(topic_id=topic_id)\n    \n    # Filter by subtopic\n    subtopic_id = request.GET.get('subtopic')\n    if subtopic_id:\n        concepts = concepts.filter(subtopic_id=subtopic_id)\n    \n    # Filter by active status\n    status = request.GET.get('status')\n    if status == 'active':\n        concepts = concepts.filter(is_active=True)\n    elif status == 'inactive':\n        concepts = concepts.filter(is_active=False)\n    \n    # Search by name\n    search = request.GET.get('search', '').strip()\n    if search:\n        concepts = concepts.filter(Q(name__icontains=search) | Q(description__icontains=search))\n    \n    concepts = concepts.order_by('subtopic__topic__subject__name', 'subtopic__topic__name', 'subtopic__name', 'order', 'name')\n    \n    return render(request, 'core/content/concepts_list.html', {\n        'concepts': concepts,\n        'subjects': subjects,\n        'topics': topics,\n        'subtopics': subtopics,\n        'selected_subject': subject_id,\n        'selected_topic': topic_id,\n        'selected_subtopic': subtopic_id,\n        'selected_status': status,\n        'search': search,\n    })\n\n\n@require_content_manager\ndef add_concept(request):\n    \"\"\"Add a new concept\"\"\"\n    from .models import Concept, Subtopic, Topic, Subject\n    \n    subjects = Subject.objects.all().order_by('name')\n    topics = Topic.objects.select_related('subject').all().order_by('subject__name', 'name')\n    subtopics = Subtopic.objects.select_related('topic', 'topic__subject').all().order_by('topic__subject__name', 'topic__name', 'name')\n    \n    if request.method == 'POST':\n        subtopic_id = request.POST.get('subtopic')\n        name = request.POST.get('name', '').strip()\n        description = request.POST.get('description', '').strip()\n        order = request.POST.get('order', 0)\n        is_active = request.POST.get('is_active') == 'on'\n        \n        if not subtopic_id or not name:\n            messages.error(request, 'Subtopic and name are required.')\n            return render(request, 'core/content/concept_form.html', {\n                'subjects': subjects,\n                'topics': topics,\n                'subtopics': subtopics,\n                'form_data': request.POST,\n            })\n        \n        try:\n            subtopic = Subtopic.objects.get(id=subtopic_id)\n            Concept.objects.create(\n                subtopic=subtopic,\n                name=name,\n                description=description,\n                order=int(order) if order else 0,\n                is_active=is_active,\n            )\n            messages.success(request, f'Concept \"{name}\" created successfully.')\n            return redirect('manage_concepts')\n        except Subtopic.DoesNotExist:\n            messages.error(request, 'Invalid subtopic selected.')\n        except IntegrityError:\n            messages.error(request, 'A concept with this name already exists for this subtopic.')\n        except Exception as e:\n            messages.error(request, f'Error creating concept: {str(e)}')\n    \n    return render(request, 'core/content/concept_form.html', {\n        'subjects': subjects,\n        'topics': topics,\n        'subtopics': subtopics,\n    })\n\n\n@require_content_manager\ndef edit_concept(request, concept_id):\n    \"\"\"Edit an existing concept\"\"\"\n    from .models import Concept, Subtopic, Topic, Subject\n    \n    concept = get_object_or_404(Concept, id=concept_id)\n    subjects = Subject.objects.all().order_by('name')\n    topics = Topic.objects.select_related('subject').all().order_by('subject__name', 'name')\n    subtopics = Subtopic.objects.select_related('topic', 'topic__subject').all().order_by('topic__subject__name', 'topic__name', 'name')\n    \n    if request.method == 'POST':\n        subtopic_id = request.POST.get('subtopic')\n        name = request.POST.get('name', '').strip()\n        description = request.POST.get('description', '').strip()\n        order = request.POST.get('order', 0)\n        is_active = request.POST.get('is_active') == 'on'\n        \n        if not subtopic_id or not name:\n            messages.error(request, 'Subtopic and name are required.')\n            return render(request, 'core/content/concept_form.html', {\n                'subjects': subjects,\n                'topics': topics,\n                'subtopics': subtopics,\n                'concept': concept,\n                'is_edit': True,\n            })\n        \n        try:\n            subtopic = Subtopic.objects.get(id=subtopic_id)\n            concept.subtopic = subtopic\n            concept.name = name\n            concept.description = description\n            concept.order = int(order) if order else 0\n            concept.is_active = is_active\n            concept.save()\n            messages.success(request, f'Concept \"{name}\" updated successfully.')\n            return redirect('manage_concepts')\n        except Subtopic.DoesNotExist:\n            messages.error(request, 'Invalid subtopic selected.')\n        except IntegrityError:\n            messages.error(request, 'A concept with this name already exists for this subtopic.')\n        except Exception as e:\n            messages.error(request, f'Error updating concept: {str(e)}')\n    \n    return render(request, 'core/content/concept_form.html', {\n        'subjects': subjects,\n        'topics': topics,\n        'subtopics': subtopics,\n        'concept': concept,\n        'is_edit': True,\n    })\n\n\n@require_content_manager\ndef delete_concept(request, concept_id):\n    \"\"\"Delete a concept\"\"\"\n    from .models import Concept\n    \n    concept = get_object_or_404(Concept, id=concept_id)\n    \n    if request.method == 'POST':\n        name = concept.name\n        concept.delete()\n        messages.success(request, f'Concept \"{name}\" deleted successfully.')\n    \n    return redirect('manage_concepts')\n\n\n@require_content_manager\ndef manage_video_lessons(request):\n    \"\"\"List all video lessons with filters\"\"\"\n    from .models import VideoLesson, Subject, Topic, Subtopic, Concept\n    \n    videos = VideoLesson.objects.select_related('subject', 'topic', 'subtopic', 'concept', 'created_by').all()\n    subjects = Subject.objects.all().order_by('name')\n    topics = Topic.objects.select_related('subject').all().order_by('subject__name', 'name')\n    subtopics = Subtopic.objects.select_related('topic', 'topic__subject').all().order_by('topic__subject__name', 'topic__name', 'name')\n    concepts = Concept.objects.select_related('subtopic', 'subtopic__topic', 'subtopic__topic__subject').all()\n    \n    # Filter by subject\n    subject_id = request.GET.get('subject')\n    if subject_id:\n        videos = videos.filter(subject_id=subject_id)\n        topics = topics.filter(subject_id=subject_id)\n        subtopics = subtopics.filter(topic__subject_id=subject_id)\n        concepts = concepts.filter(subtopic__topic__subject_id=subject_id)\n    \n    # Filter by topic\n    topic_id = request.GET.get('topic')\n    if topic_id:\n        videos = videos.filter(topic_id=topic_id)\n        subtopics = subtopics.filter(topic_id=topic_id)\n        concepts = concepts.filter(subtopic__topic_id=topic_id)\n    \n    # Filter by subtopic\n    subtopic_id = request.GET.get('subtopic')\n    if subtopic_id:\n        videos = videos.filter(subtopic_id=subtopic_id)\n        concepts = concepts.filter(subtopic_id=subtopic_id)\n    \n    # Filter by concept\n    concept_id = request.GET.get('concept')\n    if concept_id:\n        videos = videos.filter(concept_id=concept_id)\n    \n    # Filter by active status\n    status = request.GET.get('status')\n    if status == 'active':\n        videos = videos.filter(is_active=True)\n    elif status == 'inactive':\n        videos = videos.filter(is_active=False)\n    \n    # Filter by featured\n    featured = request.GET.get('featured')\n    if featured == 'yes':\n        videos = videos.filter(is_featured=True)\n    elif featured == 'no':\n        videos = videos.filter(is_featured=False)\n    \n    # Search by title/description/tags\n    search = request.GET.get('search', '').strip()\n    if search:\n        videos = videos.filter(\n            Q(title__icontains=search) | \n            Q(description__icontains=search) |\n            Q(tags__icontains=search)\n        )\n    \n    videos = videos.order_by('-created_at')\n    \n    return render(request, 'core/content/video_lessons_list.html', {\n        'videos': videos,\n        'subjects': subjects,\n        'topics': topics,\n        'subtopics': subtopics,\n        'concepts': concepts,\n        'selected_subject': subject_id,\n        'selected_topic': topic_id,\n        'selected_subtopic': subtopic_id,\n        'selected_concept': concept_id,\n        'selected_status': status,\n        'selected_featured': featured,\n        'search': search,\n    })\n\n\n@require_content_manager\ndef add_video_lesson(request):\n    \"\"\"Add a new video lesson\"\"\"\n    from .models import VideoLesson, Subject, Topic, Subtopic, Concept\n    import json\n    \n    subjects = Subject.objects.all().order_by('name')\n    topics = Topic.objects.select_related('subject').filter(is_active=True).order_by('subject__name', 'order', 'name')\n    subtopics = Subtopic.objects.select_related('topic', 'topic__subject').filter(is_active=True).order_by('topic__subject__name', 'topic__name', 'order', 'name')\n    concepts = Concept.objects.select_related('subtopic', 'subtopic__topic', 'subtopic__topic__subject').all()\n    \n    # Build JSON for Alpine.js dynamic filtering\n    topics_json = json.dumps([{'id': t.id, 'name': t.name, 'subject_id': t.subject_id} for t in topics])\n    subtopics_json = json.dumps([{'id': s.id, 'name': s.name, 'topic_id': s.topic_id} for s in subtopics])\n    concepts_json = json.dumps([{'id': c.id, 'name': c.name, 'subtopic_id': c.subtopic_id} for c in concepts])\n    \n    if request.method == 'POST':\n        subject_id = request.POST.get('subject')\n        topic_id = request.POST.get('topic') or None\n        subtopic_id = request.POST.get('subtopic') or None\n        concept_id = request.POST.get('concept') or None\n        title = request.POST.get('title', '').strip()\n        description = request.POST.get('description', '').strip()\n        youtube_url = request.POST.get('youtube_url', '').strip()\n        duration_minutes = request.POST.get('duration_minutes', 0)\n        thumbnail_url = request.POST.get('thumbnail_url', '').strip()\n        tags = request.POST.get('tags', '').strip()\n        order = request.POST.get('order', 0)\n        is_active = request.POST.get('is_active') == 'on'\n        is_featured = request.POST.get('is_featured') == 'on'\n        \n        if not subject_id or not title or not youtube_url:\n            messages.error(request, 'Subject, title, and YouTube URL are required.')\n            return render(request, 'core/content/video_lesson_form.html', {\n                'subjects': subjects,\n                'topics': topics,\n                'subtopics': subtopics,\n                'concepts': concepts,\n                'topics_json': topics_json,\n                'subtopics_json': subtopics_json,\n                'concepts_json': concepts_json,\n                'form_data': request.POST,\n            })\n        \n        try:\n            subject = Subject.objects.get(id=subject_id)\n            topic = Topic.objects.get(id=topic_id) if topic_id else None\n            subtopic = Subtopic.objects.get(id=subtopic_id) if subtopic_id else None\n            concept = Concept.objects.get(id=concept_id) if concept_id else None\n            \n            VideoLesson.objects.create(\n                subject=subject,\n                topic=topic,\n                subtopic=subtopic,\n                concept=concept,\n                title=title,\n                description=description,\n                youtube_url=youtube_url,\n                duration_minutes=int(duration_minutes) if duration_minutes else 0,\n                thumbnail_url=thumbnail_url,\n                tags=tags,\n                order=int(order) if order else 0,\n                is_active=is_active,\n                is_featured=is_featured,\n                created_by=request.user,\n            )\n            messages.success(request, f'Video lesson \"{title}\" created successfully.')\n            return redirect('manage_video_lessons')\n        except Subject.DoesNotExist:\n            messages.error(request, 'Invalid subject selected.')\n        except (Topic.DoesNotExist, Subtopic.DoesNotExist, Concept.DoesNotExist) as e:\n            messages.error(request, f'Invalid hierarchy selection: {str(e)}')\n        except Exception as e:\n            messages.error(request, f'Error creating video lesson: {str(e)}')\n    \n    return render(request, 'core/content/video_lesson_form.html', {\n        'subjects': subjects,\n        'topics': topics,\n        'subtopics': subtopics,\n        'concepts': concepts,\n        'topics_json': topics_json,\n        'subtopics_json': subtopics_json,\n        'concepts_json': concepts_json,\n    })\n\n\n@require_content_manager\ndef edit_video_lesson(request, video_id):\n    \"\"\"Edit an existing video lesson\"\"\"\n    from .models import VideoLesson, Subject, Topic, Subtopic, Concept\n    import json\n    \n    video = get_object_or_404(VideoLesson, id=video_id)\n    subjects = Subject.objects.all().order_by('name')\n    topics = Topic.objects.select_related('subject').filter(is_active=True).order_by('subject__name', 'order', 'name')\n    subtopics = Subtopic.objects.select_related('topic', 'topic__subject').filter(is_active=True).order_by('topic__subject__name', 'topic__name', 'order', 'name')\n    concepts = Concept.objects.select_related('subtopic', 'subtopic__topic', 'subtopic__topic__subject').all()\n    \n    # Build JSON for Alpine.js dynamic filtering\n    topics_json = json.dumps([{'id': t.id, 'name': t.name, 'subject_id': t.subject_id} for t in topics])\n    subtopics_json = json.dumps([{'id': s.id, 'name': s.name, 'topic_id': s.topic_id} for s in subtopics])\n    concepts_json = json.dumps([{'id': c.id, 'name': c.name, 'subtopic_id': c.subtopic_id} for c in concepts])\n    \n    if request.method == 'POST':\n        subject_id = request.POST.get('subject')\n        topic_id = request.POST.get('topic') or None\n        subtopic_id = request.POST.get('subtopic') or None\n        concept_id = request.POST.get('concept') or None\n        title = request.POST.get('title', '').strip()\n        description = request.POST.get('description', '').strip()\n        youtube_url = request.POST.get('youtube_url', '').strip()\n        duration_minutes = request.POST.get('duration_minutes', 0)\n        thumbnail_url = request.POST.get('thumbnail_url', '').strip()\n        tags = request.POST.get('tags', '').strip()\n        order = request.POST.get('order', 0)\n        is_active = request.POST.get('is_active') == 'on'\n        is_featured = request.POST.get('is_featured') == 'on'\n        \n        if not subject_id or not title or not youtube_url:\n            messages.error(request, 'Subject, title, and YouTube URL are required.')\n            return render(request, 'core/content/video_lesson_form.html', {\n                'subjects': subjects,\n                'topics': topics,\n                'subtopics': subtopics,\n                'concepts': concepts,\n                'topics_json': topics_json,\n                'subtopics_json': subtopics_json,\n                'concepts_json': concepts_json,\n                'video_lesson': video,\n            })\n        \n        try:\n            subject = Subject.objects.get(id=subject_id)\n            topic = Topic.objects.get(id=topic_id) if topic_id else None\n            subtopic = Subtopic.objects.get(id=subtopic_id) if subtopic_id else None\n            concept = Concept.objects.get(id=concept_id) if concept_id else None\n            \n            video.subject = subject\n            video.topic = topic\n            video.subtopic = subtopic\n            video.concept = concept\n            video.title = title\n            video.description = description\n            video.youtube_url = youtube_url\n            video.duration_minutes = int(duration_minutes) if duration_minutes else 0\n            video.thumbnail_url = thumbnail_url\n            video.tags = tags\n            video.order = int(order) if order else 0\n            video.is_active = is_active\n            video.is_featured = is_featured\n            video.save()\n            messages.success(request, f'Video lesson \"{title}\" updated successfully.')\n            return redirect('manage_video_lessons')\n        except Subject.DoesNotExist:\n            messages.error(request, 'Invalid subject selected.')\n        except (Topic.DoesNotExist, Subtopic.DoesNotExist, Concept.DoesNotExist) as e:\n            messages.error(request, f'Invalid hierarchy selection: {str(e)}')\n        except Exception as e:\n            messages.error(request, f'Error updating video lesson: {str(e)}')\n    \n    return render(request, 'core/content/video_lesson_form.html', {\n        'subjects': subjects,\n        'topics': topics,\n        'subtopics': subtopics,\n        'concepts': concepts,\n        'topics_json': topics_json,\n        'subtopics_json': subtopics_json,\n        'concepts_json': concepts_json,\n        'video_lesson': video,\n    })\n\n\n@require_content_manager\ndef delete_video_lesson(request, video_id):\n    \"\"\"Delete a video lesson\"\"\"\n    from .models import VideoLesson\n    \n    video = get_object_or_404(VideoLesson, id=video_id)\n    \n    if request.method == 'POST':\n        title = video.title\n        video.delete()\n        messages.success(request, f'Video lesson \"{title}\" deleted successfully.')\n    \n    return redirect('manage_video_lessons')\n\n\n# ============================================================================\n# BRILLTECH CRM VIEWS (Tasks, Leads, Activities, Mailing)\n# ============================================================================\n\n@brilltech_admin_required\ndef crm_tasks_list(request):\n    \"\"\"List all CRM tasks\"\"\"\n    from .models import CRMTask, CRMLead\n    \n    tasks = CRMTask.objects.select_related('assigned_to', 'related_lead', 'created_by').all()\n    \n    status_filter = request.GET.get('status', '')\n    priority_filter = request.GET.get('priority', '')\n    \n    if status_filter:\n        tasks = tasks.filter(status=status_filter)\n    if priority_filter:\n        tasks = tasks.filter(priority=priority_filter)\n    \n    return render(request, 'core/brilltech/admin/crm/tasks_list.html', {\n        'tasks': tasks,\n        'status_filter': status_filter,\n        'priority_filter': priority_filter,\n    })\n\n\n@brilltech_admin_required\ndef crm_task_create(request):\n    \"\"\"Create a new CRM task\"\"\"\n    from .models import CRMTask, CRMLead\n    from django.contrib.auth.models import User\n    \n    if request.method == 'POST':\n        task = CRMTask.objects.create(\n            title=request.POST.get('title'),\n            description=request.POST.get('description', ''),\n            priority=request.POST.get('priority', 'medium'),\n            status=request.POST.get('status', 'pending'),\n            due_date=request.POST.get('due_date') or None,\n            assigned_to_id=request.POST.get('assigned_to') or None,\n            related_lead_id=request.POST.get('related_lead') or None,\n        )\n        messages.success(request, f'Task \"{task.title}\" created successfully.')\n        return redirect('crm_tasks_list')\n    \n    leads = CRMLead.objects.all()\n    users = User.objects.filter(is_active=True)\n    \n    return render(request, 'core/brilltech/admin/crm/task_form.html', {\n        'leads': leads,\n        'users': users,\n    })\n\n\n@brilltech_admin_required\ndef crm_task_edit(request, task_id):\n    \"\"\"Edit a CRM task\"\"\"\n    from .models import CRMTask, CRMLead\n    from django.contrib.auth.models import User\n    \n    task = get_object_or_404(CRMTask, id=task_id)\n    \n    if request.method == 'POST':\n        task.title = request.POST.get('title')\n        task.description = request.POST.get('description', '')\n        task.priority = request.POST.get('priority', 'medium')\n        task.status = request.POST.get('status', 'pending')\n        task.due_date = request.POST.get('due_date') or None\n        task.assigned_to_id = request.POST.get('assigned_to') or None\n        task.related_lead_id = request.POST.get('related_lead') or None\n        task.save()\n        messages.success(request, f'Task \"{task.title}\" updated successfully.')\n        return redirect('crm_tasks_list')\n    \n    leads = CRMLead.objects.all()\n    users = User.objects.filter(is_active=True)\n    \n    return render(request, 'core/brilltech/admin/crm/task_form.html', {\n        'task': task,\n        'leads': leads,\n        'users': users,\n    })\n\n\n@brilltech_admin_required\ndef crm_task_delete(request, task_id):\n    \"\"\"Delete a CRM task\"\"\"\n    from .models import CRMTask\n    \n    task = get_object_or_404(CRMTask, id=task_id)\n    \n    if request.method == 'POST':\n        title = task.title\n        task.delete()\n        messages.success(request, f'Task \"{title}\" deleted successfully.')\n    \n    return redirect('crm_tasks_list')\n\n\n@brilltech_admin_required\ndef crm_leads_list(request):\n    \"\"\"List all CRM leads with pipeline filter\"\"\"\n    from .models import CRMLead\n    \n    leads = CRMLead.objects.select_related('assigned_to', 'created_by').all()\n    \n    pipeline_filter = request.GET.get('pipeline', '')\n    source_filter = request.GET.get('source', '')\n    \n    if pipeline_filter:\n        leads = leads.filter(pipeline_stage=pipeline_filter)\n    if source_filter:\n        leads = leads.filter(source=source_filter)\n    \n    pipeline_stages = []\n    for stage, label in CRMLead.PIPELINE_CHOICES:\n        count = CRMLead.objects.filter(pipeline_stage=stage).count()\n        pipeline_stages.append({'stage': stage, 'label': label, 'count': count})\n    \n    return render(request, 'core/brilltech/admin/crm/leads_list.html', {\n        'leads': leads,\n        'pipeline_filter': pipeline_filter,\n        'source_filter': source_filter,\n        'pipeline_stages': pipeline_stages,\n        'pipeline_choices': CRMLead.PIPELINE_CHOICES,\n        'source_choices': CRMLead.SOURCE_CHOICES,\n    })\n\n\n@brilltech_admin_required\ndef crm_lead_create(request):\n    \"\"\"Create a new CRM lead\"\"\"\n    from .models import CRMLead, CRMActivity\n    from django.contrib.auth.models import User\n    \n    if request.method == 'POST':\n        lead = CRMLead.objects.create(\n            first_name=request.POST.get('first_name'),\n            last_name=request.POST.get('last_name'),\n            email=request.POST.get('email'),\n            phone=request.POST.get('phone', ''),\n            company=request.POST.get('company', ''),\n            job_title=request.POST.get('job_title', ''),\n            lead_type=request.POST.get('lead_type', 'school'),\n            source=request.POST.get('source', 'website'),\n            pipeline_stage=request.POST.get('pipeline_stage', 'new'),\n            notes=request.POST.get('notes', ''),\n            estimated_value=request.POST.get('estimated_value') or None,\n            assigned_to_id=request.POST.get('assigned_to') or None,\n        )\n        CRMActivity.objects.create(\n            lead=lead,\n            activity_type='note',\n            title='Lead Created',\n            description=f'Lead was created from source: {lead.get_source_display()}',\n        )\n        messages.success(request, f'Lead \"{lead.full_name}\" created successfully.')\n        return redirect('crm_lead_detail', lead_id=lead.id)\n    \n    users = User.objects.filter(is_active=True)\n    \n    return render(request, 'core/brilltech/admin/crm/lead_form.html', {\n        'users': users,\n        'pipeline_choices': CRMLead.PIPELINE_CHOICES,\n        'source_choices': CRMLead.SOURCE_CHOICES,\n        'type_choices': CRMLead.TYPE_CHOICES,\n    })\n\n\n@brilltech_admin_required\ndef crm_lead_detail(request, lead_id):\n    \"\"\"View lead details with activities\"\"\"\n    from .models import CRMLead, CRMActivity, CRMTask\n    \n    lead = get_object_or_404(CRMLead, id=lead_id)\n    activities = lead.activities.all()[:20]\n    tasks = lead.tasks.all()[:10]\n    \n    return render(request, 'core/brilltech/admin/crm/lead_detail.html', {\n        'lead': lead,\n        'activities': activities,\n        'tasks': tasks,\n        'pipeline_choices': CRMLead.PIPELINE_CHOICES,\n        'activity_types': CRMActivity.TYPE_CHOICES,\n    })\n\n\n@brilltech_admin_required\ndef crm_lead_edit(request, lead_id):\n    \"\"\"Edit a CRM lead\"\"\"\n    from .models import CRMLead, CRMActivity\n    from django.contrib.auth.models import User\n    \n    lead = get_object_or_404(CRMLead, id=lead_id)\n    old_stage = lead.pipeline_stage\n    \n    if request.method == 'POST':\n        lead.first_name = request.POST.get('first_name')\n        lead.last_name = request.POST.get('last_name')\n        lead.email = request.POST.get('email')\n        lead.phone = request.POST.get('phone', '')\n        lead.company = request.POST.get('company', '')\n        lead.job_title = request.POST.get('job_title', '')\n        lead.lead_type = request.POST.get('lead_type', 'school')\n        lead.source = request.POST.get('source', 'website')\n        lead.pipeline_stage = request.POST.get('pipeline_stage', 'new')\n        lead.notes = request.POST.get('notes', '')\n        lead.estimated_value = request.POST.get('estimated_value') or None\n        lead.assigned_to_id = request.POST.get('assigned_to') or None\n        lead.save()\n        \n        if old_stage != lead.pipeline_stage:\n            CRMActivity.objects.create(\n                lead=lead,\n                activity_type='stage_change',\n                title='Pipeline Stage Changed',\n                description=f'Stage changed from {dict(CRMLead.PIPELINE_CHOICES).get(old_stage)} to {lead.get_pipeline_stage_display()}',\n            )\n        \n        messages.success(request, f'Lead \"{lead.full_name}\" updated successfully.')\n        return redirect('crm_lead_detail', lead_id=lead.id)\n    \n    users = User.objects.filter(is_active=True)\n    \n    return render(request, 'core/brilltech/admin/crm/lead_form.html', {\n        'lead': lead,\n        'users': users,\n        'pipeline_choices': CRMLead.PIPELINE_CHOICES,\n        'source_choices': CRMLead.SOURCE_CHOICES,\n        'type_choices': CRMLead.TYPE_CHOICES,\n    })\n\n\n@brilltech_admin_required\ndef crm_lead_delete(request, lead_id):\n    \"\"\"Delete a CRM lead\"\"\"\n    from .models import CRMLead\n    \n    lead = get_object_or_404(CRMLead, id=lead_id)\n    \n    if request.method == 'POST':\n        name = lead.full_name\n        lead.delete()\n        messages.success(request, f'Lead \"{name}\" deleted successfully.')\n    \n    return redirect('crm_leads_list')\n\n\n@brilltech_admin_required\ndef crm_activity_add(request, lead_id):\n    \"\"\"Add an activity to a lead\"\"\"\n    from .models import CRMLead, CRMActivity\n    \n    lead = get_object_or_404(CRMLead, id=lead_id)\n    \n    if request.method == 'POST':\n        CRMActivity.objects.create(\n            lead=lead,\n            activity_type=request.POST.get('activity_type', 'note'),\n            title=request.POST.get('title'),\n            description=request.POST.get('description', ''),\n        )\n        messages.success(request, 'Activity added successfully.')\n    \n    return redirect('crm_lead_detail', lead_id=lead.id)\n\n\n@brilltech_admin_required\ndef crm_mailing_lists(request):\n    \"\"\"List all mailing lists\"\"\"\n    from .models import CRMMailingList\n    \n    mailing_lists = CRMMailingList.objects.all()\n    \n    return render(request, 'core/brilltech/admin/crm/mailing_lists.html', {\n        'mailing_lists': mailing_lists,\n    })\n\n\n@brilltech_admin_required\ndef crm_mailing_list_create(request):\n    \"\"\"Create a new mailing list\"\"\"\n    from .models import CRMMailingList\n    \n    if request.method == 'POST':\n        mailing_list = CRMMailingList.objects.create(\n            name=request.POST.get('name'),\n            description=request.POST.get('description', ''),\n        )\n        messages.success(request, f'Mailing list \"{mailing_list.name}\" created successfully.')\n        return redirect('crm_mailing_list_detail', list_id=mailing_list.id)\n    \n    return render(request, 'core/brilltech/admin/crm/mailing_list_form.html', {})\n\n\n@brilltech_admin_required\ndef crm_mailing_list_detail(request, list_id):\n    \"\"\"View mailing list with subscribers\"\"\"\n    from .models import CRMMailingList, CRMMailingSubscriber\n    \n    mailing_list = get_object_or_404(CRMMailingList, id=list_id)\n    subscribers = mailing_list.subscribers.all()\n    \n    return render(request, 'core/brilltech/admin/crm/mailing_list_detail.html', {\n        'mailing_list': mailing_list,\n        'subscribers': subscribers,\n    })\n\n\n@brilltech_admin_required\ndef crm_subscriber_add(request, list_id):\n    \"\"\"Add a subscriber to a mailing list\"\"\"\n    from .models import CRMMailingList, CRMMailingSubscriber\n    \n    mailing_list = get_object_or_404(CRMMailingList, id=list_id)\n    \n    if request.method == 'POST':\n        email = request.POST.get('email')\n        if not CRMMailingSubscriber.objects.filter(mailing_list=mailing_list, email=email).exists():\n            CRMMailingSubscriber.objects.create(\n                mailing_list=mailing_list,\n                email=email,\n                first_name=request.POST.get('first_name', ''),\n                last_name=request.POST.get('last_name', ''),\n            )\n            messages.success(request, f'Subscriber \"{email}\" added successfully.')\n        else:\n            messages.warning(request, f'Subscriber \"{email}\" already exists.')\n    \n    return redirect('crm_mailing_list_detail', list_id=list_id)\n\n\n@brilltech_admin_required\ndef crm_email_campaigns(request):\n    \"\"\"List all email campaigns\"\"\"\n    from .models import CRMEmailCampaign\n    \n    campaigns = CRMEmailCampaign.objects.select_related('mailing_list', 'created_by').all()\n    \n    return render(request, 'core/brilltech/admin/crm/email_campaigns.html', {\n        'campaigns': campaigns,\n    })\n\n\n@brilltech_admin_required\ndef crm_email_campaign_create(request):\n    \"\"\"Create a new email campaign\"\"\"\n    from .models import CRMEmailCampaign, CRMMailingList\n    from django.core.mail import send_mail\n    from django.conf import settings\n    from django.utils import timezone\n    \n    if request.method == 'POST':\n        campaign = CRMEmailCampaign.objects.create(\n            name=request.POST.get('name'),\n            subject=request.POST.get('subject'),\n            body=request.POST.get('body'),\n            mailing_list_id=request.POST.get('mailing_list'),\n            status='draft',\n        )\n        \n        if request.POST.get('send_now') == 'true':\n            mailing_list = campaign.mailing_list\n            subscribers = mailing_list.subscribers.filter(is_active=True)\n            campaign.recipient_count = subscribers.count()\n            campaign.status = 'sending'\n            campaign.save()\n            \n            sent = 0\n            failed = 0\n            for subscriber in subscribers:\n                try:\n                    send_mail(\n                        subject=campaign.subject,\n                        message=campaign.body,\n                        from_email=settings.EMAIL_HOST_USER,\n                        recipient_list=[subscriber.email],\n                        fail_silently=False,\n                    )\n                    sent += 1\n                except:\n                    failed += 1\n            \n            campaign.sent_count = sent\n            campaign.failed_count = failed\n            campaign.status = 'sent' if failed == 0 else 'failed'\n            campaign.sent_at = timezone.now()\n            campaign.save()\n            \n            messages.success(request, f'Campaign sent to {sent} recipients.')\n        else:\n            messages.success(request, f'Campaign \"{campaign.name}\" saved as draft.')\n        \n        return redirect('crm_email_campaigns')\n    \n    mailing_lists = CRMMailingList.objects.all()\n    \n    return render(request, 'core/brilltech/admin/crm/email_campaign_form.html', {\n        'mailing_lists': mailing_lists,\n    })","path":null,"size_bytes":256394,"size_tokens":null},"core/migrations/0007_subscriptionplan_usersubscription_payfastpayment.py":{"content":"# Generated by Django 5.0.2 on 2025-10-02 20:58\n\nimport django.db.models.deletion\nfrom django.conf import settings\nfrom django.db import migrations, models\n\n\nclass Migration(migrations.Migration):\n\n    dependencies = [\n        ('core', '0006_assignmentshare_unique_active_generated_share_and_more'),\n        migrations.swappable_dependency(settings.AUTH_USER_MODEL),\n    ]\n\n    operations = [\n        migrations.CreateModel(\n            name='SubscriptionPlan',\n            fields=[\n                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),\n                ('name', models.CharField(max_length=50, unique=True)),\n                ('plan_type', models.CharField(choices=[('free', 'Free'), ('starter', 'Starter'), ('growth', 'Growth'), ('premium', 'Premium')], max_length=20, unique=True)),\n                ('price', models.DecimalField(decimal_places=2, max_digits=10)),\n                ('billing_period', models.CharField(default='monthly', max_length=20)),\n                ('can_upload_documents', models.BooleanField(default=True)),\n                ('can_use_ai', models.BooleanField(default=False)),\n                ('can_access_library', models.BooleanField(default=False)),\n                ('allowed_subjects_count', models.IntegerField(default=0)),\n                ('monthly_ai_generations', models.IntegerField(default=0)),\n                ('description', models.TextField(blank=True)),\n                ('is_active', models.BooleanField(default=True)),\n                ('created_at', models.DateTimeField(auto_now_add=True)),\n            ],\n            options={\n                'ordering': ['price'],\n            },\n        ),\n        migrations.CreateModel(\n            name='UserSubscription',\n            fields=[\n                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),\n                ('status', models.CharField(choices=[('active', 'Active'), ('cancelled', 'Cancelled'), ('expired', 'Expired'), ('pending', 'Pending Payment')], default='pending', max_length=20)),\n                ('started_at', models.DateTimeField(auto_now_add=True)),\n                ('current_period_start', models.DateTimeField()),\n                ('current_period_end', models.DateTimeField()),\n                ('cancelled_at', models.DateTimeField(blank=True, null=True)),\n                ('payfast_token', models.CharField(blank=True, max_length=100)),\n                ('created_at', models.DateTimeField(auto_now_add=True)),\n                ('updated_at', models.DateTimeField(auto_now=True)),\n                ('plan', models.ForeignKey(on_delete=django.db.models.deletion.PROTECT, to='core.subscriptionplan')),\n                ('selected_subject', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, to='core.subject')),\n                ('user', models.OneToOneField(on_delete=django.db.models.deletion.CASCADE, related_name='subscription', to=settings.AUTH_USER_MODEL)),\n            ],\n        ),\n        migrations.CreateModel(\n            name='PayFastPayment',\n            fields=[\n                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),\n                ('payfast_payment_id', models.CharField(max_length=100, unique=True)),\n                ('merchant_id', models.CharField(max_length=100)),\n                ('amount_gross', models.DecimalField(decimal_places=2, max_digits=10)),\n                ('amount_fee', models.DecimalField(decimal_places=2, default=0, max_digits=10)),\n                ('amount_net', models.DecimalField(decimal_places=2, max_digits=10)),\n                ('status', models.CharField(choices=[('pending', 'Pending'), ('complete', 'Complete'), ('failed', 'Failed'), ('cancelled', 'Cancelled')], default='pending', max_length=20)),\n                ('payment_status_text', models.CharField(blank=True, max_length=50)),\n                ('itn_data', models.JSONField(blank=True, null=True)),\n                ('created_at', models.DateTimeField(auto_now_add=True)),\n                ('completed_at', models.DateTimeField(blank=True, null=True)),\n                ('user', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, to=settings.AUTH_USER_MODEL)),\n                ('plan', models.ForeignKey(on_delete=django.db.models.deletion.PROTECT, to='core.subscriptionplan')),\n                ('subscription', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, to='core.usersubscription')),\n            ],\n            options={\n                'ordering': ['-created_at'],\n            },\n        ),\n    ]\n","path":null,"size_bytes":4674,"size_tokens":null},"core/migrations/0003_uploadeddocument_ai_content.py":{"content":"# Generated by Django 5.0.2 on 2025-09-21 23:12\n\nfrom django.db import migrations, models\n\n\nclass Migration(migrations.Migration):\n\n    dependencies = [\n        ('core', '0002_generatedassignment_instructions_and_more'),\n    ]\n\n    operations = [\n        migrations.AddField(\n            model_name='uploadeddocument',\n            name='ai_content',\n            field=models.JSONField(blank=True, null=True),\n        ),\n    ]\n","path":null,"size_bytes":426,"size_tokens":null},"core/apps.py":{"content":"from django.apps import AppConfig\n\n\nclass CoreConfig(AppConfig):\n    default_auto_field = 'django.db.models.BigAutoField'\n    name = 'core'","path":null,"size_bytes":139,"size_tokens":null},"README.md":{"content":"# EduTech Freemium Teacher Platform\n\nA comprehensive freemium educational technology platform designed for teachers and administrators to create, manage, and share educational content with AI-powered assistance.\n\n## üìã Table of Contents\n\n- [Overview](#overview)\n- [Features](#features)\n- [System Architecture](#system-architecture)\n- [Module Documentation](#module-documentation)\n- [Technology Stack](#technology-stack)\n- [Setup Instructions](#setup-instructions)\n- [Deployment Guide](#deployment-guide)\n- [Subscription Tiers](#subscription-tiers)\n- [API Documentation](#api-documentation)\n- [Database Schema](#database-schema)\n\n---\n\n## Overview\n\nThe EduTech Freemium Teacher Platform is a Django-based web application that helps teachers create lesson plans, generate assignments, manage documents, and distribute homework to students. The platform integrates OpenAI's GPT-5 for AI-powered content generation and uses PayFast for subscription payments.\n\n**Key Highlights:**\n- ü§ñ AI-powered lesson plan and homework generation\n- üìö Comprehensive document management system\n- üîó Shareable assignment links for student distribution\n- üí≥ PayFast-integrated subscription system with 4 pricing tiers\n- ‚úâÔ∏è Email verification for account security\n- üìä Usage analytics and quota tracking\n\n---\n\n## Features\n\n### 1. **User Management & Authentication**\n- Teacher and Admin role-based access control\n- Email verification system with token-based activation\n- Secure password management with reset functionality\n- Account settings for profile customization\n- Session management\n\n### 2. **AI-Powered Content Generation** (Premium Feature)\n- **Lesson Plans**: Generate comprehensive lesson plans with objectives, materials, activities, and assessments\n- **Homework/Assignments**: Create custom homework with various question types\n- **Question Generator**: Generate practice questions in multiple formats:\n  - Multiple Choice Questions (MCQ)\n  - Structured/Short Answer\n  - Free Response/Essay\n  - Cambridge-style Structured Questions\n\n### 3. **Document Management**\n- Upload and organize educational documents (PDF, DOCX)\n- Categorize by subject, grade, and exam board\n- Document types: Lesson Plans, Homework, Past Papers, Sample Questions\n- Download and share documents with classes\n\n### 4. **Class & Assignment Management**\n- Create and manage class groups\n- Share assignments with specific classes\n- Generate unique shareable links for each assignment\n- Track assignment views and access analytics\n- Revoke access to shared assignments\n- Set due dates and expiry dates for assignments\n\n### 5. **Subscription System**\n- **Free Tier (R0)**: Basic document upload and management\n- **Starter Tier (R50/month)**: Enhanced document features (no AI)\n- **Growth Tier (R100/month)**: Access to pre-made content library for 1 subject\n- **Premium Tier (R250/month)**: Full AI access for unlimited content generation\n\n### 6. **Payment Integration**\n- Secure PayFast payment gateway integration\n- Signature validation and webhook verification\n- Payment history tracking\n- Automatic subscription activation\n- Support for South African Rand (ZAR) currency\n\n### 7. **Account Settings**\n- Personal information management (name, email, institution, bio)\n- Password change with current password verification\n- Email notification preferences\n- Usage statistics dashboard\n- Email verification status\n\n---\n\n## System Architecture\n\n### **Backend Architecture**\n```\n‚îú‚îÄ‚îÄ Django 5.0 Framework\n‚îÇ   ‚îú‚îÄ‚îÄ Core App (main business logic)\n‚îÇ   ‚îú‚îÄ‚îÄ User Authentication & Authorization\n‚îÇ   ‚îú‚îÄ‚îÄ ORM for Database Management\n‚îÇ   ‚îî‚îÄ‚îÄ Django Admin Interface\n‚îú‚îÄ‚îÄ OpenAI Integration (GPT-5)\n‚îú‚îÄ‚îÄ PayFast Payment Gateway\n‚îî‚îÄ‚îÄ Email Service (Gmail SMTP)\n```\n\n### **Frontend Architecture**\n```\n‚îú‚îÄ‚îÄ Django Templates (Jinja2)\n‚îú‚îÄ‚îÄ Tailwind CSS (Utility-first styling)\n‚îú‚îÄ‚îÄ Alpine.js (Lightweight JavaScript framework)\n‚îú‚îÄ‚îÄ Font Awesome (Icons)\n‚îî‚îÄ‚îÄ Streamlit (Alternative interface - app.py)\n```\n\n### **Data Layer**\n```\n‚îú‚îÄ‚îÄ SQLite (Development)\n‚îú‚îÄ‚îÄ PostgreSQL (Production-ready)\n‚îú‚îÄ‚îÄ Django ORM\n‚îî‚îÄ‚îÄ JSON for AI content storage\n```\n\n---\n\n## Module Documentation\n\n### **1. Authentication Module** (`core/views.py`)\n\n**Views:**\n- `login_view`: Handles user login with email verification check\n- `logout_view`: Logs out users and clears session\n- `signup_view`: User registration with automatic email verification\n- `verify_email`: Token-based email verification\n- `resend_verification`: Resends verification email\n\n**Key Features:**\n- Inactive users (unverified emails) cannot log in\n- Secure token generation for email verification\n- Password hashing using Django's built-in system\n\n---\n\n### **2. Content Management Module**\n\n#### **Lesson Plans** (`lesson_plans_view`)\n**Functionality:**\n- Upload custom lesson plans (PDF/DOCX)\n- AI-generated lesson plans with structured JSON output\n- Categorization by subject, grade, and exam board\n- View, download, and delete lesson plans\n\n**AI Generation Process:**\n1. User provides: subject, grade, exam board, topic, duration\n2. OpenAI GPT-5 generates structured lesson plan\n3. Output includes: objectives, materials, activities, assessment, homework\n4. Stored in `UploadedDocument.ai_content` as JSON\n\n#### **Assignments** (`assignments_view`)\n**Functionality:**\n- Upload existing assignments\n- Generate AI-powered homework\n- Share assignments with class groups\n- Track shared assignments and revoke access\n\n**Assignment Sharing:**\n- Unique token-based URLs (32-character secure tokens)\n- No login required for students to view assignments\n- Teachers can set due dates and expiry dates\n- View count tracking and last accessed timestamp\n\n#### **Question Generator** (`questions_view`)\n**Functionality:**\n- Generate practice questions in 4 formats:\n  - MCQ (Multiple Choice)\n  - Structured (Short Answer)\n  - Free Response (Essay)\n  - Cambridge-style Structured\n- Specify number of questions and topic\n- Export as PDF or view inline\n\n---\n\n### **3. AI Service Module** (`core/openai_service.py`)\n\n**Functions:**\n\n#### `generate_lesson_plan(subject, grade, board, topic, duration)`\n- Uses GPT-5 with structured JSON output\n- Returns: title, objectives, materials, activities, assessment, homework\n- Error handling for API failures\n\n#### `generate_homework(subject, grade, board, topic, question_type, num_questions)`\n- Generates homework questions based on type\n- Returns: title, instructions, questions array, total marks\n- Each question includes: question text, marks, answer guidance\n\n#### `generate_questions(subject, grade, board, topic, question_type, num_questions)`\n- Similar to homework generation\n- Focused on practice questions\n- Supports all 4 question formats\n\n**Configuration:**\n- API Key: Stored in environment variable `OPENAI_API_KEY`\n- Model: `gpt-5`\n- Response Format: JSON object for structured parsing\n\n---\n\n### **4. Class Management Module**\n\n#### **Models:**\n- `ClassGroup`: Represents a class/group of students\n  - Fields: name, description, subject, grade, teacher, is_active\n  - Unique constraint: teacher + class name\n\n- `AssignmentShare`: Links assignments to classes\n  - Links to either `GeneratedAssignment` OR `UploadedDocument`\n  - Unique token for public access\n  - Tracks: view_count, last_accessed, shared_at, expires_at, revoked_at\n\n#### **Views:**\n- `classes_view`: List all classes for a teacher\n- `create_class`: Create new class group\n- `edit_class`: Update class details\n- `delete_class`: Soft delete (marks inactive)\n- `create_share`: Share assignment with class\n- `revoke_share`: Revoke access to shared assignment\n- `public_assignment_view`: Public view for students (no login)\n- `public_assignment_download`: Download shared assignment\n\n**Security Features:**\n- Teachers can only share their own assignments\n- Teachers can only share to their own classes\n- Token-based access (no student accounts needed)\n- Automatic expiry checking\n- Revocation capability\n\n---\n\n### **5. Subscription & Payment Module**\n\n#### **Models:**\n\n**SubscriptionPlan:**\n- Defines 4 pricing tiers\n- Feature flags: `can_upload_documents`, `can_use_ai`, `can_access_library`\n- Quotas: `monthly_ai_generations`, `allowed_subjects_count`\n\n**UserSubscription:**\n- Tracks user's current plan\n- Status: active, cancelled, expired, pending\n- Period tracking: `current_period_start`, `current_period_end`\n- Selected subject (for Growth plan)\n\n**PayFastPayment:**\n- Records all payment transactions\n- Stores PayFast payment ID, merchant ID, amounts\n- ITN (Instant Transaction Notification) data storage\n\n#### **PayFast Service** (`core/payfast_service.py`)\n\n**Key Functions:**\n\n`generate_signature(data_dict, passphrase)`:\n- Creates MD5 signature for payment validation\n- URL-encodes parameters in alphabetical order\n- Adds passphrase for security\n\n`generate_payment_form_data(user, plan, subscription)`:\n- Creates payment form fields for PayFast\n- Includes: merchant details, user info, amounts, callback URLs\n- Custom fields for tracking: user_id, plan_id, subscription_id\n\n`validate_signature(post_data, passphrase)`:\n- Verifies PayFast webhook signatures\n- Prevents payment tampering\n\n`validate_server_confirmation(post_data)`:\n- Server-to-server verification with PayFast\n- Ensures payment legitimacy\n\n**Security Layers:**\n1. Signature validation (MD5 hash)\n2. Server confirmation (HTTP request to PayFast)\n3. IP validation (PayFast IP whitelist)\n4. Merchant ID verification\n5. Amount verification\n\n#### **Subscription Views:**\n\n`subscription_dashboard`:\n- Display current plan and features\n- Show payment history\n- List upgrade/downgrade options\n- Subject selection for Growth plan\n\n`initiate_subscription`:\n- Create PayFastPayment record\n- Generate payment form with signature\n- Redirect to PayFast payment page\n\n`payfast_notify` (Webhook):\n- Receives PayFast ITN notifications\n- Validates signature and merchant ID\n- Verifies payment with server confirmation\n- Activates subscription on successful payment\n- Updates payment status\n\n`payment_success`:\n- User redirect after successful payment\n- Displays confirmation message\n\n`payment_cancelled`:\n- User redirect after cancelled payment\n\n---\n\n### **6. Subscription Utilities** (`core/subscription_utils.py`)\n\n**Functions:**\n\n`get_user_subscription(user)`:\n- Retrieves or creates user subscription\n- Auto-assigns Free plan to new users\n\n`user_has_feature(user, feature)`:\n- Checks if user's plan includes a feature\n- Features: 'upload_documents', 'use_ai', 'access_library'\n\n`require_subscription_feature(feature)`:\n- Decorator to protect views by feature\n- Redirects to subscription page if access denied\n\n`require_premium`:\n- Shortcut decorator for AI features\n- Requires 'use_ai' feature (Premium plan)\n\n**Usage Example:**\n```python\n@require_premium\ndef generate_assignment_ai(request):\n    # Only Premium users can access this\n    ...\n```\n\n---\n\n### **7. Document Management Module**\n\n#### **Models:**\n\n**UploadedDocument:**\n- Stores both uploaded and AI-generated content\n- Fields:\n  - `uploaded_by`: User who created it\n  - `title`, `subject`, `grade`, `board`\n  - `type`: lesson_plan, homework, past_paper, sample_questions\n  - `file`: Actual file upload (PDF/DOCX)\n  - `ai_content`: JSON field for AI-generated content\n  - `tags`: For categorization\n  - `created_at`: Timestamp\n\n**File Operations:**\n- `delete_document`: Delete document and file\n- `download_document`: Download file with proper MIME type\n- `view_document`: Display document metadata\n- `view_document_inline`: Inline PDF viewer\n\n---\n\n### **8. Account Settings Module**\n\n**View:** `account_settings`\n\n**Features:**\n\n1. **Profile Management:**\n   - Update first name, last name, email\n   - Add institution/school name\n   - Write bio\n   - Email uniqueness validation\n\n2. **Security:**\n   - Change password with current password verification\n   - 8+ character minimum password requirement\n   - Session preservation after password change (using `update_session_auth_hash`)\n\n3. **Email & Notifications:**\n   - Display email verification status\n   - Resend verification email\n   - Toggle email notifications on/off\n\n4. **Usage Statistics:**\n   - Total AI generations count\n   - Documents created count\n   - Assignments created count\n   - Assignments shared count\n\n**Template:** Tabbed interface with Alpine.js\n- Profile & Personal Info tab\n- Security tab\n- Email & Notifications tab\n- Usage Statistics tab\n\n---\n\n## Technology Stack\n\n### **Backend:**\n- **Python 3.10+**\n- **Django 5.0** - Web framework\n- **OpenAI Python SDK 1.108+** - AI integration\n- **PostgreSQL / SQLite** - Database\n- **python-dotenv** - Environment management\n\n### **Frontend:**\n- **Tailwind CSS** - Utility-first CSS framework\n- **Alpine.js** - Lightweight JavaScript framework\n- **Font Awesome** - Icon library\n- **Django Templates** - Server-side rendering\n\n### **Third-Party Services:**\n- **OpenAI GPT-5** - AI content generation\n- **PayFast** - Payment gateway (South African)\n- **Gmail SMTP** - Email service\n\n### **File Handling:**\n- **python-docx** - DOCX file processing\n- **PyPDF2** - PDF file processing\n- **Pillow** - Image processing\n- **ReportLab** - PDF generation\n\n### **Additional Libraries:**\n- **Requests** - HTTP library\n- **Streamlit** - Alternative UI framework\n- **Stripe** - (Alternative payment option)\n\n---\n\n## Setup Instructions\n\n### **1. Download the Project**\nFrom Replit:\n1. Click the three dots menu (‚ãØ) in the top-right\n2. Select \"Download as ZIP\"\n3. Extract the ZIP file to your local machine\n\n### **2. Install Dependencies**\n\n**Using pip (recommended):**\n```bash\npip install -r requirements.txt\n```\n\n**Or using Poetry:**\n```bash\npoetry install\n```\n\n### **3. Environment Variables**\nCreate a `.env` file in the project root:\n\n```env\n# Django Settings\nSECRET_KEY=your-secret-key-here\nDEBUG=True\nALLOWED_HOSTS=localhost,127.0.0.1\n\n# Database (for PostgreSQL)\nDATABASE_URL=postgresql://user:password@localhost:5432/edutech\n\n# OpenAI\nOPENAI_API_KEY=your-openai-api-key\n\n# Email Configuration\nEMAIL_HOST_USER=your-email@gmail.com\nEMAIL_HOST_PASSWORD=your-app-password\n\n# PayFast Configuration\nPAYFAST_MERCHANT_ID=your-merchant-id\nPAYFAST_MERCHANT_KEY=your-merchant-key\nPAYFAST_PASSPHRASE=your-passphrase\nPAYFAST_URL=https://sandbox.payfast.co.za/eng/process\nSITE_URL=http://localhost:8000\n```\n\n### **4. Database Setup**\n\n**Run migrations:**\n```bash\npython manage.py migrate\n```\n\n**Create superuser (admin):**\n```bash\npython manage.py createsuperuser\n```\n\n**Seed subscription plans:**\n```bash\npython manage.py seed_plans\n```\n\nThis creates the 4 default plans:\n- Free (R0)\n- Starter (R50)\n- Growth (R100)\n- Premium (R250)\n\n### **5. Run the Development Server**\n\n**Django:**\n```bash\npython manage.py runserver 0.0.0.0:5000\n```\n\n**Streamlit (alternative):**\n```bash\nstreamlit run app.py\n```\n\n### **6. Access the Application**\n\n- **Web Interface:** http://localhost:5000\n- **Admin Panel:** http://localhost:5000/admin\n- **Streamlit:** http://localhost:8501\n\n---\n\n## Deployment Guide\n\n### **Option 1: Deploy on Replit**\nThe app is already configured for Replit:\n1. Click \"Publish\" in Replit\n2. Configure custom domain (optional)\n3. Environment variables are already set\n\n### **Option 2: Deploy on Railway/Render**\n\n**1. Update settings for production:**\n```python\n# django_project/settings.py\nDEBUG = False\nALLOWED_HOSTS = ['yourdomain.com']\n```\n\n**2. Use PostgreSQL:**\n```bash\npip install psycopg2-binary\n```\n\n**3. Configure static files:**\n```bash\npython manage.py collectstatic\n```\n\n**4. Use Gunicorn:**\n```bash\npip install gunicorn\ngunicorn django_project.wsgi:application --bind 0.0.0.0:8000\n```\n\n### **Option 3: Deploy on Heroku**\n\n**1. Create `Procfile`:**\n```\nweb: gunicorn django_project.wsgi --log-file -\n```\n\n**2. Create `runtime.txt`:**\n```\npython-3.10.12\n```\n\n**3. Push to Heroku:**\n```bash\nheroku create your-app-name\ngit push heroku main\nheroku run python manage.py migrate\nheroku run python manage.py createsuperuser\nheroku run python manage.py seed_plans\n```\n\n### **Production Checklist:**\n- [ ] Set `DEBUG = False`\n- [ ] Configure `ALLOWED_HOSTS`\n- [ ] Use PostgreSQL database\n- [ ] Set secure `SECRET_KEY`\n- [ ] Configure HTTPS\n- [ ] Set up proper email backend\n- [ ] Update PayFast to production credentials\n- [ ] Configure static files serving (WhiteNoise or CDN)\n- [ ] Enable CSRF protection\n- [ ] Set up logging and monitoring\n- [ ] Configure backup strategy\n\n---\n\n## Subscription Tiers\n\n| Feature | Free | Starter | Growth | Premium |\n|---------|------|---------|--------|---------|\n| **Price** | R0 | R50/month | R100/month | R250/month |\n| **Upload Documents** | ‚úÖ | ‚úÖ | ‚úÖ | ‚úÖ |\n| **AI Generation** | ‚ùå | ‚ùå | ‚ùå | ‚úÖ |\n| **Content Library** | ‚ùå | ‚ùå | ‚úÖ (1 subject) | ‚úÖ (All) |\n| **Monthly AI Generations** | 0 | 0 | 0 | Unlimited |\n| **Document Storage** | Limited | Enhanced | Enhanced | Unlimited |\n| **Class Management** | ‚úÖ | ‚úÖ | ‚úÖ | ‚úÖ |\n| **Assignment Sharing** | ‚úÖ | ‚úÖ | ‚úÖ | ‚úÖ |\n\n---\n\n## API Documentation\n\n### **Authentication Endpoints**\n\n| Method | Endpoint | Description | Auth Required |\n|--------|----------|-------------|---------------|\n| GET/POST | `/login/` | User login | No |\n| GET | `/logout/` | User logout | Yes |\n| POST | `/signup/` | User registration | No |\n| GET | `/verify-email/<token>/` | Email verification | No |\n| POST | `/resend-verification/` | Resend verification email | Yes |\n\n### **Content Management Endpoints**\n\n| Method | Endpoint | Description | Auth Required |\n|--------|----------|-------------|---------------|\n| GET/POST | `/` | Dashboard | Yes |\n| GET/POST | `/lesson-plans/` | Lesson plans management | Yes |\n| GET/POST | `/assignments/` | Assignments management | Yes |\n| GET/POST | `/questions/` | Question generator | Yes |\n| GET/POST | `/documents/` | Document library | Yes |\n\n### **AI Generation Endpoints**\n\n| Method | Endpoint | Description | Auth Required | Plan Required |\n|--------|----------|-------------|---------------|---------------|\n| POST | `/generate-assignment/` | Generate AI assignment | Yes | Premium |\n| POST | `/generate-questions/` | Generate AI questions | Yes | Premium |\n\n### **Document Operations**\n\n| Method | Endpoint | Description | Auth Required |\n|--------|----------|-------------|---------------|\n| POST | `/document/<id>/delete/` | Delete document | Yes |\n| GET | `/document/<id>/download/` | Download document | Yes |\n| GET | `/document/<id>/view/` | View document details | Yes |\n| GET | `/document/<id>/inline/` | View document inline | Yes |\n\n### **Class Management Endpoints**\n\n| Method | Endpoint | Description | Auth Required |\n|--------|----------|-------------|---------------|\n| GET | `/classes/` | List classes | Yes |\n| POST | `/classes/create/` | Create class | Yes |\n| POST | `/classes/<id>/edit/` | Edit class | Yes |\n| POST | `/classes/<id>/delete/` | Delete class | Yes |\n\n### **Assignment Sharing Endpoints**\n\n| Method | Endpoint | Description | Auth Required |\n|--------|----------|-------------|---------------|\n| POST | `/assignments/share/create/` | Share assignment | Yes |\n| POST | `/assignments/share/<id>/revoke/` | Revoke share | Yes |\n| GET | `/share/a/<token>/` | View shared assignment | No |\n| GET | `/share/a/<token>/download/` | Download shared assignment | No |\n\n### **Subscription & Payment Endpoints**\n\n| Method | Endpoint | Description | Auth Required |\n|--------|----------|-------------|---------------|\n| GET | `/subscription/dashboard/` | Subscription dashboard | Yes |\n| POST | `/subscription/initiate/<plan_id>/` | Initiate payment | Yes |\n| POST | `/payfast/notify/` | PayFast webhook (ITN) | No |\n| GET | `/payment/success/` | Payment success redirect | Yes |\n| GET | `/payment/cancelled/` | Payment cancelled redirect | Yes |\n\n### **Account Settings**\n\n| Method | Endpoint | Description | Auth Required |\n|--------|----------|-------------|---------------|\n| GET/POST | `/account/settings/` | Account settings | Yes |\n\n---\n\n## Database Schema\n\n### **Core Models**\n\n#### **User & Profile**\n```\nUser (Django built-in)\n‚îú‚îÄ‚îÄ username\n‚îú‚îÄ‚îÄ email\n‚îú‚îÄ‚îÄ password\n‚îî‚îÄ‚îÄ is_active\n\nUserProfile\n‚îú‚îÄ‚îÄ user (FK ‚Üí User)\n‚îú‚îÄ‚îÄ role (teacher/admin)\n‚îú‚îÄ‚îÄ subscription (legacy field)\n‚îú‚îÄ‚îÄ email_verified\n‚îú‚îÄ‚îÄ verification_token\n‚îú‚îÄ‚îÄ bio\n‚îú‚îÄ‚îÄ institution\n‚îî‚îÄ‚îÄ email_notifications\n```\n\n#### **Educational Metadata**\n```\nSubject\n‚îî‚îÄ‚îÄ name\n\nGrade\n‚îî‚îÄ‚îÄ number\n\nExamBoard\n‚îú‚îÄ‚îÄ name_full\n‚îî‚îÄ‚îÄ abbreviation\n```\n\n#### **Content Management**\n```\nUploadedDocument\n‚îú‚îÄ‚îÄ uploaded_by (FK ‚Üí User)\n‚îú‚îÄ‚îÄ title\n‚îú‚îÄ‚îÄ subject (FK ‚Üí Subject)\n‚îú‚îÄ‚îÄ grade (FK ‚Üí Grade)\n‚îú‚îÄ‚îÄ board (FK ‚Üí ExamBoard)\n‚îú‚îÄ‚îÄ type (lesson_plan/homework/past_paper/sample_questions)\n‚îú‚îÄ‚îÄ file (FileField)\n‚îú‚îÄ‚îÄ ai_content (JSONField)\n‚îú‚îÄ‚îÄ created_at\n‚îî‚îÄ‚îÄ tags\n\nGeneratedAssignment\n‚îú‚îÄ‚îÄ teacher (FK ‚Üí User)\n‚îú‚îÄ‚îÄ title\n‚îú‚îÄ‚îÄ subject (FK ‚Üí Subject)\n‚îú‚îÄ‚îÄ grade (FK ‚Üí Grade)\n‚îú‚îÄ‚îÄ board (FK ‚Üí ExamBoard)\n‚îú‚îÄ‚îÄ question_type\n‚îú‚îÄ‚îÄ due_date\n‚îú‚îÄ‚îÄ file_url\n‚îú‚îÄ‚îÄ instructions\n‚îú‚îÄ‚îÄ shared_link (unique token)\n‚îú‚îÄ‚îÄ created_at\n‚îî‚îÄ‚îÄ content (JSONField)\n```\n\n#### **Usage Tracking**\n```\nUsageQuota\n‚îú‚îÄ‚îÄ user (FK ‚Üí User)\n‚îú‚îÄ‚îÄ lesson_plans_used (JSONField)\n‚îî‚îÄ‚îÄ assignments_used (JSONField)\n```\n\n#### **Class Management**\n```\nClassGroup\n‚îú‚îÄ‚îÄ teacher (FK ‚Üí User)\n‚îú‚îÄ‚îÄ name\n‚îú‚îÄ‚îÄ description\n‚îú‚îÄ‚îÄ subject (FK ‚Üí Subject)\n‚îú‚îÄ‚îÄ grade (FK ‚Üí Grade)\n‚îú‚îÄ‚îÄ created_at\n‚îî‚îÄ‚îÄ is_active\n\nAssignmentShare\n‚îú‚îÄ‚îÄ teacher (FK ‚Üí User)\n‚îú‚îÄ‚îÄ class_group (FK ‚Üí ClassGroup)\n‚îú‚îÄ‚îÄ generated_assignment (FK ‚Üí GeneratedAssignment, nullable)\n‚îú‚îÄ‚îÄ uploaded_document (FK ‚Üí UploadedDocument, nullable)\n‚îú‚îÄ‚îÄ token (unique)\n‚îú‚îÄ‚îÄ shared_at\n‚îú‚îÄ‚îÄ due_date\n‚îú‚îÄ‚îÄ expires_at\n‚îú‚îÄ‚îÄ revoked_at\n‚îú‚îÄ‚îÄ view_count\n‚îú‚îÄ‚îÄ last_accessed\n‚îî‚îÄ‚îÄ notes\n```\n\n#### **Subscription & Payments**\n```\nSubscriptionPlan\n‚îú‚îÄ‚îÄ name\n‚îú‚îÄ‚îÄ plan_type (free/starter/growth/premium)\n‚îú‚îÄ‚îÄ price\n‚îú‚îÄ‚îÄ billing_period\n‚îú‚îÄ‚îÄ can_upload_documents\n‚îú‚îÄ‚îÄ can_use_ai\n‚îú‚îÄ‚îÄ can_access_library\n‚îú‚îÄ‚îÄ allowed_subjects_count\n‚îú‚îÄ‚îÄ monthly_ai_generations\n‚îú‚îÄ‚îÄ description\n‚îî‚îÄ‚îÄ is_active\n\nUserSubscription\n‚îú‚îÄ‚îÄ user (FK ‚Üí User)\n‚îú‚îÄ‚îÄ plan (FK ‚Üí SubscriptionPlan)\n‚îú‚îÄ‚îÄ status (active/cancelled/expired/pending)\n‚îú‚îÄ‚îÄ started_at\n‚îú‚îÄ‚îÄ current_period_start\n‚îú‚îÄ‚îÄ current_period_end\n‚îú‚îÄ‚îÄ cancelled_at\n‚îú‚îÄ‚îÄ payfast_token\n‚îî‚îÄ‚îÄ selected_subject (FK ‚Üí Subject)\n\nPayFastPayment\n‚îú‚îÄ‚îÄ user (FK ‚Üí User)\n‚îú‚îÄ‚îÄ subscription (FK ‚Üí UserSubscription)\n‚îú‚îÄ‚îÄ plan (FK ‚Üí SubscriptionPlan)\n‚îú‚îÄ‚îÄ payfast_payment_id (unique)\n‚îú‚îÄ‚îÄ merchant_id\n‚îú‚îÄ‚îÄ amount_gross\n‚îú‚îÄ‚îÄ amount_fee\n‚îú‚îÄ‚îÄ amount_net\n‚îú‚îÄ‚îÄ status\n‚îú‚îÄ‚îÄ payment_status_text\n‚îú‚îÄ‚îÄ itn_data (JSONField)\n‚îú‚îÄ‚îÄ created_at\n‚îî‚îÄ‚îÄ completed_at\n```\n\n---\n\n## Security Features\n\n### **1. Authentication & Authorization**\n- Email verification required for account activation\n- Role-based access control (Teacher/Admin)\n- Secure password hashing (Django's PBKDF2)\n- Session-based authentication\n- CSRF protection on all forms\n\n### **2. Payment Security**\n- PayFast signature validation (MD5 hash)\n- Server-to-server payment confirmation\n- IP whitelisting for webhook endpoints\n- Merchant ID verification\n- Amount verification to prevent tampering\n\n### **3. Data Protection**\n- Teacher can only access their own data\n- Ownership validation on all CUD operations\n- Unique constraints on critical data\n- File upload validation\n- SQL injection protection (Django ORM)\n\n### **4. Content Sharing Security**\n- Unique 32-character tokens for shares\n- Expiry date enforcement\n- Revocation capability\n- View count tracking\n- Teacher ownership validation\n\n---\n\n## Future Enhancements\n\n### **Planned Features:**\n1. **Content Protection:**\n   - Watermarking on AI-generated content\n   - Download limits per user\n   - Usage analytics for suspicious activity\n   - Expiring share links (auto-expire after 30 days)\n\n2. **Collaboration:**\n   - Teacher-to-teacher content sharing\n   - Department/school-wide content libraries\n   - Collaborative lesson planning\n\n3. **Analytics:**\n   - Student performance tracking\n   - Assignment completion rates\n   - Content usage analytics\n   - Teacher engagement metrics\n\n4. **Mobile App:**\n   - React Native mobile application\n   - Offline access to downloaded content\n   - Push notifications\n\n5. **Institutional Plans:**\n   - School/district licensing\n   - Bulk user management\n   - Custom branding\n   - Advanced analytics\n\n---\n\n## Support & Documentation\n\n### **Admin Access:**\n- **Admin Panel:** `/admin/`\n- **Default Admin:** username: `admin`, password: `admin123`\n\n### **Test Accounts:**\n- **Teacher Account:** username: `stancho`, email: `skwembe@gmail.com`\n\n### **Environment:**\n- **Development:** SQLite database\n- **Production:** PostgreSQL (recommended)\n\n### **Key Configuration Files:**\n- `django_project/settings.py` - Django settings\n- `core/urls.py` - URL routing\n- `core/models.py` - Database models\n- `core/views.py` - Business logic\n- `core/openai_service.py` - AI integration\n- `core/payfast_service.py` - Payment processing\n\n### **Logging:**\n- Check Django logs for errors\n- PayFast webhook logs in PayFastPayment model\n- Email verification logs in console\n\n---\n\n## Contributing\n\n### **Development Workflow:**\n1. Fork the repository\n2. Create feature branch: `git checkout -b feature/your-feature`\n3. Make changes and test locally\n4. Run migrations: `python manage.py makemigrations && python manage.py migrate`\n5. Test all features\n6. Commit changes: `git commit -m \"Add your feature\"`\n7. Push to branch: `git push origin feature/your-feature`\n8. Create Pull Request\n\n### **Code Standards:**\n- Follow PEP 8 style guide\n- Use meaningful variable names\n- Add comments for complex logic\n- Write docstrings for functions\n- Keep views focused and clean\n- Use Django best practices\n\n---\n\n## License\n\nThis project is proprietary software. All rights reserved.\n\n---\n\n## Contact & Support\n\nFor questions, issues, or feature requests:\n- **Email:** support@edutech.co.za\n- **Documentation:** See this README\n- **Admin Panel:** `/admin/` for backend management\n\n---\n\n**Built with ‚ù§Ô∏è for teachers by teachers**\n","path":null,"size_bytes":26401,"size_tokens":null},"django_project/core/admin.py":{"content":"from django.contrib import admin\n\n# Register your models here.\n","path":null,"size_bytes":63,"size_tokens":null},"django_project/core/apps.py":{"content":"from django.apps import AppConfig\n\n\nclass CoreConfig(AppConfig):\n    default_auto_field = 'django.db.models.BigAutoField'\n    name = 'core'\n","path":null,"size_bytes":140,"size_tokens":null},"core/management/commands/setup_sample_data.py":{"content":"from django.core.management.base import BaseCommand\nfrom django.contrib.auth.models import User\nfrom core.models import Subject, Grade, ExamBoard, UserProfile, UploadedDocument, GeneratedAssignment, UsageQuota\nfrom datetime import datetime, timedelta\n\n\nclass Command(BaseCommand):\n    help = 'Create sample data for development'\n\n    def handle(self, *args, **options):\n        self.stdout.write('Creating sample data...')\n\n        # Create subjects\n        subjects_data = ['Mathematics', 'English', 'Science', 'History', 'Geography', 'Physics', 'Chemistry', 'Biology']\n        subjects = []\n        for subject_name in subjects_data:\n            subject, created = Subject.objects.get_or_create(name=subject_name)\n            subjects.append(subject)\n            if created:\n                self.stdout.write(f'Created subject: {subject_name}')\n\n        # Create grades\n        grades = []\n        for i in range(1, 13):  # Grades 1-12\n            grade, created = Grade.objects.get_or_create(number=i)\n            grades.append(grade)\n            if created:\n                self.stdout.write(f'Created grade: {i}')\n\n        # Create exam boards\n        exam_boards_data = [\n            ('Cambridge International', 'CIE'),\n            ('Edexcel', 'EDX'),\n            ('AQA', 'AQA'),\n            ('OCR', 'OCR'),\n        ]\n        exam_boards = []\n        for full_name, abbrev in exam_boards_data:\n            board, created = ExamBoard.objects.get_or_create(\n                name_full=full_name,\n                abbreviation=abbrev\n            )\n            exam_boards.append(board)\n            if created:\n                self.stdout.write(f'Created exam board: {full_name}')\n\n        # Create admin superuser\n        admin_user, created = User.objects.get_or_create(\n            username='admin',\n            defaults={\n                'email': 'admin@edutech.com',\n                'first_name': 'Admin',\n                'last_name': 'User',\n                'is_staff': True,\n                'is_superuser': True\n            }\n        )\n        if created:\n            admin_user.set_password('admin123')\n            admin_user.save()\n            self.stdout.write('Created admin user: admin (password: admin123)')\n        else:\n            admin_user.set_password('admin123')\n            admin_user.is_staff = True\n            admin_user.is_superuser = True\n            admin_user.save()\n            self.stdout.write('Updated admin user password to: admin123')\n\n        # Create admin profile\n        admin_profile, created = UserProfile.objects.get_or_create(\n            user=admin_user,\n            defaults={\n                'role': 'admin',\n                'subscription': 'premium'\n            }\n        )\n\n        # Create demo user\n        demo_user, created = User.objects.get_or_create(\n            username='demo_teacher',\n            defaults={\n                'email': 'demo@edutech.com',\n                'first_name': 'Demo',\n                'last_name': 'Teacher'\n            }\n        )\n        if created:\n            demo_user.set_password('demo123')\n            demo_user.save()\n            self.stdout.write('Created demo user: demo_teacher (password: demo123)')\n\n        # Create user profile\n        profile, created = UserProfile.objects.get_or_create(\n            user=demo_user,\n            defaults={\n                'role': 'teacher',\n                'subscription': 'free'\n            }\n        )\n\n        # Create usage quota\n        quota, created = UsageQuota.objects.get_or_create(\n            user=demo_user,\n            defaults={\n                'lesson_plans_used': {},\n                'assignments_used': {}\n            }\n        )\n\n        # Create sample uploaded documents\n        sample_docs = [\n            {\n                'title': 'Introduction to Algebra',\n                'subject': subjects[0],  # Mathematics\n                'grade': grades[7],      # Grade 8\n                'board': exam_boards[0], # Cambridge\n                'type': 'lesson_plan',\n                'file_url': 'https://example.com/algebra-intro.pdf',\n                'tags': 'algebra, introduction, basics'\n            },\n            {\n                'title': 'Quadratic Equations Practice',\n                'subject': subjects[0],  # Mathematics\n                'grade': grades[8],      # Grade 9\n                'board': exam_boards[0], # Cambridge\n                'type': 'homework',\n                'file_url': 'https://example.com/quadratic-practice.pdf',\n                'tags': 'quadratic, practice, equations'\n            },\n            {\n                'title': 'Shakespeare Analysis',\n                'subject': subjects[1],  # English\n                'grade': grades[9],      # Grade 10\n                'board': exam_boards[1], # Edexcel\n                'type': 'lesson_plan',\n                'file_url': 'https://example.com/shakespeare.pdf',\n                'tags': 'literature, shakespeare, analysis'\n            }\n        ]\n\n        for doc_data in sample_docs:\n            doc, created = UploadedDocument.objects.get_or_create(\n                title=doc_data['title'],\n                uploaded_by=demo_user,\n                defaults=doc_data\n            )\n            if created:\n                self.stdout.write(f'Created document: {doc_data[\"title\"]}')\n\n        # Create sample generated assignments\n        sample_assignments = [\n            {\n                'title': 'Algebra Problem Set 1',\n                'subject': subjects[0],  # Mathematics\n                'grade': grades[7],      # Grade 8\n                'board': exam_boards[0], # Cambridge\n                'question_type': 'Structured',\n                'due_date': datetime.now() + timedelta(days=7),\n                'shared_link': f'https://edutech.com/assignment/algebra-set-1-{demo_user.id}',\n                'content': {\n                    'questions': [\n                        {\n                            'question': 'Solve for x: 2x + 5 = 15',\n                            'answer': 'x = 5',\n                            'difficulty': 'easy'\n                        }\n                    ]\n                }\n            },\n            {\n                'title': 'Chemistry Lab Report Guidelines',\n                'subject': subjects[6],  # Chemistry\n                'grade': grades[10],     # Grade 11\n                'board': exam_boards[0], # Cambridge\n                'question_type': 'Free Response',\n                'due_date': datetime.now() + timedelta(days=14),\n                'shared_link': f'https://edutech.com/assignment/chem-lab-{demo_user.id}',\n                'content': {\n                    'questions': [\n                        {\n                            'question': 'Describe the proper procedure for conducting a titration experiment',\n                            'answer': 'Include safety measures, equipment setup, and step-by-step procedure',\n                            'difficulty': 'medium'\n                        }\n                    ]\n                }\n            }\n        ]\n\n        for assignment_data in sample_assignments:\n            assignment, created = GeneratedAssignment.objects.get_or_create(\n                title=assignment_data['title'],\n                teacher=demo_user,\n                defaults=assignment_data\n            )\n            if created:\n                self.stdout.write(f'Created assignment: {assignment_data[\"title\"]}')\n\n        self.stdout.write(self.style.SUCCESS('Sample data created successfully!'))\n        self.stdout.write('You can now log in with:')\n        self.stdout.write('Username: demo_teacher')\n        self.stdout.write('Password: demo123')","path":null,"size_bytes":7644,"size_tokens":null},"core/models.py":{"content":"from django.db import models\nfrom django.contrib.auth.models import User\nimport secrets\nimport string\n\nclass Subject(models.Model):\n    name = models.CharField(max_length=100)\n    \n    def __str__(self):\n        return str(self.name)\n\nclass Grade(models.Model):\n    number = models.IntegerField()\n    \n    def __str__(self):\n        return f\"Grade {self.number}\"\n\nclass ExamBoard(models.Model):\n    name_full = models.CharField(max_length=200)  # e.g., \"Cambridge International\"\n    abbreviation = models.CharField(max_length=10)  # e.g., \"CIE\"\n    region = models.CharField(max_length=100, default='')  # e.g., \"South Africa\", \"Zimbabwe\"\n    \n    def __str__(self):\n        return f\"{self.abbreviation} ({self.region})\" if self.region else self.abbreviation\n\nclass UserProfile(models.Model):\n    ROLE_CHOICES = [\n        ('teacher', 'Teacher'),\n        ('content_manager', 'Content Manager'),\n        ('admin', 'Admin'),\n    ]\n    \n    SUBSCRIPTION_CHOICES = [\n        ('free', 'Free'),\n        ('starter', 'Starter'),\n        ('growth', 'Growth'),\n        ('premium', 'Premium'),\n    ]\n    \n    user = models.OneToOneField(User, on_delete=models.CASCADE)\n    role = models.CharField(max_length=20, choices=ROLE_CHOICES, default='teacher')\n    subscription = models.CharField(max_length=20, choices=SUBSCRIPTION_CHOICES, default='free')\n    email_verified = models.BooleanField(default=False)\n    verification_token = models.CharField(max_length=100, blank=True)\n    verification_token_created = models.DateTimeField(null=True, blank=True)\n    bio = models.TextField(blank=True)\n    institution = models.CharField(max_length=200, blank=True)\n    email_notifications = models.BooleanField(default=True)\n    teacher_code = models.CharField(max_length=10, unique=True, null=True, blank=True)  # Unique code for Google Forms\n    \n    def __str__(self):\n        return f\"{self.user.username} ({self.role})\" if self.user else f\"Profile ({self.role})\"\n    \n    def get_subject_limit(self):\n        \"\"\"Returns the number of subjects allowed based on subscription tier\"\"\"\n        limits = {\n            'free': 1,\n            'starter': 1,\n            'growth': 2,\n            'premium': 3,\n        }\n        return limits.get(self.subscription, 1)\n    \n    def get_lesson_plan_limit_per_subject(self):\n        \"\"\"Returns monthly lesson plan limit per subject based on tier\"\"\"\n        limits = {\n            'free': 2,\n            'starter': 10,\n            'growth': 20,\n            'premium': 0,  # 0 means unlimited\n        }\n        return limits.get(self.subscription, 2)\n    \n    def can_use_ai(self):\n        \"\"\"Check if user can use AI features\"\"\"\n        return self.subscription in ['growth', 'premium']\n    \n    def get_ai_model(self):\n        \"\"\"Returns AI model to use based on tier\"\"\"\n        if self.subscription == 'growth':\n            return 'gpt-3.5-turbo'  # Basic AI\n        elif self.subscription == 'premium':\n            return 'gpt-4'  # Advanced AI\n        return None\n\nclass PasswordResetToken(models.Model):\n    user = models.ForeignKey(User, on_delete=models.CASCADE)\n    token = models.CharField(max_length=100, unique=True)\n    created_at = models.DateTimeField(auto_now_add=True)\n    expires_at = models.DateTimeField()\n    used = models.BooleanField(default=False)\n    \n    def __str__(self):\n        return f\"Password reset for {self.user.username}\"\n    \n    def is_valid(self):\n        from django.utils import timezone\n        return not self.used and timezone.now() < self.expires_at\n\nclass UploadedDocument(models.Model):\n    DOC_TYPES = [\n        ('lesson_plan', 'Lesson Plan'),\n        ('classwork', 'Classwork'),\n        ('homework', 'Homework'),\n        ('assignment', 'Assignment'),\n        ('test', 'Test'),\n        ('exam', 'Exam'),\n        ('general', 'General Document'),\n    ]\n    \n    uploaded_by = models.ForeignKey(User, on_delete=models.CASCADE)\n    title = models.CharField(max_length=200)\n    subject = models.ForeignKey(Subject, on_delete=models.CASCADE)\n    grade = models.ForeignKey(Grade, on_delete=models.CASCADE)\n    board = models.ForeignKey(ExamBoard, on_delete=models.CASCADE)\n    type = models.CharField(max_length=20, choices=DOC_TYPES, default='general')\n    file_url = models.URLField(blank=True)\n    file = models.FileField(upload_to='documents/%Y/%m/', null=True, blank=True)\n    ai_content = models.JSONField(null=True, blank=True)  # Store AI-generated content\n    created_at = models.DateTimeField(auto_now_add=True)\n    tags = models.TextField(blank=True)\n    \n    class Meta:\n        ordering = ['-created_at']  # Sort by upload date, newest first\n    \n    def __str__(self):\n        return f\"{self.title} - {self.subject} Grade {self.grade}\"\n\nclass GeneratedAssignment(models.Model):\n    QUESTION_TYPES = [\n        ('MCQ', 'Multiple Choice'),\n        ('Structured', 'Structured/Short Answer'),\n        ('Free Response', 'Free Response/Essay'),\n        ('Cambridge-style', 'Cambridge-style Structured'),\n    ]\n    \n    teacher = models.ForeignKey(User, on_delete=models.CASCADE)\n    title = models.CharField(max_length=200)\n    subject = models.ForeignKey(Subject, on_delete=models.CASCADE)\n    grade = models.ForeignKey(Grade, on_delete=models.CASCADE)\n    board = models.ForeignKey(ExamBoard, on_delete=models.CASCADE)\n    question_type = models.CharField(max_length=20, choices=QUESTION_TYPES)\n    due_date = models.DateTimeField()\n    file_url = models.URLField(blank=True)\n    instructions = models.TextField(blank=True)\n    shared_link = models.CharField(max_length=500, unique=True)\n    created_at = models.DateTimeField(auto_now_add=True)\n    content = models.JSONField()  # Store the generated questions\n    \n    def __str__(self):\n        return f\"{self.title} - {self.subject} Grade {self.grade}\"\n\nclass SubscribedSubject(models.Model):\n    \"\"\"Tracks which subjects a user has subscribed to\"\"\"\n    user = models.ForeignKey(User, on_delete=models.CASCADE, related_name='subscribed_subjects')\n    subject = models.ForeignKey(Subject, on_delete=models.CASCADE)\n    subscribed_at = models.DateTimeField(auto_now_add=True)\n    \n    class Meta:\n        unique_together = ['user', 'subject']\n        ordering = ['subscribed_at']\n    \n    def __str__(self):\n        return f\"{self.user.username} - {self.subject.name}\"\n\nclass UsageQuota(models.Model):\n    user = models.OneToOneField(User, on_delete=models.CASCADE)\n    lesson_plans_used = models.JSONField(default=dict)  # {\"subject_id\": count}\n    assignments_used = models.JSONField(default=dict)  # {\"subject_id\": count}\n    last_reset = models.DateTimeField(auto_now_add=True, null=True, blank=True)  # Track when quotas were last reset\n    \n    def __str__(self):\n        return f\"Quota for {self.user.username}\" if self.user else \"Quota\"\n    \n    def get_lesson_plans_used(self, subject_id):\n        \"\"\"Get lesson plans used for a specific subject\"\"\"\n        return self.lesson_plans_used.get(str(subject_id), 0)\n    \n    def increment_lesson_plans(self, subject_id):\n        \"\"\"Increment lesson plan count for a subject\"\"\"\n        subject_key = str(subject_id)\n        current = self.lesson_plans_used.get(subject_key, 0)\n        self.lesson_plans_used[subject_key] = current + 1\n        self.save()\n    \n    def reset_monthly_quotas(self):\n        \"\"\"Reset quotas at the start of each month\"\"\"\n        self.lesson_plans_used = {}\n        self.assignments_used = {}\n        from django.utils import timezone\n        self.last_reset = timezone.now()\n        self.save()\n\ndef generate_share_token():\n    \"\"\"Generate a secure random token for sharing\"\"\"\n    return ''.join(secrets.choice(string.ascii_letters + string.digits) for _ in range(32))\n\nclass ClassGroup(models.Model):\n    \"\"\"Represents a class/group of students for assignment distribution\"\"\"\n    teacher = models.ForeignKey(User, on_delete=models.CASCADE)\n    name = models.CharField(max_length=100)  # e.g., \"Grade 7A\", \"Advanced Math\"\n    description = models.TextField(blank=True)\n    subject = models.ForeignKey(Subject, on_delete=models.SET_NULL, null=True, blank=True)\n    grade = models.ForeignKey(Grade, on_delete=models.SET_NULL, null=True, blank=True)\n    created_at = models.DateTimeField(auto_now_add=True)\n    is_active = models.BooleanField(default=True)\n    \n    class Meta:\n        unique_together = ['teacher', 'name']  # Teacher can't have duplicate class names\n    \n    def __str__(self):\n        return f\"{self.name} ({self.teacher.username})\"\n\nclass AssignmentShare(models.Model):\n    \"\"\"Tracks when assignments are shared with classes\"\"\"\n    teacher = models.ForeignKey(User, on_delete=models.CASCADE)\n    class_group = models.ForeignKey(ClassGroup, on_delete=models.CASCADE)\n    \n    # Either generated assignment OR uploaded document (not both)\n    generated_assignment = models.ForeignKey(GeneratedAssignment, on_delete=models.CASCADE, null=True, blank=True)\n    uploaded_document = models.ForeignKey(UploadedDocument, on_delete=models.CASCADE, null=True, blank=True)\n    \n    # Sharing details\n    token = models.CharField(max_length=32, unique=True, default=generate_share_token)\n    shared_at = models.DateTimeField(auto_now_add=True)\n    due_date = models.DateTimeField(null=True, blank=True)\n    expires_at = models.DateTimeField(null=True, blank=True)\n    revoked_at = models.DateTimeField(null=True, blank=True)\n    \n    # Analytics\n    view_count = models.IntegerField(default=0)\n    last_accessed = models.DateTimeField(null=True, blank=True)\n    \n    # Optional teacher notes\n    notes = models.TextField(blank=True)\n    \n    class Meta:\n        # Ensure exactly one assignment type is set\n        constraints = [\n            models.CheckConstraint(\n                check=(\n                    models.Q(generated_assignment__isnull=False, uploaded_document__isnull=True) |\n                    models.Q(generated_assignment__isnull=True, uploaded_document__isnull=False)\n                ),\n                name='exactly_one_assignment_type'\n            ),\n            # Prevent duplicate shares of the same generated assignment to the same class\n            models.UniqueConstraint(\n                fields=['class_group', 'generated_assignment'],\n                condition=models.Q(generated_assignment__isnull=False, revoked_at__isnull=True),\n                name='unique_active_generated_share'\n            ),\n            # Prevent duplicate shares of the same uploaded document to the same class\n            models.UniqueConstraint(\n                fields=['class_group', 'uploaded_document'],\n                condition=models.Q(uploaded_document__isnull=False, revoked_at__isnull=True),\n                name='unique_active_uploaded_share'\n            )\n        ]\n    \n    def clean(self):\n        \"\"\"Validate ownership and data integrity\"\"\"\n        from django.core.exceptions import ValidationError\n        \n        # Ensure teacher owns the class group\n        if self.class_group and self.teacher != self.class_group.teacher:\n            raise ValidationError(\"Teacher must own the class group being shared to.\")\n        \n        # Ensure teacher owns the assignment being shared\n        if self.generated_assignment and self.teacher != self.generated_assignment.teacher:\n            raise ValidationError(\"Teacher must own the generated assignment being shared.\")\n        \n        if self.uploaded_document and self.teacher != self.uploaded_document.uploaded_by:\n            raise ValidationError(\"Teacher must own the uploaded document being shared.\")\n    \n    def save(self, *args, **kwargs):\n        \"\"\"Override save to always run validation\"\"\"\n        self.full_clean()\n        super().save(*args, **kwargs)\n    \n    def __str__(self):\n        assignment_title = self.generated_assignment.title if self.generated_assignment else self.uploaded_document.title\n        return f\"{assignment_title} shared with {self.class_group.name}\"\n    \n    @property\n    def assignment_title(self):\n        \"\"\"Get the title of the shared assignment regardless of type\"\"\"\n        return self.generated_assignment.title if self.generated_assignment else self.uploaded_document.title\n    \n    @property\n    def assignment_subject(self):\n        \"\"\"Get the subject of the shared assignment\"\"\"\n        return self.generated_assignment.subject if self.generated_assignment else self.uploaded_document.subject\n    \n    @property\n    def assignment_grade(self):\n        \"\"\"Get the grade of the shared assignment\"\"\"\n        return self.generated_assignment.grade if self.generated_assignment else self.uploaded_document.grade\n    \n    @property\n    def is_active(self):\n        \"\"\"Check if the share is currently active (not revoked or expired)\"\"\"\n        from django.utils import timezone\n        now = timezone.now()\n        \n        if self.revoked_at:\n            return False\n        if self.expires_at and self.expires_at < now:\n            return False\n        return True\n    \n    @property\n    def assignment_type(self):\n        \"\"\"Get the type of assignment being shared\"\"\"\n        return 'Generated' if self.generated_assignment else 'Uploaded'\n\nclass PastPaper(models.Model):\n    \"\"\"Past examination papers uploaded by admin\"\"\"\n    EXAM_BOARD_CHOICES = [\n        ('Cambridge', 'Cambridge International'),\n        ('Edexcel', 'Edexcel'),\n        ('GED', 'GED'),\n        ('CAPS', 'CAPS (South Africa)'),\n        ('IEB', 'IEB (South Africa)'),\n        ('ZIMSEC', 'ZIMSEC (Zimbabwe)'),\n        ('NSSC', 'Namibia Senior Secondary Certificate'),\n        ('ZEC', 'Zambia Examinations Council'),\n        ('other', 'Other (Specify in notes)'),\n    ]\n    \n    PAPER_TYPE_CHOICES = [\n        ('paper1', 'Paper 1'),\n        ('paper2', 'Paper 2'),\n        ('paper3', 'Paper 3'),\n        ('practical', 'Practical'),\n        ('coursework', 'Coursework'),\n    ]\n    \n    title = models.CharField(max_length=200)\n    exam_board = models.CharField(max_length=50, choices=EXAM_BOARD_CHOICES)\n    exam_board_custom = models.CharField(max_length=100, blank=True)  # For manual entry\n    grade = models.ForeignKey(Grade, on_delete=models.CASCADE)\n    subject = models.ForeignKey(Subject, on_delete=models.CASCADE)\n    paper_type = models.CharField(max_length=20, choices=PAPER_TYPE_CHOICES)\n    paper_code = models.CharField(max_length=50)  # Unique code from exam board\n    year = models.IntegerField()\n    chapter = models.CharField(max_length=100, blank=True)  # e.g., \"Cells\"\n    section = models.CharField(max_length=100, blank=True)  # e.g., \"Section A\"\n    file = models.FileField(upload_to='past_papers/%Y/%m/')\n    notes = models.TextField(blank=True)\n    uploaded_by = models.ForeignKey(User, on_delete=models.SET_NULL, null=True)\n    uploaded_at = models.DateTimeField(auto_now_add=True)\n    \n    class Meta:\n        unique_together = ['exam_board', 'paper_code', 'year']\n        ordering = ['-year', 'subject', 'grade']\n    \n    def __str__(self):\n        board = self.exam_board_custom if self.exam_board == 'other' else self.exam_board\n        return f\"{board} {self.subject.name} Grade {self.grade.number} - {self.paper_code} ({self.year})\"\n\nclass Quiz(models.Model):\n    \"\"\"Quizzes created from past papers or topics\"\"\"\n    title = models.CharField(max_length=200)\n    subject = models.ForeignKey(Subject, on_delete=models.CASCADE)\n    grade = models.ForeignKey(Grade, on_delete=models.CASCADE)\n    exam_board = models.CharField(max_length=50, choices=PastPaper.EXAM_BOARD_CHOICES)\n    topic = models.CharField(max_length=200)\n    chapter = models.CharField(max_length=100, blank=True)\n    section = models.CharField(max_length=100, blank=True)\n    \n    # Quiz metadata\n    google_form_link = models.URLField()\n    is_premium = models.BooleanField(default=False)  # Free or premium quiz\n    is_ai_generated = models.BooleanField(default=False)\n    difficulty_level = models.CharField(max_length=20, choices=[\n        ('easy', 'Easy'),\n        ('medium', 'Medium'),\n        ('hard', 'Hard'),\n    ], default='medium')\n    \n    # Link to source past paper if generated from one\n    created_from_paper = models.ForeignKey(PastPaper, on_delete=models.SET_NULL, null=True, blank=True)\n    \n    # Analytics\n    times_used = models.IntegerField(default=0)\n    \n    created_by = models.ForeignKey(User, on_delete=models.SET_NULL, null=True)\n    created_at = models.DateTimeField(auto_now_add=True)\n    updated_at = models.DateTimeField(auto_now=True)\n    is_active = models.BooleanField(default=True)\n    \n    class Meta:\n        ordering = ['-created_at']\n        verbose_name_plural = 'Quizzes'\n    \n    def __str__(self):\n        return f\"{self.title} - {self.subject.name} Grade {self.grade.number}\"\n\nclass QuizResponse(models.Model):\n    \"\"\"Student responses to quizzes (fetched from Google Forms)\"\"\"\n    quiz = models.ForeignKey(Quiz, on_delete=models.CASCADE, related_name='responses')\n    teacher_code = models.CharField(max_length=10)  # Teacher's unique code\n    student_name = models.CharField(max_length=200)\n    answers_json = models.JSONField()  # Store all answers from Google Form\n    score = models.DecimalField(max_digits=5, decimal_places=2, null=True, blank=True)\n    submitted_at = models.DateTimeField()\n    \n    # Link to teacher for quick filtering\n    teacher = models.ForeignKey(User, on_delete=models.CASCADE, related_name='quiz_responses', null=True)\n    \n    class Meta:\n        ordering = ['-submitted_at']\n    \n    def __str__(self):\n        return f\"{self.student_name} - {self.quiz.title} ({self.score}%)\"\n\nclass FormattedPaper(models.Model):\n    \"\"\"AI-reformatted exam papers with extracted questions and memos\"\"\"\n    QUESTION_TYPE_CHOICES = [\n        ('mcq', 'Multiple Choice'),\n        ('structured', 'Structured'),\n        ('free_response', 'Free Response'),\n        ('mixed', 'Mixed'),\n    ]\n    \n    # Link to original past paper\n    source_paper = models.ForeignKey(PastPaper, on_delete=models.CASCADE, related_name='formatted_versions')\n    \n    # Metadata (inherited from source paper for quick filtering)\n    title = models.CharField(max_length=300)\n    subject = models.ForeignKey(Subject, on_delete=models.CASCADE)\n    grade = models.ForeignKey(Grade, on_delete=models.CASCADE)\n    exam_board = models.CharField(max_length=50, choices=PastPaper.EXAM_BOARD_CHOICES)\n    year = models.IntegerField()\n    \n    # Formatted content\n    questions_json = models.JSONField()\n    memo_json = models.JSONField()\n    question_type = models.CharField(max_length=20, choices=QUESTION_TYPE_CHOICES, default='mixed')\n    total_questions = models.IntegerField(default=0)\n    total_marks = models.IntegerField(default=0)\n    \n    # Image storage - directory path where extracted images are stored\n    images_directory = models.CharField(max_length=500, blank=True)\n    has_extracted_images = models.BooleanField(default=False)\n    \n    # AI processing metadata\n    is_ai_generated = models.BooleanField(default=True)\n    ai_model_used = models.CharField(max_length=50, blank=True)\n    processing_status = models.CharField(max_length=20, choices=[\n        ('pending', 'Pending'),\n        ('processing', 'Processing'),\n        ('completed', 'Completed'),\n        ('failed', 'Failed'),\n    ], default='pending')\n    error_message = models.TextField(blank=True)\n    \n    # Tracking\n    created_by = models.ForeignKey(User, on_delete=models.SET_NULL, null=True)\n    created_at = models.DateTimeField(auto_now_add=True)\n    updated_at = models.DateTimeField(auto_now=True)\n    reviewed = models.BooleanField(default=False)\n    is_published = models.BooleanField(default=False)\n    \n    class Meta:\n        ordering = ['-created_at']\n        indexes = [\n            models.Index(fields=['subject', 'grade', 'exam_board']),\n            models.Index(fields=['processing_status']),\n            models.Index(fields=['is_published']),\n        ]\n    \n    def __str__(self):\n        return f\"Formatted: {self.title}\"\n    \n    @property\n    def has_images(self):\n        \"\"\"Check if any questions contain image references\"\"\"\n        if not self.questions_json:\n            return False\n        for q in self.questions_json.get('questions', []):\n            if q.get('image_path') or any(opt.get('image_path') for opt in q.get('options', [])):\n                return True\n        return False\n\nclass SubscriptionPlan(models.Model):\n    \"\"\"Defines available subscription tiers and their features\"\"\"\n    PLAN_TYPES = [\n        ('free', 'Free'),\n        ('starter', 'Starter'),\n        ('growth', 'Growth'),\n        ('premium', 'Premium'),\n    ]\n    \n    name = models.CharField(max_length=50, unique=True)\n    plan_type = models.CharField(max_length=20, choices=PLAN_TYPES, unique=True)\n    price = models.DecimalField(max_digits=10, decimal_places=2)\n    billing_period = models.CharField(max_length=20, default='monthly')\n    \n    # Feature flags\n    can_upload_documents = models.BooleanField(default=True)\n    can_use_ai = models.BooleanField(default=False)\n    can_access_library = models.BooleanField(default=False)\n    allowed_subjects_count = models.IntegerField(default=0)  # 0 = unlimited\n    \n    # Quotas\n    monthly_ai_generations = models.IntegerField(default=0)  # 0 = unlimited for premium\n    \n    description = models.TextField(blank=True)\n    is_active = models.BooleanField(default=True)\n    created_at = models.DateTimeField(auto_now_add=True)\n    \n    class Meta:\n        ordering = ['price']\n    \n    def __str__(self):\n        return f\"{self.name} - R{self.price}/{self.billing_period}\"\n\nclass UserSubscription(models.Model):\n    \"\"\"Tracks user subscriptions and payment status\"\"\"\n    STATUS_CHOICES = [\n        ('active', 'Active'),\n        ('cancelled', 'Cancelled'),\n        ('expired', 'Expired'),\n        ('pending', 'Pending Payment'),\n    ]\n    \n    user = models.OneToOneField(User, on_delete=models.CASCADE, related_name='subscription_record')\n    plan = models.ForeignKey(SubscriptionPlan, on_delete=models.PROTECT)\n    status = models.CharField(max_length=20, choices=STATUS_CHOICES, default='pending')\n    \n    # Subscription dates\n    started_at = models.DateTimeField(auto_now_add=True)\n    current_period_start = models.DateTimeField()\n    current_period_end = models.DateTimeField()\n    cancelled_at = models.DateTimeField(null=True, blank=True)\n    \n    # PayFast subscription token (for recurring payments)\n    payfast_token = models.CharField(max_length=100, blank=True)\n    \n    created_at = models.DateTimeField(auto_now_add=True)\n    updated_at = models.DateTimeField(auto_now=True)\n    \n    def __str__(self):\n        return f\"{self.user.username} - {self.plan.name} ({self.status})\"\n    \n    @property\n    def is_active(self):\n        \"\"\"Check if subscription is currently active\"\"\"\n        from django.utils import timezone\n        return self.status == 'active' and self.current_period_end > timezone.now()\n\nclass PayFastPayment(models.Model):\n    \"\"\"Records all PayFast payment transactions\"\"\"\n    PAYMENT_STATUS = [\n        ('pending', 'Pending'),\n        ('complete', 'Complete'),\n        ('failed', 'Failed'),\n        ('cancelled', 'Cancelled'),\n    ]\n    \n    user = models.ForeignKey(User, on_delete=models.CASCADE)\n    subscription = models.ForeignKey(UserSubscription, on_delete=models.SET_NULL, null=True, blank=True)\n    plan = models.ForeignKey(SubscriptionPlan, on_delete=models.PROTECT)\n    \n    # PayFast transaction details\n    payfast_payment_id = models.CharField(max_length=100, unique=True)\n    merchant_id = models.CharField(max_length=100)\n    amount_gross = models.DecimalField(max_digits=10, decimal_places=2)\n    amount_fee = models.DecimalField(max_digits=10, decimal_places=2, default=0)\n    amount_net = models.DecimalField(max_digits=10, decimal_places=2)\n    \n    status = models.CharField(max_length=20, choices=PAYMENT_STATUS, default='pending')\n    payment_status_text = models.CharField(max_length=50, blank=True)\n    \n    # ITN data\n    itn_data = models.JSONField(null=True, blank=True)  # Store raw ITN notification\n    \n    created_at = models.DateTimeField(auto_now_add=True)\n    completed_at = models.DateTimeField(null=True, blank=True)\n    \n    class Meta:\n        ordering = ['-created_at']\n    \n    def __str__(self):\n        return f\"Payment {self.payfast_payment_id} - {self.user.username} - R{self.amount_gross}\"\n\nclass Announcement(models.Model):\n    \"\"\"Platform announcements and notifications\"\"\"\n    TARGET_CHOICES = [\n        ('all', 'All Users'),\n        ('teachers', 'Teachers Only'),\n        ('content_managers', 'Content Managers Only'),\n        ('admins', 'Admins Only'),\n    ]\n    \n    PRIORITY_CHOICES = [\n        ('info', 'Info'),\n        ('warning', 'Warning'),\n        ('critical', 'Critical'),\n    ]\n    \n    DISPLAY_CHOICES = [\n        ('banner', 'Banner'),\n        ('modal', 'Modal'),\n    ]\n    \n    title = models.CharField(max_length=200)\n    message = models.TextField()\n    target_audience = models.CharField(max_length=20, choices=TARGET_CHOICES, default='all')\n    priority = models.CharField(max_length=10, choices=PRIORITY_CHOICES, default='info')\n    display_type = models.CharField(max_length=10, choices=DISPLAY_CHOICES, default='banner')\n    \n    # Scheduling\n    is_active = models.BooleanField(default=True)\n    starts_at = models.DateTimeField(null=True, blank=True)\n    expires_at = models.DateTimeField(null=True, blank=True)\n    \n    # Tracking\n    created_by = models.ForeignKey(User, on_delete=models.SET_NULL, null=True)\n    created_at = models.DateTimeField(auto_now_add=True)\n    updated_at = models.DateTimeField(auto_now=True)\n    \n    # Track which users have dismissed this announcement\n    dismissed_by = models.ManyToManyField(User, related_name='dismissed_announcements', blank=True)\n    \n    class Meta:\n        ordering = ['-created_at']\n    \n    def __str__(self):\n        return f\"{self.title} ({self.target_audience})\"\n    \n    def is_visible_to(self, user):\n        \"\"\"Check if announcement should be shown to this user\"\"\"\n        from django.utils import timezone\n        \n        # Check if active and not expired\n        if not self.is_active:\n            return False\n        if self.expires_at and self.expires_at < timezone.now():\n            return False\n        \n        # Check if user has dismissed it\n        if user in self.dismissed_by.all():\n            return False\n        \n        # Check target audience\n        if self.target_audience == 'all':\n            return True\n        elif self.target_audience == 'teachers':\n            return not user.is_staff\n        elif self.target_audience == 'content_managers':\n            return user.groups.filter(name='content_manager').exists()\n        elif self.target_audience == 'admins':\n            return user.is_staff\n        \n        return False\n\nclass EmailBlast(models.Model):\n    \"\"\"Email campaigns and bulk communications\"\"\"\n    TARGET_CHOICES = [\n        ('all', 'All Users'),\n        ('teachers', 'Teachers Only'),\n        ('content_managers', 'Content Managers Only'),\n    ]\n    \n    STATUS_CHOICES = [\n        ('draft', 'Draft'),\n        ('sending', 'Sending'),\n        ('sent', 'Sent'),\n        ('failed', 'Failed'),\n    ]\n    \n    subject = models.CharField(max_length=200)\n    message = models.TextField()\n    target_audience = models.CharField(max_length=20, choices=TARGET_CHOICES, default='all')\n    \n    # Tracking\n    status = models.CharField(max_length=10, choices=STATUS_CHOICES, default='draft')\n    recipient_count = models.IntegerField(default=0)\n    sent_count = models.IntegerField(default=0)\n    failed_count = models.IntegerField(default=0)\n    \n    created_by = models.ForeignKey(User, on_delete=models.SET_NULL, null=True)\n    created_at = models.DateTimeField(auto_now_add=True)\n    sent_at = models.DateTimeField(null=True, blank=True)\n    \n    class Meta:\n        ordering = ['-created_at']\n    \n    def __str__(self):\n        return f\"{self.subject} - {self.target_audience} ({self.status})\"\n\n\nclass StudentProfile(models.Model):\n    \"\"\"Student user profile - independent from teacher system\"\"\"\n    SUBSCRIPTION_CHOICES = [\n        ('free', 'Free'),\n        ('pro', 'Pro - R100/month'),\n    ]\n    \n    user = models.OneToOneField(User, on_delete=models.CASCADE, related_name='student_profile')\n    subscription = models.CharField(max_length=20, choices=SUBSCRIPTION_CHOICES, default='free')\n    parent_email = models.EmailField(blank=True)\n    grade = models.ForeignKey(Grade, on_delete=models.SET_NULL, null=True)\n    email_verified = models.BooleanField(default=False)\n    verification_token = models.CharField(max_length=100, blank=True)\n    verification_token_created = models.DateTimeField(null=True, blank=True)\n    created_at = models.DateTimeField(auto_now_add=True)\n    onboarding_completed = models.BooleanField(default=False)\n    \n    def __str__(self):\n        return f\"Student: {self.user.username}\"\n    \n    def get_exam_board_limit(self):\n        \"\"\"Free: 2 boards, Pro: 5 boards\"\"\"\n        return 2 if self.subscription == 'free' else 5\n    \n    def get_subject_limit_per_board(self):\n        \"\"\"Maximum 10 subjects per board\"\"\"\n        return 10\n\n\nclass StudentExamBoard(models.Model):\n    \"\"\"Student's selected exam boards\"\"\"\n    student = models.ForeignKey(StudentProfile, on_delete=models.CASCADE, related_name='exam_boards')\n    exam_board = models.ForeignKey(ExamBoard, on_delete=models.CASCADE)\n    selected_at = models.DateTimeField(auto_now_add=True)\n    \n    class Meta:\n        unique_together = ('student', 'exam_board')\n    \n    def __str__(self):\n        return f\"{self.student.user.username} - {self.exam_board.abbreviation}\"\n\n\nclass StudentSubject(models.Model):\n    \"\"\"Student's selected subjects per exam board\"\"\"\n    student = models.ForeignKey(StudentProfile, on_delete=models.CASCADE, related_name='subjects')\n    subject = models.ForeignKey(Subject, on_delete=models.CASCADE)\n    exam_board = models.ForeignKey(ExamBoard, on_delete=models.CASCADE)\n    selected_at = models.DateTimeField(auto_now_add=True)\n    \n    class Meta:\n        unique_together = ('student', 'subject', 'exam_board')\n    \n    def __str__(self):\n        return f\"{self.student.user.username} - {self.subject.name} ({self.exam_board.abbreviation})\"\n\n\nclass Note(models.Model):\n    \"\"\"Study notes uploaded by content managers\"\"\"\n    title = models.CharField(max_length=200)\n    subject = models.ForeignKey(Subject, on_delete=models.CASCADE)\n    exam_board = models.ForeignKey(ExamBoard, on_delete=models.CASCADE)\n    grade = models.ForeignKey(Grade, on_delete=models.CASCADE)\n    topic_text = models.CharField(max_length=200, blank=True, help_text=\"Legacy topic text field\")\n    topic = models.ForeignKey('Topic', on_delete=models.SET_NULL, null=True, blank=True, related_name='notes')\n    \n    full_version = models.FileField(upload_to='notes/full/%Y/%m/', null=True, blank=True)\n    summary_version = models.FileField(upload_to='notes/summary/%Y/%m/', null=True, blank=True)\n    full_version_text = models.TextField(blank=True)\n    summary_version_text = models.TextField(blank=True)\n    \n    created_by = models.ForeignKey(User, on_delete=models.SET_NULL, null=True)\n    created_at = models.DateTimeField(auto_now_add=True)\n    updated_at = models.DateTimeField(auto_now=True)\n    \n    class Meta:\n        ordering = ['subject', 'topic']\n    \n    def __str__(self):\n        return f\"{self.title} - {self.subject.name}\"\n    \n    def get_topic_name(self):\n        \"\"\"Get topic name from FK or legacy text field\"\"\"\n        if self.topic:\n            return self.topic.name\n        return self.topic_text\n\n\nclass Flashcard(models.Model):\n    \"\"\"Flashcards for memorization\"\"\"\n    subject = models.ForeignKey(Subject, on_delete=models.CASCADE)\n    exam_board = models.ForeignKey(ExamBoard, on_delete=models.CASCADE)\n    grade = models.ForeignKey(Grade, on_delete=models.CASCADE)\n    topic_text = models.CharField(max_length=200, blank=True, help_text=\"Legacy topic text field\")\n    topic = models.ForeignKey('Topic', on_delete=models.SET_NULL, null=True, blank=True, related_name='flashcards')\n    \n    front_text = models.TextField()\n    back_text = models.TextField()\n    image_front = models.ImageField(upload_to='flashcards/images/', null=True, blank=True)\n    image_back = models.ImageField(upload_to='flashcards/images/', null=True, blank=True)\n    \n    created_by = models.ForeignKey(User, on_delete=models.SET_NULL, null=True)\n    created_at = models.DateTimeField(auto_now_add=True)\n    \n    class Meta:\n        ordering = ['subject', 'topic']\n    \n    def __str__(self):\n        topic_name = self.topic.name if self.topic else self.topic_text\n        return f\"{self.subject.name} - {topic_name[:50]}\"\n\n\nclass InteractiveQuestion(models.Model):\n    \"\"\"Interactive questions for quizzes\"\"\"\n    QUESTION_TYPES = [\n        ('mcq', 'Multiple Choice'),\n        ('true_false', 'True/False'),\n        ('fill_blank', 'Fill in the Blank'),\n        ('matching', 'Matching'),\n        ('structured', 'Structured Question'),\n        ('essay', 'Essay/Free Response'),\n    ]\n    \n    DIFFICULTY_LEVELS = [\n        ('easy', 'Easy'),\n        ('medium', 'Medium'),\n        ('hard', 'Hard'),\n    ]\n    \n    subject = models.ForeignKey(Subject, on_delete=models.CASCADE)\n    exam_board = models.ForeignKey(ExamBoard, on_delete=models.CASCADE)\n    grade = models.ForeignKey(Grade, on_delete=models.CASCADE)\n    topic_text = models.CharField(max_length=200, blank=True, help_text=\"Legacy topic text field\")\n    topic = models.ForeignKey('Topic', on_delete=models.SET_NULL, null=True, blank=True, related_name='questions')\n    \n    question_type = models.CharField(max_length=20, choices=QUESTION_TYPES)\n    difficulty = models.CharField(max_length=10, choices=DIFFICULTY_LEVELS)\n    \n    question_text = models.TextField()\n    question_image = models.ImageField(upload_to='questions/images/', null=True, blank=True)\n    \n    # For MCQ - JSON array of options with correct answer index\n    options = models.JSONField(null=True, blank=True, help_text='[{\"text\": \"Option A\", \"is_correct\": true}, ...]')\n    \n    # Correct answer(s) - can be text, index, or JSON for complex types\n    correct_answer = models.TextField()\n    \n    # For MCQ auto-marking - store which option index is correct\n    correct_option_index = models.IntegerField(null=True, blank=True, help_text=\"0-based index of correct MCQ option\")\n    \n    # For matching questions - JSON with pairs\n    matching_pairs = models.JSONField(null=True, blank=True)\n    \n    # Solution/model answer for structured questions (for AI marking)\n    model_answer = models.TextField(blank=True, help_text=\"Model answer for structured/essay questions\")\n    marking_guide = models.TextField(blank=True, help_text=\"Marking criteria for AI grading\")\n    max_marks = models.IntegerField(default=1, help_text=\"Maximum marks for this question\")\n    \n    explanation = models.TextField(blank=True)\n    points = models.IntegerField(default=1)\n    \n    created_by = models.ForeignKey(User, on_delete=models.SET_NULL, null=True)\n    created_at = models.DateTimeField(auto_now_add=True)\n    \n    class Meta:\n        ordering = ['subject', 'topic', 'difficulty']\n    \n    def __str__(self):\n        return f\"{self.question_type} - {self.topic[:50]}\"\n\n\nclass StudentQuiz(models.Model):\n    \"\"\"Interactive quiz collections for students\"\"\"\n    LENGTH_CHOICES = [\n        (5, '5 Questions'),\n        (10, '10 Questions'),\n        (20, '20 Questions'),\n        (50, '50 Questions'),\n    ]\n    \n    DIFFICULTY_LEVELS = [\n        ('easy', 'Easy'),\n        ('medium', 'Medium'),\n        ('hard', 'Hard'),\n        ('mixed', 'Mixed'),\n    ]\n    \n    title = models.CharField(max_length=200)\n    subject = models.ForeignKey(Subject, on_delete=models.CASCADE)\n    exam_board = models.ForeignKey(ExamBoard, on_delete=models.CASCADE)\n    grade = models.ForeignKey(Grade, on_delete=models.CASCADE)\n    topic = models.CharField(max_length=200)\n    \n    difficulty = models.CharField(max_length=10, choices=DIFFICULTY_LEVELS)\n    length = models.IntegerField(choices=LENGTH_CHOICES, default=10)\n    \n    questions = models.ManyToManyField(InteractiveQuestion, related_name='student_quizzes')\n    \n    is_pro_content = models.BooleanField(default=False)\n    \n    created_by = models.ForeignKey(User, on_delete=models.SET_NULL, null=True)\n    created_at = models.DateTimeField(auto_now_add=True)\n    \n    class Meta:\n        ordering = ['-created_at']\n        verbose_name_plural = 'Student Quizzes'\n    \n    def __str__(self):\n        return f\"{self.title} - {self.subject.name}\"\n\n\nclass StudentQuizAttempt(models.Model):\n    \"\"\"Student quiz attempts and results\"\"\"\n    student = models.ForeignKey(StudentProfile, on_delete=models.CASCADE, related_name='quiz_attempts')\n    quiz = models.ForeignKey(StudentQuiz, on_delete=models.CASCADE)\n    \n    started_at = models.DateTimeField(auto_now_add=True)\n    completed_at = models.DateTimeField(null=True, blank=True)\n    \n    # Student preferences\n    is_timed = models.BooleanField(default=False)\n    time_limit_minutes = models.IntegerField(null=True, blank=True)\n    show_instant_feedback = models.BooleanField(default=True)\n    \n    # Results\n    answers = models.JSONField(default=dict)\n    score = models.IntegerField(null=True, blank=True)\n    percentage = models.DecimalField(max_digits=5, decimal_places=2, null=True, blank=True)\n    \n    class Meta:\n        ordering = ['-started_at']\n    \n    def __str__(self):\n        return f\"{self.student.user.username} - {self.quiz.title}\"\n\n\nclass StudentQuizQuota(models.Model):\n    \"\"\"Track free tier quiz quotas - 2 different quizzes per topic lifetime\"\"\"\n    student = models.ForeignKey(StudentProfile, on_delete=models.CASCADE, related_name='quiz_quotas')\n    subject = models.ForeignKey(Subject, on_delete=models.CASCADE)\n    topic = models.CharField(max_length=200)\n    \n    quizzes_completed = models.ManyToManyField(StudentQuiz, blank=True)\n    attempt_count = models.IntegerField(default=0)\n    \n    class Meta:\n        unique_together = ('student', 'subject', 'topic')\n    \n    def __str__(self):\n        return f\"{self.student.user.username} - {self.topic}\"\n    \n    def has_free_attempts_left(self):\n        \"\"\"Free users get 2 different quizzes per topic\"\"\"\n        return self.quizzes_completed.count() < 2\n    \n    def can_attempt_quiz(self, quiz, is_pro):\n        \"\"\"Check if student can attempt this quiz\"\"\"\n        if is_pro:\n            return True\n        \n        # Free users: check if already attempted 2 different quizzes\n        if self.quizzes_completed.count() >= 2:\n            # Can only retry already attempted quizzes\n            return quiz in self.quizzes_completed.all()\n        \n        return True\n\n\nclass ExamPaper(models.Model):\n    \"\"\"Full exam papers for practice\"\"\"\n    title = models.CharField(max_length=200)\n    subject = models.ForeignKey(Subject, on_delete=models.CASCADE)\n    exam_board = models.ForeignKey(ExamBoard, on_delete=models.CASCADE)\n    grade = models.ForeignKey(Grade, on_delete=models.CASCADE)\n    year = models.IntegerField(null=True, blank=True)\n    \n    paper_file = models.FileField(upload_to='exam_papers/%Y/%m/')\n    marking_scheme = models.FileField(upload_to='exam_papers/marking/%Y/%m/', null=True, blank=True)\n    \n    # Interactive version (questions extracted)\n    has_interactive_version = models.BooleanField(default=False)\n    interactive_questions = models.ManyToManyField(InteractiveQuestion, blank=True)\n    \n    is_pro_content = models.BooleanField(default=False)\n    \n    created_by = models.ForeignKey(User, on_delete=models.SET_NULL, null=True)\n    created_at = models.DateTimeField(auto_now_add=True)\n    \n    class Meta:\n        ordering = ['-year', 'subject']\n    \n    def __str__(self):\n        return f\"{self.title} - {self.subject.name}\"\n\n\nclass StudentProgress(models.Model):\n    \"\"\"Track student learning progress\"\"\"\n    student = models.ForeignKey(StudentProfile, on_delete=models.CASCADE, related_name='progress')\n    subject = models.ForeignKey(Subject, on_delete=models.CASCADE)\n    topic = models.CharField(max_length=200)\n    \n    quizzes_attempted = models.IntegerField(default=0)\n    quizzes_passed = models.IntegerField(default=0)\n    average_score = models.DecimalField(max_digits=5, decimal_places=2, default=0)\n    \n    notes_viewed = models.BooleanField(default=False)\n    flashcards_reviewed = models.IntegerField(default=0)\n    \n    last_activity = models.DateTimeField(auto_now=True)\n    \n    class Meta:\n        unique_together = ('student', 'subject', 'topic')\n        ordering = ['-last_activity']\n    \n    def __str__(self):\n        return f\"{self.student.user.username} - {self.subject.name} - {self.topic}\"\n\n\nclass OfficialExamPaper(models.Model):\n    \"\"\"Official exam papers from various boards for free download and AI training\"\"\"\n    \n    SESSION_CHOICES = [\n        ('june', 'June'),\n        ('november', 'November'),\n        ('may', 'May/June'),\n        ('february', 'February/March'),\n        ('october', 'October/November'),\n        ('summer', 'Summer'),\n        ('winter', 'Winter'),\n        ('other', 'Other'),\n    ]\n    \n    PAPER_TYPE_CHOICES = [\n        ('qp', 'Question Paper'),\n        ('ms', 'Marking Scheme'),\n        ('er', 'Examiner Report'),\n        ('gt', 'Grade Thresholds'),\n        ('ir', 'Insert/Resource Booklet'),\n        ('specimen', 'Specimen Paper'),\n        ('other', 'Other'),\n    ]\n    \n    # Board and Subject (with ForeignKeys for proper filtering)\n    exam_board = models.ForeignKey(ExamBoard, on_delete=models.CASCADE, help_text=\"Exam board\")\n    subject = models.ForeignKey(Subject, on_delete=models.CASCADE, null=True, blank=True, help_text=\"Optional subject mapping\")\n    subject_code = models.CharField(max_length=50, help_text=\"Official subject code (e.g., 0580, 9MA0, PHYS-01)\")\n    subject_name = models.CharField(max_length=200, blank=True, help_text=\"e.g., Mathematics, Physics\")\n    module_code = models.CharField(max_length=50, blank=True, help_text=\"Optional module/component code\")\n    \n    # Paper details\n    year = models.IntegerField(help_text=\"e.g., 2023\")\n    session = models.CharField(max_length=20, choices=SESSION_CHOICES)\n    paper_number = models.CharField(max_length=20, help_text=\"e.g., 1, 2, 3, 4H, 1F\")\n    variant = models.CharField(max_length=10, blank=True, help_text=\"e.g., 1, 2, 3 for Cambridge variants\")\n    paper_type = models.CharField(max_length=20, choices=PAPER_TYPE_CHOICES, default='qp')\n    \n    # File storage\n    original_filename = models.CharField(max_length=255, help_text=\"Original file name for reference\")\n    file = models.FileField(upload_to='official_exam_papers/%Y/%m/')\n    \n    # Metadata and flags\n    metadata_json = models.JSONField(default=dict, blank=True, help_text=\"Additional parsed metadata\")\n    is_public = models.BooleanField(default=True, help_text=\"Visible on public download page\")\n    can_use_for_training = models.BooleanField(default=True, help_text=\"Use for AI training\")\n    \n    # Tracking\n    uploaded_by = models.ForeignKey(User, on_delete=models.SET_NULL, null=True)\n    created_at = models.DateTimeField(auto_now_add=True)\n    updated_at = models.DateTimeField(auto_now=True)\n    \n    class Meta:\n        ordering = ['-year', 'exam_board', 'subject_code', 'session', 'paper_number']\n        unique_together = [\n            ('exam_board', 'subject_code', 'year', 'session', 'paper_number', 'variant', 'paper_type')\n        ]\n        indexes = [\n            models.Index(fields=['exam_board', 'subject_code', 'year']),\n            models.Index(fields=['is_public']),\n            models.Index(fields=['subject', 'year']),\n        ]\n    \n    def __str__(self):\n        variant_str = f\"v{self.variant}\" if self.variant else \"\"\n        return f\"{self.exam_board.abbreviation} {self.subject_code} {self.year} {self.session} Paper {self.paper_number}{variant_str}\"\n    \n    def get_display_name(self):\n        \"\"\"Generate human-readable display name\"\"\"\n        parts = [self.exam_board.name_full, self.subject_name or self.subject_code]\n        parts.append(f\"({self.year})\")\n        parts.append(self.get_session_display())\n        parts.append(f\"Paper {self.paper_number}\")\n        if self.variant:\n            parts.append(f\"Variant {self.variant}\")\n        parts.append(f\"[{self.get_paper_type_display()}]\")\n        return \" \".join(parts)\n    \n    def get_search_text(self):\n        \"\"\"Combined text for full-text search\"\"\"\n        board_name = self.exam_board.name_full if self.exam_board else \"\"\n        return f\"{board_name} {self.subject_code} {self.subject_name} {self.year} {self.session} {self.paper_number} {self.variant} {self.original_filename}\"\n\n\nclass TeacherAssessment(models.Model):\n    \"\"\"Teacher-created assessments (exams, tests, assignments, homework)\"\"\"\n    \n    CATEGORY_CHOICES = [\n        ('exam', 'Exam'),\n        ('test', 'Test'),\n        ('assignment', 'Assignment'),\n        ('homework', 'Homework'),\n        ('classwork', 'Classwork'),\n    ]\n    \n    STATUS_CHOICES = [\n        ('draft', 'Draft'),\n        ('published', 'Published'),\n        ('archived', 'Archived'),\n    ]\n    \n    teacher = models.ForeignKey(User, on_delete=models.CASCADE, related_name='assessments')\n    title = models.CharField(max_length=255)\n    description = models.TextField(blank=True)\n    category = models.CharField(max_length=20, choices=CATEGORY_CHOICES)\n    subject = models.ForeignKey(Subject, on_delete=models.SET_NULL, null=True, blank=True)\n    grade = models.ForeignKey(Grade, on_delete=models.SET_NULL, null=True, blank=True)\n    \n    time_limit = models.IntegerField(null=True, blank=True, help_text=\"Time limit in minutes\")\n    total_marks = models.IntegerField(default=0)\n    passing_marks = models.IntegerField(null=True, blank=True)\n    instructions = models.TextField(blank=True)\n    \n    status = models.CharField(max_length=20, choices=STATUS_CHOICES, default='draft')\n    is_shuffle_questions = models.BooleanField(default=False)\n    show_correct_answers = models.BooleanField(default=True)\n    \n    created_at = models.DateTimeField(auto_now_add=True)\n    updated_at = models.DateTimeField(auto_now=True)\n    \n    class Meta:\n        ordering = ['-created_at']\n        indexes = [\n            models.Index(fields=['teacher', 'category']),\n            models.Index(fields=['status']),\n        ]\n    \n    def __str__(self):\n        return f\"{self.title} ({self.get_category_display()})\"\n    \n    def get_question_count(self):\n        return self.questions.count()\n    \n    def calculate_total_marks(self):\n        return self.questions.aggregate(total=models.Sum('marks'))['total'] or 0\n\n\nclass TeacherQuestion(models.Model):\n    \"\"\"Questions within a teacher assessment\"\"\"\n    \n    QUESTION_TYPE_CHOICES = [\n        ('mcq', 'Multiple Choice'),\n        ('mcq_multi', 'Multiple Choice (Multiple Answers)'),\n        ('true_false', 'True/False'),\n        ('short_answer', 'Short Answer'),\n        ('long_answer', 'Long Answer / Essay'),\n        ('matching', 'Matching'),\n        ('fill_blank', 'Fill in the Blank'),\n    ]\n    \n    assessment = models.ForeignKey(TeacherAssessment, on_delete=models.CASCADE, related_name='questions')\n    question_type = models.CharField(max_length=20, choices=QUESTION_TYPE_CHOICES)\n    question_text = models.TextField()\n    question_image = models.ImageField(upload_to='assessment_questions/%Y/%m/', null=True, blank=True)\n    \n    marks = models.IntegerField(default=1)\n    order = models.IntegerField(default=0)\n    \n    correct_answer = models.TextField(blank=True, help_text=\"For short/long answer - expected answer or keywords\")\n    explanation = models.TextField(blank=True, help_text=\"Explanation shown after answering\")\n    \n    is_required = models.BooleanField(default=True)\n    \n    created_at = models.DateTimeField(auto_now_add=True)\n    updated_at = models.DateTimeField(auto_now=True)\n    \n    class Meta:\n        ordering = ['order', 'id']\n    \n    def __str__(self):\n        return f\"Q{self.order}: {self.question_text[:50]}...\"\n\n\nclass TeacherQuestionOption(models.Model):\n    \"\"\"Options for MCQ and matching questions\"\"\"\n    \n    question = models.ForeignKey(TeacherQuestion, on_delete=models.CASCADE, related_name='options')\n    option_text = models.CharField(max_length=500)\n    option_image = models.ImageField(upload_to='assessment_options/%Y/%m/', null=True, blank=True)\n    is_correct = models.BooleanField(default=False)\n    order = models.IntegerField(default=0)\n    \n    match_pair = models.CharField(max_length=500, blank=True, help_text=\"For matching questions - the paired answer\")\n    \n    class Meta:\n        ordering = ['order', 'id']\n    \n    def __str__(self):\n        return self.option_text[:50]\n\n\nclass ContentShare(models.Model):\n    \"\"\"Token-based sharing for assessments and documents\"\"\"\n    \n    teacher = models.ForeignKey(User, on_delete=models.CASCADE)\n    token = models.CharField(max_length=32, unique=True, default=generate_share_token)\n    \n    assessment = models.ForeignKey('TeacherAssessment', on_delete=models.CASCADE, null=True, blank=True, related_name='shares')\n    document = models.ForeignKey(UploadedDocument, on_delete=models.CASCADE, null=True, blank=True, related_name='shares')\n    \n    created_at = models.DateTimeField(auto_now_add=True)\n    expires_at = models.DateTimeField(null=True, blank=True)\n    is_active = models.BooleanField(default=True)\n    \n    view_count = models.IntegerField(default=0)\n    last_accessed = models.DateTimeField(null=True, blank=True)\n    \n    class Meta:\n        indexes = [\n            models.Index(fields=['token']),\n        ]\n        constraints = [\n            models.CheckConstraint(\n                check=(\n                    models.Q(assessment__isnull=False, document__isnull=True) |\n                    models.Q(assessment__isnull=True, document__isnull=False)\n                ),\n                name='exactly_one_content_type'\n            ),\n        ]\n    \n    def __str__(self):\n        if self.assessment:\n            return f\"Share: {self.assessment.title} ({self.token[:8]}...)\"\n        elif self.document:\n            return f\"Share: {self.document.title} ({self.token[:8]}...)\"\n        return f\"Share ({self.token[:8]}...)\"\n    \n    @property\n    def is_valid(self):\n        \"\"\"Check if share link is still valid\"\"\"\n        if not self.is_active:\n            return False\n        if self.expires_at:\n            from django.utils import timezone\n            return timezone.now() < self.expires_at\n        return True\n\n\nclass BrillTechAdmin(models.Model):\n    \"\"\"Admin users for BrillTech corporate website (separate from EduTech)\"\"\"\n    username = models.CharField(max_length=50, unique=True)\n    password_hash = models.CharField(max_length=255)\n    email = models.EmailField(blank=True)\n    full_name = models.CharField(max_length=100, blank=True)\n    is_active = models.BooleanField(default=True)\n    created_at = models.DateTimeField(auto_now_add=True)\n    last_login = models.DateTimeField(null=True, blank=True)\n    \n    class Meta:\n        verbose_name = 'BrillTech Admin'\n        verbose_name_plural = 'BrillTech Admins'\n    \n    def __str__(self):\n        return self.username\n    \n    def set_password(self, raw_password):\n        \"\"\"Hash and set the password\"\"\"\n        from django.contrib.auth.hashers import make_password\n        self.password_hash = make_password(raw_password)\n    \n    def check_password(self, raw_password):\n        \"\"\"Check if password matches\"\"\"\n        from django.contrib.auth.hashers import check_password\n        return check_password(raw_password, self.password_hash)\n\n\nclass ContactSubmission(models.Model):\n    \"\"\"Contact form submissions from BrillTech website\"\"\"\n    STATUS_CHOICES = [\n        ('new', 'New'),\n        ('read', 'Read'),\n        ('replied', 'Replied'),\n        ('archived', 'Archived'),\n    ]\n    \n    name = models.CharField(max_length=100)\n    email = models.EmailField()\n    phone = models.CharField(max_length=30, blank=True)\n    company = models.CharField(max_length=100, blank=True)\n    subject = models.CharField(max_length=200, blank=True)\n    message = models.TextField()\n    \n    status = models.CharField(max_length=20, choices=STATUS_CHOICES, default='new')\n    is_read = models.BooleanField(default=False)\n    \n    created_at = models.DateTimeField(auto_now_add=True)\n    read_at = models.DateTimeField(null=True, blank=True)\n    replied_at = models.DateTimeField(null=True, blank=True)\n    \n    admin_notes = models.TextField(blank=True, help_text=\"Internal notes about this submission\")\n    \n    class Meta:\n        ordering = ['-created_at']\n        verbose_name = 'Contact Submission'\n        verbose_name_plural = 'Contact Submissions'\n    \n    def __str__(self):\n        return f\"{self.name} - {self.subject or 'No Subject'} ({self.created_at.strftime('%Y-%m-%d')})\"\n    \n    def mark_as_read(self):\n        \"\"\"Mark submission as read\"\"\"\n        from django.utils import timezone\n        self.is_read = True\n        self.status = 'read'\n        self.read_at = timezone.now()\n        self.save()\n\n\n# ============================================\n# VIDEO LESSON SYSTEM - Hierarchical Structure\n# Subject ‚Üí Topic ‚Üí Subtopic ‚Üí Concept ‚Üí VideoLesson\n# ============================================\n\nclass Topic(models.Model):\n    \"\"\"Topics belong to Subjects. Example: Mathematics ‚Üí Algebra\"\"\"\n    subject = models.ForeignKey(Subject, on_delete=models.CASCADE, related_name='topics')\n    name = models.CharField(max_length=200)\n    description = models.TextField(blank=True)\n    order = models.IntegerField(default=0, help_text=\"Display order within subject\")\n    is_active = models.BooleanField(default=True)\n    created_at = models.DateTimeField(auto_now_add=True)\n    updated_at = models.DateTimeField(auto_now=True)\n    \n    class Meta:\n        ordering = ['subject', 'order', 'name']\n        unique_together = ['subject', 'name']\n    \n    def __str__(self):\n        return f\"{self.subject.name} ‚Üí {self.name}\"\n\n\nclass Subtopic(models.Model):\n    \"\"\"Subtopics belong to Topics. Example: Algebra ‚Üí Linear Equations\"\"\"\n    topic = models.ForeignKey(Topic, on_delete=models.CASCADE, related_name='subtopics')\n    name = models.CharField(max_length=200)\n    description = models.TextField(blank=True)\n    order = models.IntegerField(default=0, help_text=\"Display order within topic\")\n    is_active = models.BooleanField(default=True)\n    created_at = models.DateTimeField(auto_now_add=True)\n    updated_at = models.DateTimeField(auto_now=True)\n    \n    class Meta:\n        ordering = ['topic', 'order', 'name']\n        unique_together = ['topic', 'name']\n    \n    def __str__(self):\n        return f\"{self.topic.name} ‚Üí {self.name}\"\n    \n    def get_full_path(self):\n        return f\"{self.topic.subject.name} ‚Üí {self.topic.name} ‚Üí {self.name}\"\n\n\nclass Concept(models.Model):\n    \"\"\"Concepts belong to Subtopics. Example: Linear Equations ‚Üí Solving for X\"\"\"\n    subtopic = models.ForeignKey(Subtopic, on_delete=models.CASCADE, related_name='concepts')\n    name = models.CharField(max_length=200)\n    description = models.TextField(blank=True)\n    order = models.IntegerField(default=0, help_text=\"Display order within subtopic\")\n    is_active = models.BooleanField(default=True)\n    created_at = models.DateTimeField(auto_now_add=True)\n    updated_at = models.DateTimeField(auto_now=True)\n    \n    class Meta:\n        ordering = ['subtopic', 'order', 'name']\n        unique_together = ['subtopic', 'name']\n    \n    def __str__(self):\n        return f\"{self.subtopic.name} ‚Üí {self.name}\"\n    \n    def get_full_path(self):\n        return f\"{self.subtopic.topic.subject.name} ‚Üí {self.subtopic.topic.name} ‚Üí {self.subtopic.name} ‚Üí {self.name}\"\n\n\nclass VideoLesson(models.Model):\n    \"\"\"Video lessons linked to the Subject/Topic/Subtopic/Concept hierarchy\"\"\"\n    \n    # Hierarchy - can be linked at any level (Concept is most specific)\n    subject = models.ForeignKey(Subject, on_delete=models.CASCADE, related_name='video_lessons')\n    topic = models.ForeignKey(Topic, on_delete=models.CASCADE, related_name='video_lessons', null=True, blank=True)\n    subtopic = models.ForeignKey(Subtopic, on_delete=models.CASCADE, related_name='video_lessons', null=True, blank=True)\n    concept = models.ForeignKey(Concept, on_delete=models.CASCADE, related_name='video_lessons', null=True, blank=True)\n    \n    # Video details\n    title = models.CharField(max_length=300)\n    description = models.TextField(blank=True)\n    youtube_url = models.URLField(max_length=500, help_text=\"YouTube video URL\")\n    duration_minutes = models.IntegerField(default=0, help_text=\"Video duration in minutes\")\n    thumbnail_url = models.URLField(max_length=500, blank=True, help_text=\"Custom thumbnail URL (auto-generated from YouTube if empty)\")\n    \n    # Metadata\n    tags = models.CharField(max_length=500, blank=True, help_text=\"Comma-separated tags\")\n    order = models.IntegerField(default=0, help_text=\"Display order\")\n    is_active = models.BooleanField(default=True)\n    is_featured = models.BooleanField(default=False)\n    \n    # Tracking\n    view_count = models.IntegerField(default=0)\n    created_by = models.ForeignKey(User, on_delete=models.SET_NULL, null=True, related_name='created_videos')\n    created_at = models.DateTimeField(auto_now_add=True)\n    updated_at = models.DateTimeField(auto_now=True)\n    \n    class Meta:\n        ordering = ['subject', 'topic', 'subtopic', 'concept', 'order', '-created_at']\n    \n    def __str__(self):\n        return self.title\n    \n    def get_youtube_embed_url(self):\n        \"\"\"Convert YouTube URL to embed URL\"\"\"\n        url = self.youtube_url\n        if 'youtube.com/watch?v=' in url:\n            video_id = url.split('v=')[1].split('&')[0]\n            return f\"https://www.youtube.com/embed/{video_id}\"\n        elif 'youtu.be/' in url:\n            video_id = url.split('youtu.be/')[1].split('?')[0]\n            return f\"https://www.youtube.com/embed/{video_id}\"\n        elif 'youtube.com/embed/' in url:\n            return url\n        return url\n    \n    def get_youtube_video_id(self):\n        \"\"\"Extract YouTube video ID\"\"\"\n        url = self.youtube_url\n        if 'youtube.com/watch?v=' in url:\n            return url.split('v=')[1].split('&')[0]\n        elif 'youtu.be/' in url:\n            return url.split('youtu.be/')[1].split('?')[0]\n        elif 'youtube.com/embed/' in url:\n            return url.split('embed/')[1].split('?')[0]\n        return None\n    \n    def get_thumbnail(self):\n        \"\"\"Get thumbnail URL (custom or from YouTube)\"\"\"\n        if self.thumbnail_url:\n            return self.thumbnail_url\n        video_id = self.get_youtube_video_id()\n        if video_id:\n            return f\"https://img.youtube.com/vi/{video_id}/hqdefault.jpg\"\n        return None\n    \n    def get_hierarchy_path(self):\n        \"\"\"Get full hierarchy path\"\"\"\n        parts = [self.subject.name]\n        if self.topic:\n            parts.append(self.topic.name)\n        if self.subtopic:\n            parts.append(self.subtopic.name)\n        if self.concept:\n            parts.append(self.concept.name)\n        return ' ‚Üí '.join(parts)\n    \n    def get_tags_list(self):\n        \"\"\"Get tags as a list\"\"\"\n        if self.tags:\n            return [tag.strip() for tag in self.tags.split(',') if tag.strip()]\n        return []\n\n\nclass StudentVideoProgress(models.Model):\n    \"\"\"Track student's video watching progress\"\"\"\n    student = models.ForeignKey('StudentProfile', on_delete=models.CASCADE, related_name='video_progress')\n    video = models.ForeignKey(VideoLesson, on_delete=models.CASCADE, related_name='student_progress')\n    \n    watched_seconds = models.IntegerField(default=0)\n    is_completed = models.BooleanField(default=False)\n    last_watched_at = models.DateTimeField(auto_now=True)\n    \n    class Meta:\n        unique_together = ['student', 'video']\n    \n    def __str__(self):\n        return f\"{self.student.user.username} - {self.video.title}\"\n\n\nclass StudentVideoBookmark(models.Model):\n    \"\"\"Student bookmarked/favourite videos\"\"\"\n    student = models.ForeignKey('StudentProfile', on_delete=models.CASCADE, related_name='video_bookmarks')\n    video = models.ForeignKey(VideoLesson, on_delete=models.CASCADE, related_name='bookmarks')\n    created_at = models.DateTimeField(auto_now_add=True)\n    \n    class Meta:\n        unique_together = ['student', 'video']\n        ordering = ['-created_at']\n    \n    def __str__(self):\n        return f\"{self.student.user.username} bookmarked {self.video.title}\"\n\n\nclass Syllabus(models.Model):\n    \"\"\"Syllabi for different exam boards and subjects\"\"\"\n    exam_board = models.ForeignKey(ExamBoard, on_delete=models.CASCADE)\n    subject = models.ForeignKey(Subject, on_delete=models.CASCADE)\n    grade = models.ForeignKey(Grade, on_delete=models.CASCADE, null=True, blank=True)\n    \n    title = models.CharField(max_length=300)\n    description = models.TextField(blank=True)\n    year = models.IntegerField(null=True, blank=True, help_text=\"Syllabus year/version\")\n    \n    file = models.FileField(upload_to='syllabi/%Y/%m/', null=True, blank=True)\n    external_url = models.URLField(max_length=500, blank=True, help_text=\"Link to external syllabus\")\n    \n    is_active = models.BooleanField(default=True)\n    created_by = models.ForeignKey(User, on_delete=models.SET_NULL, null=True)\n    created_at = models.DateTimeField(auto_now_add=True)\n    updated_at = models.DateTimeField(auto_now=True)\n    \n    class Meta:\n        ordering = ['exam_board', 'subject', '-year']\n        verbose_name_plural = 'Syllabi'\n    \n    def __str__(self):\n        return f\"{self.exam_board.abbreviation} - {self.subject.name} Syllabus ({self.year or 'N/A'})\"\n\n\nclass StudentTopicProgress(models.Model):\n    \"\"\"Track detailed student progress per topic for the pathway system\"\"\"\n    student = models.ForeignKey('StudentProfile', on_delete=models.CASCADE, related_name='topic_progress')\n    subject = models.ForeignKey(Subject, on_delete=models.CASCADE)\n    topic = models.ForeignKey(Topic, on_delete=models.CASCADE)\n    \n    # Notes progress\n    notes_read_count = models.IntegerField(default=0)\n    notes_completed = models.BooleanField(default=False)\n    \n    # Videos progress\n    videos_watched_count = models.IntegerField(default=0)\n    videos_total = models.IntegerField(default=0)\n    \n    # Flashcards progress\n    flashcards_reviewed_count = models.IntegerField(default=0)\n    flashcards_mastered_count = models.IntegerField(default=0)\n    \n    # Quiz progress by difficulty\n    quizzes_easy_completed = models.IntegerField(default=0)\n    quizzes_easy_passed = models.IntegerField(default=0)\n    quizzes_medium_completed = models.IntegerField(default=0)\n    quizzes_medium_passed = models.IntegerField(default=0)\n    quizzes_hard_completed = models.IntegerField(default=0)\n    quizzes_hard_passed = models.IntegerField(default=0)\n    \n    # Overall scores\n    average_quiz_score = models.DecimalField(max_digits=5, decimal_places=2, default=0)\n    total_time_spent_minutes = models.IntegerField(default=0)\n    \n    last_activity = models.DateTimeField(auto_now=True)\n    \n    class Meta:\n        unique_together = ['student', 'subject', 'topic']\n        ordering = ['-last_activity']\n    \n    def __str__(self):\n        return f\"{self.student.user.username} - {self.subject.name} - {self.topic.name}\"\n    \n    def get_completion_percentage(self):\n        \"\"\"Calculate overall topic completion percentage\"\"\"\n        total_items = 4  # notes, videos, flashcards, quizzes\n        completed = 0\n        \n        if self.notes_completed:\n            completed += 1\n        if self.videos_total > 0 and self.videos_watched_count >= self.videos_total:\n            completed += 1\n        if self.flashcards_mastered_count > 0:\n            completed += 0.5 + (0.5 if self.flashcards_mastered_count >= 10 else 0)\n        if self.quizzes_easy_passed > 0 or self.quizzes_medium_passed > 0 or self.quizzes_hard_passed > 0:\n            completed += 1\n        \n        return int((completed / total_items) * 100)\n\n\nclass StudentSubscriptionPricing(models.Model):\n    \"\"\"Admin-configurable pricing for student subscriptions\"\"\"\n    per_subject_price = models.DecimalField(max_digits=10, decimal_places=2, default=100.00, help_text=\"Price per subject (R100 default)\")\n    multi_subject_price = models.DecimalField(max_digits=10, decimal_places=2, default=200.00, help_text=\"Price for 4-5 subjects (R200 default)\")\n    all_access_price = models.DecimalField(max_digits=10, decimal_places=2, default=300.00, help_text=\"Price for all subjects (R300 default)\")\n    tutor_addon_price = models.DecimalField(max_digits=10, decimal_places=2, default=500.00, help_text=\"Tutor email support add-on (R500 default)\")\n    \n    per_subject_max = models.IntegerField(default=3, help_text=\"Max subjects for per-subject pricing\")\n    multi_subject_min = models.IntegerField(default=4, help_text=\"Min subjects for multi-subject tier\")\n    multi_subject_max = models.IntegerField(default=5, help_text=\"Max subjects for multi-subject tier\")\n    \n    is_active = models.BooleanField(default=True)\n    updated_at = models.DateTimeField(auto_now=True)\n    \n    class Meta:\n        verbose_name = \"Student Subscription Pricing\"\n        verbose_name_plural = \"Student Subscription Pricing\"\n    \n    def __str__(self):\n        return f\"Student Pricing: R{self.per_subject_price}/subject, R{self.multi_subject_price}/4-5, R{self.all_access_price}/all\"\n    \n    @classmethod\n    def get_current(cls):\n        pricing = cls.objects.filter(is_active=True).first()\n        if not pricing:\n            pricing = cls.objects.create()\n        return pricing\n    \n    def calculate_price(self, num_subjects, total_subjects_available, has_tutor=False):\n        base_price = 0\n        if num_subjects <= self.per_subject_max:\n            base_price = self.per_subject_price * num_subjects\n        elif num_subjects <= self.multi_subject_max:\n            base_price = self.multi_subject_price\n        else:\n            base_price = self.all_access_price\n        \n        if has_tutor:\n            base_price += self.tutor_addon_price\n        \n        return base_price\n\n\nclass StudentSubscription(models.Model):\n    \"\"\"Tracks student subscription status\"\"\"\n    STATUS_CHOICES = [\n        ('free', 'Free'),\n        ('active', 'Active'),\n        ('expired', 'Expired'),\n        ('cancelled', 'Cancelled'),\n    ]\n    \n    PLAN_CHOICES = [\n        ('free', 'Free'),\n        ('per_subject', 'Per Subject (1-3)'),\n        ('multi_subject', 'Multi Subject (4-5)'),\n        ('all_access', 'All Access'),\n    ]\n    \n    student = models.OneToOneField('StudentProfile', on_delete=models.CASCADE, related_name='subscription_record')\n    plan = models.CharField(max_length=20, choices=PLAN_CHOICES, default='free')\n    status = models.CharField(max_length=20, choices=STATUS_CHOICES, default='free')\n    has_tutor_support = models.BooleanField(default=False)\n    \n    subjects_count = models.IntegerField(default=0)\n    amount_paid = models.DecimalField(max_digits=10, decimal_places=2, default=0)\n    \n    started_at = models.DateTimeField(null=True, blank=True)\n    expires_at = models.DateTimeField(null=True, blank=True)\n    \n    created_at = models.DateTimeField(auto_now_add=True)\n    updated_at = models.DateTimeField(auto_now=True)\n    \n    def __str__(self):\n        return f\"{self.student.user.username} - {self.get_plan_display()} ({self.status})\"\n    \n    @property\n    def is_active(self):\n        from django.utils import timezone\n        if self.status == 'active' and self.expires_at:\n            return self.expires_at > timezone.now()\n        return self.status == 'free'\n\n\nclass SupportEnquiry(models.Model):\n    \"\"\"Student support enquiries/tickets\"\"\"\n    TYPE_CHOICES = [\n        ('tutor', 'Tutor Help'),\n        ('system', 'System Support'),\n        ('billing', 'Billing Query'),\n        ('content', 'Content Issue'),\n    ]\n    \n    STATUS_CHOICES = [\n        ('open', 'Open'),\n        ('in_progress', 'In Progress'),\n        ('resolved', 'Resolved'),\n        ('closed', 'Closed'),\n    ]\n    \n    PRIORITY_CHOICES = [\n        ('low', 'Low'),\n        ('medium', 'Medium'),\n        ('high', 'High'),\n    ]\n    \n    student = models.ForeignKey('StudentProfile', on_delete=models.CASCADE, related_name='support_enquiries')\n    enquiry_type = models.CharField(max_length=20, choices=TYPE_CHOICES, default='system')\n    subject = models.CharField(max_length=200)\n    message = models.TextField()\n    priority = models.CharField(max_length=10, choices=PRIORITY_CHOICES, default='medium')\n    status = models.CharField(max_length=20, choices=STATUS_CHOICES, default='open')\n    \n    related_subject = models.ForeignKey(Subject, on_delete=models.SET_NULL, null=True, blank=True, help_text=\"Related academic subject if applicable\")\n    related_topic = models.CharField(max_length=200, blank=True)\n    \n    response = models.TextField(blank=True)\n    responded_by = models.ForeignKey(User, on_delete=models.SET_NULL, null=True, blank=True, related_name='support_responses')\n    responded_at = models.DateTimeField(null=True, blank=True)\n    \n    created_at = models.DateTimeField(auto_now_add=True)\n    updated_at = models.DateTimeField(auto_now=True)\n    \n    class Meta:\n        ordering = ['-created_at']\n        verbose_name_plural = \"Support Enquiries\"\n    \n    def __str__(self):\n        return f\"[{self.get_status_display()}] {self.subject} - {self.student.user.username}\"\n\n\n# ===== CRM MODELS FOR BRILLTECH ADMIN =====\n\nclass CRMTask(models.Model):\n    \"\"\"Tasks/Todo items for CRM\"\"\"\n    PRIORITY_CHOICES = [\n        ('low', 'Low'),\n        ('medium', 'Medium'),\n        ('high', 'High'),\n        ('urgent', 'Urgent'),\n    ]\n    \n    STATUS_CHOICES = [\n        ('pending', 'Pending'),\n        ('in_progress', 'In Progress'),\n        ('completed', 'Completed'),\n        ('cancelled', 'Cancelled'),\n    ]\n    \n    title = models.CharField(max_length=200)\n    description = models.TextField(blank=True)\n    priority = models.CharField(max_length=10, choices=PRIORITY_CHOICES, default='medium')\n    status = models.CharField(max_length=20, choices=STATUS_CHOICES, default='pending')\n    due_date = models.DateField(null=True, blank=True)\n    assigned_to = models.ForeignKey(User, on_delete=models.SET_NULL, null=True, blank=True, related_name='crm_tasks')\n    related_lead = models.ForeignKey('CRMLead', on_delete=models.SET_NULL, null=True, blank=True, related_name='tasks')\n    created_by = models.ForeignKey(User, on_delete=models.SET_NULL, null=True, related_name='created_crm_tasks')\n    created_at = models.DateTimeField(auto_now_add=True)\n    updated_at = models.DateTimeField(auto_now=True)\n    \n    class Meta:\n        ordering = ['-created_at']\n        verbose_name = \"CRM Task\"\n        verbose_name_plural = \"CRM Tasks\"\n    \n    def __str__(self):\n        return self.title\n\n\nclass CRMLead(models.Model):\n    \"\"\"Leads/Customers for CRM\"\"\"\n    PIPELINE_CHOICES = [\n        ('new', 'New Lead'),\n        ('contacted', 'Contacted'),\n        ('demo', 'Demo Scheduled'),\n        ('trial', 'Trial'),\n        ('proposal', 'Proposal Sent'),\n        ('won', 'Won'),\n        ('lost', 'Lost'),\n    ]\n    \n    SOURCE_CHOICES = [\n        ('website', 'Website'),\n        ('referral', 'Referral'),\n        ('social', 'Social Media'),\n        ('email', 'Email Campaign'),\n        ('event', 'Event/Conference'),\n        ('cold_call', 'Cold Call'),\n        ('partner', 'Partner'),\n        ('other', 'Other'),\n    ]\n    \n    TYPE_CHOICES = [\n        ('school', 'School'),\n        ('teacher', 'Individual Teacher'),\n        ('district', 'School District'),\n        ('publisher', 'Publisher'),\n        ('other', 'Other'),\n    ]\n    \n    first_name = models.CharField(max_length=100)\n    last_name = models.CharField(max_length=100)\n    email = models.EmailField()\n    phone = models.CharField(max_length=20, blank=True)\n    company = models.CharField(max_length=200, blank=True, help_text=\"School or organization name\")\n    job_title = models.CharField(max_length=100, blank=True)\n    lead_type = models.CharField(max_length=20, choices=TYPE_CHOICES, default='school')\n    source = models.CharField(max_length=20, choices=SOURCE_CHOICES, default='website')\n    pipeline_stage = models.CharField(max_length=20, choices=PIPELINE_CHOICES, default='new')\n    notes = models.TextField(blank=True)\n    estimated_value = models.DecimalField(max_digits=10, decimal_places=2, null=True, blank=True)\n    assigned_to = models.ForeignKey(User, on_delete=models.SET_NULL, null=True, blank=True, related_name='assigned_leads')\n    created_by = models.ForeignKey(User, on_delete=models.SET_NULL, null=True, related_name='created_leads')\n    created_at = models.DateTimeField(auto_now_add=True)\n    updated_at = models.DateTimeField(auto_now=True)\n    \n    class Meta:\n        ordering = ['-created_at']\n        verbose_name = \"CRM Lead\"\n        verbose_name_plural = \"CRM Leads\"\n    \n    def __str__(self):\n        return f\"{self.first_name} {self.last_name} - {self.company}\"\n    \n    @property\n    def full_name(self):\n        return f\"{self.first_name} {self.last_name}\"\n\n\nclass CRMActivity(models.Model):\n    \"\"\"Activity log for leads\"\"\"\n    TYPE_CHOICES = [\n        ('call', 'Phone Call'),\n        ('email', 'Email'),\n        ('meeting', 'Meeting'),\n        ('demo', 'Demo'),\n        ('note', 'Note'),\n        ('task', 'Task Completed'),\n        ('stage_change', 'Stage Change'),\n    ]\n    \n    lead = models.ForeignKey(CRMLead, on_delete=models.CASCADE, related_name='activities')\n    activity_type = models.CharField(max_length=20, choices=TYPE_CHOICES, default='note')\n    title = models.CharField(max_length=200)\n    description = models.TextField(blank=True)\n    created_by = models.ForeignKey(User, on_delete=models.SET_NULL, null=True)\n    created_at = models.DateTimeField(auto_now_add=True)\n    \n    class Meta:\n        ordering = ['-created_at']\n        verbose_name = \"CRM Activity\"\n        verbose_name_plural = \"CRM Activities\"\n    \n    def __str__(self):\n        return f\"{self.get_activity_type_display()}: {self.title}\"\n\n\nclass CRMMailingList(models.Model):\n    \"\"\"Email list for marketing campaigns\"\"\"\n    name = models.CharField(max_length=100)\n    description = models.TextField(blank=True)\n    created_at = models.DateTimeField(auto_now_add=True)\n    \n    class Meta:\n        verbose_name = \"Mailing List\"\n        verbose_name_plural = \"Mailing Lists\"\n    \n    def __str__(self):\n        return self.name\n    \n    @property\n    def subscriber_count(self):\n        return self.subscribers.filter(is_active=True).count()\n\n\nclass CRMMailingSubscriber(models.Model):\n    \"\"\"Subscribers for mailing lists\"\"\"\n    mailing_list = models.ForeignKey(CRMMailingList, on_delete=models.CASCADE, related_name='subscribers')\n    email = models.EmailField()\n    first_name = models.CharField(max_length=100, blank=True)\n    last_name = models.CharField(max_length=100, blank=True)\n    is_active = models.BooleanField(default=True)\n    lead = models.ForeignKey(CRMLead, on_delete=models.SET_NULL, null=True, blank=True)\n    subscribed_at = models.DateTimeField(auto_now_add=True)\n    unsubscribed_at = models.DateTimeField(null=True, blank=True)\n    \n    class Meta:\n        unique_together = ['mailing_list', 'email']\n        verbose_name = \"Mailing Subscriber\"\n        verbose_name_plural = \"Mailing Subscribers\"\n    \n    def __str__(self):\n        return f\"{self.email} - {self.mailing_list.name}\"\n\n\nclass CRMEmailCampaign(models.Model):\n    \"\"\"Email campaigns for marketing\"\"\"\n    STATUS_CHOICES = [\n        ('draft', 'Draft'),\n        ('scheduled', 'Scheduled'),\n        ('sending', 'Sending'),\n        ('sent', 'Sent'),\n        ('failed', 'Failed'),\n    ]\n    \n    name = models.CharField(max_length=200)\n    subject = models.CharField(max_length=200)\n    body = models.TextField()\n    mailing_list = models.ForeignKey(CRMMailingList, on_delete=models.CASCADE)\n    status = models.CharField(max_length=20, choices=STATUS_CHOICES, default='draft')\n    scheduled_at = models.DateTimeField(null=True, blank=True)\n    sent_at = models.DateTimeField(null=True, blank=True)\n    recipient_count = models.IntegerField(default=0)\n    sent_count = models.IntegerField(default=0)\n    failed_count = models.IntegerField(default=0)\n    created_by = models.ForeignKey(User, on_delete=models.SET_NULL, null=True)\n    created_at = models.DateTimeField(auto_now_add=True)\n    updated_at = models.DateTimeField(auto_now=True)\n    \n    class Meta:\n        ordering = ['-created_at']\n        verbose_name = \"Email Campaign\"\n        verbose_name_plural = \"Email Campaigns\"\n    \n    def __str__(self):\n        return self.name","path":null,"size_bytes":76571,"size_tokens":null},"django_project/core/migrations/__init__.py":{"content":"","path":null,"size_bytes":0,"size_tokens":null},"core/payfast_service.py":{"content":"import hashlib\nimport urllib.parse\nimport requests\nimport logging\nfrom django.conf import settings\nfrom django.urls import reverse\n\nlogger = logging.getLogger(__name__)\n\nclass PayFastService:\n    \"\"\"Service for generating PayFast payment forms and validating signatures\"\"\"\n    \n    PAYFAST_VALID_HOSTS = [\n        'www.payfast.co.za',\n        'sandbox.payfast.co.za',\n        'w1w.payfast.co.za',\n        'w2w.payfast.co.za',\n    ]\n    \n    # PayFast requires fields in this EXACT order for signature generation\n    CHECKOUT_SIGNATURE_FIELD_ORDER = [\n        'merchant_id', 'merchant_key', 'return_url', 'cancel_url', \n        'notify_url', 'name_first', 'name_last', 'email_address',\n        'cell_number', 'amount', 'item_name', 'item_description',\n        'custom_int1', 'custom_int2', 'custom_int3', 'custom_int4',\n        'custom_int5', 'custom_str1', 'custom_str2', 'custom_str3',\n        'custom_str4', 'custom_str5', 'email_confirmation',\n        'confirmation_address', 'payment_method', 'm_payment_id',\n        'subscription_type', 'billing_date', 'recurring_amount',\n        'frequency', 'cycles'\n    ]\n    \n    @staticmethod\n    def _sort_by_priority_list(values, priority):\n        \"\"\"Sort values based on PayFast priority list order\"\"\"\n        priority_dict = {k: i for i, k in enumerate(priority)}\n        def priority_getter(value):\n            return priority_dict.get(value, len(values))\n        return sorted(values, key=priority_getter)\n    \n    @staticmethod\n    def generate_signature(data_dict, passphrase=None):\n        \"\"\"\n        Generate MD5 signature for PayFast payment\n        Uses PayFast's required field ordering, not alphabetical sorting\n        \n        Args:\n            data_dict: Dictionary of payment parameters\n            passphrase: Optional passphrase for added security\n        \n        Returns:\n            MD5 signature string\n        \"\"\"\n        if passphrase is None:\n            passphrase = settings.PAYFAST_PASSPHRASE\n        \n        # Filter out empty values and strip whitespace\n        output_data = {}\n        for key, value in data_dict.items():\n            if str(value).strip():\n                output_data[key] = str(value).strip()\n        \n        # Sort keys by PayFast field order (NOT alphabetically!)\n        keys = PayFastService._sort_by_priority_list(\n            output_data.keys(), \n            PayFastService.CHECKOUT_SIGNATURE_FIELD_ORDER\n        )\n        \n        # Build parameter string with URL encoding\n        payload_string = \"\"\n        for key in keys:\n            if key != 'signature':\n                payload_string += f\"{key}={urllib.parse.quote_plus(output_data[key])}&\"\n        \n        # Remove trailing '&'\n        payload_string = payload_string.rstrip('&')\n        \n        # Append passphrase if provided\n        if passphrase:\n            payload_string += f\"&passphrase={urllib.parse.quote_plus(passphrase.strip())}\"\n        \n        # Generate MD5 hash\n        signature = hashlib.md5(payload_string.encode()).hexdigest()\n        return signature\n    \n    @staticmethod\n    def generate_payment_form_data(user, plan, subscription=None):\n        \"\"\"\n        Generate PayFast payment form data for a subscription\n        \n        Args:\n            user: Django User object\n            plan: SubscriptionPlan object\n            subscription: UserSubscription object (optional)\n        \n        Returns:\n            Dictionary of payment form fields\n        \"\"\"\n        payment_data = {\n            'merchant_id': settings.PAYFAST_MERCHANT_ID,\n            'merchant_key': settings.PAYFAST_MERCHANT_KEY,\n            'return_url': f\"{settings.SITE_URL}{reverse('payment_success')}\",\n            'cancel_url': f\"{settings.SITE_URL}{reverse('payment_cancelled')}\",\n            'notify_url': f\"{settings.SITE_URL}{reverse('payfast_notify')}\",\n            \n            'name_first': user.first_name or user.username,\n            'name_last': user.last_name or '',\n            'email_address': user.email,\n            \n            'amount': str(plan.price),\n            'item_name': f'{plan.name} Subscription',\n            'item_description': plan.description,\n            \n            'custom_str1': str(user.id),\n            'custom_str2': str(plan.id),\n            'custom_str3': str(subscription.id) if subscription else '',\n            \n            'subscription_type': '1' if plan.price > 0 else '0',\n            'billing_date': '',\n            'recurring_amount': str(plan.price),\n            'frequency': '3',\n            'cycles': '0',\n        }\n        \n        # Remove empty fields BEFORE signature generation\n        # This ensures both our signature and PayFast's signature use the same fields\n        clean_data = {}\n        for key, value in payment_data.items():\n            # Only include fields with non-empty values\n            if str(value).strip():\n                clean_data[key] = str(value).strip()\n        \n        # Generate signature on clean data\n        clean_data['signature'] = PayFastService.generate_signature(clean_data)\n        \n        return clean_data\n    \n    @staticmethod\n    def validate_itn_signature(post_data):\n        \"\"\"\n        Validate PayFast ITN (Instant Transaction Notification) signature\n        \n        Args:\n            post_data: POST data from PayFast ITN request\n        \n        Returns:\n            Boolean indicating if signature is valid\n        \"\"\"\n        data_dict = {}\n        for key, value in post_data.items():\n            if key != 'signature':\n                if isinstance(value, list):\n                    data_dict[key] = value[0]\n                else:\n                    data_dict[key] = value\n        \n        received_signature = post_data.get('signature', [''])[0] if isinstance(post_data.get('signature'), list) else post_data.get('signature', '')\n        \n        calculated_signature = PayFastService.generate_signature(data_dict)\n        \n        return received_signature == calculated_signature\n    \n    @staticmethod\n    def verify_payment_with_payfast(post_data):\n        \"\"\"\n        Verify payment notification with PayFast servers (server-to-server validation)\n        This is CRITICAL for security to prevent spoofed payment notifications\n        \n        Args:\n            post_data: POST data from PayFast ITN request\n        \n        Returns:\n            Boolean indicating if payment is valid\n        \"\"\"\n        try:\n            param_string = urllib.parse.urlencode(post_data)\n            \n            response = requests.post(\n                settings.PAYFAST_VALIDATE_URL,\n                data=param_string,\n                headers={'Content-Type': 'application/x-www-form-urlencoded'},\n                timeout=10\n            )\n            \n            if response.status_code == 200 and response.text == 'VALID':\n                logger.info('PayFast server validation: VALID')\n                return True\n            else:\n                logger.error(f'PayFast server validation failed: {response.status_code} - {response.text}')\n                return False\n                \n        except requests.RequestException as e:\n            logger.error(f'Error connecting to PayFast validation server: {str(e)}')\n            return False\n    \n    @staticmethod\n    def validate_payment_amount(post_data, expected_amount):\n        \"\"\"\n        Validate that the payment amount matches the expected amount\n        \n        Args:\n            post_data: POST data from PayFast\n            expected_amount: Expected payment amount\n        \n        Returns:\n            Boolean indicating if amounts match\n        \"\"\"\n        try:\n            received_amount = float(post_data.get('amount_gross', 0))\n            expected_amount = float(expected_amount)\n            \n            return abs(received_amount - expected_amount) < 0.01\n        except (ValueError, TypeError):\n            return False\n    \n    @staticmethod\n    def validate_merchant_id(post_data):\n        \"\"\"\n        Validate that the merchant ID matches our configuration\n        \n        Args:\n            post_data: POST data from PayFast\n        \n        Returns:\n            Boolean indicating if merchant ID is valid\n        \"\"\"\n        received_merchant_id = post_data.get('merchant_id', '')\n        return received_merchant_id == settings.PAYFAST_MERCHANT_ID\n    \n    @staticmethod\n    def get_payfast_url():\n        \"\"\"Get the appropriate PayFast payment URL (sandbox or production)\"\"\"\n        return settings.PAYFAST_URL\n","path":null,"size_bytes":8471,"size_tokens":null},"core/management/commands/__init__.py":{"content":"# Management commands","path":null,"size_bytes":21,"size_tokens":null},"core/migrations/0009_passwordresettoken.py":{"content":"# Generated by Django 5.0.2 on 2025-10-21 23:28\n\nimport django.db.models.deletion\nfrom django.conf import settings\nfrom django.db import migrations, models\n\n\nclass Migration(migrations.Migration):\n\n    dependencies = [\n        ('core', '0008_userprofile_bio_userprofile_email_notifications_and_more'),\n        migrations.swappable_dependency(settings.AUTH_USER_MODEL),\n    ]\n\n    operations = [\n        migrations.CreateModel(\n            name='PasswordResetToken',\n            fields=[\n                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),\n                ('token', models.CharField(max_length=100, unique=True)),\n                ('created_at', models.DateTimeField(auto_now_add=True)),\n                ('expires_at', models.DateTimeField()),\n                ('used', models.BooleanField(default=False)),\n                ('user', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, to=settings.AUTH_USER_MODEL)),\n            ],\n        ),\n    ]\n","path":null,"size_bytes":1021,"size_tokens":null},"pyproject.toml":{"content":"[tool.poetry]\nauthors = [\"Your Name <you@example.com>\"]\ndescription = \"\"\nname = \"django-template\"\nversion = \"0.1.0\"\n[tool.poetry.dependencies]\nDjango = \"5.0.2\"\npython = \"^3.10\"\nstreamlit = \"^1.49.1\"\npsycopg2-binary = \"^2.9.10\"\npython-docx = \"^1.2.0\"\nreportlab = \"^4.4.4\"\nstripe = \"^12.5.1\"\npypdf2 = \"^3.0.1\"\npython-dotenv = \"^1.1.1\"\npillow = \"^11.3.0\"\nrequests = \"^2.32.5\"\nopenai = \"^1.108.1\"\ndjangorestframework = \"3.14.0\"\ndjango-cors-headers = \"4.3.1\"\ndjango-filter = \"23.5\"\ndrf-yasg = \"^1.21.11\"\ndjango-allauth = \"^65.13.1\"\npyjwt = \"^2.10.1\"\ncryptography = \"^46.0.3\"\nwhitenoise = \"^6.11.0\"\ndjango-compressor = \"^4.6.0\"\n[tool.poetry.dev-dependencies]\n\n[tool.pyright]\n# https://github.com/microsoft/pyright/blob/main/docs/configuration.md\nuseLibraryCodeForTypes = true\nexclude = [\".cache\"]\n\n[tool.ruff]\n# https://beta.ruff.rs/docs/configuration/\nselect = ['E', 'W', 'F', 'I', 'B', 'C4', 'ARG', 'SIM']\nignore = ['W291', 'W292', 'W293']\n\n[build-system]\nrequires = [\"poetry-core>=1.0.0\"]\nbuild-backend = \"poetry.core.masonry.api\"","path":null,"size_bytes":1027,"size_tokens":null},"core/__init__.py":{"content":"# Django core app","path":null,"size_bytes":17,"size_tokens":null},"django_project/urls.py":{"content":"\"\"\"\nURL configuration for django_project project.\n\nThe `urlpatterns` list routes URLs to views. For more information please see:\n    https://docs.djangoproject.com/en/5.0/topics/http/urls/\nExamples:\nFunction views\n    1. Add an import:  from my_app import views\n    2. Add a URL to urlpatterns:  path('', views.home, name='home')\nClass-based views\n    1. Add an import:  from other_app.views import Home\n    2. Add a URL to urlpatterns:  path('', Home.as_view(), name='home')\nIncluding another URLconf\n    1. Import the include() function: from django.urls import include, path\n    2. Add a URL to urlpatterns:  path('blog/', include('blog.urls'))\n\"\"\"\nfrom django.contrib import admin\nfrom django.urls import path, include\nfrom django.conf import settings\nfrom django.conf.urls.static import static\n\nurlpatterns = [\n    path('brilltech/signup/', include('core.admin_signup_urls')),\n    path('django-admin/', admin.site.urls),\n    path('accounts/', include('allauth.urls')),\n    path('api/', include('core.api_urls')),\n    path('student/', include('core.student_urls')),\n    path('', include('core.urls')),\n]\n\nif settings.DEBUG:\n    urlpatterns += static(settings.MEDIA_URL, document_root=settings.MEDIA_ROOT)\n","path":null,"size_bytes":1209,"size_tokens":null},"core/management/__init__.py":{"content":"# Management commands directory","path":null,"size_bytes":31,"size_tokens":null},"core/admin.py":{"content":"from django.contrib import admin\nfrom django.contrib.auth.admin import UserAdmin as BaseUserAdmin\nfrom django.contrib.auth.models import User\nfrom .models import (\n    Subject, Grade, ExamBoard, UserProfile, UploadedDocument, \n    GeneratedAssignment, UsageQuota, SubscriptionPlan, UserSubscription, PayFastPayment,\n    SubscribedSubject, PastPaper, Quiz, QuizResponse, ClassGroup, AssignmentShare,\n    StudentSubscriptionPricing, StudentSubscription, SupportEnquiry\n)\n\n# Unregister the default User admin\nadmin.site.unregister(User)\n\n# Define an inline admin descriptor for UserProfile model\nclass UserProfileInline(admin.StackedInline):\n    model = UserProfile\n    can_delete = False\n    verbose_name_plural = 'Profile'\n\n# Define a new User admin\nclass UserAdmin(BaseUserAdmin):\n    inlines = (UserProfileInline,)\n\n# Re-register UserAdmin\nadmin.site.register(User, UserAdmin)\n\n@admin.register(Subject)\nclass SubjectAdmin(admin.ModelAdmin):\n    list_display = ['name']\n    search_fields = ['name']\n    ordering = ['name']\n\n@admin.register(Grade)\nclass GradeAdmin(admin.ModelAdmin):\n    list_display = ['number']\n    ordering = ['number']\n\n@admin.register(ExamBoard)\nclass ExamBoardAdmin(admin.ModelAdmin):\n    list_display = ['name_full', 'abbreviation']\n    search_fields = ['name_full', 'abbreviation']\n    ordering = ['name_full']\n\n@admin.register(UploadedDocument)\nclass UploadedDocumentAdmin(admin.ModelAdmin):\n    list_display = ['title', 'subject', 'grade', 'board', 'type', 'uploaded_by', 'created_at']\n    list_filter = ['type', 'subject', 'grade', 'board', 'created_at']\n    search_fields = ['title', 'uploaded_by__username']\n    readonly_fields = ['created_at']\n    ordering = ['-created_at']\n    \n    fieldsets = (\n        ('Basic Information', {\n            'fields': ('title', 'uploaded_by', 'type')\n        }),\n        ('Academic Details', {\n            'fields': ('subject', 'grade', 'board')\n        }),\n        ('File Information', {\n            'fields': ('file', 'file_url')\n        }),\n        ('Additional Info', {\n            'fields': ('tags', 'created_at'),\n            'classes': ('collapse',)\n        })\n    )\n    \n    def get_queryset(self, request):\n        qs = super().get_queryset(request)\n        return qs.select_related('uploaded_by', 'subject', 'grade', 'board')\n\n@admin.register(GeneratedAssignment)\nclass GeneratedAssignmentAdmin(admin.ModelAdmin):\n    list_display = ['title', 'subject', 'grade', 'board', 'question_type', 'teacher', 'created_at']\n    list_filter = ['question_type', 'subject', 'grade', 'board', 'created_at']\n    search_fields = ['title', 'teacher__username']\n    readonly_fields = ['created_at', 'shared_link']\n    ordering = ['-created_at']\n    \n    fieldsets = (\n        ('Basic Information', {\n            'fields': ('title', 'teacher', 'question_type')\n        }),\n        ('Academic Details', {\n            'fields': ('subject', 'grade', 'board')\n        }),\n        ('Assignment Details', {\n            'fields': ('due_date', 'instructions', 'shared_link')\n        }),\n        ('Generated Content', {\n            'fields': ('content',),\n            'classes': ('collapse',)\n        }),\n        ('Additional Info', {\n            'fields': ('file_url', 'created_at'),\n            'classes': ('collapse',)\n        })\n    )\n    \n    def get_queryset(self, request):\n        qs = super().get_queryset(request)\n        return qs.select_related('teacher', 'subject', 'grade', 'board')\n\n@admin.register(UsageQuota)\nclass UsageQuotaAdmin(admin.ModelAdmin):\n    list_display = ['user', 'get_total_lesson_plans', 'get_total_assignments']\n    search_fields = ['user__username']\n    readonly_fields = ['lesson_plans_used', 'assignments_used']\n    \n    def get_total_lesson_plans(self, obj):\n        return sum(obj.lesson_plans_used.values()) if obj.lesson_plans_used else 0\n    get_total_lesson_plans.short_description = 'Total Lesson Plans'\n    \n    def get_total_assignments(self, obj):\n        return sum(obj.assignments_used.values()) if obj.assignments_used else 0\n    get_total_assignments.short_description = 'Total Assignments'\n\n@admin.register(SubscriptionPlan)\nclass SubscriptionPlanAdmin(admin.ModelAdmin):\n    list_display = ['name', 'plan_type', 'price', 'billing_period', 'can_use_ai', 'can_access_library', 'is_active']\n    list_filter = ['plan_type', 'is_active', 'can_use_ai', 'can_access_library']\n    search_fields = ['name', 'description']\n    ordering = ['price']\n    \n    fieldsets = (\n        ('Basic Information', {\n            'fields': ('name', 'plan_type', 'price', 'billing_period', 'description', 'is_active')\n        }),\n        ('Features', {\n            'fields': ('can_upload_documents', 'can_use_ai', 'can_access_library', 'allowed_subjects_count')\n        }),\n        ('Quotas', {\n            'fields': ('monthly_ai_generations',)\n        }),\n    )\n\n@admin.register(SubscribedSubject)\nclass SubscribedSubjectAdmin(admin.ModelAdmin):\n    list_display = ['user', 'subject', 'subscribed_at']\n    list_filter = ['subject']\n    search_fields = ['user__username', 'subject__name']\n    readonly_fields = ['subscribed_at']\n    ordering = ['-subscribed_at']\n\n@admin.register(UserSubscription)\nclass UserSubscriptionAdmin(admin.ModelAdmin):\n    list_display = ['user', 'plan', 'status', 'current_period_start', 'current_period_end']\n    list_filter = ['status', 'plan']\n    search_fields = ['user__username', 'user__email']\n    readonly_fields = ['started_at', 'created_at', 'updated_at']\n    ordering = ['-created_at']\n    \n    fieldsets = (\n        ('User & Plan', {\n            'fields': ('user', 'plan', 'status')\n        }),\n        ('Subscription Period', {\n            'fields': ('started_at', 'current_period_start', 'current_period_end', 'cancelled_at')\n        }),\n        ('Additional Info', {\n            'fields': ('payfast_token', 'created_at', 'updated_at')\n        }),\n    )\n    \n    def get_queryset(self, request):\n        qs = super().get_queryset(request)\n        return qs.select_related('user', 'plan')\n\n@admin.register(PayFastPayment)\nclass PayFastPaymentAdmin(admin.ModelAdmin):\n    list_display = ['payfast_payment_id', 'user', 'plan', 'amount_gross', 'status', 'created_at', 'completed_at']\n    list_filter = ['status', 'plan', 'created_at']\n    search_fields = ['payfast_payment_id', 'user__username', 'user__email']\n    readonly_fields = ['payfast_payment_id', 'created_at', 'completed_at', 'itn_data']\n    ordering = ['-created_at']\n    \n    fieldsets = (\n        ('Payment Details', {\n            'fields': ('user', 'subscription', 'plan', 'status', 'payment_status_text')\n        }),\n        ('PayFast Information', {\n            'fields': ('payfast_payment_id', 'merchant_id')\n        }),\n        ('Amounts', {\n            'fields': ('amount_gross', 'amount_fee', 'amount_net')\n        }),\n        ('Timestamps', {\n            'fields': ('created_at', 'completed_at')\n        }),\n        ('Raw Data', {\n            'fields': ('itn_data',),\n            'classes': ('collapse',)\n        }),\n    )\n    \n    def get_queryset(self, request):\n        qs = super().get_queryset(request)\n        return qs.select_related('user', 'plan', 'subscription')\n\n@admin.register(PastPaper)\nclass PastPaperAdmin(admin.ModelAdmin):\n    list_display = ['title', 'exam_board', 'subject', 'grade', 'paper_code', 'year', 'uploaded_at']\n    list_filter = ['exam_board', 'subject', 'grade', 'year', 'paper_type']\n    search_fields = ['title', 'paper_code', 'subject__name']\n    readonly_fields = ['uploaded_at']\n    ordering = ['-year', 'subject']\n    \n    fieldsets = (\n        ('Basic Information', {\n            'fields': ('title', 'exam_board', 'exam_board_custom', 'subject', 'grade')\n        }),\n        ('Paper Details', {\n            'fields': ('paper_type', 'paper_code', 'year')\n        }),\n        ('Organization', {\n            'fields': ('chapter', 'section')\n        }),\n        ('File & Upload Info', {\n            'fields': ('file', 'notes', 'uploaded_by', 'uploaded_at')\n        }),\n    )\n    \n    def get_queryset(self, request):\n        qs = super().get_queryset(request)\n        return qs.select_related('subject', 'grade', 'uploaded_by')\n\n@admin.register(Quiz)\nclass QuizAdmin(admin.ModelAdmin):\n    list_display = ['title', 'subject', 'grade', 'exam_board', 'difficulty_level', 'is_premium', 'is_ai_generated', 'times_used', 'is_active']\n    list_filter = ['exam_board', 'subject', 'grade', 'difficulty_level', 'is_premium', 'is_ai_generated', 'is_active']\n    search_fields = ['title', 'topic', 'subject__name']\n    readonly_fields = ['times_used', 'created_at', 'updated_at']\n    ordering = ['-created_at']\n    \n    fieldsets = (\n        ('Basic Information', {\n            'fields': ('title', 'subject', 'grade', 'exam_board')\n        }),\n        ('Content Organization', {\n            'fields': ('topic', 'chapter', 'section')\n        }),\n        ('Quiz Settings', {\n            'fields': ('google_form_link', 'is_premium', 'is_ai_generated', 'difficulty_level', 'is_active')\n        }),\n        ('Source & Analytics', {\n            'fields': ('created_from_paper', 'times_used')\n        }),\n        ('Timestamps', {\n            'fields': ('created_by', 'created_at', 'updated_at'),\n            'classes': ('collapse',)\n        }),\n    )\n    \n    def get_queryset(self, request):\n        qs = super().get_queryset(request)\n        return qs.select_related('subject', 'grade', 'created_from_paper', 'created_by')\n\n@admin.register(QuizResponse)\nclass QuizResponseAdmin(admin.ModelAdmin):\n    list_display = ['student_name', 'quiz', 'teacher_code', 'score', 'submitted_at']\n    list_filter = ['quiz', 'teacher', 'submitted_at']\n    search_fields = ['student_name', 'teacher_code', 'quiz__title']\n    readonly_fields = ['submitted_at']\n    ordering = ['-submitted_at']\n    \n    fieldsets = (\n        ('Student & Quiz', {\n            'fields': ('student_name', 'quiz', 'teacher', 'teacher_code')\n        }),\n        ('Response Data', {\n            'fields': ('score', 'answers_json', 'submitted_at')\n        }),\n    )\n    \n    def get_queryset(self, request):\n        qs = super().get_queryset(request)\n        return qs.select_related('quiz', 'teacher')\n\n@admin.register(ClassGroup)\nclass ClassGroupAdmin(admin.ModelAdmin):\n    list_display = ['name', 'teacher', 'subject', 'grade', 'is_active', 'created_at']\n    list_filter = ['subject', 'grade', 'is_active']\n    search_fields = ['name', 'teacher__username', 'description']\n    readonly_fields = ['created_at']\n    ordering = ['teacher', 'name']\n\n@admin.register(AssignmentShare)\nclass AssignmentShareAdmin(admin.ModelAdmin):\n    list_display = ['assignment_title', 'class_group', 'teacher', 'shared_at', 'is_active']\n    list_filter = ['shared_at']\n    search_fields = ['teacher__username', 'class_group__name']\n    readonly_fields = ['token', 'shared_at', 'last_accessed', 'view_count']\n    ordering = ['-shared_at']\n\n@admin.register(StudentSubscriptionPricing)\nclass StudentSubscriptionPricingAdmin(admin.ModelAdmin):\n    list_display = ['per_subject_price', 'multi_subject_price', 'all_access_price', 'tutor_addon_price', 'is_active', 'updated_at']\n    fieldsets = (\n        ('Per-Subject Pricing (1-3 subjects)', {\n            'fields': ('per_subject_price', 'per_subject_max'),\n            'description': 'Students pay this amount for each subject they select (1-3 subjects)'\n        }),\n        ('Multi-Subject Pricing (4-5 subjects)', {\n            'fields': ('multi_subject_price', 'multi_subject_min', 'multi_subject_max'),\n            'description': 'Flat rate for students selecting 4-5 subjects'\n        }),\n        ('All Access Pricing', {\n            'fields': ('all_access_price',),\n            'description': 'Flat rate for unlimited subject access'\n        }),\n        ('Tutor Add-on', {\n            'fields': ('tutor_addon_price',),\n            'description': 'Additional fee for tutor email support'\n        }),\n        ('Status', {\n            'fields': ('is_active',)\n        }),\n    )\n\n@admin.register(StudentSubscription)\nclass StudentSubscriptionAdmin(admin.ModelAdmin):\n    list_display = ['student', 'plan', 'status', 'has_tutor_support', 'subjects_count', 'amount_paid', 'expires_at']\n    list_filter = ['plan', 'status', 'has_tutor_support']\n    search_fields = ['student__user__username', 'student__user__email']\n    readonly_fields = ['created_at', 'updated_at']\n    ordering = ['-created_at']\n\n@admin.register(SupportEnquiry)\nclass SupportEnquiryAdmin(admin.ModelAdmin):\n    list_display = ['subject', 'student', 'enquiry_type', 'priority', 'status', 'created_at', 'responded_at']\n    list_filter = ['enquiry_type', 'priority', 'status', 'created_at']\n    search_fields = ['subject', 'message', 'student__user__username']\n    readonly_fields = ['created_at', 'updated_at']\n    ordering = ['-created_at']\n    \n    fieldsets = (\n        ('Enquiry Details', {\n            'fields': ('student', 'enquiry_type', 'subject', 'message', 'priority', 'status')\n        }),\n        ('Related Content', {\n            'fields': ('related_subject', 'related_topic'),\n            'classes': ('collapse',)\n        }),\n        ('Response', {\n            'fields': ('response', 'responded_by', 'responded_at')\n        }),\n        ('Timestamps', {\n            'fields': ('created_at', 'updated_at'),\n            'classes': ('collapse',)\n        }),\n    )\n\n# Customize admin site\nadmin.site.site_header = \"EduTech Platform Admin\"\nadmin.site.site_title = \"EduTech Admin\"\nadmin.site.index_title = \"Welcome to EduTech Administration\"","path":null,"size_bytes":13501,"size_tokens":null},"core/migrations/0005_classgroup_assignmentshare_and_more.py":{"content":"# Generated by Django 5.0.2 on 2025-09-22 23:02\n\nimport core.models\nimport django.db.models.deletion\nfrom django.conf import settings\nfrom django.db import migrations, models\n\n\nclass Migration(migrations.Migration):\n\n    dependencies = [\n        ('core', '0004_userprofile_email_verified_and_more'),\n        migrations.swappable_dependency(settings.AUTH_USER_MODEL),\n    ]\n\n    operations = [\n        migrations.CreateModel(\n            name='ClassGroup',\n            fields=[\n                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),\n                ('name', models.CharField(max_length=100)),\n                ('description', models.TextField(blank=True)),\n                ('created_at', models.DateTimeField(auto_now_add=True)),\n                ('is_active', models.BooleanField(default=True)),\n                ('grade', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, to='core.grade')),\n                ('subject', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, to='core.subject')),\n                ('teacher', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, to=settings.AUTH_USER_MODEL)),\n            ],\n            options={\n                'unique_together': {('teacher', 'name')},\n            },\n        ),\n        migrations.CreateModel(\n            name='AssignmentShare',\n            fields=[\n                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),\n                ('token', models.CharField(default=core.models.generate_share_token, max_length=32, unique=True)),\n                ('shared_at', models.DateTimeField(auto_now_add=True)),\n                ('due_date', models.DateTimeField(blank=True, null=True)),\n                ('expires_at', models.DateTimeField(blank=True, null=True)),\n                ('revoked_at', models.DateTimeField(blank=True, null=True)),\n                ('view_count', models.IntegerField(default=0)),\n                ('last_accessed', models.DateTimeField(blank=True, null=True)),\n                ('notes', models.TextField(blank=True)),\n                ('generated_assignment', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.CASCADE, to='core.generatedassignment')),\n                ('teacher', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, to=settings.AUTH_USER_MODEL)),\n                ('uploaded_document', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.CASCADE, to='core.uploadeddocument')),\n                ('class_group', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, to='core.classgroup')),\n            ],\n        ),\n        migrations.AddConstraint(\n            model_name='assignmentshare',\n            constraint=models.CheckConstraint(check=models.Q(models.Q(('generated_assignment__isnull', False), ('uploaded_document__isnull', True)), models.Q(('generated_assignment__isnull', True), ('uploaded_document__isnull', False)), _connector='OR'), name='exactly_one_assignment_type'),\n        ),\n    ]\n","path":null,"size_bytes":3158,"size_tokens":null},"django_project/core/views.py":{"content":"from django.shortcuts import render\n\n# Create your views here.\n","path":null,"size_bytes":63,"size_tokens":null},"django_project/__init__.py":{"content":"","path":null,"size_bytes":0,"size_tokens":null},"core/openai_service.py":{"content":"# OpenAI Integration - Follows blueprint:python_openai pattern\n# the newest OpenAI model is \"gpt-5\" which was released August 7, 2025.\n# do not change this unless explicitly requested by the user\n\nimport os\nimport json\nfrom openai import OpenAI\n\nOPENAI_API_KEY = os.environ.get(\"OPENAI_API_KEY\")\nopenai_client = OpenAI(api_key=OPENAI_API_KEY)\n\ndef generate_lesson_plan(subject, grade, board, topic, duration=\"60 minutes\", model=\"gpt-3.5-turbo\"):\n    \"\"\"Generate a detailed lesson plan using AI\n    \n    Args:\n        subject: Subject name\n        grade: Grade level\n        board: Exam board\n        topic: Topic to teach\n        duration: Lesson duration\n        model: AI model to use (gpt-3.5-turbo for Growth, gpt-4 for Premium)\n    \"\"\"\n    prompt = f\"\"\"Create a detailed lesson plan for:\n    Subject: {subject}\n    Grade: {grade}\n    Exam Board: {board}\n    Topic: {topic}\n    Duration: {duration}\n    \n    Please provide a comprehensive lesson plan in JSON format with the following structure:\n    {{\n        \"title\": \"lesson title\",\n        \"objectives\": [\"objective 1\", \"objective 2\"],\n        \"materials\": [\"material 1\", \"material 2\"],\n        \"activities\": [\n            {{\n                \"name\": \"activity name\",\n                \"duration\": \"time in minutes\",\n                \"description\": \"detailed description\"\n            }}\n        ],\n        \"assessment\": \"assessment method\",\n        \"homework\": \"homework assignment\"\n    }}\"\"\"\n    \n    try:\n        response = openai_client.chat.completions.create(\n            model=model,\n            messages=[\n                {\"role\": \"system\", \"content\": \"You are an expert teacher creating educational content. Respond only with valid JSON.\"},\n                {\"role\": \"user\", \"content\": prompt}\n            ],\n            response_format={\"type\": \"json_object\"}\n        )\n        content = response.choices[0].message.content\n        if content:\n            return json.loads(content)\n        else:\n            raise Exception(\"Empty response from OpenAI\")\n    except Exception as e:\n        raise Exception(f\"Failed to generate lesson plan: {e}\")\n\ndef generate_homework(subject, grade, board, topic, question_type, num_questions=5, model=\"gpt-3.5-turbo\"):\n    \"\"\"Generate homework questions using AI\n    \n    Args:\n        model: AI model to use (gpt-3.5-turbo for Growth, gpt-4 for Premium)\n    \"\"\"\n    prompt = f\"\"\"Create homework questions for:\n    Subject: {subject}\n    Grade: {grade}\n    Exam Board: {board}\n    Topic: {topic}\n    Question Type: {question_type}\n    Number of Questions: {num_questions}\n    \n    Please provide questions in JSON format with the following structure:\n    {{\n        \"title\": \"homework title\",\n        \"instructions\": \"general instructions\",\n        \"questions\": [\n            {{\n                \"question_number\": 1,\n                \"question_text\": \"question content\",\n                \"marks\": \"number of marks\",\n                \"answer_guidance\": \"marking scheme or answer guidance\"\n            }}\n        ],\n        \"total_marks\": \"total marks for all questions\"\n    }}\"\"\"\n    \n    try:\n        response = openai_client.chat.completions.create(\n            model=model,\n            messages=[\n                {\"role\": \"system\", \"content\": \"You are an expert teacher creating educational assessments. Respond only with valid JSON.\"},\n                {\"role\": \"user\", \"content\": prompt}\n            ],\n            response_format={\"type\": \"json_object\"}\n        )\n        content = response.choices[0].message.content\n        if content:\n            return json.loads(content)\n        else:\n            raise Exception(\"Empty response from OpenAI\")\n    except Exception as e:\n        raise Exception(f\"Failed to generate homework: {e}\")\n\ndef generate_questions(subject, grade, board, topic, question_type, difficulty=\"medium\", model=\"gpt-3.5-turbo\"):\n    \"\"\"Generate practice questions using AI\n    \n    Args:\n        model: AI model to use (gpt-3.5-turbo for Growth, gpt-4 for Premium)\n    \"\"\"\n    prompt = f\"\"\"Create practice questions for:\n    Subject: {subject}\n    Grade: {grade}\n    Exam Board: {board}\n    Topic: {topic}\n    Question Type: {question_type}\n    Difficulty: {difficulty}\n    \n    Please provide questions in JSON format with the following structure:\n    {{\n        \"title\": \"question set title\",\n        \"difficulty\": \"{difficulty}\",\n        \"questions\": [\n            {{\n                \"question_number\": 1,\n                \"question_text\": \"question content\",\n                \"options\": [\"A) option\", \"B) option\", \"C) option\", \"D) option\"],\n                \"correct_answer\": \"A\",\n                \"explanation\": \"explanation of correct answer\"\n            }}\n        ]\n    }}\"\"\"\n    \n    try:\n        response = openai_client.chat.completions.create(\n            model=model,\n            messages=[\n                {\"role\": \"system\", \"content\": \"You are an expert teacher creating educational assessments. Respond only with valid JSON.\"},\n                {\"role\": \"user\", \"content\": prompt}\n            ],\n            response_format={\"type\": \"json_object\"}\n        )\n        content = response.choices[0].message.content\n        if content:\n            return json.loads(content)\n        else:\n            raise Exception(\"Empty response from OpenAI\")\n    except Exception as e:\n        raise Exception(f\"Failed to generate questions: {e}\")\n\ndef extract_questions_from_paper(file_path, subject, grade, exam_board, paper_type, model=\"gpt-4\"):\n    \"\"\"Extract questions and generate memo from uploaded exam paper using AI with image support\n    \n    Args:\n        file_path: Path to the uploaded exam paper (PDF)\n        subject: Subject name\n        grade: Grade level  \n        exam_board: Exam board name\n        paper_type: Type of paper (paper1, paper2, etc)\n        model: AI model to use (default gpt-4 for best quality)\n        \n    Returns:\n        dict with:\n            - questions_json: Structured questions with marks, images noted\n            - memo_json: Complete marking scheme/answers\n            - total_questions: Number of questions extracted\n            - total_marks: Total marks for the paper\n            - question_type: Detected question type (mcq, structured, mixed)\n    \"\"\"\n    prompt = f\"\"\"You are an expert examiner analyzing a {exam_board} {subject} Grade {grade} exam paper ({paper_type}).\n\nExtract ALL questions from this exam paper and create a comprehensive marking memo.\n\nFor each question, identify:\n1. Question number and sub-parts (e.g., 1, 1.1, 1.2, 1.2.a)\n2. Complete question text\n3. Marks allocated\n4. Any diagrams/images (note their presence and description)\n5. Question type (MCQ, structured, free response, calculation, etc.)\n\nFor the memo, provide:\n1. Complete answers/model responses\n2. Marking criteria and rubrics\n3. Common mistakes to watch for\n4. Mark allocation breakdown\n\nReturn ONLY valid JSON in this EXACT structure:\n{{\n    \"paper_info\": {{\n        \"subject\": \"{subject}\",\n        \"grade\": \"{grade}\",\n        \"exam_board\": \"{exam_board}\",\n        \"total_marks\": 100\n    }},\n    \"questions\": [\n        {{\n            \"question_number\": \"1\",\n            \"question_text\": \"Full question text here\",\n            \"marks\": 5,\n            \"question_type\": \"structured\",\n            \"has_diagram\": false,\n            \"diagram_description\": \"\",\n            \"sub_questions\": [\n                {{\n                    \"sub_number\": \"1.1\",\n                    \"sub_text\": \"Sub-question text\",\n                    \"marks\": 2,\n                    \"has_diagram\": false\n                }}\n            ]\n        }}\n    ],\n    \"memo\": [\n        {{\n            \"question_number\": \"1\",\n            \"answer\": \"Complete answer or marking scheme\",\n            \"marking_points\": [\"Point 1 (1 mark)\", \"Point 2 (1 mark)\"],\n            \"common_mistakes\": [\"Mistake to watch for\"],\n            \"sub_answers\": [\n                {{\n                    \"sub_number\": \"1.1\",\n                    \"answer\": \"Answer for sub-question\",\n                    \"marking_points\": [\"Point 1 (1 mark)\"]\n                }}\n            ]\n        }}\n    ],\n    \"question_type_summary\": \"mixed\",\n    \"total_questions\": 5,\n    \"total_marks\": 100\n}}\n\nNOTE: For diagrams/images, set has_diagram: true and provide a text description in diagram_description. We'll handle image extraction separately.\"\"\"\n    \n    try:\n        import PyPDF2\n        \n        # Extract text from PDF\n        pdf_text = \"\"\n        with open(file_path, 'rb') as file:\n            pdf_reader = PyPDF2.PdfReader(file)\n            for page in pdf_reader.pages:\n                pdf_text += page.extract_text() + \"\\n\\n\"\n        \n        # Call OpenAI with extracted text\n        response = openai_client.chat.completions.create(\n            model=model,\n            messages=[\n                {\"role\": \"system\", \"content\": \"You are an expert examiner who extracts questions and creates marking memos from exam papers. Respond only with valid JSON.\"},\n                {\"role\": \"user\", \"content\": f\"{prompt}\\n\\nEXAM PAPER TEXT:\\n\\n{pdf_text[:8000]}\"}  # Limit to avoid token limits\n            ],\n            response_format={\"type\": \"json_object\"},\n            temperature=0.3\n        )\n        \n        content = response.choices[0].message.content\n        if content:\n            result = json.loads(content)\n            \n            # Ensure we have the required fields\n            return {\n                'questions_json': {\n                    'paper_info': result.get('paper_info', {}),\n                    'questions': result.get('questions', [])\n                },\n                'memo_json': {\n                    'memo': result.get('memo', [])\n                },\n                'total_questions': result.get('total_questions', len(result.get('questions', []))),\n                'total_marks': result.get('total_marks', result.get('paper_info', {}).get('total_marks', 0)),\n                'question_type': result.get('question_type_summary', 'mixed'),\n                'ai_model_used': model\n            }\n        else:\n            raise Exception(\"Empty response from OpenAI\")\n            \n    except PyPDF2.errors.PdfReadError as e:\n        raise Exception(f\"Failed to read PDF file: {e}\")\n    except Exception as e:\n        raise Exception(f\"Failed to extract questions from paper: {e}\")\n","path":null,"size_bytes":10296,"size_tokens":null},"core/migrations/0002_generatedassignment_instructions_and_more.py":{"content":"# Generated by Django 5.0.2 on 2025-09-21 23:07\n\nfrom django.db import migrations, models\n\n\nclass Migration(migrations.Migration):\n\n    dependencies = [\n        ('core', '0001_initial'),\n    ]\n\n    operations = [\n        migrations.AddField(\n            model_name='generatedassignment',\n            name='instructions',\n            field=models.TextField(blank=True),\n        ),\n        migrations.AddField(\n            model_name='uploadeddocument',\n            name='file',\n            field=models.FileField(blank=True, null=True, upload_to='documents/%Y/%m/'),\n        ),\n        migrations.AlterField(\n            model_name='uploadeddocument',\n            name='file_url',\n            field=models.URLField(blank=True),\n        ),\n    ]\n","path":null,"size_bytes":744,"size_tokens":null},"core/subscription_utils.py":{"content":"from functools import wraps\nfrom django.shortcuts import redirect\nfrom django.contrib import messages\nfrom .models import UserSubscription, SubscriptionPlan\n\ndef get_user_subscription(user):\n    \"\"\"Get or create user subscription\"\"\"\n    try:\n        return UserSubscription.objects.select_related('plan').get(user=user)\n    except UserSubscription.DoesNotExist:\n        from django.utils import timezone\n        from datetime import timedelta\n        free_plan = SubscriptionPlan.objects.get(plan_type='free')\n        return UserSubscription.objects.create(\n            user=user,\n            plan=free_plan,\n            status='active',\n            current_period_start=timezone.now(),\n            current_period_end=timezone.now() + timedelta(days=365)\n        )\n\ndef user_has_feature(user, feature):\n    \"\"\"Check if user's subscription has a specific feature\"\"\"\n    subscription = get_user_subscription(user)\n    \n    if not subscription.is_active:\n        return False\n    \n    feature_map = {\n        'upload_documents': subscription.plan.can_upload_documents,\n        'use_ai': subscription.plan.can_use_ai,\n        'access_library': subscription.plan.can_access_library,\n    }\n    \n    return feature_map.get(feature, False)\n\ndef require_subscription_feature(feature, redirect_to='subscription_dashboard'):\n    \"\"\"\n    Decorator to require a specific subscription feature\n    \n    Usage:\n        @require_subscription_feature('use_ai')\n        def my_ai_view(request):\n            ...\n    \"\"\"\n    def decorator(view_func):\n        @wraps(view_func)\n        def wrapper(request, *args, **kwargs):\n            if not user_has_feature(request.user, feature):\n                subscription = get_user_subscription(request.user)\n                messages.error(\n                    request,\n                    f'This feature requires an upgraded subscription. '\n                    f'Your current plan: {subscription.plan.name}'\n                )\n                return redirect(redirect_to)\n            return view_func(request, *args, **kwargs)\n        return wrapper\n    return decorator\n\ndef require_premium(view_func):\n    \"\"\"Shortcut decorator to require Premium subscription\"\"\"\n    return require_subscription_feature('use_ai')(view_func)\n","path":null,"size_bytes":2247,"size_tokens":null},"core/migrations/__init__.py":{"content":"","path":null,"size_bytes":0,"size_tokens":null},"django_project/wsgi.py":{"content":"\"\"\"\nWSGI config for django_project project.\n\nIt exposes the WSGI callable as a module-level variable named ``application``.\n\nFor more information on this file, see\nhttps://docs.djangoproject.com/en/5.0/howto/deployment/wsgi/\n\"\"\"\n\nimport os\n\nfrom django.core.wsgi import get_wsgi_application\n\nos.environ.setdefault('DJANGO_SETTINGS_MODULE', 'django_project.settings')\n\napplication = get_wsgi_application()\n","path":null,"size_bytes":405,"size_tokens":null},"django_project/asgi.py":{"content":"\"\"\"\nASGI config for django_project project.\n\nIt exposes the ASGI callable as a module-level variable named ``application``.\n\nFor more information on this file, see\nhttps://docs.djangoproject.com/en/5.0/howto/deployment/asgi/\n\"\"\"\n\nimport os\n\nfrom django.core.asgi import get_asgi_application\n\nos.environ.setdefault('DJANGO_SETTINGS_MODULE', 'django_project.settings')\n\napplication = get_asgi_application()\n","path":null,"size_bytes":405,"size_tokens":null},"core/migrations/0004_userprofile_email_verified_and_more.py":{"content":"# Generated by Django 5.0.2 on 2025-09-22 21:40\n\nfrom django.db import migrations, models\n\n\nclass Migration(migrations.Migration):\n\n    dependencies = [\n        ('core', '0003_uploadeddocument_ai_content'),\n    ]\n\n    operations = [\n        migrations.AddField(\n            model_name='userprofile',\n            name='email_verified',\n            field=models.BooleanField(default=False),\n        ),\n        migrations.AddField(\n            model_name='userprofile',\n            name='verification_token',\n            field=models.CharField(blank=True, max_length=100),\n        ),\n        migrations.AddField(\n            model_name='userprofile',\n            name='verification_token_created',\n            field=models.DateTimeField(blank=True, null=True),\n        ),\n    ]\n","path":null,"size_bytes":775,"size_tokens":null},"django_project/core/tests.py":{"content":"from django.test import TestCase\n\n# Create your tests here.\n","path":null,"size_bytes":60,"size_tokens":null},"core/management/commands/seed_plans.py":{"content":"from django.core.management.base import BaseCommand\nfrom core.models import SubscriptionPlan\n\nclass Command(BaseCommand):\n    help = 'Creates the 4 subscription plan tiers for the platform'\n\n    def handle(self, *args, **kwargs):\n        plans = [\n            {\n                'name': 'Free',\n                'plan_type': 'free',\n                'price': 0,\n                'billing_period': 'monthly',\n                'can_upload_documents': True,\n                'can_use_ai': False,\n                'can_access_library': False,\n                'allowed_subjects_count': 0,\n                'monthly_ai_generations': 0,\n                'description': 'Basic document uploads and viewing capabilities'\n            },\n            {\n                'name': 'Starter',\n                'plan_type': 'starter',\n                'price': 50,\n                'billing_period': 'monthly',\n                'can_upload_documents': True,\n                'can_use_ai': False,\n                'can_access_library': False,\n                'allowed_subjects_count': 0,\n                'monthly_ai_generations': 0,\n                'description': 'Document management only - perfect for organized teachers who bring their own content'\n            },\n            {\n                'name': 'Growth',\n                'plan_type': 'growth',\n                'price': 100,\n                'billing_period': 'monthly',\n                'can_upload_documents': True,\n                'can_use_ai': False,\n                'can_access_library': True,\n                'allowed_subjects_count': 1,\n                'monthly_ai_generations': 0,\n                'description': 'Access pre-generated worksheets and lesson plans for 1 subject of your choice'\n            },\n            {\n                'name': 'Premium',\n                'plan_type': 'premium',\n                'price': 250,\n                'billing_period': 'monthly',\n                'can_upload_documents': True,\n                'can_use_ai': True,\n                'can_access_library': True,\n                'allowed_subjects_count': 0,\n                'monthly_ai_generations': 0,\n                'description': 'Full AI-powered content generation for all subjects with unlimited generations'\n            },\n        ]\n\n        created_count = 0\n        updated_count = 0\n\n        for plan_data in plans:\n            plan, created = SubscriptionPlan.objects.update_or_create(\n                plan_type=plan_data['plan_type'],\n                defaults=plan_data\n            )\n            if created:\n                created_count += 1\n                self.stdout.write(self.style.SUCCESS(f'‚úì Created plan: {plan.name} (R{plan.price}/month)'))\n            else:\n                updated_count += 1\n                self.stdout.write(self.style.WARNING(f'‚Üª Updated plan: {plan.name} (R{plan.price}/month)'))\n\n        self.stdout.write(self.style.SUCCESS(f'\\nTotal: {created_count} created, {updated_count} updated'))\n","path":null,"size_bytes":2952,"size_tokens":null},"core/migrations/0006_assignmentshare_unique_active_generated_share_and_more.py":{"content":"# Generated by Django 5.0.2 on 2025-09-22 23:03\n\nfrom django.conf import settings\nfrom django.db import migrations, models\n\n\nclass Migration(migrations.Migration):\n\n    dependencies = [\n        ('core', '0005_classgroup_assignmentshare_and_more'),\n        migrations.swappable_dependency(settings.AUTH_USER_MODEL),\n    ]\n\n    operations = [\n        migrations.AddConstraint(\n            model_name='assignmentshare',\n            constraint=models.UniqueConstraint(condition=models.Q(('generated_assignment__isnull', False), ('revoked_at__isnull', True)), fields=('class_group', 'generated_assignment'), name='unique_active_generated_share'),\n        ),\n        migrations.AddConstraint(\n            model_name='assignmentshare',\n            constraint=models.UniqueConstraint(condition=models.Q(('revoked_at__isnull', True), ('uploaded_document__isnull', False)), fields=('class_group', 'uploaded_document'), name='unique_active_uploaded_share'),\n        ),\n    ]\n","path":null,"size_bytes":964,"size_tokens":null},"core/management/commands/setup_subscription_system.py":{"content":"from django.core.management.base import BaseCommand\nfrom django.contrib.auth.models import User\nfrom core.models import UserProfile, SubscriptionPlan\nimport random\nimport string\n\nclass Command(BaseCommand):\n    help = 'Generate teacher codes and update subscription plans with new pricing'\n\n    def handle(self, *args, **kwargs):\n        self.stdout.write('Setting up subscription system...\\n')\n        \n        # Generate teacher codes for existing users\n        self.stdout.write('Generating teacher codes for existing users...')\n        profiles_updated = 0\n        for profile in UserProfile.objects.filter(teacher_code__isnull=True):\n            # Generate a unique 6-character code\n            while True:\n                code = ''.join(random.choices(string.ascii_uppercase + string.digits, k=6))\n                if not UserProfile.objects.filter(teacher_code=code).exists():\n                    profile.teacher_code = code\n                    profile.save()\n                    profiles_updated += 1\n                    break\n        \n        self.stdout.write(self.style.SUCCESS(f'‚úì Generated teacher codes for {profiles_updated} users'))\n        \n        # Update subscription plans with new pricing\n        self.stdout.write('\\nUpdating subscription plans...')\n        \n        # Free Plan\n        free_plan, created = SubscriptionPlan.objects.update_or_create(\n            plan_type='free',\n            defaults={\n                'name': 'Free',\n                'price': 0.00,\n                'billing_period': 'monthly',\n                'can_upload_documents': True,\n                'can_use_ai': False,\n                'can_access_library': True,\n                'allowed_subjects_count': 1,\n                'monthly_ai_generations': 0,\n                'description': '1 subject, 2 lesson plans/month, 10 library quizzes. No AI features.',\n                'is_active': True,\n            }\n        )\n        self.stdout.write(f\"  {'Created' if created else 'Updated'} Free plan (R0)\")\n        \n        # Starter Plan\n        starter_plan, created = SubscriptionPlan.objects.update_or_create(\n            plan_type='starter',\n            defaults={\n                'name': 'Starter',\n                'price': 50.00,\n                'billing_period': 'monthly',\n                'can_upload_documents': True,\n                'can_use_ai': False,\n                'can_access_library': True,\n                'allowed_subjects_count': 1,\n                'monthly_ai_generations': 0,\n                'description': '1 subject, 10 lesson plans/month, all library quizzes. No AI features.',\n                'is_active': True,\n            }\n        )\n        self.stdout.write(f\"  {'Created' if created else 'Updated'} Starter plan (R50)\")\n        \n        # Growth Plan\n        growth_plan, created = SubscriptionPlan.objects.update_or_create(\n            plan_type='growth',\n            defaults={\n                'name': 'Growth',\n                'price': 100.00,\n                'billing_period': 'monthly',\n                'can_upload_documents': True,\n                'can_use_ai': True,\n                'can_access_library': True,\n                'allowed_subjects_count': 2,\n                'monthly_ai_generations': 40,  # 20 per subject\n                'description': '2 subjects, 20 lesson plans per subject/month, all library quizzes, basic AI (GPT-3.5).',\n                'is_active': True,\n            }\n        )\n        self.stdout.write(f\"  {'Created' if created else 'Updated'} Growth plan (R100)\")\n        \n        # Premium Plan\n        premium_plan, created = SubscriptionPlan.objects.update_or_create(\n            plan_type='premium',\n            defaults={\n                'name': 'Premium',\n                'price': 250.00,\n                'billing_period': 'monthly',\n                'can_upload_documents': True,\n                'can_use_ai': True,\n                'can_access_library': True,\n                'allowed_subjects_count': 3,\n                'monthly_ai_generations': 0,  # 0 = unlimited\n                'description': '3 subjects, unlimited lesson plans, all library quizzes, advanced AI (GPT-4).',\n                'is_active': True,\n            }\n        )\n        self.stdout.write(self.style.SUCCESS(f\"  {'Created' if created else 'Updated'} Premium plan (R250)\"))\n        \n        self.stdout.write(self.style.SUCCESS('\\n‚úì Subscription system setup complete!'))\n        self.stdout.write('\\nNext steps:')\n        self.stdout.write('  1. Users can now select their subjects during signup')\n        self.stdout.write('  2. Quotas are enforced per subject based on subscription tier')\n        self.stdout.write('  3. Teacher codes are ready for Google Forms integration')\n","path":null,"size_bytes":4719,"size_tokens":null},"core/migrations/0010_remove_usersubscription_selected_subject_and_more.py":{"content":"# Generated by Django 5.0.2 on 2025-10-22 02:10\n\nimport django.db.models.deletion\nfrom django.conf import settings\nfrom django.db import migrations, models\n\n\nclass Migration(migrations.Migration):\n\n    dependencies = [\n        ('core', '0009_passwordresettoken'),\n        migrations.swappable_dependency(settings.AUTH_USER_MODEL),\n    ]\n\n    operations = [\n        migrations.RemoveField(\n            model_name='usersubscription',\n            name='selected_subject',\n        ),\n        migrations.AddField(\n            model_name='usagequota',\n            name='last_reset',\n            field=models.DateTimeField(auto_now_add=True, null=True),\n        ),\n        migrations.AddField(\n            model_name='userprofile',\n            name='teacher_code',\n            field=models.CharField(blank=True, max_length=10, null=True, unique=True),\n        ),\n        migrations.AlterField(\n            model_name='userprofile',\n            name='subscription',\n            field=models.CharField(choices=[('free', 'Free'), ('starter', 'Starter'), ('growth', 'Growth'), ('premium', 'Premium')], default='free', max_length=20),\n        ),\n        migrations.AlterField(\n            model_name='usersubscription',\n            name='user',\n            field=models.OneToOneField(on_delete=django.db.models.deletion.CASCADE, related_name='subscription_record', to=settings.AUTH_USER_MODEL),\n        ),\n        migrations.CreateModel(\n            name='PastPaper',\n            fields=[\n                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),\n                ('title', models.CharField(max_length=200)),\n                ('exam_board', models.CharField(choices=[('Cambridge', 'Cambridge International'), ('Edexcel', 'Edexcel'), ('GED', 'GED'), ('CAPS', 'CAPS (South Africa)'), ('IEB', 'IEB (South Africa)'), ('ZIMSEC', 'ZIMSEC (Zimbabwe)'), ('NSSC', 'Namibia Senior Secondary Certificate'), ('ZEC', 'Zambia Examinations Council'), ('other', 'Other (Specify in notes)')], max_length=50)),\n                ('exam_board_custom', models.CharField(blank=True, max_length=100)),\n                ('paper_type', models.CharField(choices=[('paper1', 'Paper 1'), ('paper2', 'Paper 2'), ('paper3', 'Paper 3'), ('practical', 'Practical'), ('coursework', 'Coursework')], max_length=20)),\n                ('paper_code', models.CharField(max_length=50)),\n                ('year', models.IntegerField()),\n                ('chapter', models.CharField(blank=True, max_length=100)),\n                ('section', models.CharField(blank=True, max_length=100)),\n                ('file', models.FileField(upload_to='past_papers/%Y/%m/')),\n                ('notes', models.TextField(blank=True)),\n                ('uploaded_at', models.DateTimeField(auto_now_add=True)),\n                ('grade', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, to='core.grade')),\n                ('subject', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, to='core.subject')),\n                ('uploaded_by', models.ForeignKey(null=True, on_delete=django.db.models.deletion.SET_NULL, to=settings.AUTH_USER_MODEL)),\n            ],\n            options={\n                'ordering': ['-year', 'subject', 'grade'],\n                'unique_together': {('exam_board', 'paper_code', 'year')},\n            },\n        ),\n        migrations.CreateModel(\n            name='Quiz',\n            fields=[\n                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),\n                ('title', models.CharField(max_length=200)),\n                ('exam_board', models.CharField(choices=[('Cambridge', 'Cambridge International'), ('Edexcel', 'Edexcel'), ('GED', 'GED'), ('CAPS', 'CAPS (South Africa)'), ('IEB', 'IEB (South Africa)'), ('ZIMSEC', 'ZIMSEC (Zimbabwe)'), ('NSSC', 'Namibia Senior Secondary Certificate'), ('ZEC', 'Zambia Examinations Council'), ('other', 'Other (Specify in notes)')], max_length=50)),\n                ('topic', models.CharField(max_length=200)),\n                ('chapter', models.CharField(blank=True, max_length=100)),\n                ('section', models.CharField(blank=True, max_length=100)),\n                ('google_form_link', models.URLField()),\n                ('is_premium', models.BooleanField(default=False)),\n                ('is_ai_generated', models.BooleanField(default=False)),\n                ('difficulty_level', models.CharField(choices=[('easy', 'Easy'), ('medium', 'Medium'), ('hard', 'Hard')], default='medium', max_length=20)),\n                ('times_used', models.IntegerField(default=0)),\n                ('created_at', models.DateTimeField(auto_now_add=True)),\n                ('updated_at', models.DateTimeField(auto_now=True)),\n                ('is_active', models.BooleanField(default=True)),\n                ('created_by', models.ForeignKey(null=True, on_delete=django.db.models.deletion.SET_NULL, to=settings.AUTH_USER_MODEL)),\n                ('created_from_paper', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, to='core.pastpaper')),\n                ('grade', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, to='core.grade')),\n                ('subject', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, to='core.subject')),\n            ],\n            options={\n                'verbose_name_plural': 'Quizzes',\n                'ordering': ['-created_at'],\n            },\n        ),\n        migrations.CreateModel(\n            name='QuizResponse',\n            fields=[\n                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),\n                ('teacher_code', models.CharField(max_length=10)),\n                ('student_name', models.CharField(max_length=200)),\n                ('answers_json', models.JSONField()),\n                ('score', models.DecimalField(blank=True, decimal_places=2, max_digits=5, null=True)),\n                ('submitted_at', models.DateTimeField()),\n                ('quiz', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='responses', to='core.quiz')),\n                ('teacher', models.ForeignKey(null=True, on_delete=django.db.models.deletion.CASCADE, related_name='quiz_responses', to=settings.AUTH_USER_MODEL)),\n            ],\n            options={\n                'ordering': ['-submitted_at'],\n            },\n        ),\n        migrations.CreateModel(\n            name='SubscribedSubject',\n            fields=[\n                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),\n                ('subscribed_at', models.DateTimeField(auto_now_add=True)),\n                ('subject', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, to='core.subject')),\n                ('user', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='subscribed_subjects', to=settings.AUTH_USER_MODEL)),\n            ],\n            options={\n                'ordering': ['subscribed_at'],\n                'unique_together': {('user', 'subject')},\n            },\n        ),\n    ]\n","path":null,"size_bytes":7180,"size_tokens":null},"core/migrations/0011_alter_uploadeddocument_options_and_more.py":{"content":"# Generated by Django 5.0.2 on 2025-10-22 10:54\n\nfrom django.db import migrations, models\n\n\nclass Migration(migrations.Migration):\n\n    dependencies = [\n        ('core', '0010_remove_usersubscription_selected_subject_and_more'),\n    ]\n\n    operations = [\n        migrations.AlterModelOptions(\n            name='uploadeddocument',\n            options={'ordering': ['-created_at']},\n        ),\n        migrations.AlterField(\n            model_name='uploadeddocument',\n            name='type',\n            field=models.CharField(choices=[('lesson_plan', 'Lesson Plan'), ('classwork', 'Classwork'), ('homework', 'Homework'), ('assignment', 'Assignment'), ('test', 'Test'), ('exam', 'Exam'), ('general', 'General Document')], default='general', max_length=20),\n        ),\n    ]\n","path":null,"size_bytes":773,"size_tokens":null},"core/migrations/0012_examboard_region.py":{"content":"# Generated by Django 5.0.2 on 2025-10-22 11:38\n\nfrom django.db import migrations, models\n\n\nclass Migration(migrations.Migration):\n\n    dependencies = [\n        ('core', '0011_alter_uploadeddocument_options_and_more'),\n    ]\n\n    operations = [\n        migrations.AddField(\n            model_name='examboard',\n            name='region',\n            field=models.CharField(default='', max_length=100),\n        ),\n    ]\n","path":null,"size_bytes":418,"size_tokens":null},"core/migrations/0013_alter_userprofile_role.py":{"content":"# Generated by Django 5.0.2 on 2025-10-22 21:52\n\nfrom django.db import migrations, models\n\n\nclass Migration(migrations.Migration):\n\n    dependencies = [\n        ('core', '0012_examboard_region'),\n    ]\n\n    operations = [\n        migrations.AlterField(\n            model_name='userprofile',\n            name='role',\n            field=models.CharField(choices=[('teacher', 'Teacher'), ('content_manager', 'Content Manager'), ('admin', 'Admin')], default='teacher', max_length=20),\n        ),\n    ]\n","path":null,"size_bytes":497,"size_tokens":null},"core/migrations/0015_formattedpaper_has_extracted_images_and_more.py":{"content":"# Generated by Django 5.0.2 on 2025-10-22 22:30\n\nfrom django.db import migrations, models\n\n\nclass Migration(migrations.Migration):\n\n    dependencies = [\n        ('core', '0014_formattedpaper'),\n    ]\n\n    operations = [\n        migrations.AddField(\n            model_name='formattedpaper',\n            name='has_extracted_images',\n            field=models.BooleanField(default=False),\n        ),\n        migrations.AddField(\n            model_name='formattedpaper',\n            name='images_directory',\n            field=models.CharField(blank=True, max_length=500),\n        ),\n    ]\n","path":null,"size_bytes":584,"size_tokens":null},"core/context_processors.py":{"content":"\"\"\"Context processors for making data available in all templates\"\"\"\n\ndef announcements(request):\n    \"\"\"Add active announcements to all template contexts\"\"\"\n    from .models import Announcement\n    from django.db import models\n    from django.utils import timezone\n    \n    if request.user.is_authenticated:\n        # Get announcements that are visible to this user\n        now = timezone.now()\n        active_announcements = []\n        \n        # Build query with proper scheduling logic\n        query = Announcement.objects.filter(is_active=True)\n        \n        # Filter by start time (if set)\n        query = query.filter(models.Q(starts_at__isnull=True) | models.Q(starts_at__lte=now))\n        \n        # Filter by expiry time (if set)\n        query = query.filter(models.Q(expires_at__isnull=True) | models.Q(expires_at__gte=now))\n        \n        # Exclude dismissed announcements\n        query = query.exclude(dismissed_by=request.user)\n        \n        # Order by priority (critical first) then created date\n        query = query.order_by(\n            models.Case(\n                models.When(priority='critical', then=1),\n                models.When(priority='warning', then=2),\n                models.When(priority='info', then=3),\n                default=4,\n                output_field=models.IntegerField(),\n            ),\n            '-created_at'\n        )\n        \n        all_announcements = query\n        \n        for announcement in all_announcements:\n            if announcement.is_visible_to(request.user):\n                active_announcements.append(announcement)\n        \n        return {'active_announcements': active_announcements}\n    \n    return {'active_announcements': []}\n","path":null,"size_bytes":1704,"size_tokens":null},"core/migrations/0017_announcement_starts_at.py":{"content":"# Generated by Django 5.0.2 on 2025-10-23 22:02\n\nfrom django.db import migrations, models\n\n\nclass Migration(migrations.Migration):\n\n    dependencies = [\n        ('core', '0016_announcement_emailblast'),\n    ]\n\n    operations = [\n        migrations.AddField(\n            model_name='announcement',\n            name='starts_at',\n            field=models.DateTimeField(blank=True, null=True),\n        ),\n    ]\n","path":null,"size_bytes":407,"size_tokens":null},"core/migrations/0016_announcement_emailblast.py":{"content":"# Generated by Django 5.0.2 on 2025-10-23 21:51\n\nimport django.db.models.deletion\nfrom django.conf import settings\nfrom django.db import migrations, models\n\n\nclass Migration(migrations.Migration):\n\n    dependencies = [\n        ('core', '0015_formattedpaper_has_extracted_images_and_more'),\n        migrations.swappable_dependency(settings.AUTH_USER_MODEL),\n    ]\n\n    operations = [\n        migrations.CreateModel(\n            name='Announcement',\n            fields=[\n                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),\n                ('title', models.CharField(max_length=200)),\n                ('message', models.TextField()),\n                ('target_audience', models.CharField(choices=[('all', 'All Users'), ('teachers', 'Teachers Only'), ('content_managers', 'Content Managers Only'), ('admins', 'Admins Only')], default='all', max_length=20)),\n                ('priority', models.CharField(choices=[('info', 'Info'), ('warning', 'Warning'), ('critical', 'Critical')], default='info', max_length=10)),\n                ('display_type', models.CharField(choices=[('banner', 'Banner'), ('modal', 'Modal')], default='banner', max_length=10)),\n                ('is_active', models.BooleanField(default=True)),\n                ('expires_at', models.DateTimeField(blank=True, null=True)),\n                ('created_at', models.DateTimeField(auto_now_add=True)),\n                ('updated_at', models.DateTimeField(auto_now=True)),\n                ('created_by', models.ForeignKey(null=True, on_delete=django.db.models.deletion.SET_NULL, to=settings.AUTH_USER_MODEL)),\n                ('dismissed_by', models.ManyToManyField(blank=True, related_name='dismissed_announcements', to=settings.AUTH_USER_MODEL)),\n            ],\n            options={\n                'ordering': ['-created_at'],\n            },\n        ),\n        migrations.CreateModel(\n            name='EmailBlast',\n            fields=[\n                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),\n                ('subject', models.CharField(max_length=200)),\n                ('message', models.TextField()),\n                ('target_audience', models.CharField(choices=[('all', 'All Users'), ('teachers', 'Teachers Only'), ('content_managers', 'Content Managers Only')], default='all', max_length=20)),\n                ('status', models.CharField(choices=[('draft', 'Draft'), ('sending', 'Sending'), ('sent', 'Sent'), ('failed', 'Failed')], default='draft', max_length=10)),\n                ('recipient_count', models.IntegerField(default=0)),\n                ('sent_count', models.IntegerField(default=0)),\n                ('failed_count', models.IntegerField(default=0)),\n                ('created_at', models.DateTimeField(auto_now_add=True)),\n                ('sent_at', models.DateTimeField(blank=True, null=True)),\n                ('created_by', models.ForeignKey(null=True, on_delete=django.db.models.deletion.SET_NULL, to=settings.AUTH_USER_MODEL)),\n            ],\n            options={\n                'ordering': ['-created_at'],\n            },\n        ),\n    ]\n","path":null,"size_bytes":3160,"size_tokens":null},"core/api_views.py":{"content":"from rest_framework import viewsets, permissions, filters, status\nfrom rest_framework.decorators import action\nfrom rest_framework.response import Response\nfrom rest_framework.authtoken.models import Token\nfrom rest_framework.views import APIView\nfrom django_filters.rest_framework import DjangoFilterBackend\nfrom django.contrib.auth.models import User\nfrom django.utils import timezone\nfrom django.db.models import Q, Avg, Count\nfrom decimal import Decimal\nimport secrets\n\n\nclass IsFreeQuizOrAuthenticated(permissions.BasePermission):\n    \"\"\"\n    Custom permission: Allow access to free quizzes for all,\n    but require authentication for premium quizzes.\n    \"\"\"\n    def has_object_permission(self, request, view, obj):\n        # Allow access if quiz is free, otherwise require authentication\n        if not obj.is_premium:\n            return True\n        return request.user and request.user.is_authenticated\n\n\nclass IsStudent(permissions.BasePermission):\n    \"\"\"\n    Custom permission to only allow students to access student endpoints.\n    \"\"\"\n    def has_permission(self, request, view):\n        return request.user and request.user.is_authenticated and hasattr(request.user, 'student_profile')\n\n\nfrom .models import (\n    PastPaper, Quiz, Subject, Grade, ExamBoard,\n    FormattedPaper, GeneratedAssignment, StudentProfile,\n    StudentExamBoard, StudentSubject, InteractiveQuestion,\n    StudentQuiz, StudentQuizAttempt, Note, Flashcard,\n    ExamPaper, StudentProgress, StudentQuizQuota\n)\nfrom .serializers import (\n    PastPaperSerializer, QuizSerializer, SubjectSerializer,\n    GradeSerializer, ExamBoardSerializer, FormattedPaperSerializer,\n    GeneratedAssignmentSerializer, StudentProfileSerializer,\n    StudentExamBoardSerializer, StudentSubjectSerializer,\n    InteractiveQuestionSerializer, StudentQuizSerializer,\n    StudentQuizListSerializer, StudentQuizAttemptSerializer,\n    NoteSerializer, FlashcardSerializer, ExamPaperSerializer,\n    StudentProgressSerializer, StudentRegisterSerializer,\n    StudentLoginSerializer, StudentOnboardingSerializer,\n    InteractiveQuestionWithoutAnswerSerializer\n)\n\n\nclass ExamBoardViewSet(viewsets.ReadOnlyModelViewSet):\n    \"\"\"\n    API endpoint for exam boards.\n    \n    List all exam boards or retrieve a specific one.\n    Public access - no authentication required.\n    \"\"\"\n    queryset = ExamBoard.objects.all()\n    serializer_class = ExamBoardSerializer\n    permission_classes = [permissions.AllowAny]\n    filter_backends = [filters.SearchFilter, filters.OrderingFilter]\n    search_fields = ['name_full', 'abbreviation', 'region']\n    ordering_fields = ['name_full', 'abbreviation']\n    ordering = ['abbreviation']\n\n\nclass SubjectViewSet(viewsets.ReadOnlyModelViewSet):\n    \"\"\"\n    API endpoint for subjects.\n    \n    List all subjects or retrieve a specific one.\n    Public access - no authentication required.\n    \"\"\"\n    queryset = Subject.objects.all()\n    serializer_class = SubjectSerializer\n    permission_classes = [permissions.AllowAny]\n    filter_backends = [filters.SearchFilter, filters.OrderingFilter]\n    search_fields = ['name']\n    ordering_fields = ['name']\n    ordering = ['name']\n\n\nclass GradeViewSet(viewsets.ReadOnlyModelViewSet):\n    \"\"\"\n    API endpoint for grades.\n    \n    List all grades or retrieve a specific one.\n    Public access - no authentication required.\n    \"\"\"\n    queryset = Grade.objects.all()\n    serializer_class = GradeSerializer\n    permission_classes = [permissions.AllowAny]\n    filter_backends = [filters.OrderingFilter]\n    ordering_fields = ['number']\n    ordering = ['number']\n\n\nclass PastPaperViewSet(viewsets.ReadOnlyModelViewSet):\n    \"\"\"\n    API endpoint for past papers.\n    \n    Public access - government exam papers available to all.\n    \n    Filter by:\n    - exam_board (text match)\n    - subject (ID)\n    - grade (ID)\n    - year (exact match)\n    - chapter (text contains)\n    - section (text contains)\n    \n    Search: title, chapter, section\n    \"\"\"\n    queryset = PastPaper.objects.select_related('subject', 'grade').all()\n    serializer_class = PastPaperSerializer\n    permission_classes = [permissions.AllowAny]\n    filter_backends = [DjangoFilterBackend, filters.SearchFilter, filters.OrderingFilter]\n    filterset_fields = ['exam_board', 'subject', 'grade', 'year']\n    search_fields = ['title', 'chapter', 'section']\n    ordering_fields = ['year', 'uploaded_at', 'title']\n    ordering = ['-year', '-uploaded_at']\n\n\nclass FormattedPaperViewSet(viewsets.ReadOnlyModelViewSet):\n    \"\"\"\n    API endpoint for AI-formatted papers.\n    \n    Filter by:\n    - exam_board (text match)\n    - subject (ID)\n    - grade (ID)\n    - year (exact match)\n    - processing_status (pending, processing, completed, failed)\n    - is_published (boolean)\n    \n    Search: title\n    \"\"\"\n    queryset = FormattedPaper.objects.select_related('subject', 'grade', 'source_paper').filter(is_published=True)\n    serializer_class = FormattedPaperSerializer\n    permission_classes = [permissions.IsAuthenticated]\n    filter_backends = [DjangoFilterBackend, filters.SearchFilter, filters.OrderingFilter]\n    filterset_fields = ['exam_board', 'subject', 'grade', 'year', 'processing_status', 'is_published']\n    search_fields = ['title']\n    ordering_fields = ['year', 'created_at', 'total_questions']\n    ordering = ['-year', '-created_at']\n\n\nclass QuizViewSet(viewsets.ReadOnlyModelViewSet):\n    \"\"\"\n    API endpoint for quizzes.\n    \n    Public access for free quizzes, authentication required for premium quizzes.\n    \n    Filter by:\n    - exam_board (text match)\n    - subject (ID)\n    - grade (ID)\n    - topic (text contains)\n    - is_premium (boolean)\n    \n    Search: title, topic\n    \"\"\"\n    queryset = Quiz.objects.select_related('subject', 'grade').all()\n    serializer_class = QuizSerializer\n    permission_classes = [permissions.AllowAny]\n    filter_backends = [DjangoFilterBackend, filters.SearchFilter, filters.OrderingFilter]\n    filterset_fields = ['exam_board', 'subject', 'grade', 'is_premium']\n    search_fields = ['title', 'topic']\n    ordering_fields = ['created_at', 'title']\n    ordering = ['-created_at']\n    \n    def get_queryset(self):\n        \"\"\"Filter premium quizzes based on authentication\"\"\"\n        queryset = super().get_queryset()\n        # If user is not authenticated, only show free quizzes\n        if not self.request.user.is_authenticated:\n            queryset = queryset.filter(is_premium=False)\n        return queryset\n\n\nclass AssignmentViewSet(viewsets.ReadOnlyModelViewSet):\n    \"\"\"\n    API endpoint for assignments.\n    \n    Filter by:\n    - subject (ID)\n    - grade (ID)\n    - question_type (text match)\n    \n    Search: title, instructions\n    \"\"\"\n    queryset = GeneratedAssignment.objects.select_related('subject', 'grade').all()\n    serializer_class = GeneratedAssignmentSerializer\n    permission_classes = [permissions.IsAuthenticated]\n    filter_backends = [DjangoFilterBackend, filters.SearchFilter, filters.OrderingFilter]\n    filterset_fields = ['subject', 'grade', 'question_type']\n    search_fields = ['title', 'instructions']\n    ordering_fields = ['created_at', 'title']\n    ordering = ['-created_at']\n\n\nclass StudentRegisterView(APIView):\n    \"\"\"\n    Student registration endpoint.\n    Creates a new student account and returns authentication token.\n    \"\"\"\n    permission_classes = [permissions.AllowAny]\n    \n    def post(self, request):\n        serializer = StudentRegisterSerializer(data=request.data)\n        if serializer.is_valid():\n            user = serializer.save()\n            token, created = Token.objects.get_or_create(user=user)\n            \n            return Response({\n                'token': token.key,\n                'user_id': user.id,\n                'username': user.username,\n                'email': user.email,\n                'message': 'Registration successful. Please verify your email.'\n            }, status=status.HTTP_201_CREATED)\n        \n        return Response(serializer.errors, status=status.HTTP_400_BAD_REQUEST)\n\n\nclass StudentLoginView(APIView):\n    \"\"\"\n    Student login endpoint.\n    Returns authentication token for valid credentials.\n    \"\"\"\n    permission_classes = [permissions.AllowAny]\n    \n    def post(self, request):\n        serializer = StudentLoginSerializer(data=request.data)\n        if serializer.is_valid():\n            user = serializer.validated_data['user']\n            token, created = Token.objects.get_or_create(user=user)\n            \n            profile = user.student_profile\n            \n            return Response({\n                'token': token.key,\n                'user_id': user.id,\n                'username': user.username,\n                'email': user.email,\n                'subscription': profile.subscription,\n                'onboarding_completed': profile.onboarding_completed\n            }, status=status.HTTP_200_OK)\n        \n        return Response(serializer.errors, status=status.HTTP_400_BAD_REQUEST)\n\n\nclass StudentVerifyEmailView(APIView):\n    \"\"\"\n    Email verification endpoint.\n    Activates student account with verification token.\n    \"\"\"\n    permission_classes = [permissions.AllowAny]\n    \n    def post(self, request):\n        token = request.data.get('token')\n        \n        if not token:\n            return Response({'error': 'Token required.'}, status=status.HTTP_400_BAD_REQUEST)\n        \n        try:\n            profile = StudentProfile.objects.get(verification_token=token)\n            \n            if profile.verification_token_created:\n                time_diff = timezone.now() - profile.verification_token_created\n                if time_diff.days > 1:\n                    return Response({'error': 'Token expired.'}, status=status.HTTP_400_BAD_REQUEST)\n            \n            profile.email_verified = True\n            profile.user.is_active = True\n            profile.user.save()\n            profile.save()\n            \n            return Response({'message': 'Email verified successfully.'}, status=status.HTTP_200_OK)\n        \n        except StudentProfile.DoesNotExist:\n            return Response({'error': 'Invalid token.'}, status=status.HTTP_400_BAD_REQUEST)\n\n\nclass StudentOnboardingView(APIView):\n    \"\"\"\n    Student onboarding endpoint.\n    Completes student profile with grade, exam boards, and subjects.\n    \"\"\"\n    permission_classes = [IsStudent]\n    \n    def post(self, request):\n        serializer = StudentOnboardingSerializer(data=request.data, context={'request': request})\n        \n        if serializer.is_valid():\n            student_profile = request.user.student_profile\n            grade_id = serializer.validated_data['grade_id']\n            exam_board_ids = serializer.validated_data['exam_board_ids']\n            subject_data = serializer.validated_data['subject_data']\n            \n            student_profile.grade_id = grade_id\n            student_profile.onboarding_completed = True\n            student_profile.save()\n            \n            StudentExamBoard.objects.filter(student=student_profile).delete()\n            for board_id in exam_board_ids:\n                StudentExamBoard.objects.create(\n                    student=student_profile,\n                    exam_board_id=board_id\n                )\n            \n            StudentSubject.objects.filter(student=student_profile).delete()\n            for item in subject_data:\n                StudentSubject.objects.create(\n                    student=student_profile,\n                    subject_id=item['subject_id'],\n                    exam_board_id=item['exam_board_id']\n                )\n            \n            return Response({\n                'message': 'Onboarding completed successfully.',\n                'profile': StudentProfileSerializer(student_profile, context={'request': request}).data\n            }, status=status.HTTP_200_OK)\n        \n        return Response(serializer.errors, status=status.HTTP_400_BAD_REQUEST)\n\n\nclass StudentProfileViewSet(viewsets.ModelViewSet):\n    \"\"\"\n    Student profile endpoint.\n    GET: Retrieve current student profile\n    PATCH: Update profile (subscription, parent_email)\n    \"\"\"\n    serializer_class = StudentProfileSerializer\n    permission_classes = [IsStudent]\n    http_method_names = ['get', 'patch']\n    \n    def get_queryset(self):\n        if getattr(self, 'swagger_fake_view', False):\n            return StudentProfile.objects.none()\n        \n        return StudentProfile.objects.filter(user=self.request.user)\n    \n    def get_object(self):\n        return self.request.user.student_profile\n    \n    @action(detail=False, methods=['get'])\n    def me(self, request):\n        \"\"\"Get current student profile\"\"\"\n        profile = request.user.student_profile\n        serializer = self.get_serializer(profile)\n        return Response(serializer.data)\n\n\nclass StudentQuizViewSet(viewsets.ReadOnlyModelViewSet):\n    \"\"\"\n    Student quiz endpoint.\n    LIST: Get quizzes filtered by student's subjects\n    RETRIEVE: Get quiz details with questions (without answers)\n    \"\"\"\n    permission_classes = [IsStudent]\n    filter_backends = [DjangoFilterBackend, filters.SearchFilter, filters.OrderingFilter]\n    filterset_fields = ['subject', 'exam_board', 'grade', 'difficulty', 'topic']\n    search_fields = ['title', 'topic']\n    ordering_fields = ['created_at', 'difficulty', 'title']\n    ordering = ['-created_at']\n    \n    def get_queryset(self):\n        if getattr(self, 'swagger_fake_view', False):\n            return StudentQuiz.objects.none()\n        \n        student_profile = self.request.user.student_profile\n        student_subjects = student_profile.subjects.values_list('subject_id', flat=True)\n        \n        queryset = StudentQuiz.objects.filter(\n            subject_id__in=student_subjects\n        ).select_related('subject', 'exam_board', 'grade')\n        \n        if student_profile.subscription != 'pro':\n            queryset = queryset.filter(is_pro_content=False)\n        \n        return queryset\n    \n    def get_serializer_class(self):\n        if self.action == 'list':\n            return StudentQuizListSerializer\n        return StudentQuizSerializer\n\n\nclass StudentQuizAttemptViewSet(viewsets.ModelViewSet):\n    \"\"\"\n    Student quiz attempt endpoint.\n    CREATE: Start a new quiz attempt\n    LIST: Get all attempts for current student\n    RETRIEVE: Get specific attempt with results\n    \"\"\"\n    serializer_class = StudentQuizAttemptSerializer\n    permission_classes = [IsStudent]\n    filter_backends = [DjangoFilterBackend, filters.OrderingFilter]\n    filterset_fields = ['quiz', 'completed_at']\n    ordering_fields = ['started_at', 'score', 'percentage']\n    ordering = ['-started_at']\n    \n    def get_queryset(self):\n        if getattr(self, 'swagger_fake_view', False):\n            return StudentQuizAttempt.objects.none()\n        \n        return StudentQuizAttempt.objects.filter(\n            student=self.request.user.student_profile\n        ).select_related('quiz', 'quiz__subject', 'quiz__exam_board', 'quiz__grade')\n    \n    def perform_create(self, serializer):\n        student_profile = self.request.user.student_profile\n        quiz_id = self.request.data.get('quiz_id')\n        \n        try:\n            quiz = StudentQuiz.objects.get(id=quiz_id)\n        except StudentQuiz.DoesNotExist:\n            from rest_framework import serializers as drf_serializers\n            raise drf_serializers.ValidationError({'quiz_id': 'Quiz not found.'})\n        \n        if quiz.is_pro_content and student_profile.subscription != 'pro':\n            from rest_framework import serializers as drf_serializers\n            raise drf_serializers.ValidationError({'error': 'Pro subscription required for this quiz.'})\n        \n        quota, created = StudentQuizQuota.objects.get_or_create(\n            student=student_profile,\n            subject=quiz.subject,\n            topic=quiz.topic\n        )\n        \n        if not quota.can_attempt_quiz(quiz, student_profile.subscription == 'pro'):\n            from rest_framework import serializers as drf_serializers\n            raise drf_serializers.ValidationError({\n                'error': 'Free tier limit reached for this topic. Upgrade to Pro or retry completed quizzes.'\n            })\n        \n        serializer.save(student=student_profile)\n    \n    @action(detail=True, methods=['post'])\n    def submit_answer(self, request, pk=None):\n        \"\"\"Submit answer for a single question (for instant feedback)\"\"\"\n        attempt = self.get_object()\n        \n        question_id = request.data.get('question_id')\n        answer = request.data.get('answer')\n        \n        if not question_id or answer is None:\n            return Response({'error': 'question_id and answer required.'}, status=status.HTTP_400_BAD_REQUEST)\n        \n        try:\n            question = InteractiveQuestion.objects.get(id=question_id)\n        except InteractiveQuestion.DoesNotExist:\n            return Response({'error': 'Question not found.'}, status=status.HTTP_400_BAD_REQUEST)\n        \n        if question not in attempt.quiz.questions.all():\n            return Response({'error': 'Question not in this quiz.'}, status=status.HTTP_400_BAD_REQUEST)\n        \n        if not isinstance(attempt.answers, dict):\n            attempt.answers = {}\n        \n        attempt.answers[str(question_id)] = answer\n        attempt.save()\n        \n        is_correct = str(answer).strip().lower() == str(question.correct_answer).strip().lower()\n        \n        response_data = {\n            'question_id': question_id,\n            'submitted_answer': answer,\n            'is_correct': is_correct\n        }\n        \n        if attempt.show_instant_feedback:\n            response_data['correct_answer'] = question.correct_answer\n            response_data['explanation'] = question.explanation\n        \n        return Response(response_data, status=status.HTTP_200_OK)\n    \n    @action(detail=True, methods=['post'])\n    def complete(self, request, pk=None):\n        \"\"\"Complete quiz and calculate final score\"\"\"\n        attempt = self.get_object()\n        \n        if attempt.completed_at:\n            return Response({'error': 'Quiz already completed.'}, status=status.HTTP_400_BAD_REQUEST)\n        \n        final_answers = request.data.get('answers', {})\n        if final_answers:\n            attempt.answers = final_answers\n        \n        questions = attempt.quiz.questions.all()\n        total_points = sum(q.points for q in questions)\n        earned_points = 0\n        \n        for question in questions:\n            student_answer = attempt.answers.get(str(question.id), '')\n            if str(student_answer).strip().lower() == str(question.correct_answer).strip().lower():\n                earned_points += question.points\n        \n        attempt.score = earned_points\n        if total_points > 0:\n            attempt.percentage = Decimal((earned_points / total_points) * 100).quantize(Decimal('0.01'))\n        else:\n            attempt.percentage = Decimal('0.00')\n        \n        attempt.completed_at = timezone.now()\n        attempt.save()\n        \n        student_profile = request.user.student_profile\n        quota, created = StudentQuizQuota.objects.get_or_create(\n            student=student_profile,\n            subject=attempt.quiz.subject,\n            topic=attempt.quiz.topic\n        )\n        if attempt.quiz not in quota.quizzes_completed.all():\n            quota.quizzes_completed.add(attempt.quiz)\n        quota.attempt_count += 1\n        quota.save()\n        \n        progress, created = StudentProgress.objects.get_or_create(\n            student=student_profile,\n            subject=attempt.quiz.subject,\n            topic=attempt.quiz.topic\n        )\n        progress.quizzes_attempted += 1\n        if attempt.percentage >= 50:\n            progress.quizzes_passed += 1\n        \n        if progress.quizzes_attempted > 0:\n            progress.average_score = (\n                (progress.average_score * (progress.quizzes_attempted - 1) + attempt.percentage) \n                / progress.quizzes_attempted\n            )\n        \n        progress.save()\n        \n        return Response({\n            'message': 'Quiz completed successfully.',\n            'score': attempt.score,\n            'total_points': total_points,\n            'percentage': float(attempt.percentage),\n            'passed': attempt.percentage >= 50\n        }, status=status.HTTP_200_OK)\n    \n    @action(detail=True, methods=['get'])\n    def results(self, request, pk=None):\n        \"\"\"Get detailed results with correct answers and explanations\"\"\"\n        attempt = self.get_object()\n        \n        if not attempt.completed_at:\n            return Response({'error': 'Quiz not completed yet.'}, status=status.HTTP_400_BAD_REQUEST)\n        \n        questions = attempt.quiz.questions.all()\n        results = []\n        \n        for question in questions:\n            student_answer = attempt.answers.get(str(question.id), '')\n            is_correct = str(student_answer).strip().lower() == str(question.correct_answer).strip().lower()\n            \n            results.append({\n                'question': InteractiveQuestionSerializer(question, context={'request': request}).data,\n                'student_answer': student_answer,\n                'is_correct': is_correct\n            })\n        \n        return Response({\n            'attempt': StudentQuizAttemptSerializer(attempt, context={'request': request}).data,\n            'results': results\n        }, status=status.HTTP_200_OK)\n\n\nclass NoteViewSet(viewsets.ReadOnlyModelViewSet):\n    \"\"\"\n    Notes endpoint.\n    LIST: Get notes filtered by student's subjects\n    RETRIEVE: Get note content (full and summary versions)\n    \"\"\"\n    serializer_class = NoteSerializer\n    permission_classes = [IsStudent]\n    filter_backends = [DjangoFilterBackend, filters.SearchFilter, filters.OrderingFilter]\n    filterset_fields = ['subject', 'exam_board', 'grade', 'topic']\n    search_fields = ['title', 'topic', 'full_version_text', 'summary_version_text']\n    ordering_fields = ['created_at', 'title']\n    ordering = ['subject', 'topic']\n    \n    def get_queryset(self):\n        if getattr(self, 'swagger_fake_view', False):\n            return Note.objects.none()\n        \n        student_profile = self.request.user.student_profile\n        student_subjects = student_profile.subjects.values_list('subject_id', flat=True)\n        \n        return Note.objects.filter(\n            subject_id__in=student_subjects\n        ).select_related('subject', 'exam_board', 'grade')\n    \n    def retrieve(self, request, *args, **kwargs):\n        instance = self.get_object()\n        \n        student_profile = request.user.student_profile\n        progress, created = StudentProgress.objects.get_or_create(\n            student=student_profile,\n            subject=instance.subject,\n            topic=instance.topic\n        )\n        progress.notes_viewed = True\n        progress.save()\n        \n        serializer = self.get_serializer(instance)\n        return Response(serializer.data)\n\n\nclass FlashcardViewSet(viewsets.ReadOnlyModelViewSet):\n    \"\"\"\n    Flashcards endpoint.\n    LIST: Get flashcards filtered by subject/topic\n    RETRIEVE: Get individual flashcard\n    \"\"\"\n    serializer_class = FlashcardSerializer\n    permission_classes = [IsStudent]\n    filter_backends = [DjangoFilterBackend, filters.SearchFilter, filters.OrderingFilter]\n    filterset_fields = ['subject', 'exam_board', 'grade', 'topic']\n    search_fields = ['topic', 'front_text', 'back_text']\n    ordering_fields = ['created_at', 'topic']\n    ordering = ['subject', 'topic']\n    \n    def get_queryset(self):\n        if getattr(self, 'swagger_fake_view', False):\n            return Flashcard.objects.none()\n        \n        student_profile = self.request.user.student_profile\n        student_subjects = student_profile.subjects.values_list('subject_id', flat=True)\n        \n        return Flashcard.objects.filter(\n            subject_id__in=student_subjects\n        ).select_related('subject', 'exam_board', 'grade')\n    \n    @action(detail=False, methods=['get'])\n    def by_topic(self, request):\n        \"\"\"Get all flashcards for a specific topic\"\"\"\n        topic = request.query_params.get('topic')\n        subject_id = request.query_params.get('subject_id')\n        \n        if not topic or not subject_id:\n            return Response({'error': 'topic and subject_id required.'}, status=status.HTTP_400_BAD_REQUEST)\n        \n        flashcards = self.get_queryset().filter(topic=topic, subject_id=subject_id)\n        serializer = self.get_serializer(flashcards, many=True)\n        \n        student_profile = request.user.student_profile\n        progress, created = StudentProgress.objects.get_or_create(\n            student=student_profile,\n            subject_id=subject_id,\n            topic=topic\n        )\n        progress.flashcards_reviewed += len(flashcards)\n        progress.save()\n        \n        return Response(serializer.data)\n\n\nclass ExamPaperViewSet(viewsets.ReadOnlyModelViewSet):\n    \"\"\"\n    Exam papers endpoint.\n    LIST: Get exam papers filtered by subject/year\n    RETRIEVE: Get paper details with file URLs\n    \"\"\"\n    serializer_class = ExamPaperSerializer\n    permission_classes = [IsStudent]\n    filter_backends = [DjangoFilterBackend, filters.SearchFilter, filters.OrderingFilter]\n    filterset_fields = ['subject', 'exam_board', 'grade', 'year']\n    search_fields = ['title']\n    ordering_fields = ['year', 'created_at', 'title']\n    ordering = ['-year', 'subject']\n    \n    def get_queryset(self):\n        if getattr(self, 'swagger_fake_view', False):\n            return ExamPaper.objects.none()\n        \n        student_profile = self.request.user.student_profile\n        student_subjects = student_profile.subjects.values_list('subject_id', flat=True)\n        \n        queryset = ExamPaper.objects.filter(\n            subject_id__in=student_subjects\n        ).select_related('subject', 'exam_board', 'grade')\n        \n        if student_profile.subscription != 'pro':\n            queryset = queryset.filter(is_pro_content=False)\n        \n        return queryset\n\n\nclass StudentProgressViewSet(viewsets.ReadOnlyModelViewSet):\n    \"\"\"\n    Student progress endpoint.\n    LIST: Get progress for all subjects/topics\n    RETRIEVE: Get progress for specific subject/topic\n    \"\"\"\n    serializer_class = StudentProgressSerializer\n    permission_classes = [IsStudent]\n    filter_backends = [DjangoFilterBackend, filters.OrderingFilter]\n    filterset_fields = ['subject', 'topic']\n    ordering_fields = ['average_score', 'quizzes_attempted', 'last_activity']\n    ordering = ['-last_activity']\n    \n    def get_queryset(self):\n        if getattr(self, 'swagger_fake_view', False):\n            return StudentProgress.objects.none()\n        \n        return StudentProgress.objects.filter(\n            student=self.request.user.student_profile\n        ).select_related('subject')\n    \n    @action(detail=False, methods=['get'])\n    def summary(self, request):\n        \"\"\"Get overall progress summary\"\"\"\n        student_profile = request.user.student_profile\n        progress_data = StudentProgress.objects.filter(student=student_profile)\n        \n        total_quizzes = progress_data.aggregate(total=Count('quizzes_attempted'))['total'] or 0\n        total_passed = progress_data.aggregate(total=Count('quizzes_passed'))['total'] or 0\n        avg_score = progress_data.aggregate(avg=Avg('average_score'))['avg'] or 0\n        \n        return Response({\n            'total_quizzes_attempted': total_quizzes,\n            'total_quizzes_passed': total_passed,\n            'overall_average_score': float(avg_score),\n            'subjects_studied': progress_data.values('subject').distinct().count(),\n            'topics_covered': progress_data.count()\n        })\n\n\nclass BulkQuizzesView(APIView):\n    \"\"\"\n    Bulk download endpoint for quizzes (offline support).\n    Returns all quizzes for student's subjects.\n    \"\"\"\n    permission_classes = [IsStudent]\n    \n    def get(self, request):\n        student_profile = request.user.student_profile\n        student_subjects = student_profile.subjects.values_list('subject_id', flat=True)\n        \n        quizzes = StudentQuiz.objects.filter(\n            subject_id__in=student_subjects\n        ).select_related('subject', 'exam_board', 'grade').prefetch_related('questions')\n        \n        if student_profile.subscription != 'pro':\n            quizzes = quizzes.filter(is_pro_content=False)\n        \n        serializer = StudentQuizSerializer(quizzes, many=True, context={'request': request})\n        \n        return Response({\n            'count': quizzes.count(),\n            'quizzes': serializer.data\n        })\n\n\nclass BulkNotesView(APIView):\n    \"\"\"\n    Bulk download endpoint for notes (offline support).\n    Returns all notes for student's subjects.\n    \"\"\"\n    permission_classes = [IsStudent]\n    \n    def get(self, request):\n        student_profile = request.user.student_profile\n        student_subjects = student_profile.subjects.values_list('subject_id', flat=True)\n        \n        notes = Note.objects.filter(\n            subject_id__in=student_subjects\n        ).select_related('subject', 'exam_board', 'grade')\n        \n        serializer = NoteSerializer(notes, many=True, context={'request': request})\n        \n        return Response({\n            'count': notes.count(),\n            'notes': serializer.data\n        })\n\n\nclass BulkFlashcardsView(APIView):\n    \"\"\"\n    Bulk download endpoint for flashcards (offline support).\n    Returns all flashcards for student's subjects.\n    \"\"\"\n    permission_classes = [IsStudent]\n    \n    def get(self, request):\n        student_profile = request.user.student_profile\n        student_subjects = student_profile.subjects.values_list('subject_id', flat=True)\n        \n        flashcards = Flashcard.objects.filter(\n            subject_id__in=student_subjects\n        ).select_related('subject', 'exam_board', 'grade')\n        \n        serializer = FlashcardSerializer(flashcards, many=True, context={'request': request})\n        \n        return Response({\n            'count': flashcards.count(),\n            'flashcards': serializer.data\n        })\n\n\nclass SyncView(APIView):\n    \"\"\"\n    Sync endpoint for offline mode.\n    Upload offline quiz attempts and download new content.\n    \"\"\"\n    permission_classes = [IsStudent]\n    \n    def post(self, request):\n        student_profile = request.user.student_profile\n        offline_attempts = request.data.get('quiz_attempts', [])\n        \n        synced_attempts = []\n        errors = []\n        \n        for attempt_data in offline_attempts:\n            try:\n                quiz_id = attempt_data.get('quiz_id')\n                answers = attempt_data.get('answers', {})\n                \n                quiz = StudentQuiz.objects.get(id=quiz_id)\n                \n                attempt = StudentQuizAttempt.objects.create(\n                    student=student_profile,\n                    quiz=quiz,\n                    answers=answers,\n                    is_timed=attempt_data.get('is_timed', False),\n                    time_limit_minutes=attempt_data.get('time_limit_minutes'),\n                    show_instant_feedback=attempt_data.get('show_instant_feedback', True)\n                )\n                \n                questions = quiz.questions.all()\n                total_points = sum(q.points for q in questions)\n                earned_points = 0\n                \n                for question in questions:\n                    student_answer = answers.get(str(question.id), '')\n                    if str(student_answer).strip().lower() == str(question.correct_answer).strip().lower():\n                        earned_points += question.points\n                \n                attempt.score = earned_points\n                if total_points > 0:\n                    attempt.percentage = Decimal((earned_points / total_points) * 100).quantize(Decimal('0.01'))\n                attempt.completed_at = timezone.now()\n                attempt.save()\n                \n                synced_attempts.append(attempt.id)\n            \n            except Exception as e:\n                errors.append({'quiz_id': quiz_id, 'error': str(e)})\n        \n        last_sync = request.data.get('last_sync')\n        new_quizzes = StudentQuiz.objects.filter(\n            subject__in=student_profile.subjects.values_list('subject_id', flat=True)\n        )\n        \n        if last_sync:\n            try:\n                last_sync_time = timezone.datetime.fromisoformat(last_sync.replace('Z', '+00:00'))\n                new_quizzes = new_quizzes.filter(created_at__gt=last_sync_time)\n            except:\n                pass\n        \n        return Response({\n            'synced_attempts': synced_attempts,\n            'errors': errors,\n            'new_content': {\n                'quizzes_count': new_quizzes.count(),\n                'last_sync': timezone.now().isoformat()\n            }\n        })\n","path":null,"size_bytes":32908,"size_tokens":null},"core/serializers.py":{"content":"from rest_framework import serializers\nfrom django.contrib.auth.models import User\nfrom django.contrib.auth import authenticate\nfrom django.utils import timezone\nfrom .models import (\n    PastPaper, Quiz, Subject, Grade, ExamBoard, \n    FormattedPaper, GeneratedAssignment, StudentProfile,\n    StudentExamBoard, StudentSubject, InteractiveQuestion,\n    StudentQuiz, StudentQuizAttempt, Note, Flashcard,\n    ExamPaper, StudentProgress, StudentQuizQuota\n)\n\n\nclass ExamBoardSerializer(serializers.ModelSerializer):\n    class Meta:\n        model = ExamBoard\n        fields = ['id', 'name_full', 'abbreviation', 'region']\n\n\nclass SubjectSerializer(serializers.ModelSerializer):\n    class Meta:\n        model = Subject\n        fields = ['id', 'name']\n\n\nclass GradeSerializer(serializers.ModelSerializer):\n    class Meta:\n        model = Grade\n        fields = ['id', 'number']\n\n\nclass PastPaperSerializer(serializers.ModelSerializer):\n    subject = SubjectSerializer(read_only=True)\n    grade = GradeSerializer(read_only=True)\n    file_url = serializers.SerializerMethodField()\n    file_size = serializers.SerializerMethodField()\n    \n    class Meta:\n        model = PastPaper\n        fields = [\n            'id', 'title', 'exam_board', 'year', 'subject', 'grade',\n            'chapter', 'section', 'file_url', 'file_size', 'uploaded_at'\n        ]\n    \n    def get_file_url(self, obj):\n        if obj.file:\n            request = self.context.get('request')\n            if request:\n                return request.build_absolute_uri(obj.file.url)\n            return obj.file.url\n        return None\n    \n    def get_file_size(self, obj):\n        if obj.file:\n            return obj.file.size\n        return None\n\n\nclass FormattedPaperSerializer(serializers.ModelSerializer):\n    subject = SubjectSerializer(read_only=True)\n    grade = GradeSerializer(read_only=True)\n    source_paper = PastPaperSerializer(read_only=True)\n    \n    class Meta:\n        model = FormattedPaper\n        fields = [\n            'id', 'title', 'exam_board', 'year', 'subject', 'grade',\n            'questions_json', 'memo_json', 'total_questions', 'total_marks',\n            'question_type', 'processing_status', 'is_published',\n            'source_paper', 'created_at'\n        ]\n\n\nclass QuizSerializer(serializers.ModelSerializer):\n    subject = SubjectSerializer(read_only=True)\n    grade = GradeSerializer(read_only=True)\n    \n    class Meta:\n        model = Quiz\n        fields = [\n            'id', 'title', 'exam_board', 'subject', 'grade', 'topic',\n            'is_premium', 'google_form_link', 'created_at'\n        ]\n\n\nclass GeneratedAssignmentSerializer(serializers.ModelSerializer):\n    subject = SubjectSerializer(read_only=True)\n    grade = GradeSerializer(read_only=True)\n    board = ExamBoardSerializer(read_only=True)\n    \n    class Meta:\n        model = GeneratedAssignment\n        fields = [\n            'id', 'title', 'subject', 'grade', 'board', 'question_type',\n            'instructions', 'content', 'file_url', 'created_at', 'due_date'\n        ]\n        read_only_fields = ['id', 'created_at']\n\n\nclass UserSerializer(serializers.ModelSerializer):\n    class Meta:\n        model = User\n        fields = ['id', 'username', 'email', 'first_name', 'last_name']\n        read_only_fields = ['id']\n\n\nclass StudentProfileSerializer(serializers.ModelSerializer):\n    user = UserSerializer(read_only=True)\n    grade = GradeSerializer(read_only=True)\n    exam_board_limit = serializers.SerializerMethodField()\n    subject_limit_per_board = serializers.SerializerMethodField()\n    \n    class Meta:\n        model = StudentProfile\n        fields = [\n            'id', 'user', 'subscription', 'parent_email', 'grade',\n            'email_verified', 'created_at', 'onboarding_completed',\n            'exam_board_limit', 'subject_limit_per_board'\n        ]\n        read_only_fields = ['id', 'user', 'email_verified', 'created_at']\n    \n    def get_exam_board_limit(self, obj):\n        return obj.get_exam_board_limit()\n    \n    def get_subject_limit_per_board(self, obj):\n        return obj.get_subject_limit_per_board()\n\n\nclass StudentExamBoardSerializer(serializers.ModelSerializer):\n    exam_board = ExamBoardSerializer(read_only=True)\n    exam_board_id = serializers.IntegerField(write_only=True)\n    \n    class Meta:\n        model = StudentExamBoard\n        fields = ['id', 'exam_board', 'exam_board_id', 'selected_at']\n        read_only_fields = ['id', 'selected_at']\n\n\nclass StudentSubjectSerializer(serializers.ModelSerializer):\n    subject = SubjectSerializer(read_only=True)\n    exam_board = ExamBoardSerializer(read_only=True)\n    subject_id = serializers.IntegerField(write_only=True)\n    exam_board_id = serializers.IntegerField(write_only=True)\n    \n    class Meta:\n        model = StudentSubject\n        fields = [\n            'id', 'subject', 'exam_board', 'subject_id', \n            'exam_board_id', 'selected_at'\n        ]\n        read_only_fields = ['id', 'selected_at']\n\n\nclass InteractiveQuestionSerializer(serializers.ModelSerializer):\n    subject = SubjectSerializer(read_only=True)\n    exam_board = ExamBoardSerializer(read_only=True)\n    grade = GradeSerializer(read_only=True)\n    question_image_url = serializers.SerializerMethodField()\n    \n    class Meta:\n        model = InteractiveQuestion\n        fields = [\n            'id', 'subject', 'exam_board', 'grade', 'topic',\n            'question_type', 'difficulty', 'question_text', \n            'question_image_url', 'options', 'correct_answer',\n            'matching_pairs', 'explanation', 'points', 'created_at'\n        ]\n        read_only_fields = ['id', 'created_at']\n    \n    def get_question_image_url(self, obj):\n        if obj.question_image:\n            request = self.context.get('request')\n            if request:\n                return request.build_absolute_uri(obj.question_image.url)\n            return obj.question_image.url\n        return None\n\n\nclass InteractiveQuestionWithoutAnswerSerializer(serializers.ModelSerializer):\n    subject = SubjectSerializer(read_only=True)\n    exam_board = ExamBoardSerializer(read_only=True)\n    grade = GradeSerializer(read_only=True)\n    question_image_url = serializers.SerializerMethodField()\n    \n    class Meta:\n        model = InteractiveQuestion\n        fields = [\n            'id', 'subject', 'exam_board', 'grade', 'topic',\n            'question_type', 'difficulty', 'question_text', \n            'question_image_url', 'options', 'matching_pairs', \n            'points'\n        ]\n        read_only_fields = ['id']\n    \n    def get_question_image_url(self, obj):\n        if obj.question_image:\n            request = self.context.get('request')\n            if request:\n                return request.build_absolute_uri(obj.question_image.url)\n            return obj.question_image.url\n        return None\n\n\nclass StudentQuizSerializer(serializers.ModelSerializer):\n    subject = SubjectSerializer(read_only=True)\n    exam_board = ExamBoardSerializer(read_only=True)\n    grade = GradeSerializer(read_only=True)\n    question_count = serializers.SerializerMethodField()\n    questions = InteractiveQuestionWithoutAnswerSerializer(many=True, read_only=True)\n    \n    class Meta:\n        model = StudentQuiz\n        fields = [\n            'id', 'title', 'subject', 'exam_board', 'grade', 'topic',\n            'difficulty', 'length', 'is_pro_content', 'created_at',\n            'question_count', 'questions'\n        ]\n        read_only_fields = ['id', 'created_at']\n    \n    def get_question_count(self, obj):\n        return obj.questions.count()\n\n\nclass StudentQuizListSerializer(serializers.ModelSerializer):\n    subject = SubjectSerializer(read_only=True)\n    exam_board = ExamBoardSerializer(read_only=True)\n    grade = GradeSerializer(read_only=True)\n    question_count = serializers.SerializerMethodField()\n    \n    class Meta:\n        model = StudentQuiz\n        fields = [\n            'id', 'title', 'subject', 'exam_board', 'grade', 'topic',\n            'difficulty', 'length', 'is_pro_content', 'created_at',\n            'question_count'\n        ]\n        read_only_fields = ['id', 'created_at']\n    \n    def get_question_count(self, obj):\n        return obj.questions.count()\n\n\nclass StudentQuizAttemptSerializer(serializers.ModelSerializer):\n    quiz = StudentQuizListSerializer(read_only=True)\n    quiz_id = serializers.IntegerField(write_only=True)\n    percentage_display = serializers.SerializerMethodField()\n    \n    class Meta:\n        model = StudentQuizAttempt\n        fields = [\n            'id', 'quiz', 'quiz_id', 'started_at', 'completed_at',\n            'is_timed', 'time_limit_minutes', 'show_instant_feedback',\n            'answers', 'score', 'percentage', 'percentage_display'\n        ]\n        read_only_fields = ['id', 'started_at', 'score', 'percentage']\n    \n    def get_percentage_display(self, obj):\n        if obj.percentage:\n            return f\"{obj.percentage}%\"\n        return None\n\n\nclass NoteSerializer(serializers.ModelSerializer):\n    subject = SubjectSerializer(read_only=True)\n    exam_board = ExamBoardSerializer(read_only=True)\n    grade = GradeSerializer(read_only=True)\n    full_version_url = serializers.SerializerMethodField()\n    summary_version_url = serializers.SerializerMethodField()\n    \n    class Meta:\n        model = Note\n        fields = [\n            'id', 'title', 'subject', 'exam_board', 'grade', 'topic',\n            'full_version_url', 'summary_version_url', \n            'full_version_text', 'summary_version_text',\n            'created_at', 'updated_at'\n        ]\n        read_only_fields = ['id', 'created_at', 'updated_at']\n    \n    def get_full_version_url(self, obj):\n        if obj.full_version:\n            request = self.context.get('request')\n            if request:\n                return request.build_absolute_uri(obj.full_version.url)\n            return obj.full_version.url\n        return None\n    \n    def get_summary_version_url(self, obj):\n        if obj.summary_version:\n            request = self.context.get('request')\n            if request:\n                return request.build_absolute_uri(obj.summary_version.url)\n            return obj.summary_version.url\n        return None\n\n\nclass FlashcardSerializer(serializers.ModelSerializer):\n    subject = SubjectSerializer(read_only=True)\n    exam_board = ExamBoardSerializer(read_only=True)\n    grade = GradeSerializer(read_only=True)\n    image_front_url = serializers.SerializerMethodField()\n    image_back_url = serializers.SerializerMethodField()\n    \n    class Meta:\n        model = Flashcard\n        fields = [\n            'id', 'subject', 'exam_board', 'grade', 'topic',\n            'front_text', 'back_text', 'image_front_url', \n            'image_back_url', 'created_at'\n        ]\n        read_only_fields = ['id', 'created_at']\n    \n    def get_image_front_url(self, obj):\n        if obj.image_front:\n            request = self.context.get('request')\n            if request:\n                return request.build_absolute_uri(obj.image_front.url)\n            return obj.image_front.url\n        return None\n    \n    def get_image_back_url(self, obj):\n        if obj.image_back:\n            request = self.context.get('request')\n            if request:\n                return request.build_absolute_uri(obj.image_back.url)\n            return obj.image_back.url\n        return None\n\n\nclass ExamPaperSerializer(serializers.ModelSerializer):\n    subject = SubjectSerializer(read_only=True)\n    exam_board = ExamBoardSerializer(read_only=True)\n    grade = GradeSerializer(read_only=True)\n    paper_file_url = serializers.SerializerMethodField()\n    marking_scheme_url = serializers.SerializerMethodField()\n    question_count = serializers.SerializerMethodField()\n    \n    class Meta:\n        model = ExamPaper\n        fields = [\n            'id', 'title', 'subject', 'exam_board', 'grade', 'year',\n            'paper_file_url', 'marking_scheme_url', 'has_interactive_version',\n            'is_pro_content', 'created_at', 'question_count'\n        ]\n        read_only_fields = ['id', 'created_at']\n    \n    def get_paper_file_url(self, obj):\n        if obj.paper_file:\n            request = self.context.get('request')\n            if request:\n                return request.build_absolute_uri(obj.paper_file.url)\n            return obj.paper_file.url\n        return None\n    \n    def get_marking_scheme_url(self, obj):\n        if obj.marking_scheme:\n            request = self.context.get('request')\n            if request:\n                return request.build_absolute_uri(obj.marking_scheme.url)\n            return obj.marking_scheme.url\n        return None\n    \n    def get_question_count(self, obj):\n        return obj.interactive_questions.count()\n\n\nclass StudentProgressSerializer(serializers.ModelSerializer):\n    subject = SubjectSerializer(read_only=True)\n    pass_rate = serializers.SerializerMethodField()\n    \n    class Meta:\n        model = StudentProgress\n        fields = [\n            'id', 'subject', 'topic', 'quizzes_attempted', \n            'quizzes_passed', 'average_score', 'pass_rate',\n            'notes_viewed', 'flashcards_reviewed', 'last_activity'\n        ]\n        read_only_fields = ['id', 'last_activity']\n    \n    def get_pass_rate(self, obj):\n        if obj.quizzes_attempted > 0:\n            return (obj.quizzes_passed / obj.quizzes_attempted) * 100\n        return 0\n\n\nclass StudentRegisterSerializer(serializers.Serializer):\n    username = serializers.CharField(max_length=150)\n    email = serializers.EmailField()\n    password = serializers.CharField(write_only=True, min_length=8)\n    parent_email = serializers.EmailField(required=False, allow_blank=True)\n    first_name = serializers.CharField(max_length=150, required=False, allow_blank=True)\n    last_name = serializers.CharField(max_length=150, required=False, allow_blank=True)\n    \n    def validate_username(self, value):\n        if User.objects.filter(username=value).exists():\n            raise serializers.ValidationError(\"Username already exists.\")\n        return value\n    \n    def validate_email(self, value):\n        if User.objects.filter(email=value).exists():\n            raise serializers.ValidationError(\"Email already registered.\")\n        return value\n    \n    def create(self, validated_data):\n        parent_email = validated_data.pop('parent_email', '')\n        user = User.objects.create_user(\n            username=validated_data['username'],\n            email=validated_data['email'],\n            password=validated_data['password'],\n            first_name=validated_data.get('first_name', ''),\n            last_name=validated_data.get('last_name', ''),\n            is_active=False\n        )\n        \n        import secrets\n        verification_token = secrets.token_urlsafe(32)\n        \n        StudentProfile.objects.create(\n            user=user,\n            parent_email=parent_email,\n            verification_token=verification_token,\n            verification_token_created=timezone.now()\n        )\n        \n        return user\n\n\nclass StudentLoginSerializer(serializers.Serializer):\n    username = serializers.CharField()\n    password = serializers.CharField(write_only=True)\n    \n    def validate(self, attrs):\n        username = attrs.get('username')\n        password = attrs.get('password')\n        \n        if username and password:\n            user = authenticate(username=username, password=password)\n            \n            if not user:\n                raise serializers.ValidationError(\"Invalid credentials.\")\n            \n            if not user.is_active:\n                raise serializers.ValidationError(\"Email verification required.\")\n            \n            if not hasattr(user, 'student_profile'):\n                raise serializers.ValidationError(\"Not a student account.\")\n            \n            attrs['user'] = user\n            return attrs\n        \n        raise serializers.ValidationError(\"Must include username and password.\")\n\n\nclass StudentOnboardingSerializer(serializers.Serializer):\n    grade_id = serializers.IntegerField()\n    exam_board_ids = serializers.ListField(\n        child=serializers.IntegerField(),\n        min_length=1,\n        max_length=5\n    )\n    subject_data = serializers.ListField(\n        child=serializers.DictField(),\n        min_length=1\n    )\n    \n    def validate_grade_id(self, value):\n        if not Grade.objects.filter(id=value).exists():\n            raise serializers.ValidationError(\"Invalid grade ID.\")\n        return value\n    \n    def validate_exam_board_ids(self, value):\n        student_profile = self.context['request'].user.student_profile\n        if len(value) > student_profile.get_exam_board_limit():\n            raise serializers.ValidationError(\n                f\"Maximum {student_profile.get_exam_board_limit()} exam boards allowed.\"\n            )\n        \n        if not all(ExamBoard.objects.filter(id=board_id).exists() for board_id in value):\n            raise serializers.ValidationError(\"One or more invalid exam board IDs.\")\n        \n        return value\n    \n    def validate_subject_data(self, value):\n        for item in value:\n            if 'subject_id' not in item or 'exam_board_id' not in item:\n                raise serializers.ValidationError(\n                    \"Each subject must have subject_id and exam_board_id.\"\n                )\n        return value\n","path":null,"size_bytes":17307,"size_tokens":null},"core/api_urls.py":{"content":"from django.urls import path, include\nfrom rest_framework.routers import DefaultRouter\nfrom rest_framework.authtoken.views import obtain_auth_token\nfrom rest_framework import permissions\nfrom drf_yasg.views import get_schema_view\nfrom drf_yasg import openapi\nfrom .api_views import (\n    ExamBoardViewSet, SubjectViewSet, GradeViewSet,\n    PastPaperViewSet, FormattedPaperViewSet, QuizViewSet,\n    AssignmentViewSet, StudentRegisterView, StudentLoginView,\n    StudentVerifyEmailView, StudentOnboardingView, StudentProfileViewSet,\n    StudentQuizViewSet, StudentQuizAttemptViewSet, NoteViewSet,\n    FlashcardViewSet, ExamPaperViewSet, StudentProgressViewSet,\n    BulkQuizzesView, BulkNotesView, BulkFlashcardsView, SyncView\n)\n\nschema_view = get_schema_view(\n    openapi.Info(\n        title=\"Student EdTech API\",\n        default_version='v1',\n        description=\"\"\"\n        Comprehensive REST API for Student Mobile Application\n        \n        ## Authentication\n        Use Token authentication for all protected endpoints.\n        Include the token in the Authorization header: `Authorization: Token <your-token>`\n        \n        ## Student Features\n        - User registration and authentication\n        - Profile management with onboarding\n        - Interactive quizzes with instant feedback\n        - Study notes and flashcards\n        - Past exam papers\n        - Progress tracking and analytics\n        - Offline support with bulk download and sync\n        \n        ## Free vs Pro Subscription\n        - Free: Access to 2 exam boards, limited quizzes per topic\n        - Pro (R100/month): Access to 5 exam boards, unlimited quizzes, premium content\n        \"\"\",\n        terms_of_service=\"https://www.example.com/terms/\",\n        contact=openapi.Contact(email=\"support@example.com\"),\n        license=openapi.License(name=\"Proprietary\"),\n    ),\n    public=True,\n    permission_classes=(permissions.AllowAny,),\n)\n\nrouter = DefaultRouter()\nrouter.register(r'exam-boards', ExamBoardViewSet, basename='examboard')\nrouter.register(r'subjects', SubjectViewSet, basename='subject')\nrouter.register(r'grades', GradeViewSet, basename='grade')\nrouter.register(r'past-papers', PastPaperViewSet, basename='pastpaper')\nrouter.register(r'formatted-papers', FormattedPaperViewSet, basename='formattedpaper')\nrouter.register(r'quizzes', QuizViewSet, basename='quiz')\nrouter.register(r'assignments', AssignmentViewSet, basename='assignment')\n\nstudent_router = DefaultRouter()\nstudent_router.register(r'profile', StudentProfileViewSet, basename='student-profile')\nstudent_router.register(r'quizzes', StudentQuizViewSet, basename='student-quiz')\nstudent_router.register(r'quiz-attempts', StudentQuizAttemptViewSet, basename='student-quiz-attempt')\nstudent_router.register(r'notes', NoteViewSet, basename='student-note')\nstudent_router.register(r'flashcards', FlashcardViewSet, basename='student-flashcard')\nstudent_router.register(r'exam-papers', ExamPaperViewSet, basename='student-exam-paper')\nstudent_router.register(r'progress', StudentProgressViewSet, basename='student-progress')\n\nurlpatterns = [\n    path('swagger/', schema_view.with_ui('swagger', cache_timeout=0), name='schema-swagger-ui'),\n    path('redoc/', schema_view.with_ui('redoc', cache_timeout=0), name='schema-redoc'),\n    path('swagger.json', schema_view.without_ui(cache_timeout=0), name='schema-json'),\n    \n    path('', include(router.urls)),\n    path('auth/token/', obtain_auth_token, name='api_token_auth'),\n    \n    path('student/register/', StudentRegisterView.as_view(), name='student-register'),\n    path('student/login/', StudentLoginView.as_view(), name='student-login'),\n    path('student/verify-email/', StudentVerifyEmailView.as_view(), name='student-verify-email'),\n    path('student/onboarding/', StudentOnboardingView.as_view(), name='student-onboarding'),\n    \n    path('student/', include(student_router.urls)),\n    \n    path('student/bulk/quizzes/', BulkQuizzesView.as_view(), name='student-bulk-quizzes'),\n    path('student/bulk/notes/', BulkNotesView.as_view(), name='student-bulk-notes'),\n    path('student/bulk/flashcards/', BulkFlashcardsView.as_view(), name='student-bulk-flashcards'),\n    path('student/sync/', SyncView.as_view(), name='student-sync'),\n]\n","path":null,"size_bytes":4238,"size_tokens":null},"core/migrations/0014_formattedpaper.py":{"content":"# Generated by Django 5.0.2 on 2025-10-22 22:24\n\nimport django.db.models.deletion\nfrom django.conf import settings\nfrom django.db import migrations, models\n\n\nclass Migration(migrations.Migration):\n\n    dependencies = [\n        ('core', '0013_alter_userprofile_role'),\n        migrations.swappable_dependency(settings.AUTH_USER_MODEL),\n    ]\n\n    operations = [\n        migrations.CreateModel(\n            name='FormattedPaper',\n            fields=[\n                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),\n                ('title', models.CharField(max_length=300)),\n                ('exam_board', models.CharField(choices=[('Cambridge', 'Cambridge International'), ('Edexcel', 'Edexcel'), ('GED', 'GED'), ('CAPS', 'CAPS (South Africa)'), ('IEB', 'IEB (South Africa)'), ('ZIMSEC', 'ZIMSEC (Zimbabwe)'), ('NSSC', 'Namibia Senior Secondary Certificate'), ('ZEC', 'Zambia Examinations Council'), ('other', 'Other (Specify in notes)')], max_length=50)),\n                ('year', models.IntegerField()),\n                ('questions_json', models.JSONField()),\n                ('memo_json', models.JSONField()),\n                ('question_type', models.CharField(choices=[('mcq', 'Multiple Choice'), ('structured', 'Structured'), ('free_response', 'Free Response'), ('mixed', 'Mixed')], default='mixed', max_length=20)),\n                ('total_questions', models.IntegerField(default=0)),\n                ('total_marks', models.IntegerField(default=0)),\n                ('is_ai_generated', models.BooleanField(default=True)),\n                ('ai_model_used', models.CharField(blank=True, max_length=50)),\n                ('processing_status', models.CharField(choices=[('pending', 'Pending'), ('processing', 'Processing'), ('completed', 'Completed'), ('failed', 'Failed')], default='pending', max_length=20)),\n                ('error_message', models.TextField(blank=True)),\n                ('created_at', models.DateTimeField(auto_now_add=True)),\n                ('updated_at', models.DateTimeField(auto_now=True)),\n                ('reviewed', models.BooleanField(default=False)),\n                ('is_published', models.BooleanField(default=False)),\n                ('created_by', models.ForeignKey(null=True, on_delete=django.db.models.deletion.SET_NULL, to=settings.AUTH_USER_MODEL)),\n                ('grade', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, to='core.grade')),\n                ('source_paper', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='formatted_versions', to='core.pastpaper')),\n                ('subject', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, to='core.subject')),\n            ],\n            options={\n                'ordering': ['-created_at'],\n                'indexes': [models.Index(fields=['subject', 'grade', 'exam_board'], name='core_format_subject_85f050_idx'), models.Index(fields=['processing_status'], name='core_format_process_99a756_idx'), models.Index(fields=['is_published'], name='core_format_is_publ_663f8c_idx')],\n            },\n        ),\n    ]\n","path":null,"size_bytes":3121,"size_tokens":null},"core/static/core/css/modern-dashboard.css":{"content":"/* ==========================================\n   Modern Dashboard Styling\n   Windows 11 + iPhone Aesthetic\n   ========================================== */\n\n:root {\n    /* Color System - Warmer Palette */\n    --primary-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\n    --success-gradient: linear-gradient(135deg, #10b981 0%, #059669 100%);\n    --warning-gradient: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);\n    --danger-gradient: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);\n    \n    /* Glassmorphism */\n    --glass-bg: rgba(255, 255, 255, 0.85);\n    --glass-border: rgba(255, 255, 255, 0.3);\n    --glass-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.1);\n    \n    /* Shadows - Multi-layer for depth */\n    --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.05);\n    --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);\n    --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);\n    --shadow-xl: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);\n    --shadow-2xl: 0 25px 50px -12px rgba(0, 0, 0, 0.25);\n    \n    /* Rounded Corners (Windows 11 Standard) */\n    --radius-sm: 4px;\n    --radius-md: 8px;\n    --radius-lg: 12px;\n    --radius-xl: 16px;\n    \n    /* Spacing */\n    --spacing-xs: 0.5rem;\n    --spacing-sm: 0.75rem;\n    --spacing-md: 1rem;\n    --spacing-lg: 1.5rem;\n    --spacing-xl: 2rem;\n    --spacing-2xl: 3rem;\n    \n    /* Transitions */\n    --transition-fast: 150ms cubic-bezier(0.4, 0, 0.2, 1);\n    --transition-base: 200ms cubic-bezier(0.4, 0, 0.2, 1);\n    --transition-slow: 300ms cubic-bezier(0.4, 0, 0.2, 1);\n}\n\n/* ==========================================\n   Global Resets & Improvements\n   ========================================== */\n\n* {\n    -webkit-font-smoothing: antialiased;\n    -moz-osx-font-smoothing: grayscale;\n}\n\nbody {\n    background: linear-gradient(135deg, #f5f7fa 0%, #e9ecef 100%);\n    background-attachment: fixed;\n}\n\n/* ==========================================\n   Glass Cards - Premium Look\n   ========================================== */\n\n.glass-card {\n    background: var(--glass-bg);\n    backdrop-filter: blur(10px);\n    -webkit-backdrop-filter: blur(10px);\n    border: 1px solid var(--glass-border);\n    border-radius: var(--radius-md);\n    box-shadow: var(--shadow-lg);\n    transition: all var(--transition-base);\n}\n\n.glass-card:hover {\n    transform: translateY(-2px);\n    box-shadow: var(--shadow-xl);\n}\n\n/* ==========================================\n   Stat Cards with Modern Design\n   ========================================== */\n\n.stat-card {\n    background: white;\n    border-radius: var(--radius-md);\n    padding: 1.5rem;\n    box-shadow: var(--shadow-md);\n    transition: all var(--transition-base);\n    position: relative;\n    overflow: hidden;\n}\n\n.stat-card::before {\n    content: '';\n    position: absolute;\n    top: 0;\n    left: 0;\n    right: 0;\n    height: 3px;\n    background: var(--primary-gradient);\n    opacity: 0;\n    transition: opacity var(--transition-base);\n}\n\n.stat-card:hover {\n    transform: translateY(-4px);\n    box-shadow: var(--shadow-xl);\n}\n\n.stat-card:hover::before {\n    opacity: 1;\n}\n\n.stat-icon-wrapper {\n    width: 56px;\n    height: 56px;\n    border-radius: var(--radius-md);\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    position: relative;\n    transition: transform var(--transition-base);\n}\n\n.stat-card:hover .stat-icon-wrapper {\n    transform: scale(1.1) rotate(5deg);\n}\n\n.stat-icon-wrapper::before {\n    content: '';\n    position: absolute;\n    inset: -2px;\n    border-radius: inherit;\n    padding: 2px;\n    background: linear-gradient(135deg, rgba(255,255,255,0.5), rgba(255,255,255,0));\n    -webkit-mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0);\n    -webkit-mask-composite: xor;\n    mask-composite: exclude;\n    opacity: 0;\n    transition: opacity var(--transition-base);\n}\n\n.stat-card:hover .stat-icon-wrapper::before {\n    opacity: 1;\n}\n\n/* Icon gradient backgrounds */\n.icon-indigo {\n    background: linear-gradient(135deg, #818cf8 0%, #6366f1 100%);\n    box-shadow: 0 4px 12px rgba(99, 102, 241, 0.3);\n}\n\n.icon-green {\n    background: linear-gradient(135deg, #34d399 0%, #10b981 100%);\n    box-shadow: 0 4px 12px rgba(16, 185, 129, 0.3);\n}\n\n.icon-yellow {\n    background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%);\n    box-shadow: 0 4px 12px rgba(245, 158, 11, 0.3);\n}\n\n.icon-purple {\n    background: linear-gradient(135deg, #a78bfa 0%, #8b5cf6 100%);\n    box-shadow: 0 4px 12px rgba(139, 92, 246, 0.3);\n}\n\n/* ==========================================\n   Action Cards with Gradient Hover\n   ========================================== */\n\n.action-card {\n    background: white;\n    border-radius: var(--radius-md);\n    padding: 1.75rem;\n    box-shadow: var(--shadow-md);\n    border: 1px solid rgba(0, 0, 0, 0.05);\n    transition: all var(--transition-slow);\n    position: relative;\n    overflow: hidden;\n}\n\n.action-card::before {\n    content: '';\n    position: absolute;\n    inset: 0;\n    background: var(--primary-gradient);\n    opacity: 0;\n    transition: opacity var(--transition-slow);\n    z-index: 0;\n}\n\n.action-card:hover::before {\n    opacity: 0.03;\n}\n\n.action-card:hover {\n    transform: translateY(-6px) scale(1.02);\n    box-shadow: var(--shadow-2xl);\n    border-color: rgba(102, 126, 234, 0.2);\n}\n\n.action-card > * {\n    position: relative;\n    z-index: 1;\n}\n\n.action-icon-wrapper {\n    width: 48px;\n    height: 48px;\n    border-radius: var(--radius-md);\n    display: inline-flex;\n    align-items: center;\n    justify-content: center;\n    transition: all var(--transition-base);\n}\n\n.action-card:hover .action-icon-wrapper {\n    transform: scale(1.15) rotate(-5deg);\n    box-shadow: 0 8px 16px rgba(0, 0, 0, 0.15);\n}\n\n.action-arrow {\n    transition: all var(--transition-base);\n    opacity: 0.4;\n}\n\n.action-card:hover .action-arrow {\n    opacity: 1;\n    transform: translateX(4px);\n}\n\n/* ==========================================\n   Gradient Buttons\n   ========================================== */\n\n.btn-gradient {\n    background: var(--primary-gradient);\n    color: white;\n    font-weight: 600;\n    padding: 0.75rem 1.5rem;\n    border-radius: var(--radius-sm);\n    border: none;\n    box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);\n    transition: all var(--transition-base);\n    position: relative;\n    overflow: hidden;\n}\n\n.btn-gradient::before {\n    content: '';\n    position: absolute;\n    inset: 0;\n    background: linear-gradient(135deg, rgba(255,255,255,0.2), transparent);\n    opacity: 0;\n    transition: opacity var(--transition-base);\n}\n\n.btn-gradient:hover {\n    transform: translateY(-2px) scale(1.05);\n    box-shadow: 0 6px 20px rgba(102, 126, 234, 0.5);\n}\n\n.btn-gradient:hover::before {\n    opacity: 1;\n}\n\n.btn-gradient:active {\n    transform: translateY(0) scale(0.98);\n}\n\n/* ==========================================\n   Modern Sidebar\n   ========================================== */\n\n.sidebar {\n    background: linear-gradient(180deg, #1f2937 0%, #111827 100%);\n    box-shadow: 4px 0 24px rgba(0, 0, 0, 0.15);\n}\n\n.sidebar-nav-item {\n    position: relative;\n    border-radius: var(--radius-sm);\n    margin: 0.25rem 0;\n    transition: all var(--transition-base);\n}\n\n.sidebar-nav-item::before {\n    content: '';\n    position: absolute;\n    left: -0.5rem;\n    top: 50%;\n    transform: translateY(-50%);\n    width: 3px;\n    height: 0;\n    background: var(--primary-gradient);\n    border-radius: 0 2px 2px 0;\n    transition: height var(--transition-base);\n}\n\n.sidebar-nav-item.active::before,\n.sidebar-nav-item:hover::before {\n    height: 70%;\n}\n\n.sidebar-nav-item.active {\n    background: rgba(99, 102, 241, 0.15);\n}\n\n.sidebar-nav-item:not(.active):hover {\n    background: rgba(255, 255, 255, 0.05);\n}\n\n.sidebar-nav-item i {\n    transition: transform var(--transition-base);\n}\n\n.sidebar-nav-item:hover i {\n    transform: scale(1.1);\n}\n\n/* ==========================================\n   Typography Enhancements\n   ========================================== */\n\n.heading-primary {\n    font-size: 2rem;\n    font-weight: 700;\n    line-height: 1.2;\n    letter-spacing: -0.025em;\n    background: linear-gradient(135deg, #1f2937 0%, #4b5563 100%);\n    -webkit-background-clip: text;\n    -webkit-text-fill-color: transparent;\n    background-clip: text;\n}\n\n.heading-secondary {\n    font-size: 1.5rem;\n    font-weight: 600;\n    line-height: 1.3;\n    color: #1f2937;\n}\n\n.text-gradient {\n    background: var(--primary-gradient);\n    -webkit-background-clip: text;\n    -webkit-text-fill-color: transparent;\n    background-clip: text;\n}\n\n/* ==========================================\n   Upgrade Banner - Premium\n   ========================================== */\n\n.upgrade-banner {\n    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\n    border-radius: var(--radius-md);\n    padding: 2rem;\n    box-shadow: var(--shadow-xl);\n    position: relative;\n    overflow: hidden;\n}\n\n.upgrade-banner::before {\n    content: '';\n    position: absolute;\n    top: -50%;\n    right: -10%;\n    width: 400px;\n    height: 400px;\n    background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 70%);\n    border-radius: 50%;\n}\n\n.upgrade-banner::after {\n    content: '';\n    position: absolute;\n    bottom: -30%;\n    left: -5%;\n    width: 300px;\n    height: 300px;\n    background: radial-gradient(circle, rgba(255,255,255,0.08) 0%, transparent 70%);\n    border-radius: 50%;\n}\n\n.upgrade-banner > * {\n    position: relative;\n    z-index: 1;\n}\n\n/* ==========================================\n   Loading Skeletons\n   ========================================== */\n\n.skeleton {\n    background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);\n    background-size: 200% 100%;\n    animation: loading 1.5s ease-in-out infinite;\n    border-radius: var(--radius-sm);\n}\n\n@keyframes loading {\n    0% {\n        background-position: 200% 0;\n    }\n    100% {\n        background-position: -200% 0;\n    }\n}\n\n/* ==========================================\n   Smooth Animations\n   ========================================== */\n\n@keyframes fadeInUp {\n    from {\n        opacity: 0;\n        transform: translateY(20px);\n    }\n    to {\n        opacity: 1;\n        transform: translateY(0);\n    }\n}\n\n@keyframes slideInRight {\n    from {\n        opacity: 0;\n        transform: translateX(-20px);\n    }\n    to {\n        opacity: 1;\n        transform: translateX(0);\n    }\n}\n\n@keyframes scaleIn {\n    from {\n        opacity: 0;\n        transform: scale(0.9);\n    }\n    to {\n        opacity: 1;\n        transform: scale(1);\n    }\n}\n\n.animate-fade-in-up {\n    animation: fadeInUp 0.6s cubic-bezier(0.4, 0, 0.2, 1) forwards;\n}\n\n.animate-slide-in-right {\n    animation: slideInRight 0.5s cubic-bezier(0.4, 0, 0.2, 1) forwards;\n}\n\n.animate-scale-in {\n    animation: scaleIn 0.4s cubic-bezier(0.4, 0, 0.2, 1) forwards;\n}\n\n/* Stagger animation delays */\n.delay-100 { animation-delay: 100ms; }\n.delay-200 { animation-delay: 200ms; }\n.delay-300 { animation-delay: 300ms; }\n.delay-400 { animation-delay: 400ms; }\n\n/* ==========================================\n   Responsive Design\n   ========================================== */\n\n@media (max-width: 768px) {\n    .stat-card {\n        padding: 1.25rem;\n    }\n    \n    .action-card {\n        padding: 1.5rem;\n    }\n    \n    .heading-primary {\n        font-size: 1.75rem;\n    }\n}\n\n/* ==========================================\n   Accessibility & Focus States\n   ========================================== */\n\n.action-card:focus-visible,\n.btn-gradient:focus-visible {\n    outline: 3px solid rgba(99, 102, 241, 0.5);\n    outline-offset: 2px;\n}\n\n/* ==========================================\n   Progress Bars\n   ========================================== */\n\n.progress-bar-wrapper {\n    height: 6px;\n    background: rgba(0, 0, 0, 0.05);\n    border-radius: 999px;\n    overflow: hidden;\n    margin-top: 0.75rem;\n}\n\n.progress-bar {\n    height: 100%;\n    background: var(--primary-gradient);\n    border-radius: 999px;\n    transition: width var(--transition-slow);\n    position: relative;\n}\n\n.progress-bar::after {\n    content: '';\n    position: absolute;\n    inset: 0;\n    background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);\n    animation: shimmer 2s infinite;\n}\n\n@keyframes shimmer {\n    0% { transform: translateX(-100%); }\n    100% { transform: translateX(100%); }\n}\n","path":null,"size_bytes":12387,"size_tokens":null},"core/static/core/css/content-theme.css":{"content":"/* ==========================================\n   Content Management Portal Color Theme\n   Orange/Teal Theme Override\n   ========================================== */\n\n:root {\n    /* Content Portal Color System - Orange/Teal */\n    --primary-gradient: linear-gradient(135deg, #f97316 0%, #ea580c 100%);\n    --primary-light: #fb923c;\n    --primary-dark: #c2410c;\n    \n    /* Sidebar Colors */\n    --sidebar-bg: linear-gradient(180deg, #1f2937 0%, #111827 100%);\n    --sidebar-active-bg: rgba(249, 115, 22, 0.15);\n    --sidebar-hover-bg: rgba(249, 115, 22, 0.08);\n    --sidebar-text: #d1d5db;\n    --sidebar-text-active: #ffffff;\n    --sidebar-icon: #9ca3af;\n    --sidebar-accent: linear-gradient(135deg, #f97316 0%, #ea580c 100%);\n    \n    /* Card Accents */\n    --card-accent-gradient: linear-gradient(135deg, #f97316 0%, #ea580c 100%);\n    \n    /* Icon Gradients - Content Theme */\n    --icon-gradient-1: linear-gradient(135deg, #fb923c 0%, #f97316 100%);\n    --icon-gradient-2: linear-gradient(135deg, #14b8a6 0%, #0d9488 100%);\n    --icon-gradient-3: linear-gradient(135deg, #06b6d4 0%, #0891b2 100%);\n    --icon-gradient-4: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%);\n}\n\n/* Sidebar Styling */\n.sidebar-content {\n    background: var(--sidebar-bg);\n    box-shadow: 4px 0 24px rgba(249, 115, 22, 0.15);\n}\n\n.sidebar-content .sidebar-nav-item::before {\n    background: var(--sidebar-accent);\n}\n\n.sidebar-content .sidebar-nav-item.active {\n    background: var(--sidebar-active-bg);\n    color: var(--sidebar-text-active);\n}\n\n.sidebar-content .sidebar-nav-item:not(.active):hover {\n    background: var(--sidebar-hover-bg);\n}\n\n/* Content-specific icon colors */\n.icon-content-primary {\n    background: linear-gradient(135deg, #fb923c 0%, #f97316 100%);\n    box-shadow: 0 4px 12px rgba(249, 115, 22, 0.4);\n}\n\n.icon-content-secondary {\n    background: linear-gradient(135deg, #14b8a6 0%, #0d9488 100%);\n    box-shadow: 0 4px 12px rgba(20, 184, 166, 0.4);\n}\n\n.icon-content-tertiary {\n    background: linear-gradient(135deg, #06b6d4 0%, #0891b2 100%);\n    box-shadow: 0 4px 12px rgba(6, 182, 212, 0.4);\n}\n\n.icon-content-accent {\n    background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%);\n    box-shadow: 0 4px 12px rgba(139, 92, 246, 0.4);\n}\n\n/* Logo gradient for content */\n.logo-gradient-content {\n    background: linear-gradient(135deg, #f97316 0%, #14b8a6 100%);\n}\n\n/* Progress bar for content */\n.progress-bar-content {\n    background: linear-gradient(135deg, #f97316 0%, #14b8a6 100%);\n}\n\n/* Text gradient for content */\n.text-gradient-content {\n    background: linear-gradient(135deg, #f97316 0%, #14b8a6 100%);\n    -webkit-background-clip: text;\n    -webkit-text-fill-color: transparent;\n    background-clip: text;\n}\n\n/* Content feature banners */\n.feature-banner-content {\n    background: linear-gradient(135deg, #f97316 0%, #14b8a6 100%);\n}\n","path":null,"size_bytes":2855,"size_tokens":null},"core/static/core/css/admin-theme.css":{"content":"/* ==========================================\n   Admin Portal Color Theme\n   Purple/Indigo Theme Override\n   ========================================== */\n\n:root {\n    /* Admin Color System - Purple/Indigo */\n    --primary-gradient: linear-gradient(135deg, #6366f1 0%, #4f46e5 100%);\n    --primary-light: #818cf8;\n    --primary-dark: #4338ca;\n    \n    /* Sidebar Colors */\n    --sidebar-bg: linear-gradient(180deg, #4c1d95 0%, #3730a3 100%);\n    --sidebar-active-bg: rgba(99, 102, 241, 0.2);\n    --sidebar-hover-bg: rgba(99, 102, 241, 0.1);\n    --sidebar-text: #e0e7ff;\n    --sidebar-text-active: #ffffff;\n    --sidebar-icon: #a5b4fc;\n    --sidebar-accent: linear-gradient(135deg, #818cf8 0%, #6366f1 100%);\n    \n    /* Card Accents */\n    --card-accent-gradient: linear-gradient(135deg, #6366f1 0%, #4f46e5 100%);\n    \n    /* Icon Gradients - Admin Theme */\n    --icon-gradient-1: linear-gradient(135deg, #818cf8 0%, #6366f1 100%);\n    --icon-gradient-2: linear-gradient(135deg, #a78bfa 0%, #8b5cf6 100%);\n    --icon-gradient-3: linear-gradient(135deg, #c084fc 0%, #a855f7 100%);\n    --icon-gradient-4: linear-gradient(135deg, #e879f9 0%, #d946ef 100%);\n}\n\n/* Sidebar Styling */\n.sidebar-admin {\n    background: var(--sidebar-bg);\n    box-shadow: 4px 0 24px rgba(79, 70, 229, 0.2);\n}\n\n.sidebar-admin .sidebar-nav-item::before {\n    background: var(--sidebar-accent);\n}\n\n.sidebar-admin .sidebar-nav-item.active {\n    background: var(--sidebar-active-bg);\n    color: var(--sidebar-text-active);\n}\n\n.sidebar-admin .sidebar-nav-item:not(.active):hover {\n    background: var(--sidebar-hover-bg);\n}\n\n/* Admin-specific icon colors */\n.icon-admin-primary {\n    background: linear-gradient(135deg, #818cf8 0%, #6366f1 100%);\n    box-shadow: 0 4px 12px rgba(99, 102, 241, 0.4);\n}\n\n.icon-admin-secondary {\n    background: linear-gradient(135deg, #a78bfa 0%, #8b5cf6 100%);\n    box-shadow: 0 4px 12px rgba(139, 92, 246, 0.4);\n}\n\n.icon-admin-tertiary {\n    background: linear-gradient(135deg, #c084fc 0%, #a855f7 100%);\n    box-shadow: 0 4px 12px rgba(168, 85, 247, 0.4);\n}\n\n.icon-admin-accent {\n    background: linear-gradient(135deg, #e879f9 0%, #d946ef 100%);\n    box-shadow: 0 4px 12px rgba(217, 70, 239, 0.4);\n}\n\n/* Logo gradient for admin */\n.logo-gradient-admin {\n    background: linear-gradient(135deg, #818cf8 0%, #a78bfa 100%);\n}\n\n/* Progress bar for admin */\n.progress-bar-admin {\n    background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);\n}\n\n/* Text gradient for admin */\n.text-gradient-admin {\n    background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);\n    -webkit-background-clip: text;\n    -webkit-text-fill-color: transparent;\n    background-clip: text;\n}\n\n/* Admin upgrade/feature banners */\n.feature-banner-admin {\n    background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);\n}\n","path":null,"size_bytes":2806,"size_tokens":null},"core/migrations/0018_flashcard_interactivequestion_exampaper_note_and_more.py":{"content":"# Generated by Django 5.0.2 on 2025-10-24 16:57\n\nimport django.db.models.deletion\nfrom django.conf import settings\nfrom django.db import migrations, models\n\n\nclass Migration(migrations.Migration):\n\n    dependencies = [\n        ('core', '0017_announcement_starts_at'),\n        migrations.swappable_dependency(settings.AUTH_USER_MODEL),\n    ]\n\n    operations = [\n        migrations.CreateModel(\n            name='Flashcard',\n            fields=[\n                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),\n                ('topic', models.CharField(max_length=200)),\n                ('front_text', models.TextField()),\n                ('back_text', models.TextField()),\n                ('image_front', models.ImageField(blank=True, null=True, upload_to='flashcards/images/')),\n                ('image_back', models.ImageField(blank=True, null=True, upload_to='flashcards/images/')),\n                ('created_at', models.DateTimeField(auto_now_add=True)),\n                ('created_by', models.ForeignKey(null=True, on_delete=django.db.models.deletion.SET_NULL, to=settings.AUTH_USER_MODEL)),\n                ('exam_board', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, to='core.examboard')),\n                ('grade', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, to='core.grade')),\n                ('subject', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, to='core.subject')),\n            ],\n            options={\n                'ordering': ['subject', 'topic'],\n            },\n        ),\n        migrations.CreateModel(\n            name='InteractiveQuestion',\n            fields=[\n                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),\n                ('topic', models.CharField(max_length=200)),\n                ('question_type', models.CharField(choices=[('mcq', 'Multiple Choice'), ('true_false', 'True/False'), ('fill_blank', 'Fill in the Blank'), ('matching', 'Matching'), ('essay', 'Essay/Free Response')], max_length=20)),\n                ('difficulty', models.CharField(choices=[('easy', 'Easy'), ('medium', 'Medium'), ('hard', 'Hard')], max_length=10)),\n                ('question_text', models.TextField()),\n                ('question_image', models.ImageField(blank=True, null=True, upload_to='questions/images/')),\n                ('options', models.JSONField(blank=True, null=True)),\n                ('correct_answer', models.TextField()),\n                ('matching_pairs', models.JSONField(blank=True, null=True)),\n                ('explanation', models.TextField(blank=True)),\n                ('points', models.IntegerField(default=1)),\n                ('created_at', models.DateTimeField(auto_now_add=True)),\n                ('created_by', models.ForeignKey(null=True, on_delete=django.db.models.deletion.SET_NULL, to=settings.AUTH_USER_MODEL)),\n                ('exam_board', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, to='core.examboard')),\n                ('grade', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, to='core.grade')),\n                ('subject', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, to='core.subject')),\n            ],\n            options={\n                'ordering': ['subject', 'topic', 'difficulty'],\n            },\n        ),\n        migrations.CreateModel(\n            name='ExamPaper',\n            fields=[\n                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),\n                ('title', models.CharField(max_length=200)),\n                ('year', models.IntegerField(blank=True, null=True)),\n                ('paper_file', models.FileField(upload_to='exam_papers/%Y/%m/')),\n                ('marking_scheme', models.FileField(blank=True, null=True, upload_to='exam_papers/marking/%Y/%m/')),\n                ('has_interactive_version', models.BooleanField(default=False)),\n                ('is_pro_content', models.BooleanField(default=False)),\n                ('created_at', models.DateTimeField(auto_now_add=True)),\n                ('created_by', models.ForeignKey(null=True, on_delete=django.db.models.deletion.SET_NULL, to=settings.AUTH_USER_MODEL)),\n                ('exam_board', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, to='core.examboard')),\n                ('grade', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, to='core.grade')),\n                ('subject', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, to='core.subject')),\n                ('interactive_questions', models.ManyToManyField(blank=True, to='core.interactivequestion')),\n            ],\n            options={\n                'ordering': ['-year', 'subject'],\n            },\n        ),\n        migrations.CreateModel(\n            name='Note',\n            fields=[\n                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),\n                ('title', models.CharField(max_length=200)),\n                ('topic', models.CharField(max_length=200)),\n                ('full_version', models.FileField(blank=True, null=True, upload_to='notes/full/%Y/%m/')),\n                ('summary_version', models.FileField(blank=True, null=True, upload_to='notes/summary/%Y/%m/')),\n                ('full_version_text', models.TextField(blank=True)),\n                ('summary_version_text', models.TextField(blank=True)),\n                ('created_at', models.DateTimeField(auto_now_add=True)),\n                ('updated_at', models.DateTimeField(auto_now=True)),\n                ('created_by', models.ForeignKey(null=True, on_delete=django.db.models.deletion.SET_NULL, to=settings.AUTH_USER_MODEL)),\n                ('exam_board', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, to='core.examboard')),\n                ('grade', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, to='core.grade')),\n                ('subject', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, to='core.subject')),\n            ],\n            options={\n                'ordering': ['subject', 'topic'],\n            },\n        ),\n        migrations.CreateModel(\n            name='StudentProfile',\n            fields=[\n                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),\n                ('subscription', models.CharField(choices=[('free', 'Free'), ('pro', 'Pro - R100/month')], default='free', max_length=20)),\n                ('parent_email', models.EmailField(blank=True, max_length=254)),\n                ('email_verified', models.BooleanField(default=False)),\n                ('verification_token', models.CharField(blank=True, max_length=100)),\n                ('verification_token_created', models.DateTimeField(blank=True, null=True)),\n                ('created_at', models.DateTimeField(auto_now_add=True)),\n                ('onboarding_completed', models.BooleanField(default=False)),\n                ('grade', models.ForeignKey(null=True, on_delete=django.db.models.deletion.SET_NULL, to='core.grade')),\n                ('user', models.OneToOneField(on_delete=django.db.models.deletion.CASCADE, related_name='student_profile', to=settings.AUTH_USER_MODEL)),\n            ],\n        ),\n        migrations.CreateModel(\n            name='StudentQuiz',\n            fields=[\n                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),\n                ('title', models.CharField(max_length=200)),\n                ('topic', models.CharField(max_length=200)),\n                ('difficulty', models.CharField(choices=[('easy', 'Easy'), ('medium', 'Medium'), ('hard', 'Hard'), ('mixed', 'Mixed')], max_length=10)),\n                ('length', models.IntegerField(choices=[(5, '5 Questions'), (10, '10 Questions'), (20, '20 Questions'), (50, '50 Questions')], default=10)),\n                ('is_pro_content', models.BooleanField(default=False)),\n                ('created_at', models.DateTimeField(auto_now_add=True)),\n                ('created_by', models.ForeignKey(null=True, on_delete=django.db.models.deletion.SET_NULL, to=settings.AUTH_USER_MODEL)),\n                ('exam_board', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, to='core.examboard')),\n                ('grade', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, to='core.grade')),\n                ('questions', models.ManyToManyField(related_name='student_quizzes', to='core.interactivequestion')),\n                ('subject', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, to='core.subject')),\n            ],\n            options={\n                'verbose_name_plural': 'Student Quizzes',\n                'ordering': ['-created_at'],\n            },\n        ),\n        migrations.CreateModel(\n            name='StudentQuizAttempt',\n            fields=[\n                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),\n                ('started_at', models.DateTimeField(auto_now_add=True)),\n                ('completed_at', models.DateTimeField(blank=True, null=True)),\n                ('is_timed', models.BooleanField(default=False)),\n                ('time_limit_minutes', models.IntegerField(blank=True, null=True)),\n                ('show_instant_feedback', models.BooleanField(default=True)),\n                ('answers', models.JSONField(default=dict)),\n                ('score', models.IntegerField(blank=True, null=True)),\n                ('percentage', models.DecimalField(blank=True, decimal_places=2, max_digits=5, null=True)),\n                ('quiz', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, to='core.studentquiz')),\n                ('student', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='quiz_attempts', to='core.studentprofile')),\n            ],\n            options={\n                'ordering': ['-started_at'],\n            },\n        ),\n        migrations.CreateModel(\n            name='StudentExamBoard',\n            fields=[\n                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),\n                ('selected_at', models.DateTimeField(auto_now_add=True)),\n                ('exam_board', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, to='core.examboard')),\n                ('student', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='exam_boards', to='core.studentprofile')),\n            ],\n            options={\n                'unique_together': {('student', 'exam_board')},\n            },\n        ),\n        migrations.CreateModel(\n            name='StudentProgress',\n            fields=[\n                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),\n                ('topic', models.CharField(max_length=200)),\n                ('quizzes_attempted', models.IntegerField(default=0)),\n                ('quizzes_passed', models.IntegerField(default=0)),\n                ('average_score', models.DecimalField(decimal_places=2, default=0, max_digits=5)),\n                ('notes_viewed', models.BooleanField(default=False)),\n                ('flashcards_reviewed', models.IntegerField(default=0)),\n                ('last_activity', models.DateTimeField(auto_now=True)),\n                ('student', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='progress', to='core.studentprofile')),\n                ('subject', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, to='core.subject')),\n            ],\n            options={\n                'ordering': ['-last_activity'],\n                'unique_together': {('student', 'subject', 'topic')},\n            },\n        ),\n        migrations.CreateModel(\n            name='StudentQuizQuota',\n            fields=[\n                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),\n                ('topic', models.CharField(max_length=200)),\n                ('attempt_count', models.IntegerField(default=0)),\n                ('quizzes_completed', models.ManyToManyField(blank=True, to='core.studentquiz')),\n                ('student', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='quiz_quotas', to='core.studentprofile')),\n                ('subject', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, to='core.subject')),\n            ],\n            options={\n                'unique_together': {('student', 'subject', 'topic')},\n            },\n        ),\n        migrations.CreateModel(\n            name='StudentSubject',\n            fields=[\n                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),\n                ('selected_at', models.DateTimeField(auto_now_add=True)),\n                ('exam_board', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, to='core.examboard')),\n                ('student', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='subjects', to='core.studentprofile')),\n                ('subject', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, to='core.subject')),\n            ],\n            options={\n                'unique_together': {('student', 'subject', 'exam_board')},\n            },\n        ),\n    ]\n","path":null,"size_bytes":13582,"size_tokens":null},"core/student_views.py":{"content":"from django.shortcuts import render, redirect\nfrom django.contrib.auth import authenticate, login, logout\nfrom django.contrib.auth.decorators import login_required\nfrom django.contrib.auth.models import User\nfrom django.contrib import messages\nfrom django.http import JsonResponse\nfrom django.core.mail import send_mail\nfrom django.conf import settings\nfrom django.urls import reverse\nfrom django.utils import timezone\nfrom django.db import IntegrityError\nfrom functools import wraps\nimport secrets\nimport os\nfrom datetime import timedelta\nfrom django.db.models import Q, Sum\nfrom .models import (\n    StudentProfile, Grade, ExamBoard, Subject, \n    StudentExamBoard, StudentSubject, StudentQuiz,\n    InteractiveQuestion, StudentQuizAttempt, StudentQuizQuota,\n    StudentProgress, Note, Flashcard, ExamPaper,\n    VideoLesson, Topic, Subtopic, Concept\n)\n\n\ndef mark_structured_question_with_ai(question_text, model_answer, marking_guide, student_answer, max_marks):\n    \"\"\"Use AI to mark structured/essay questions and provide feedback\"\"\"\n    import os\n    try:\n        from openai import OpenAI\n        \n        api_key = os.environ.get('OPENAI_API_KEY')\n        if not api_key:\n            return {'marks': 0, 'feedback': 'AI marking unavailable - no API key configured'}\n        \n        client = OpenAI(api_key=api_key)\n        \n        prompt = f\"\"\"You are an experienced exam marker. Mark the following student answer and provide constructive feedback.\n\nQUESTION:\n{question_text}\n\nMODEL ANSWER:\n{model_answer}\n\nMARKING CRITERIA:\n{marking_guide if marking_guide else 'Use your judgment based on the model answer.'}\n\nSTUDENT ANSWER:\n{student_answer}\n\nMAXIMUM MARKS: {max_marks}\n\nPlease provide:\n1. A mark out of {max_marks} (be fair but rigorous)\n2. Brief constructive feedback (2-3 sentences max)\n\nRespond in this exact JSON format:\n{{\"marks\": <number>, \"feedback\": \"<feedback text>\"}}\"\"\"\n\n        response = client.chat.completions.create(\n            model=\"gpt-3.5-turbo\",\n            messages=[\n                {\"role\": \"system\", \"content\": \"You are an expert exam marker. Respond only with valid JSON.\"},\n                {\"role\": \"user\", \"content\": prompt}\n            ],\n            max_tokens=200,\n            temperature=0.3\n        )\n        \n        import json\n        result_text = response.choices[0].message.content.strip()\n        \n        # Try to parse JSON response\n        try:\n            result = json.loads(result_text)\n            marks = min(max(0, int(result.get('marks', 0))), max_marks)\n            feedback = result.get('feedback', 'No feedback provided.')\n            return {'marks': marks, 'feedback': feedback}\n        except json.JSONDecodeError:\n            # If JSON parsing fails, try to extract marks from text\n            return {'marks': 0, 'feedback': 'AI marking encountered an error. Please review manually.'}\n            \n    except Exception as e:\n        return {'marks': 0, 'feedback': f'AI marking unavailable: {str(e)[:50]}'}\n\n\ndef student_login_required(view_func):\n    \"\"\"Decorator to ensure user is a student and logged in\"\"\"\n    @wraps(view_func)\n    def wrapper(request, *args, **kwargs):\n        if not request.user.is_authenticated:\n            messages.error(request, 'Please log in to continue.')\n            return redirect('student_login')\n        \n        # Check if user has a student profile\n        if not hasattr(request.user, 'student_profile'):\n            messages.error(request, 'Access denied. This area is for students only.')\n            return redirect('student_login')\n        \n        # Check if onboarding is completed\n        if not request.user.student_profile.onboarding_completed:\n            if request.path != reverse('student_onboarding'):\n                messages.info(request, 'Please complete your profile setup.')\n                return redirect('student_onboarding')\n        \n        return view_func(request, *args, **kwargs)\n    return wrapper\n\n\ndef student_register(request):\n    \"\"\"Student registration view\"\"\"\n    if request.method == 'POST':\n        username = request.POST.get('username', '').strip()\n        email = request.POST.get('email', '').strip()\n        parent_email = request.POST.get('parent_email', '').strip()\n        password = request.POST.get('password')\n        password_confirm = request.POST.get('password_confirm')\n        \n        # Validation\n        if not all([username, email, password, password_confirm]):\n            messages.error(request, 'Please fill in all required fields.')\n            return render(request, 'core/student/register.html')\n        \n        if password != password_confirm:\n            messages.error(request, 'Passwords do not match.')\n            return render(request, 'core/student/register.html')\n        \n        if len(password) < 8:\n            messages.error(request, 'Password must be at least 8 characters long.')\n            return render(request, 'core/student/register.html')\n        \n        # Check if username or email already exists\n        if User.objects.filter(username=username).exists():\n            messages.error(request, 'Username already taken.')\n            return render(request, 'core/student/register.html')\n        \n        if User.objects.filter(email=email).exists():\n            messages.error(request, 'Email already registered.')\n            return render(request, 'core/student/register.html')\n        \n        try:\n            # Create user (inactive until email verified)\n            user = User.objects.create_user(\n                username=username,\n                email=email,\n                password=password,\n                is_active=False\n            )\n            \n            # Generate verification token\n            verification_token = secrets.token_urlsafe(32)\n            \n            # Create student profile\n            student_profile = StudentProfile.objects.create(\n                user=user,\n                parent_email=parent_email,\n                email_verified=False,\n                verification_token=verification_token,\n                verification_token_created=timezone.now()\n            )\n            \n            # Send verification email\n            verification_path = reverse('student_verify_email', kwargs={'token': verification_token})\n            \n            replit_domain = os.environ.get('REPLIT_DEV_DOMAIN')\n            if replit_domain:\n                verification_url = f\"https://{replit_domain}{verification_path}\"\n            else:\n                verification_url = request.build_absolute_uri(verification_path)\n            \n            send_mail(\n                subject='Welcome to EduTech - Verify Your Email',\n                message=f'''Hi {username},\n\nWelcome to EduTech! We're excited to have you join our learning platform.\n\nPlease click the link below to verify your email address and activate your account:\n\n{verification_url}\n\nThis link will expire in 24 hours.\n\nIf you have any questions, feel free to reach out to our support team.\n\nBest regards,\nEduTech Team''',\n                from_email=settings.DEFAULT_FROM_EMAIL,\n                recipient_list=[email],\n                fail_silently=False,\n            )\n            \n            # Also notify parent if parent email provided\n            if parent_email:\n                send_mail(\n                    subject='Your Child Joined EduTech',\n                    message=f'''Hello,\n\nYour child ({username}) has created an account on EduTech, an educational platform designed to help students learn and prepare for exams.\n\nStudent email: {email}\n\nYou can monitor their progress and we'll keep you updated on their learning journey.\n\nIf you have any questions or concerns, please contact us.\n\nBest regards,\nEduTech Team''',\n                    from_email=settings.DEFAULT_FROM_EMAIL,\n                    recipient_list=[parent_email],\n                    fail_silently=True,\n                )\n            \n            messages.success(request, 'Registration successful! Please check your email to verify your account.')\n            return redirect('student_login')\n            \n        except IntegrityError as e:\n            messages.error(request, 'An error occurred during registration. Please try again.')\n            return render(request, 'core/student/register.html')\n    \n    return render(request, 'core/student/register.html')\n\n\ndef student_login(request):\n    \"\"\"Student login view\"\"\"\n    if request.method == 'POST':\n        username_or_email = request.POST.get('username', '').strip()\n        password = request.POST.get('password')\n        \n        # Determine if input is email or username\n        username = username_or_email\n        if '@' in username_or_email:\n            try:\n                user_by_email = User.objects.get(email=username_or_email)\n                username = user_by_email.username\n            except User.DoesNotExist:\n                username = username_or_email\n        \n        # Check if user exists and has student profile\n        try:\n            existing_user = User.objects.get(username=username)\n            \n            # Check if it's a student account\n            if not hasattr(existing_user, 'student_profile'):\n                messages.error(request, 'Invalid credentials. Are you a teacher? Please use the teacher login page.')\n                return render(request, 'core/student/login.html')\n            \n            # Check if account is verified\n            if not existing_user.is_active:\n                messages.error(request, 'Please verify your email address before signing in. Check your inbox for the verification link.')\n                return render(request, 'core/student/login.html')\n                \n        except User.DoesNotExist:\n            messages.error(request, 'Invalid credentials.')\n            return render(request, 'core/student/login.html')\n        \n        # Authenticate user\n        user = authenticate(request, username=username, password=password)\n        if user is not None:\n            login(request, user)\n            \n            # Redirect to onboarding if not completed\n            if not user.student_profile.onboarding_completed:\n                return redirect('student_onboarding')\n            \n            # Otherwise redirect to student dashboard (to be created later)\n            messages.success(request, f'Welcome back, {user.username}!')\n            return redirect('student_dashboard')\n        else:\n            messages.error(request, 'Invalid credentials.')\n    \n    return render(request, 'core/student/login.html')\n\n\ndef student_logout(request):\n    \"\"\"Student logout view\"\"\"\n    logout(request)\n    messages.success(request, 'You have been logged out successfully.')\n    return redirect('student_login')\n\n\ndef student_verify_email(request, token):\n    \"\"\"Email verification handler\"\"\"\n    try:\n        student_profile = StudentProfile.objects.get(verification_token=token)\n        \n        # Check if token is expired (24 hours)\n        token_age = timezone.now() - student_profile.verification_token_created\n        if token_age > timedelta(hours=24):\n            messages.error(request, 'Verification link has expired. Please request a new one.')\n            return redirect('student_login')\n        \n        # Check if already verified\n        if student_profile.email_verified:\n            messages.info(request, 'Email already verified. Please log in.')\n            return redirect('student_login')\n        \n        # Activate user account\n        user = student_profile.user\n        user.is_active = True\n        user.save()\n        \n        # Mark email as verified\n        student_profile.email_verified = True\n        student_profile.verification_token = ''\n        student_profile.save()\n        \n        # Send welcome email\n        send_mail(\n            subject='Welcome to EduTech - Get Started!',\n            message=f'''Hi {user.username},\n\nYour email has been verified successfully! üéâ\n\nYou can now log in and start your learning journey. Here's what you can do:\n\n‚Ä¢ Complete your profile setup\n‚Ä¢ Choose your exam boards and subjects\n‚Ä¢ Access study materials and practice quizzes\n‚Ä¢ Track your progress\n\nReady to get started? Log in now: {request.build_absolute_uri(reverse('student_login'))}\n\nHappy learning!\n\nBest regards,\nEduTech Team''',\n            from_email=settings.DEFAULT_FROM_EMAIL,\n            recipient_list=[user.email],\n            fail_silently=True,\n        )\n        \n        messages.success(request, 'Email verified successfully! You can now log in.')\n        return redirect('student_login')\n        \n    except StudentProfile.DoesNotExist:\n        messages.error(request, 'Invalid verification link.')\n        return redirect('student_login')\n\n\n@student_login_required\ndef student_onboarding(request):\n    \"\"\"Multi-step onboarding process for students\"\"\"\n    student_profile = request.user.student_profile\n    \n    if request.method == 'POST':\n        # Get form data\n        grade_id = request.POST.get('grade')\n        selected_boards = request.POST.getlist('exam_boards[]')\n        \n        # Validate grade\n        if not grade_id:\n            return JsonResponse({'success': False, 'error': 'Please select your grade level.'})\n        \n        try:\n            grade = Grade.objects.get(id=grade_id)\n            student_profile.grade = grade\n        except Grade.DoesNotExist:\n            return JsonResponse({'success': False, 'error': 'Invalid grade selected.'})\n        \n        # Validate exam boards\n        board_limit = student_profile.get_exam_board_limit()\n        if len(selected_boards) == 0:\n            return JsonResponse({'success': False, 'error': 'Please select at least one exam board.'})\n        \n        if len(selected_boards) > board_limit:\n            return JsonResponse({\n                'success': False, \n                'error': f'You can select up to {board_limit} exam boards. Upgrade to Pro for more!'\n            })\n        \n        # Clear existing boards and subjects\n        StudentExamBoard.objects.filter(student=student_profile).delete()\n        StudentSubject.objects.filter(student=student_profile).delete()\n        \n        # Save selected exam boards\n        for board_id in selected_boards:\n            try:\n                exam_board = ExamBoard.objects.get(id=board_id)\n                StudentExamBoard.objects.create(\n                    student=student_profile,\n                    exam_board=exam_board\n                )\n            except ExamBoard.DoesNotExist:\n                continue\n        \n        # Process subjects for each board\n        subject_limit = student_profile.get_subject_limit_per_board()\n        for board_id in selected_boards:\n            subject_ids = request.POST.getlist(f'subjects_board_{board_id}[]')\n            \n            if len(subject_ids) > subject_limit:\n                return JsonResponse({\n                    'success': False,\n                    'error': f'You can select up to {subject_limit} subjects per exam board.'\n                })\n            \n            for subject_id in subject_ids:\n                try:\n                    subject = Subject.objects.get(id=subject_id)\n                    exam_board = ExamBoard.objects.get(id=board_id)\n                    StudentSubject.objects.create(\n                        student=student_profile,\n                        subject=subject,\n                        exam_board=exam_board\n                    )\n                except (Subject.DoesNotExist, ExamBoard.DoesNotExist):\n                    continue\n        \n        # Mark onboarding as completed\n        student_profile.onboarding_completed = True\n        student_profile.save()\n        \n        return JsonResponse({'success': True, 'redirect': reverse('student_dashboard')})\n    \n    # GET request - show onboarding form\n    grades = Grade.objects.all().order_by('number')\n    exam_boards = ExamBoard.objects.all().order_by('name_full')\n    subjects = Subject.objects.all().order_by('name')\n    \n    context = {\n        'student_profile': student_profile,\n        'grades': grades,\n        'exam_boards': exam_boards,\n        'subjects': subjects,\n        'board_limit': student_profile.get_exam_board_limit(),\n        'subject_limit': student_profile.get_subject_limit_per_board(),\n    }\n    \n    return render(request, 'core/student/onboarding.html', context)\n\n\n@student_login_required\ndef student_dashboard(request):\n    \"\"\"Enhanced student dashboard with stats and activity\"\"\"\n    from .models import StudentTopicProgress\n    \n    student_profile = request.user.student_profile\n    \n    # Get student's exam boards and subjects\n    student_boards = StudentExamBoard.objects.filter(student=student_profile).select_related('exam_board')\n    student_subjects = StudentSubject.objects.filter(student=student_profile).select_related('subject', 'exam_board')\n    \n    # Calculate statistics\n    total_quizzes = StudentQuizAttempt.objects.filter(\n        student=student_profile,\n        completed_at__isnull=False\n    ).count()\n    \n    # Calculate average score across all quiz attempts\n    completed_attempts = StudentQuizAttempt.objects.filter(\n        student=student_profile,\n        completed_at__isnull=False\n    )\n    avg_score = 0\n    if completed_attempts.exists():\n        total_percentage = sum(a.percentage for a in completed_attempts if a.percentage)\n        avg_score = total_percentage / completed_attempts.count()\n    \n    # Count notes viewed from StudentTopicProgress\n    notes_viewed_count = StudentTopicProgress.objects.filter(\n        student=student_profile\n    ).aggregate(total=Sum('notes_read_count'))['total'] or 0\n    \n    # Count videos watched from StudentTopicProgress\n    videos_watched_count = StudentTopicProgress.objects.filter(\n        student=student_profile\n    ).aggregate(total=Sum('videos_watched_count'))['total'] or 0\n    \n    # Count active subjects\n    active_subjects = student_subjects.count()\n    \n    # Get recent quiz attempts (last 5)\n    recent_attempts = StudentQuizAttempt.objects.filter(\n        student=student_profile,\n        completed_at__isnull=False\n    ).select_related('quiz', 'quiz__subject').order_by('-completed_at')[:5]\n    \n    # Get progress by subject for chart and subject cards\n    subject_progress = []\n    subjects_with_progress = []\n    for student_subject in student_subjects:\n        topic_progress = StudentTopicProgress.objects.filter(\n            student=student_profile,\n            subject=student_subject.subject\n        )\n        \n        # Calculate subject completion percentage\n        total_completion = 0\n        if topic_progress.exists():\n            total_completion = sum(tp.get_completion_percentage() for tp in topic_progress) / topic_progress.count()\n        \n        # Calculate average quiz score for subject\n        subject_attempts = StudentQuizAttempt.objects.filter(\n            student=student_profile,\n            quiz__subject=student_subject.subject,\n            completed_at__isnull=False\n        )\n        avg_subject_score = 0\n        if subject_attempts.exists():\n            avg_subject_score = sum(a.percentage for a in subject_attempts if a.percentage) / subject_attempts.count()\n        \n        subject_data = {\n            'student_subject': student_subject,\n            'subject': student_subject.subject,\n            'exam_board': student_subject.exam_board,\n            'completion_percentage': round(total_completion),\n            'avg_score': round(avg_subject_score, 1),\n            'topics_count': Topic.objects.filter(\n                subject=student_subject.subject\n            ).count()\n        }\n        subjects_with_progress.append(subject_data)\n        \n        if avg_subject_score > 0:\n            subject_progress.append({\n                'subject': student_subject.subject.name,\n                'score': round(float(avg_subject_score), 1)\n            })\n    \n    context = {\n        'student_profile': student_profile,\n        'student_boards': student_boards,\n        'student_subjects': student_subjects,\n        'subjects_with_progress': subjects_with_progress,\n        'total_quizzes': total_quizzes,\n        'avg_score': round(avg_score, 1),\n        'notes_viewed_count': notes_viewed_count,\n        'videos_watched_count': videos_watched_count,\n        'active_subjects': active_subjects,\n        'recent_attempts': recent_attempts,\n        'subject_progress': subject_progress,\n    }\n    \n    return render(request, 'core/student/dashboard.html', context)\n\n\n@student_login_required\ndef student_quizzes_list(request):\n    \"\"\"Browse available quizzes filtered by student's selected subjects\"\"\"\n    student_profile = request.user.student_profile\n    \n    # Get student's selected subjects\n    student_subjects = StudentSubject.objects.filter(student=student_profile).select_related('subject', 'exam_board')\n    subject_ids = student_subjects.values_list('subject_id', flat=True)\n    exam_board_ids = student_subjects.values_list('exam_board_id', flat=True)\n    \n    # Get quizzes matching student's subjects and exam boards\n    quizzes = StudentQuiz.objects.filter(\n        subject_id__in=subject_ids,\n        exam_board_id__in=exam_board_ids,\n        grade=student_profile.grade\n    ).select_related('subject', 'exam_board', 'grade').prefetch_related('questions')\n    \n    # Apply filters\n    subject_filter = request.GET.get('subject')\n    topic_filter = request.GET.get('topic')\n    difficulty_filter = request.GET.get('difficulty')\n    length_filter = request.GET.get('length')\n    \n    if subject_filter:\n        quizzes = quizzes.filter(subject_id=subject_filter)\n    if topic_filter:\n        quizzes = quizzes.filter(topic__icontains=topic_filter)\n    if difficulty_filter:\n        quizzes = quizzes.filter(difficulty=difficulty_filter)\n    if length_filter:\n        quizzes = quizzes.filter(length=length_filter)\n    \n    # Get unique topics for the filter dropdown\n    all_topics = StudentQuiz.objects.filter(\n        subject_id__in=subject_ids,\n        exam_board_id__in=exam_board_ids,\n        grade=student_profile.grade\n    ).values_list('topic', flat=True).distinct().order_by('topic')\n    \n    # Get attempt counts for each quiz\n    quiz_attempts = {}\n    for quiz in quizzes:\n        attempt_count = StudentQuizAttempt.objects.filter(\n            student=student_profile,\n            quiz=quiz\n        ).count()\n        quiz_attempts[quiz.id] = attempt_count\n    \n    context = {\n        'student_profile': student_profile,\n        'quizzes': quizzes,\n        'quiz_attempts': quiz_attempts,\n        'student_subjects': student_subjects,\n        'all_topics': all_topics,\n        'selected_subject': subject_filter,\n        'selected_topic': topic_filter,\n        'selected_difficulty': difficulty_filter,\n        'selected_length': length_filter,\n    }\n    \n    return render(request, 'core/student/quizzes/list.html', context)\n\n\n@student_login_required\ndef student_quiz_start(request, quiz_id):\n    \"\"\"Start quiz with preferences form\"\"\"\n    student_profile = request.user.student_profile\n    \n    try:\n        quiz = StudentQuiz.objects.get(id=quiz_id)\n    except StudentQuiz.DoesNotExist:\n        messages.error(request, 'Quiz not found.')\n        return redirect('student_quizzes_list')\n    \n    # Check if student has this subject\n    has_subject = StudentSubject.objects.filter(\n        student=student_profile,\n        subject=quiz.subject,\n        exam_board=quiz.exam_board\n    ).exists()\n    \n    if not has_subject:\n        messages.error(request, 'You do not have access to this quiz. Please select this subject first.')\n        return redirect('student_quizzes_list')\n    \n    # Check quota for free users\n    is_pro = student_profile.subscription == 'pro'\n    \n    if not is_pro and quiz.is_pro_content:\n        messages.warning(request, 'This is PRO content. Upgrade your subscription to access it.')\n        return redirect('student_quizzes_list')\n    \n    # Get or create quota tracker\n    quota, created = StudentQuizQuota.objects.get_or_create(\n        student=student_profile,\n        subject=quiz.subject,\n        topic=quiz.topic\n    )\n    \n    # Check if student can attempt this quiz\n    can_attempt = quota.can_attempt_quiz(quiz, is_pro)\n    \n    if not can_attempt:\n        messages.warning(request, f'You have reached your free quiz limit for {quiz.topic}. Upgrade to PRO for unlimited access or retry your previous quizzes.')\n        return redirect('student_quizzes_list')\n    \n    # Get previous attempts\n    previous_attempts = StudentQuizAttempt.objects.filter(\n        student=student_profile,\n        quiz=quiz\n    ).order_by('-started_at')[:5]\n    \n    context = {\n        'student_profile': student_profile,\n        'quiz': quiz,\n        'previous_attempts': previous_attempts,\n        'is_pro': is_pro,\n        'quota': quota,\n    }\n    \n    return render(request, 'core/student/quizzes/start.html', context)\n\n\n@student_login_required\ndef student_quiz_take(request, quiz_id):\n    \"\"\"Interactive quiz interface\"\"\"\n    student_profile = request.user.student_profile\n    \n    try:\n        quiz = StudentQuiz.objects.get(id=quiz_id)\n    except StudentQuiz.DoesNotExist:\n        messages.error(request, 'Quiz not found.')\n        return redirect('student_quizzes_list')\n    \n    # Get quiz preferences from POST\n    is_timed = request.POST.get('is_timed') == 'on'\n    time_limit = int(request.POST.get('time_limit', 30)) if is_timed else None\n    show_instant_feedback = request.POST.get('show_instant_feedback') == 'on'\n    \n    # Create quiz attempt\n    attempt = StudentQuizAttempt.objects.create(\n        student=student_profile,\n        quiz=quiz,\n        is_timed=is_timed,\n        time_limit_minutes=time_limit,\n        show_instant_feedback=show_instant_feedback\n    )\n    \n    # Get all questions for this quiz\n    questions = list(quiz.questions.all().order_by('?'))  # Randomize order\n    \n    # Store questions in session for this attempt\n    request.session[f'quiz_attempt_{attempt.id}_questions'] = [q.id for q in questions]\n    \n    context = {\n        'student_profile': student_profile,\n        'quiz': quiz,\n        'attempt': attempt,\n        'questions': questions,\n        'total_questions': len(questions),\n    }\n    \n    return render(request, 'core/student/quizzes/take.html', context)\n\n\n@student_login_required\ndef student_quiz_submit(request):\n    \"\"\"Process quiz answers and calculate score\"\"\"\n    if request.method != 'POST':\n        return redirect('student_quizzes_list')\n    \n    student_profile = request.user.student_profile\n    attempt_id = request.POST.get('attempt_id')\n    \n    try:\n        attempt = StudentQuizAttempt.objects.get(id=attempt_id, student=student_profile)\n    except StudentQuizAttempt.DoesNotExist:\n        messages.error(request, 'Quiz attempt not found.')\n        return redirect('student_quizzes_list')\n    \n    # Check if already completed\n    if attempt.completed_at:\n        messages.info(request, 'This quiz has already been submitted.')\n        return redirect('student_quiz_results', attempt_id=attempt.id)\n    \n    # Get questions from session\n    question_ids = request.session.get(f'quiz_attempt_{attempt.id}_questions', [])\n    questions = InteractiveQuestion.objects.filter(id__in=question_ids)\n    \n    # Process answers\n    answers = {}\n    score = 0\n    total_points = 0\n    \n    for question in questions:\n        question_key = f'question_{question.id}'\n        student_answer = request.POST.get(question_key, '')\n        \n        total_points += question.points\n        \n        # Check if answer is correct based on question type\n        is_correct = False\n        points_earned = 0\n        ai_feedback = ''\n        \n        if question.question_type == 'mcq':\n            # Use correct_option_index if available, otherwise fall back to correct_answer\n            if question.correct_option_index is not None:\n                try:\n                    is_correct = int(student_answer) == question.correct_option_index\n                except (ValueError, TypeError):\n                    is_correct = student_answer == str(question.correct_option_index)\n            else:\n                is_correct = student_answer == question.correct_answer\n            points_earned = question.points if is_correct else 0\n        elif question.question_type == 'true_false':\n            is_correct = student_answer.lower() == question.correct_answer.lower()\n            points_earned = question.points if is_correct else 0\n        elif question.question_type == 'fill_blank':\n            is_correct = student_answer.strip().lower() == question.correct_answer.strip().lower()\n            points_earned = question.points if is_correct else 0\n        elif question.question_type == 'matching':\n            # For matching, student answer should be JSON\n            import json\n            try:\n                student_pairs = json.loads(student_answer)\n                correct_pairs = question.matching_pairs\n                is_correct = student_pairs == correct_pairs\n            except:\n                is_correct = False\n            points_earned = question.points if is_correct else 0\n        elif question.question_type in ['structured', 'essay']:\n            # Structured/essay questions - use AI marking if model answer available\n            if question.model_answer and student_answer.strip():\n                ai_result = mark_structured_question_with_ai(\n                    question_text=question.question_text,\n                    model_answer=question.model_answer,\n                    marking_guide=question.marking_guide,\n                    student_answer=student_answer,\n                    max_marks=question.max_marks\n                )\n                points_earned = ai_result.get('marks', 0)\n                ai_feedback = ai_result.get('feedback', '')\n                is_correct = points_earned >= (question.max_marks * 0.7)  # 70% threshold\n            else:\n                # No model answer - mark as pending\n                is_correct = None\n                points_earned = 0\n        \n        if is_correct:\n            score += points_earned\n        elif points_earned > 0:\n            score += points_earned  # Partial marks for structured\n        \n        answers[str(question.id)] = {\n            'answer': student_answer,\n            'is_correct': is_correct,\n            'points_earned': points_earned,\n            'ai_feedback': ai_feedback,\n            'max_marks': question.max_marks if question.question_type in ['structured', 'essay'] else question.points\n        }\n    \n    # Calculate percentage\n    percentage = (score / total_points * 100) if total_points > 0 else 0\n    \n    # Save results\n    attempt.answers = answers\n    attempt.score = score\n    attempt.percentage = round(percentage, 2)\n    attempt.completed_at = timezone.now()\n    attempt.save()\n    \n    # Update quota\n    quota, created = StudentQuizQuota.objects.get_or_create(\n        student=student_profile,\n        subject=attempt.quiz.subject,\n        topic=attempt.quiz.topic\n    )\n    \n    if attempt.quiz not in quota.quizzes_completed.all():\n        quota.quizzes_completed.add(attempt.quiz)\n    quota.attempt_count += 1\n    quota.save()\n    \n    # Update progress\n    progress, created = StudentProgress.objects.get_or_create(\n        student=student_profile,\n        subject=attempt.quiz.subject,\n        topic=attempt.quiz.topic\n    )\n    \n    progress.quizzes_attempted += 1\n    if percentage >= 70:  # Pass threshold\n        progress.quizzes_passed += 1\n    \n    # Update average score\n    all_attempts = StudentQuizAttempt.objects.filter(\n        student=student_profile,\n        quiz__subject=attempt.quiz.subject,\n        quiz__topic=attempt.quiz.topic,\n        completed_at__isnull=False\n    )\n    \n    total_percentage = sum(a.percentage for a in all_attempts if a.percentage)\n    progress.average_score = total_percentage / all_attempts.count() if all_attempts.count() > 0 else 0\n    progress.save()\n    \n    # Clean up session\n    if f'quiz_attempt_{attempt.id}_questions' in request.session:\n        del request.session[f'quiz_attempt_{attempt.id}_questions']\n    \n    messages.success(request, f'Quiz submitted! You scored {percentage:.1f}%')\n    return redirect('student_quiz_results', attempt_id=attempt.id)\n\n\n@student_login_required\ndef student_quiz_results(request, attempt_id):\n    \"\"\"Show quiz results with correct answers and explanations\"\"\"\n    student_profile = request.user.student_profile\n    \n    try:\n        attempt = StudentQuizAttempt.objects.get(id=attempt_id, student=student_profile)\n    except StudentQuizAttempt.DoesNotExist:\n        messages.error(request, 'Quiz attempt not found.')\n        return redirect('student_quizzes_list')\n    \n    # Get questions with student answers\n    question_results = []\n    \n    for question_id, answer_data in attempt.answers.items():\n        try:\n            question = InteractiveQuestion.objects.get(id=int(question_id))\n            question_results.append({\n                'question': question,\n                'student_answer': answer_data['answer'],\n                'is_correct': answer_data['is_correct'],\n                'points_earned': answer_data['points_earned']\n            })\n        except InteractiveQuestion.DoesNotExist:\n            continue\n    \n    context = {\n        'student_profile': student_profile,\n        'attempt': attempt,\n        'quiz': attempt.quiz,\n        'question_results': question_results,\n    }\n    \n    return render(request, 'core/student/quizzes/results.html', context)\n\n\n@student_login_required\ndef student_quiz_history(request):\n    \"\"\"View all past quiz attempts\"\"\"\n    student_profile = request.user.student_profile\n    \n    # Get all completed attempts\n    attempts = StudentQuizAttempt.objects.filter(\n        student=student_profile,\n        completed_at__isnull=False\n    ).select_related('quiz', 'quiz__subject').order_by('-completed_at')\n    \n    # Apply filters\n    subject_filter = request.GET.get('subject')\n    if subject_filter:\n        attempts = attempts.filter(quiz__subject_id=subject_filter)\n    \n    # Get student subjects for filter\n    student_subjects = StudentSubject.objects.filter(\n        student=student_profile\n    ).select_related('subject').values('subject_id', 'subject__name').distinct()\n    \n    context = {\n        'student_profile': student_profile,\n        'attempts': attempts,\n        'student_subjects': student_subjects,\n        'selected_subject': subject_filter,\n    }\n    \n    return render(request, 'core/student/quizzes/history.html', context)\n\n\n@student_login_required\ndef student_notes(request):\n    \"\"\"Browse all notes for student's subjects\"\"\"\n    student_profile = request.user.student_profile\n    \n    # Get student's selected subjects\n    student_subjects = StudentSubject.objects.filter(student=student_profile).select_related('subject', 'exam_board')\n    subject_ids = student_subjects.values_list('subject_id', flat=True)\n    exam_board_ids = student_subjects.values_list('exam_board_id', flat=True)\n    \n    # Get notes matching student's subjects and exam boards\n    notes = Note.objects.filter(\n        subject_id__in=subject_ids,\n        exam_board_id__in=exam_board_ids,\n        grade=student_profile.grade\n    ).select_related('subject', 'exam_board', 'grade')\n    \n    # Apply filters\n    subject_filter = request.GET.get('subject')\n    topic_filter = request.GET.get('topic')\n    \n    if subject_filter:\n        notes = notes.filter(subject_id=subject_filter)\n    if topic_filter:\n        notes = notes.filter(topic__name__icontains=topic_filter)\n    \n    # Get unique topics for filter (topic is a ForeignKey, get names)\n    topic_ids = Note.objects.filter(\n        subject_id__in=subject_ids,\n        exam_board_id__in=exam_board_ids,\n        grade=student_profile.grade,\n        topic__isnull=False\n    ).values_list('topic_id', flat=True).distinct()\n    topics = Topic.objects.filter(id__in=topic_ids).values_list('name', flat=True).order_by('name')\n    \n    context = {\n        'student_profile': student_profile,\n        'notes': notes,\n        'student_subjects': student_subjects,\n        'topics': topics,\n        'selected_subject': subject_filter,\n        'selected_topic': topic_filter,\n    }\n    \n    return render(request, 'core/student/notes/list.html', context)\n\n\n@student_login_required\ndef student_note_view(request, note_id):\n    \"\"\"View individual note with full and summary versions\"\"\"\n    student_profile = request.user.student_profile\n    \n    try:\n        note = Note.objects.select_related('subject', 'exam_board', 'grade').get(id=note_id)\n    except Note.DoesNotExist:\n        messages.error(request, 'Note not found.')\n        return redirect('student_notes')\n    \n    # Check if student has access to this note's subject\n    has_access = StudentSubject.objects.filter(\n        student=student_profile,\n        subject=note.subject,\n        exam_board=note.exam_board\n    ).exists()\n    \n    if not has_access:\n        messages.error(request, 'You do not have access to this note.')\n        return redirect('student_notes')\n    \n    # Update progress - mark note as viewed\n    # Get topic name (note.topic is a ForeignKey, StudentProgress.topic is CharField)\n    topic_name = note.topic.name if note.topic else (note.topic_text or 'General')\n    progress, created = StudentProgress.objects.get_or_create(\n        student=student_profile,\n        subject=note.subject,\n        topic=topic_name\n    )\n    progress.notes_viewed = True\n    progress.save()\n    \n    context = {\n        'student_profile': student_profile,\n        'note': note,\n    }\n    \n    return render(request, 'core/student/notes/view.html', context)\n\n\n@student_login_required\ndef student_flashcards(request):\n    \"\"\"Browse flashcards by subject/topic\"\"\"\n    student_profile = request.user.student_profile\n    \n    # Get student's selected subjects\n    student_subjects = StudentSubject.objects.filter(student=student_profile).select_related('subject', 'exam_board')\n    subject_ids = student_subjects.values_list('subject_id', flat=True)\n    exam_board_ids = student_subjects.values_list('exam_board_id', flat=True)\n    \n    # Get flashcards matching student's subjects\n    flashcards = Flashcard.objects.filter(\n        subject_id__in=subject_ids,\n        exam_board_id__in=exam_board_ids,\n        grade=student_profile.grade\n    ).select_related('subject', 'exam_board', 'grade')\n    \n    # Apply filters\n    subject_filter = request.GET.get('subject')\n    topic_filter = request.GET.get('topic')\n    \n    if subject_filter:\n        flashcards = flashcards.filter(subject_id=subject_filter)\n    if topic_filter:\n        flashcards = flashcards.filter(topic__name__icontains=topic_filter)\n    \n    # Get unique topics for filter dropdown\n    topic_ids = Flashcard.objects.filter(\n        subject_id__in=subject_ids,\n        exam_board_id__in=exam_board_ids,\n        grade=student_profile.grade,\n        topic__isnull=False\n    ).values_list('topic_id', flat=True).distinct()\n    all_topics = Topic.objects.filter(id__in=topic_ids).values_list('name', flat=True).order_by('name')\n    \n    # Group flashcards by subject and topic\n    flashcard_groups = {}\n    for flashcard in flashcards:\n        subject_name = flashcard.subject.name\n        if subject_name not in flashcard_groups:\n            flashcard_groups[subject_name] = {}\n        \n        # Get topic info - use Topic FK if available, else legacy text\n        if flashcard.topic:\n            topic_name = flashcard.topic.name\n            topic_id = flashcard.topic.id\n        else:\n            topic_name = flashcard.topic_text or 'General'\n            topic_id = None\n        \n        topic_key = (topic_name, topic_id)\n        if topic_key not in flashcard_groups[subject_name]:\n            flashcard_groups[subject_name][topic_key] = []\n        \n        flashcard_groups[subject_name][topic_key].append(flashcard)\n    \n    # Get review progress\n    progress_data = {}\n    for student_subject in student_subjects:\n        topics_progress = StudentProgress.objects.filter(\n            student=student_profile,\n            subject=student_subject.subject\n        )\n        for progress in topics_progress:\n            key = f\"{progress.subject.name}_{progress.topic}\"\n            progress_data[key] = progress.flashcards_reviewed\n    \n    context = {\n        'student_profile': student_profile,\n        'flashcard_groups': flashcard_groups,\n        'student_subjects': student_subjects,\n        'all_topics': all_topics,\n        'progress_data': progress_data,\n        'selected_subject': subject_filter,\n        'selected_topic': topic_filter,\n    }\n    \n    return render(request, 'core/student/flashcards/list.html', context)\n\n\n@student_login_required\ndef student_flashcard_study(request, subject_id):\n    \"\"\"Interactive flashcard study mode\"\"\"\n    student_profile = request.user.student_profile\n    \n    try:\n        subject = Subject.objects.get(id=subject_id)\n    except Subject.DoesNotExist:\n        messages.error(request, 'Subject not found.')\n        return redirect('student_flashcards')\n    \n    # Check if student has this subject\n    student_subject = StudentSubject.objects.filter(\n        student=student_profile,\n        subject=subject\n    ).first()\n    \n    if not student_subject:\n        messages.error(request, 'You do not have access to this subject.')\n        return redirect('student_flashcards')\n    \n    # Get topic filter from query params (support both topic_id and legacy topic name)\n    topic_id = request.GET.get('topic_id')\n    topic_filter = request.GET.get('topic')\n    timed_mode = request.GET.get('timed', 'false') == 'true'\n    topic_obj = None\n    topic_display_name = None\n    \n    # Get flashcards for this subject\n    flashcards = Flashcard.objects.filter(\n        subject=subject,\n        exam_board=student_subject.exam_board,\n        grade=student_profile.grade\n    )\n    \n    # Filter by topic - support both FK and legacy text field\n    if topic_id:\n        topic_obj = Topic.objects.filter(id=topic_id).first()\n        if topic_obj:\n            flashcards = flashcards.filter(topic=topic_obj)\n            topic_display_name = topic_obj.name\n    elif topic_filter:\n        # Legacy text filter for backwards compatibility\n        flashcards = flashcards.filter(topic_text=topic_filter)\n        topic_display_name = topic_filter\n    \n    flashcards = list(flashcards.order_by('?'))  # Randomize\n    \n    if not flashcards:\n        return redirect('student_flashcards')\n    \n    # Handle AJAX request for marking flashcard as reviewed\n    if request.method == 'POST' and request.headers.get('X-Requested-With') == 'XMLHttpRequest':\n        from .models import StudentTopicProgress\n        \n        flashcard_id = request.POST.get('flashcard_id')\n        \n        # Get the flashcard to find its topic\n        flashcard = Flashcard.objects.filter(id=flashcard_id).first()\n        if flashcard and flashcard.topic:\n            # Update StudentTopicProgress\n            progress, created = StudentTopicProgress.objects.get_or_create(\n                student=student_profile,\n                subject=subject,\n                topic=flashcard.topic\n            )\n            progress.flashcards_reviewed += 1\n            progress.save()\n            \n            return JsonResponse({'success': True, 'flashcards_reviewed': progress.flashcards_reviewed})\n        \n        return JsonResponse({'success': False, 'error': 'Flashcard not found'})\n    \n    context = {\n        'student_profile': student_profile,\n        'subject': subject,\n        'flashcards': flashcards,\n        'topic_filter': topic_display_name,\n        'topic_id': topic_id,\n        'total_cards': len(flashcards),\n        'timed_mode': timed_mode,\n    }\n    \n    return render(request, 'core/student/flashcards/study.html', context)\n\n\n@student_login_required\ndef student_exam_papers(request):\n    \"\"\"Browse exam papers with filtering\"\"\"\n    student_profile = request.user.student_profile\n    \n    # Get student's selected subjects\n    student_subjects = StudentSubject.objects.filter(student=student_profile).select_related('subject', 'exam_board')\n    subject_ids = student_subjects.values_list('subject_id', flat=True)\n    exam_board_ids = student_subjects.values_list('exam_board_id', flat=True)\n    \n    # Get exam papers matching student's subjects\n    exam_papers = ExamPaper.objects.filter(\n        subject_id__in=subject_ids,\n        exam_board_id__in=exam_board_ids,\n        grade=student_profile.grade\n    ).select_related('subject', 'exam_board', 'grade')\n    \n    # Apply filters\n    subject_filter = request.GET.get('subject')\n    year_filter = request.GET.get('year')\n    board_filter = request.GET.get('board')\n    \n    if subject_filter:\n        exam_papers = exam_papers.filter(subject_id=subject_filter)\n    if year_filter:\n        exam_papers = exam_papers.filter(year=year_filter)\n    if board_filter:\n        exam_papers = exam_papers.filter(exam_board_id=board_filter)\n    \n    # Get unique years for filter\n    years = ExamPaper.objects.filter(\n        subject_id__in=subject_ids,\n        exam_board_id__in=exam_board_ids,\n        grade=student_profile.grade\n    ).values_list('year', flat=True).distinct().order_by('-year')\n    \n    # Check if user is pro\n    is_pro = student_profile.subscription == 'pro'\n    \n    context = {\n        'student_profile': student_profile,\n        'exam_papers': exam_papers,\n        'student_subjects': student_subjects,\n        'years': years,\n        'student_boards': StudentExamBoard.objects.filter(student=student_profile).select_related('exam_board'),\n        'selected_subject': subject_filter,\n        'selected_year': year_filter,\n        'selected_board': board_filter,\n        'is_pro': is_pro,\n    }\n    \n    return render(request, 'core/student/exam_papers/list.html', context)\n\n\n@student_login_required\ndef student_exam_paper_view(request, paper_id):\n    \"\"\"View exam paper with download option\"\"\"\n    student_profile = request.user.student_profile\n    \n    try:\n        exam_paper = ExamPaper.objects.select_related('subject', 'exam_board', 'grade').get(id=paper_id)\n    except ExamPaper.DoesNotExist:\n        messages.error(request, 'Exam paper not found.')\n        return redirect('student_exam_papers')\n    \n    # Check if student has access\n    has_access = StudentSubject.objects.filter(\n        student=student_profile,\n        subject=exam_paper.subject,\n        exam_board=exam_paper.exam_board\n    ).exists()\n    \n    if not has_access:\n        messages.error(request, 'You do not have access to this exam paper.')\n        return redirect('student_exam_papers')\n    \n    # Check if PRO content\n    is_pro = student_profile.subscription == 'pro'\n    if exam_paper.is_pro_content and not is_pro:\n        messages.warning(request, 'This is PRO content. Upgrade to access it.')\n        return redirect('student_exam_papers')\n    \n    context = {\n        'student_profile': student_profile,\n        'exam_paper': exam_paper,\n        'is_pro': is_pro,\n    }\n    \n    return render(request, 'core/student/exam_papers/view.html', context)\n\n\n@student_login_required\ndef student_subscription(request):\n    \"\"\"Show subscription details and upgrade/downgrade options\"\"\"\n    student_profile = request.user.student_profile\n    is_pro = student_profile.subscription == 'pro'\n    \n    # Get current exam board count\n    current_board_count = StudentExamBoard.objects.filter(student=student_profile).count()\n    \n    # Get pricing from admin-configurable model\n    pricing = {}\n    try:\n        from .models import StudentSubscriptionPricing\n        for tier in StudentSubscriptionPricing.objects.all():\n            pricing[tier.tier_type] = {\n                'price': tier.price,\n                'min_subjects': tier.min_subjects,\n                'max_subjects': tier.max_subjects,\n                'description': tier.description,\n            }\n    except Exception:\n        # Default pricing if not configured\n        pricing = {\n            'per_subject': {'price': 100, 'min_subjects': 1, 'max_subjects': 3, 'description': 'Pay per subject'},\n            'bundle_medium': {'price': 200, 'min_subjects': 4, 'max_subjects': 5, 'description': '4-5 subjects bundle'},\n            'bundle_all': {'price': 300, 'min_subjects': None, 'max_subjects': None, 'description': 'All subjects access'},\n            'tutor_addon': {'price': 500, 'min_subjects': None, 'max_subjects': None, 'description': 'Tutor support add-on'},\n        }\n    \n    # Get current student subscription if any\n    from .models import StudentSubscription\n    active_subscription = StudentSubscription.objects.filter(\n        student=student_profile, \n        is_active=True\n    ).first()\n    \n    context = {\n        'student_profile': student_profile,\n        'is_pro': is_pro,\n        'current_board_count': current_board_count,\n        'board_limit': student_profile.get_exam_board_limit(),\n        'pricing': pricing,\n        'active_subscription': active_subscription,\n    }\n    \n    return render(request, 'core/student/subscription.html', context)\n\n\n@student_login_required\ndef student_upgrade_to_pro(request):\n    \"\"\"Initiate PayFast payment for Pro subscription\"\"\"\n    from .payfast_service import PayFastService\n    import logging\n    \n    logger = logging.getLogger(__name__)\n    student_profile = request.user.student_profile\n    \n    # Check if already Pro\n    if student_profile.subscription == 'pro':\n        messages.info(request, 'You are already a Pro member!')\n        return redirect('student_subscription')\n    \n    # Generate PayFast payment form data for student subscription\n    payment_data = {\n        'merchant_id': settings.PAYFAST_MERCHANT_ID,\n        'merchant_key': settings.PAYFAST_MERCHANT_KEY,\n        'return_url': f\"{settings.SITE_URL}{reverse('student_payfast_return')}\",\n        'cancel_url': f\"{settings.SITE_URL}{reverse('student_payfast_cancel')}\",\n        'notify_url': f\"{settings.SITE_URL}{reverse('student_payfast_notify')}\",\n        \n        'name_first': request.user.first_name or request.user.username,\n        'name_last': request.user.last_name or '',\n        'email_address': request.user.email,\n        \n        'amount': '100.00',\n        'item_name': 'EduTech Pro Subscription',\n        'item_description': 'Monthly Pro subscription with unlimited quizzes and 5 exam boards',\n        \n        'custom_str1': str(request.user.id),\n        'custom_str2': 'pro_subscription',\n        \n        'subscription_type': '1',\n        'recurring_amount': '100.00',\n        'frequency': '3',\n        'cycles': '0',\n    }\n    \n    # Remove empty fields before signature generation\n    clean_data = {k: v for k, v in payment_data.items() if str(v).strip()}\n    \n    # Generate signature\n    clean_data['signature'] = PayFastService.generate_signature(clean_data)\n    \n    logger.info(f'Generated PayFast payment for user {request.user.username}')\n    \n    context = {\n        'student_profile': student_profile,\n        'payment_data': clean_data,\n        'payfast_url': PayFastService.get_payfast_url(),\n    }\n    \n    return render(request, 'core/student/upgrade.html', context)\n\n\nfrom django.views.decorators.csrf import csrf_exempt\nfrom django.http import HttpResponse\n\n@csrf_exempt\ndef student_payfast_notify(request):\n    \"\"\"Handle PayFast IPN (Instant Payment Notification)\"\"\"\n    from .payfast_service import PayFastService\n    import logging\n    \n    logger = logging.getLogger(__name__)\n    \n    if request.method != 'POST':\n        return HttpResponse('Invalid request method', status=400)\n    \n    post_data = request.POST.copy()\n    logger.info(f'PayFast IPN received: {post_data}')\n    \n    # Validate signature\n    if not PayFastService.validate_itn_signature(post_data):\n        logger.error('PayFast IPN signature validation failed')\n        return HttpResponse('Invalid signature', status=400)\n    \n    # Validate merchant ID\n    if not PayFastService.validate_merchant_id(post_data):\n        logger.error('PayFast IPN merchant ID validation failed')\n        return HttpResponse('Invalid merchant ID', status=400)\n    \n    # Validate payment amount\n    if not PayFastService.validate_payment_amount(post_data, 100.00):\n        logger.error('PayFast IPN amount validation failed')\n        return HttpResponse('Invalid amount', status=400)\n    \n    # Verify with PayFast servers\n    if not PayFastService.verify_payment_with_payfast(post_data):\n        logger.error('PayFast server verification failed')\n        return HttpResponse('Server verification failed', status=400)\n    \n    # Check payment status\n    payment_status = post_data.get('payment_status', '')\n    if payment_status != 'COMPLETE':\n        logger.warning(f'PayFast IPN payment not complete: {payment_status}')\n        return HttpResponse('Payment not complete', status=200)\n    \n    # Get user from custom field\n    try:\n        user_id = int(post_data.get('custom_str1', 0))\n        user = User.objects.get(id=user_id)\n        student_profile = user.student_profile\n    except (ValueError, User.DoesNotExist, AttributeError):\n        logger.error(f'PayFast IPN user not found: {post_data.get(\"custom_str1\")}')\n        return HttpResponse('User not found', status=400)\n    \n    # Update subscription to Pro\n    old_subscription = student_profile.subscription\n    student_profile.subscription = 'pro'\n    student_profile.save()\n    \n    logger.info(f'User {user.username} upgraded to Pro via PayFast')\n    \n    # Clear quiz quotas (Pro has unlimited)\n    StudentQuizQuota.objects.filter(student=student_profile).delete()\n    \n    # Send confirmation email\n    try:\n        send_mail(\n            subject='Welcome to EduTech Pro! üéâ',\n            message=f'''Hi {user.username},\n\nCongratulations! Your payment was successful and you are now an EduTech Pro member!\n\nHere's what you now have access to:\n\n‚úÖ Unlimited quizzes on all topics\n‚úÖ Select up to 5 exam boards (previously 2)\n‚úÖ Access to all study materials\n‚úÖ Early access to new features\n‚úÖ Priority support\n\nYou can now:\n- Take unlimited quizzes on any topic\n- Add more exam boards to your profile (up to 5 total)\n- Access all Pro-exclusive content\n\nThank you for upgrading! We're excited to support your learning journey.\n\nBest regards,\nEduTech Team\n\nP.S. Your subscription will automatically renew monthly at R100. You can cancel anytime from your subscription page.''',\n            from_email=settings.DEFAULT_FROM_EMAIL,\n            recipient_list=[user.email],\n            fail_silently=True,\n        )\n        \n        # Also notify parent if provided\n        if student_profile.parent_email:\n            send_mail(\n                subject='Your Child Upgraded to EduTech Pro',\n                message=f'''Hello,\n\nYour child ({user.username}) has upgraded to EduTech Pro subscription.\n\nSubscription: EduTech Pro\nPrice: R100/month (auto-renewal)\n\nThey now have access to:\n- Unlimited quizzes\n- 5 exam boards\n- All study materials\n- Priority support\n\nIf you have any questions about this subscription, please contact us.\n\nBest regards,\nEduTech Team''',\n                from_email=settings.DEFAULT_FROM_EMAIL,\n                recipient_list=[student_profile.parent_email],\n                fail_silently=True,\n            )\n    except Exception as e:\n        logger.error(f'Failed to send Pro upgrade email: {str(e)}')\n    \n    return HttpResponse('OK', status=200)\n\n\n@student_login_required\ndef student_payfast_return(request):\n    \"\"\"Handle user return from PayFast after payment\"\"\"\n    student_profile = request.user.student_profile\n    \n    # Check if upgrade was successful\n    if student_profile.subscription == 'pro':\n        messages.success(request, 'üéâ Welcome to Pro! Your upgrade was successful.')\n    else:\n        messages.info(request, 'Your payment is being processed. You will receive a confirmation email shortly.')\n    \n    return redirect('student_subscription')\n\n\n@student_login_required\ndef student_payfast_cancel(request):\n    \"\"\"Handle payment cancellation\"\"\"\n    messages.warning(request, 'Payment was cancelled. You can upgrade to Pro anytime!')\n    return redirect('student_subscription')\n\n\n@student_login_required\ndef student_subscription_cancel(request):\n    \"\"\"Cancel Pro subscription (downgrade to Free)\"\"\"\n    student_profile = request.user.student_profile\n    \n    if request.method == 'POST':\n        # Check if currently Pro\n        if student_profile.subscription != 'pro':\n            messages.error(request, 'You are not currently a Pro member.')\n            return redirect('student_subscription')\n        \n        # Downgrade to Free\n        student_profile.subscription = 'free'\n        student_profile.save()\n        \n        # Check if they have more than 2 exam boards\n        board_count = StudentExamBoard.objects.filter(student=student_profile).count()\n        warning_message = ''\n        if board_count > 2:\n            warning_message = f' You currently have {board_count} exam boards selected. Free accounts are limited to 2 boards. Please update your selections in your onboarding settings.'\n        \n        # Send confirmation email\n        try:\n            send_mail(\n                subject='EduTech Pro Subscription Cancelled',\n                message=f'''Hi {request.user.username},\n\nYour EduTech Pro subscription has been cancelled successfully.\n\nYou have been downgraded to the Free plan with the following features:\n- 2 exam boards (down from 5)\n- 2 different quizzes per topic (down from unlimited)\n- All subjects still available\n\n{warning_message}\n\nYour access to Pro features will continue until the end of your current billing period.\n\nWe're sad to see you go! If you change your mind, you can upgrade again anytime.\n\nBest regards,\nEduTech Team''',\n                from_email=settings.DEFAULT_FROM_EMAIL,\n                recipient_list=[request.user.email],\n                fail_silently=True,\n            )\n        except Exception as e:\n            pass\n        \n        messages.success(request, f'Your Pro subscription has been cancelled. You are now on the Free plan.{warning_message}')\n        return redirect('student_subscription')\n    \n    # GET request - show confirmation page\n    context = {\n        'student_profile': student_profile,\n    }\n    \n    return render(request, 'core/student/subscription_cancel_confirm.html', context)\n\n\n@student_login_required\ndef student_video_library(request):\n    \"\"\"Browse video lessons with cascading filters\"\"\"\n    student_profile = request.user.student_profile\n    \n    # Get all active videos\n    videos = VideoLesson.objects.filter(is_active=True).select_related(\n        'subject', 'topic', 'subtopic', 'concept'\n    )\n    \n    # Get featured videos\n    featured_videos = videos.filter(is_featured=True)[:6]\n    \n    # Get filter parameters\n    subject_filter = request.GET.get('subject')\n    topic_filter = request.GET.get('topic')\n    subtopic_filter = request.GET.get('subtopic')\n    concept_filter = request.GET.get('concept')\n    search_query = request.GET.get('search', '').strip()\n    \n    # Apply filters\n    if subject_filter:\n        videos = videos.filter(subject_id=subject_filter)\n    if topic_filter:\n        videos = videos.filter(topic_id=topic_filter)\n    if subtopic_filter:\n        videos = videos.filter(subtopic_id=subtopic_filter)\n    if concept_filter:\n        videos = videos.filter(concept_id=concept_filter)\n    if search_query:\n        videos = videos.filter(\n            Q(title__icontains=search_query) |\n            Q(description__icontains=search_query) |\n            Q(tags__icontains=search_query)\n        )\n    \n    # Order by featured first, then by order and created date\n    videos = videos.order_by('-is_featured', 'order', '-created_at')\n    \n    # Get all subjects with videos for filtering\n    subjects_with_videos = Subject.objects.filter(\n        video_lessons__is_active=True\n    ).distinct().order_by('name')\n    \n    # Get topics/subtopics/concepts for selected subject (for cascading dropdowns)\n    topics = []\n    subtopics = []\n    concepts = []\n    \n    if subject_filter:\n        topics = Topic.objects.filter(\n            subject_id=subject_filter,\n            is_active=True\n        ).order_by('order', 'name')\n        \n        if topic_filter:\n            subtopics = Subtopic.objects.filter(\n                topic_id=topic_filter,\n                is_active=True\n            ).order_by('order', 'name')\n            \n            if subtopic_filter:\n                concepts = Concept.objects.filter(\n                    subtopic_id=subtopic_filter,\n                    is_active=True\n                ).order_by('order', 'name')\n    \n    context = {\n        'student_profile': student_profile,\n        'videos': videos,\n        'featured_videos': featured_videos,\n        'subjects': subjects_with_videos,\n        'topics': topics,\n        'subtopics': subtopics,\n        'concepts': concepts,\n        'selected_subject': subject_filter,\n        'selected_topic': topic_filter,\n        'selected_subtopic': subtopic_filter,\n        'selected_concept': concept_filter,\n        'search_query': search_query,\n    }\n    \n    return render(request, 'core/student/video_library.html', context)\n\n\n@student_login_required\ndef student_video_player(request, video_id):\n    \"\"\"Watch individual video lesson\"\"\"\n    student_profile = request.user.student_profile\n    \n    try:\n        video = VideoLesson.objects.select_related(\n            'subject', 'topic', 'subtopic', 'concept'\n        ).get(id=video_id, is_active=True)\n    except VideoLesson.DoesNotExist:\n        messages.error(request, 'Video not found.')\n        return redirect('student_video_library')\n    \n    # Increment view count\n    video.view_count += 1\n    video.save(update_fields=['view_count'])\n    \n    # Get related videos from same topic/subtopic\n    related_videos = VideoLesson.objects.filter(is_active=True).exclude(id=video.id)\n    \n    if video.subtopic:\n        related_videos = related_videos.filter(subtopic=video.subtopic)\n    elif video.topic:\n        related_videos = related_videos.filter(topic=video.topic)\n    elif video.subject:\n        related_videos = related_videos.filter(subject=video.subject)\n    \n    related_videos = related_videos.select_related(\n        'subject', 'topic', 'subtopic', 'concept'\n    ).order_by('order', '-created_at')[:8]\n    \n    # Parse tags\n    tags_list = []\n    if video.tags:\n        tags_list = [tag.strip() for tag in video.tags.split(',') if tag.strip()]\n    \n    context = {\n        'student_profile': student_profile,\n        'video': video,\n        'related_videos': related_videos,\n        'tags_list': tags_list,\n        'embed_url': video.get_youtube_embed_url(),\n    }\n    \n    return render(request, 'core/student/video_player.html', context)\n\n\ndef student_video_ajax_filters(request):\n    \"\"\"AJAX endpoint for cascading filter dropdowns\"\"\"\n    filter_type = request.GET.get('type')\n    parent_id = request.GET.get('parent_id')\n    \n    data = []\n    \n    if filter_type == 'topics' and parent_id:\n        topics = Topic.objects.filter(\n            subject_id=parent_id,\n            is_active=True\n        ).order_by('order', 'name')\n        data = [{'id': t.id, 'name': t.name} for t in topics]\n    \n    elif filter_type == 'subtopics' and parent_id:\n        subtopics = Subtopic.objects.filter(\n            topic_id=parent_id,\n            is_active=True\n        ).order_by('order', 'name')\n        data = [{'id': s.id, 'name': s.name} for s in subtopics]\n    \n    elif filter_type == 'concepts' and parent_id:\n        concepts = Concept.objects.filter(\n            subtopic_id=parent_id,\n            is_active=True\n        ).order_by('order', 'name')\n        data = [{'id': c.id, 'name': c.name} for c in concepts]\n    \n    return JsonResponse({'items': data})\n\n\n# ===== STUDENT PATHWAY SYSTEM =====\n\n@student_login_required\ndef student_subject_pathway(request, subject_id):\n    \"\"\"Subject pathway selection - Study, Revise, or Info\"\"\"\n    from .models import StudentSubject, Topic, Note, Flashcard, StudentQuiz, ExamPaper, Syllabus, StudentTopicProgress\n    \n    student_profile = StudentProfile.objects.get(user=request.user)\n    \n    # Check if student has this subject enrolled\n    student_subject = get_object_or_404(\n        StudentSubject, \n        student=student_profile, \n        subject_id=subject_id\n    )\n    subject = student_subject.subject\n    exam_board = student_subject.exam_board\n    \n    # Get progress stats\n    topics = Topic.objects.filter(\n        subject=subject,\n        exam_board=exam_board,\n        is_active=True\n    ).count()\n    \n    notes_count = Note.objects.filter(\n        subject=subject,\n        exam_board=exam_board\n    ).count()\n    \n    flashcards_count = Flashcard.objects.filter(\n        subject=subject,\n        exam_board=exam_board\n    ).count()\n    \n    quizzes_count = StudentQuiz.objects.filter(\n        subject=subject,\n        exam_board=exam_board\n    ).count()\n    \n    videos_count = VideoLesson.objects.filter(\n        subject=subject,\n        is_active=True\n    ).count()\n    \n    # Calculate overall progress\n    progress = StudentTopicProgress.objects.filter(\n        student=student_profile,\n        subject=subject\n    )\n    avg_progress = 0\n    if progress.exists():\n        total_completion = sum(p.get_completion_percentage() for p in progress)\n        avg_progress = int(total_completion / max(topics, 1))\n    \n    context = {\n        'student_profile': student_profile,\n        'subject': subject,\n        'exam_board': exam_board,\n        'topics_count': topics,\n        'notes_count': notes_count,\n        'flashcards_count': flashcards_count,\n        'quizzes_count': quizzes_count,\n        'videos_count': videos_count,\n        'overall_progress': avg_progress,\n    }\n    \n    return render(request, 'core/student/pathway/subject_pathway.html', context)\n\n\n@student_login_required\ndef student_study_pathway(request, subject_id):\n    \"\"\"Study pathway - New layout with sidebar topics and tabbed content\"\"\"\n    from django.shortcuts import get_object_or_404\n    from .models import StudentSubject, Topic, Subtopic, Note, VideoLesson, Flashcard, StudentQuiz, StudentTopicProgress\n    \n    student_profile = StudentProfile.objects.get(user=request.user)\n    \n    student_subject = get_object_or_404(\n        StudentSubject, \n        student=student_profile, \n        subject_id=subject_id\n    )\n    subject = student_subject.subject\n    exam_board = student_subject.exam_board\n    \n    # Get all topics for this subject with their subtopics\n    topics = Topic.objects.filter(\n        subject=subject,\n        is_active=True\n    ).order_by('order', 'name')\n    \n    # Build topics with subtopics and content counts\n    topics_with_data = []\n    for topic in topics:\n        subtopics = Subtopic.objects.filter(topic=topic, is_active=True).order_by('order', 'name')\n        progress = StudentTopicProgress.objects.filter(\n            student=student_profile,\n            subject=subject,\n            topic=topic\n        ).first()\n        \n        topics_with_data.append({\n            'topic': topic,\n            'subtopics': list(subtopics),\n            'notes_count': Note.objects.filter(subject=subject, topic=topic).count(),\n            'videos_count': VideoLesson.objects.filter(subject=subject, topic=topic, is_active=True).count(),\n            'flashcards_count': Flashcard.objects.filter(subject=subject, topic=topic).count(),\n            'quizzes_count': StudentQuiz.objects.filter(subject=subject, topic=topic.name).count(),\n            'progress': progress.get_completion_percentage() if progress else 0,\n        })\n    \n    context = {\n        'student_profile': student_profile,\n        'subject': subject,\n        'exam_board': exam_board,\n        'topics_with_data': topics_with_data,\n    }\n    \n    return render(request, 'core/student/pathway/study_layout.html', context)\n\n\n@student_login_required\ndef student_topic_content_ajax(request, subject_id, topic_id):\n    \"\"\"AJAX endpoint to load topic content for the study layout\"\"\"\n    from django.shortcuts import get_object_or_404\n    from .models import StudentSubject, Topic, Subtopic, Note, VideoLesson, Flashcard, StudentQuiz\n    import json\n    \n    if request.headers.get('X-Requested-With') != 'XMLHttpRequest':\n        return JsonResponse({'error': 'Invalid request'}, status=400)\n    \n    student_profile = StudentProfile.objects.get(user=request.user)\n    \n    student_subject = get_object_or_404(\n        StudentSubject, \n        student=student_profile, \n        subject_id=subject_id\n    )\n    subject = student_subject.subject\n    topic = get_object_or_404(Topic, id=topic_id, subject=subject, is_active=True)\n    \n    subtopic_id = request.GET.get('subtopic')\n    subtopic = None\n    if subtopic_id:\n        subtopic = Subtopic.objects.filter(id=subtopic_id, topic=topic).first()\n    \n    # Get notes\n    notes_qs = Note.objects.filter(subject=subject, topic=topic)\n    notes = [{\n        'id': n.id,\n        'title': n.title,\n        'description': n.full_version_text[:100] if n.full_version_text else '',\n        'has_full': bool(n.full_version),\n        'has_summary': bool(n.summary_version),\n    } for n in notes_qs[:10]]\n    \n    # Get videos\n    videos_qs = VideoLesson.objects.filter(subject=subject, topic=topic, is_active=True)\n    if subtopic:\n        videos_qs = videos_qs.filter(subtopic=subtopic)\n    videos = [{\n        'id': v.id,\n        'title': v.title,\n        'duration': str(v.duration) if hasattr(v, 'duration') and v.duration else '',\n    } for v in videos_qs[:10]]\n    \n    # Get flashcards\n    flashcards_qs = Flashcard.objects.filter(subject=subject, topic=topic)\n    flashcards = [{\n        'id': f.id,\n        'front': f.front_text[:100] if f.front_text else '',\n        'back': f.back_text[:100] if f.back_text else '',\n    } for f in flashcards_qs[:20]]\n    \n    # Get quizzes\n    quizzes_qs = StudentQuiz.objects.filter(subject=subject, topic=topic.name)\n    quizzes = [{\n        'id': q.id,\n        'title': q.title,\n        'difficulty': q.difficulty,\n        'questions_count': q.questions.count(),\n    } for q in quizzes_qs[:10]]\n    \n    return JsonResponse({\n        'notes': notes,\n        'videos': videos,\n        'flashcards': flashcards,\n        'quizzes': quizzes,\n    })\n\n\n@student_login_required\ndef student_topic_detail(request, subject_id, topic_id):\n    \"\"\"Topic detail with tabbed content - Notes, Videos, Flashcards, Quizzes\"\"\"\n    from .models import StudentSubject, Topic, Note, VideoLesson, Flashcard, StudentQuiz, InteractiveQuestion, StudentTopicProgress\n    \n    student_profile = StudentProfile.objects.get(user=request.user)\n    \n    student_subject = get_object_or_404(\n        StudentSubject, \n        student=student_profile, \n        subject_id=subject_id\n    )\n    subject = student_subject.subject\n    exam_board = student_subject.exam_board\n    \n    topic = get_object_or_404(Topic, id=topic_id, subject=subject, is_active=True)\n    \n    # Get content for this topic\n    notes = Note.objects.filter(subject=subject, topic=topic).order_by('-created_at')\n    videos = VideoLesson.objects.filter(subject=subject, topic=topic, is_active=True).order_by('order', '-created_at')\n    flashcards = Flashcard.objects.filter(subject=subject, topic=topic).order_by('-created_at')\n    \n    # Get quizzes grouped by difficulty\n    quizzes_easy = StudentQuiz.objects.filter(\n        subject=subject, topic=topic.name, difficulty='easy'\n    ).order_by('-created_at')\n    quizzes_medium = StudentQuiz.objects.filter(\n        subject=subject, topic=topic.name, difficulty='medium'\n    ).order_by('-created_at')\n    quizzes_hard = StudentQuiz.objects.filter(\n        subject=subject, topic=topic.name, difficulty='hard'\n    ).order_by('-created_at')\n    \n    # Get structured questions for this topic\n    structured_questions = InteractiveQuestion.objects.filter(\n        subject=subject,\n        topic=topic,\n        question_type='structured'\n    ).order_by('difficulty', '-created_at')\n    \n    active_tab = request.GET.get('tab', 'notes')\n    \n    # AJAX endpoint for tracking content views\n    if request.method == 'POST' and request.headers.get('X-Requested-With') == 'XMLHttpRequest':\n        content_type = request.POST.get('content_type')  # notes, videos, flashcards\n        content_id = request.POST.get('content_id')\n        \n        progress, created = StudentTopicProgress.objects.get_or_create(\n            student=student_profile,\n            subject=subject,\n            topic=topic\n        )\n        \n        if content_type == 'notes' and content_id:\n            progress.notes_viewed += 1\n        elif content_type == 'videos' and content_id:\n            progress.videos_watched += 1\n        elif content_type == 'flashcards' and content_id:\n            progress.flashcards_reviewed += 1\n        \n        progress.save()\n        return JsonResponse({\n            'success': True, \n            'progress_percentage': progress.get_completion_percentage()\n        })\n    \n    # Get current progress for display\n    topic_progress, _ = StudentTopicProgress.objects.get_or_create(\n        student=student_profile,\n        subject=subject,\n        topic=topic\n    )\n    \n    context = {\n        'student_profile': student_profile,\n        'subject': subject,\n        'exam_board': exam_board,\n        'topic': topic,\n        'notes': notes,\n        'videos': videos,\n        'flashcards': flashcards,\n        'quizzes_easy': quizzes_easy,\n        'quizzes_medium': quizzes_medium,\n        'quizzes_hard': quizzes_hard,\n        'structured_questions': structured_questions,\n        'active_tab': active_tab,\n        'topic_progress': topic_progress,\n    }\n    \n    return render(request, 'core/student/pathway/topic_detail.html', context)\n\n\n@student_login_required\ndef student_info_pathway(request, subject_id):\n    \"\"\"Info pathway - Syllabi, sample papers, exam guidelines\"\"\"\n    from .models import StudentSubject, Syllabus, OfficialExamPaper, ExamPaper\n    \n    student_profile = StudentProfile.objects.get(user=request.user)\n    \n    student_subject = get_object_or_404(\n        StudentSubject, \n        student=student_profile, \n        subject_id=subject_id\n    )\n    subject = student_subject.subject\n    exam_board = student_subject.exam_board\n    \n    # Get syllabi\n    syllabi = Syllabus.objects.filter(\n        subject=subject,\n        exam_board=exam_board,\n        is_active=True\n    ).order_by('-year')\n    \n    # Get official exam papers\n    official_papers = OfficialExamPaper.objects.filter(\n        subject=subject,\n        exam_board=exam_board,\n        is_public=True\n    ).order_by('-year', 'session')[:20]\n    \n    # Get sample/practice papers\n    sample_papers = ExamPaper.objects.filter(\n        subject=subject,\n        exam_board=exam_board,\n        is_pro_content=False\n    ).order_by('-year', '-created_at')[:10]\n    \n    context = {\n        'student_profile': student_profile,\n        'subject': subject,\n        'exam_board': exam_board,\n        'syllabi': syllabi,\n        'official_papers': official_papers,\n        'sample_papers': sample_papers,\n    }\n    \n    return render(request, 'core/student/pathway/info_pathway.html', context)\n\n\n@student_login_required\ndef student_revise_pathway(request, subject_id):\n    \"\"\"Revise pathway - Quick flashcard review and practice quizzes\"\"\"\n    from .models import StudentSubject, Topic, Flashcard, StudentQuiz, StudentTopicProgress\n    \n    student_profile = StudentProfile.objects.get(user=request.user)\n    \n    student_subject = get_object_or_404(\n        StudentSubject, \n        student=student_profile, \n        subject_id=subject_id\n    )\n    subject = student_subject.subject\n    exam_board = student_subject.exam_board\n    \n    # Get topics with flashcards\n    topics_with_flashcards = Topic.objects.filter(\n        subject=subject,\n        exam_board=exam_board,\n        is_active=True,\n        flashcards__isnull=False\n    ).distinct().order_by('order', 'name')\n    \n    # Get quick quiz options (by difficulty)\n    easy_quizzes = StudentQuiz.objects.filter(\n        subject=subject,\n        exam_board=exam_board,\n        difficulty='easy'\n    ).order_by('?')[:5]\n    \n    medium_quizzes = StudentQuiz.objects.filter(\n        subject=subject,\n        exam_board=exam_board,\n        difficulty='medium'\n    ).order_by('?')[:5]\n    \n    hard_quizzes = StudentQuiz.objects.filter(\n        subject=subject,\n        exam_board=exam_board,\n        difficulty='hard'\n    ).order_by('?')[:5]\n    \n    # Get flashcard counts by topic\n    flashcard_topics = []\n    for topic in topics_with_flashcards:\n        count = Flashcard.objects.filter(subject=subject, topic=topic).count()\n        flashcard_topics.append({\n            'topic': topic,\n            'count': count\n        })\n    \n    context = {\n        'student_profile': student_profile,\n        'subject': subject,\n        'exam_board': exam_board,\n        'flashcard_topics': flashcard_topics,\n        'easy_quizzes': easy_quizzes,\n        'medium_quizzes': medium_quizzes,\n        'hard_quizzes': hard_quizzes,\n    }\n    \n    return render(request, 'core/student/pathway/revise_pathway.html', context)\n\n\n@student_login_required\ndef student_progress_dashboard(request):\n    \"\"\"Student progress dashboard with percentages and stats\"\"\"\n    from .models import StudentSubject, StudentTopicProgress, StudentQuizAttempt\n    \n    student_profile = StudentProfile.objects.get(user=request.user)\n    \n    # Get all enrolled subjects with progress\n    subjects_data = []\n    student_subjects = StudentSubject.objects.filter(\n        student=student_profile\n    ).select_related('subject', 'exam_board')\n    \n    for ss in student_subjects:\n        topic_progress = StudentTopicProgress.objects.filter(\n            student=student_profile,\n            subject=ss.subject\n        )\n        \n        topics_total = Topic.objects.filter(\n            subject=ss.subject,\n            exam_board=ss.exam_board,\n            is_active=True\n        ).count()\n        \n        topics_completed = topic_progress.filter(notes_completed=True).count()\n        \n        avg_quiz_score = 0\n        if topic_progress.exists():\n            scores = [p.average_quiz_score for p in topic_progress if p.average_quiz_score > 0]\n            if scores:\n                avg_quiz_score = sum(scores) / len(scores)\n        \n        overall_progress = 0\n        if topic_progress.exists():\n            total = sum(p.get_completion_percentage() for p in topic_progress)\n            overall_progress = int(total / max(topics_total, 1))\n        \n        subjects_data.append({\n            'subject': ss.subject,\n            'exam_board': ss.exam_board,\n            'topics_total': topics_total,\n            'topics_completed': topics_completed,\n            'avg_quiz_score': round(avg_quiz_score, 1),\n            'overall_progress': overall_progress,\n        })\n    \n    # Recent quiz attempts\n    recent_attempts = StudentQuizAttempt.objects.filter(\n        student=student_profile\n    ).select_related('quiz', 'quiz__subject').order_by('-started_at')[:10]\n    \n    context = {\n        'student_profile': student_profile,\n        'subjects_data': subjects_data,\n        'recent_attempts': recent_attempts,\n    }\n    \n    return render(request, 'core/student/pathway/progress_dashboard.html', context)\n\n\n@student_login_required\ndef student_settings(request):\n    \"\"\"Student account settings page\"\"\"\n    from .models import StudentSubscriptionPricing, StudentSubscription, StudentSubject\n    \n    student_profile = request.user.student_profile\n    \n    # Get subscription info\n    try:\n        subscription = StudentSubscription.objects.get(student=student_profile)\n    except StudentSubscription.DoesNotExist:\n        subscription = None\n    \n    # Get pricing info\n    pricing = StudentSubscriptionPricing.get_current()\n    \n    # Get student's subjects\n    student_subjects = StudentSubject.objects.filter(student=student_profile).select_related('subject', 'exam_board')\n    subjects_count = student_subjects.count()\n    \n    # Calculate current tier price\n    if subjects_count <= pricing.per_subject_max:\n        current_price = pricing.per_subject_price * subjects_count\n        plan_name = f\"Per Subject ({subjects_count} subject{'s' if subjects_count != 1 else ''})\"\n    elif subjects_count <= pricing.multi_subject_max:\n        current_price = pricing.multi_subject_price\n        plan_name = f\"Multi Subject ({subjects_count} subjects)\"\n    else:\n        current_price = pricing.all_access_price\n        plan_name = \"All Access\"\n    \n    if request.method == 'POST':\n        # Handle profile updates\n        first_name = request.POST.get('first_name', '')\n        last_name = request.POST.get('last_name', '')\n        \n        user = request.user\n        user.first_name = first_name\n        user.last_name = last_name\n        user.save()\n        \n        messages.success(request, 'Profile updated successfully!')\n        return redirect('student_settings')\n    \n    context = {\n        'student_profile': student_profile,\n        'subscription': subscription,\n        'pricing': pricing,\n        'student_subjects': student_subjects,\n        'subjects_count': subjects_count,\n        'current_price': current_price,\n        'plan_name': plan_name,\n    }\n    \n    return render(request, 'core/student/settings/settings.html', context)\n\n\n@student_login_required\ndef student_change_password(request):\n    \"\"\"Change password view\"\"\"\n    student_profile = request.user.student_profile\n    \n    if request.method == 'POST':\n        current_password = request.POST.get('current_password', '')\n        new_password = request.POST.get('new_password', '')\n        confirm_password = request.POST.get('confirm_password', '')\n        \n        user = request.user\n        \n        if not user.check_password(current_password):\n            messages.error(request, 'Current password is incorrect.')\n            return redirect('student_settings')\n        \n        if new_password != confirm_password:\n            messages.error(request, 'New passwords do not match.')\n            return redirect('student_settings')\n        \n        if len(new_password) < 8:\n            messages.error(request, 'Password must be at least 8 characters.')\n            return redirect('student_settings')\n        \n        user.set_password(new_password)\n        user.save()\n        \n        from django.contrib.auth import update_session_auth_hash\n        update_session_auth_hash(request, user)\n        \n        messages.success(request, 'Password changed successfully!')\n        return redirect('student_settings')\n    \n    return redirect('student_settings')\n\n\n@student_login_required\ndef student_support(request):\n    \"\"\"Student support page - list enquiries\"\"\"\n    from .models import SupportEnquiry\n    \n    student_profile = request.user.student_profile\n    \n    # Get all enquiries for this student\n    enquiries = SupportEnquiry.objects.filter(student=student_profile).order_by('-created_at')\n    \n    # Filter by status\n    status_filter = request.GET.get('status', '')\n    if status_filter:\n        enquiries = enquiries.filter(status=status_filter)\n    \n    context = {\n        'student_profile': student_profile,\n        'enquiries': enquiries,\n        'selected_status': status_filter,\n    }\n    \n    return render(request, 'core/student/support/list.html', context)\n\n\n@student_login_required\ndef student_support_new(request):\n    \"\"\"Create new support enquiry\"\"\"\n    from .models import SupportEnquiry, StudentSubject\n    \n    student_profile = request.user.student_profile\n    \n    # Get student's subjects for the form\n    student_subjects = StudentSubject.objects.filter(student=student_profile).select_related('subject')\n    \n    if request.method == 'POST':\n        enquiry_type = request.POST.get('enquiry_type', 'system')\n        subject = request.POST.get('subject', '')\n        message = request.POST.get('message', '')\n        related_subject_id = request.POST.get('related_subject', '')\n        related_topic = request.POST.get('related_topic', '')\n        \n        if not subject or not message:\n            messages.error(request, 'Please fill in all required fields.')\n            return redirect('student_support_new')\n        \n        # Check if tutor support requires subscription\n        if enquiry_type == 'tutor':\n            try:\n                subscription = student_profile.subscription_record\n                if not subscription.has_tutor_support:\n                    messages.warning(request, 'Tutor support requires the R500 add-on. Your enquiry will be submitted as a system support request.')\n                    enquiry_type = 'system'\n            except:\n                messages.warning(request, 'Tutor support requires a subscription add-on. Your enquiry will be submitted as a system support request.')\n                enquiry_type = 'system'\n        \n        enquiry = SupportEnquiry.objects.create(\n            student=student_profile,\n            enquiry_type=enquiry_type,\n            subject=subject,\n            message=message,\n            related_topic=related_topic,\n        )\n        \n        if related_subject_id:\n            try:\n                enquiry.related_subject_id = int(related_subject_id)\n                enquiry.save()\n            except:\n                pass\n        \n        messages.success(request, 'Your support enquiry has been submitted. We will get back to you soon!')\n        return redirect('student_support')\n    \n    context = {\n        'student_profile': student_profile,\n        'student_subjects': student_subjects,\n    }\n    \n    return render(request, 'core/student/support/new.html', context)\n\n\n@student_login_required\ndef student_support_view(request, enquiry_id):\n    \"\"\"View a support enquiry\"\"\"\n    from .models import SupportEnquiry\n    \n    student_profile = request.user.student_profile\n    \n    try:\n        enquiry = SupportEnquiry.objects.get(id=enquiry_id, student=student_profile)\n    except SupportEnquiry.DoesNotExist:\n        messages.error(request, 'Enquiry not found.')\n        return redirect('student_support')\n    \n    context = {\n        'student_profile': student_profile,\n        'enquiry': enquiry,\n    }\n    \n    return render(request, 'core/student/support/view.html', context)\n","path":null,"size_bytes":86248,"size_tokens":null},"core/student_urls.py":{"content":"from django.urls import path\nfrom . import student_views\n\nurlpatterns = [\n    path('register/', student_views.student_register, name='student_register'),\n    path('login/', student_views.student_login, name='student_login'),\n    path('logout/', student_views.student_logout, name='student_logout'),\n    path('verify-email/<str:token>/', student_views.student_verify_email, name='student_verify_email'),\n    path('onboarding/', student_views.student_onboarding, name='student_onboarding'),\n    path('dashboard/', student_views.student_dashboard, name='student_dashboard'),\n    \n    path('quizzes/', student_views.student_quizzes_list, name='student_quizzes_list'),\n    path('quiz/<int:quiz_id>/start/', student_views.student_quiz_start, name='student_quiz_start'),\n    path('quiz/<int:quiz_id>/take/', student_views.student_quiz_take, name='student_quiz_take'),\n    path('quiz/submit/', student_views.student_quiz_submit, name='student_quiz_submit'),\n    path('quiz/<int:attempt_id>/results/', student_views.student_quiz_results, name='student_quiz_results'),\n    path('quiz/history/', student_views.student_quiz_history, name='student_quiz_history'),\n    \n    path('notes/', student_views.student_notes, name='student_notes'),\n    path('note/<int:note_id>/', student_views.student_note_view, name='student_note_view'),\n    path('flashcards/', student_views.student_flashcards, name='student_flashcards'),\n    path('flashcards/study/<int:subject_id>/', student_views.student_flashcard_study, name='student_flashcard_study'),\n    path('exam-papers/', student_views.student_exam_papers, name='student_exam_papers'),\n    path('exam-paper/<int:paper_id>/', student_views.student_exam_paper_view, name='student_exam_paper_view'),\n    \n    path('subscription/', student_views.student_subscription, name='student_subscription'),\n    path('subscription/upgrade/', student_views.student_upgrade_to_pro, name='student_upgrade_to_pro'),\n    path('subscription/payfast-notify/', student_views.student_payfast_notify, name='student_payfast_notify'),\n    path('subscription/payfast-return/', student_views.student_payfast_return, name='student_payfast_return'),\n    path('subscription/payfast-cancel/', student_views.student_payfast_cancel, name='student_payfast_cancel'),\n    path('subscription/cancel/', student_views.student_subscription_cancel, name='student_subscription_cancel'),\n    \n    path('videos/', student_views.student_video_library, name='student_video_library'),\n    path('videos/<int:video_id>/', student_views.student_video_player, name='student_video_player'),\n    path('videos/ajax/filters/', student_views.student_video_ajax_filters, name='student_video_ajax_filters'),\n    \n    # Student Pathway System\n    path('subject/<int:subject_id>/', student_views.student_subject_pathway, name='student_subject_pathway'),\n    path('subject/<int:subject_id>/study/', student_views.student_study_pathway, name='student_study_pathway'),\n    path('subject/<int:subject_id>/study/<int:topic_id>/', student_views.student_topic_detail, name='student_topic_detail'),\n    path('subject/<int:subject_id>/content/<int:topic_id>/', student_views.student_topic_content_ajax, name='student_topic_content_ajax'),\n    path('subject/<int:subject_id>/info/', student_views.student_info_pathway, name='student_info_pathway'),\n    path('subject/<int:subject_id>/revise/', student_views.student_revise_pathway, name='student_revise_pathway'),\n    path('progress/', student_views.student_progress_dashboard, name='student_progress_dashboard'),\n    \n    # Settings and Support\n    path('settings/', student_views.student_settings, name='student_settings'),\n    path('settings/password/', student_views.student_change_password, name='student_change_password'),\n    path('support/', student_views.student_support, name='student_support'),\n    path('support/new/', student_views.student_support_new, name='student_support_new'),\n    path('support/<int:enquiry_id>/', student_views.student_support_view, name='student_support_view'),\n]\n","path":null,"size_bytes":4007,"size_tokens":null},"core/templatetags/__init__.py":{"content":"# Template tags and filters for EduTech\n","path":null,"size_bytes":40,"size_tokens":null},"core/templatetags/quiz_filters.py":{"content":"from django import template\n\nregister = template.Library()\n\n@register.filter\ndef get_item(dictionary, key):\n    \"\"\"Get an item from a dictionary using a key\"\"\"\n    if dictionary is None:\n        return None\n    return dictionary.get(key)\n","path":null,"size_bytes":238,"size_tokens":null},"core/migrations/0019_officialexampaper.py":{"content":"# Generated by Django 5.0.2 on 2025-11-22 23:09\n\nimport django.db.models.deletion\nfrom django.conf import settings\nfrom django.db import migrations, models\n\n\nclass Migration(migrations.Migration):\n\n    dependencies = [\n        ('core', '0018_flashcard_interactivequestion_exampaper_note_and_more'),\n        migrations.swappable_dependency(settings.AUTH_USER_MODEL),\n    ]\n\n    operations = [\n        migrations.CreateModel(\n            name='OfficialExamPaper',\n            fields=[\n                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),\n                ('subject_code', models.CharField(help_text='Official subject code (e.g., 0580, 9MA0, PHYS-01)', max_length=50)),\n                ('subject_name', models.CharField(blank=True, help_text='e.g., Mathematics, Physics', max_length=200)),\n                ('module_code', models.CharField(blank=True, help_text='Optional module/component code', max_length=50)),\n                ('year', models.IntegerField(help_text='e.g., 2023')),\n                ('session', models.CharField(choices=[('june', 'June'), ('november', 'November'), ('may', 'May/June'), ('february', 'February/March'), ('october', 'October/November'), ('summer', 'Summer'), ('winter', 'Winter'), ('other', 'Other')], max_length=20)),\n                ('paper_number', models.CharField(help_text='e.g., 1, 2, 3, 4H, 1F', max_length=20)),\n                ('variant', models.CharField(blank=True, help_text='e.g., 1, 2, 3 for Cambridge variants', max_length=10)),\n                ('paper_type', models.CharField(choices=[('qp', 'Question Paper'), ('ms', 'Marking Scheme'), ('er', 'Examiner Report'), ('gt', 'Grade Thresholds'), ('ir', 'Insert/Resource Booklet'), ('specimen', 'Specimen Paper'), ('other', 'Other')], default='qp', max_length=20)),\n                ('original_filename', models.CharField(help_text='Original file name for reference', max_length=255)),\n                ('file', models.FileField(upload_to='official_exam_papers/%Y/%m/')),\n                ('metadata_json', models.JSONField(blank=True, default=dict, help_text='Additional parsed metadata')),\n                ('is_public', models.BooleanField(default=True, help_text='Visible on public download page')),\n                ('can_use_for_training', models.BooleanField(default=True, help_text='Use for AI training')),\n                ('created_at', models.DateTimeField(auto_now_add=True)),\n                ('updated_at', models.DateTimeField(auto_now=True)),\n                ('exam_board', models.ForeignKey(help_text='Exam board', on_delete=django.db.models.deletion.CASCADE, to='core.examboard')),\n                ('subject', models.ForeignKey(blank=True, help_text='Optional subject mapping', null=True, on_delete=django.db.models.deletion.CASCADE, to='core.subject')),\n                ('uploaded_by', models.ForeignKey(null=True, on_delete=django.db.models.deletion.SET_NULL, to=settings.AUTH_USER_MODEL)),\n            ],\n            options={\n                'ordering': ['-year', 'exam_board', 'subject_code', 'session', 'paper_number'],\n                'indexes': [models.Index(fields=['exam_board', 'subject_code', 'year'], name='core_offici_exam_bo_e40af8_idx'), models.Index(fields=['is_public'], name='core_offici_is_publ_83814b_idx'), models.Index(fields=['subject', 'year'], name='core_offici_subject_6d2c2c_idx')],\n                'unique_together': {('exam_board', 'subject_code', 'year', 'session', 'paper_number', 'variant', 'paper_type')},\n            },\n        ),\n    ]\n","path":null,"size_bytes":3536,"size_tokens":null},"core/templatetags/custom_filters.py":{"content":"from django import template\n\nregister = template.Library()\n\n@register.filter\ndef get_item(dictionary, key):\n    \"\"\"\n    Template filter to get an item from a dictionary using a dynamic key.\n    Usage: {{ dict|get_item:key }}\n    \"\"\"\n    if dictionary is None:\n        return None\n    return dictionary.get(key)\n","path":null,"size_bytes":311,"size_tokens":null},"core/migrations/0020_teacherassessment_teacherquestion_and_more.py":{"content":"# Generated by Django 5.0.2 on 2025-11-28 21:19\n\nimport django.db.models.deletion\nfrom django.conf import settings\nfrom django.db import migrations, models\n\n\nclass Migration(migrations.Migration):\n\n    dependencies = [\n        ('core', '0019_officialexampaper'),\n        migrations.swappable_dependency(settings.AUTH_USER_MODEL),\n    ]\n\n    operations = [\n        migrations.CreateModel(\n            name='TeacherAssessment',\n            fields=[\n                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),\n                ('title', models.CharField(max_length=255)),\n                ('description', models.TextField(blank=True)),\n                ('category', models.CharField(choices=[('exam', 'Exam'), ('test', 'Test'), ('assignment', 'Assignment'), ('homework', 'Homework'), ('classwork', 'Classwork')], max_length=20)),\n                ('time_limit', models.IntegerField(blank=True, help_text='Time limit in minutes', null=True)),\n                ('total_marks', models.IntegerField(default=0)),\n                ('passing_marks', models.IntegerField(blank=True, null=True)),\n                ('instructions', models.TextField(blank=True)),\n                ('status', models.CharField(choices=[('draft', 'Draft'), ('published', 'Published'), ('archived', 'Archived')], default='draft', max_length=20)),\n                ('is_shuffle_questions', models.BooleanField(default=False)),\n                ('show_correct_answers', models.BooleanField(default=True)),\n                ('created_at', models.DateTimeField(auto_now_add=True)),\n                ('updated_at', models.DateTimeField(auto_now=True)),\n                ('grade', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, to='core.grade')),\n                ('subject', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, to='core.subject')),\n                ('teacher', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='assessments', to=settings.AUTH_USER_MODEL)),\n            ],\n            options={\n                'ordering': ['-created_at'],\n            },\n        ),\n        migrations.CreateModel(\n            name='TeacherQuestion',\n            fields=[\n                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),\n                ('question_type', models.CharField(choices=[('mcq', 'Multiple Choice'), ('mcq_multi', 'Multiple Choice (Multiple Answers)'), ('true_false', 'True/False'), ('short_answer', 'Short Answer'), ('long_answer', 'Long Answer / Essay'), ('matching', 'Matching'), ('fill_blank', 'Fill in the Blank')], max_length=20)),\n                ('question_text', models.TextField()),\n                ('question_image', models.ImageField(blank=True, null=True, upload_to='assessment_questions/%Y/%m/')),\n                ('marks', models.IntegerField(default=1)),\n                ('order', models.IntegerField(default=0)),\n                ('correct_answer', models.TextField(blank=True, help_text='For short/long answer - expected answer or keywords')),\n                ('explanation', models.TextField(blank=True, help_text='Explanation shown after answering')),\n                ('is_required', models.BooleanField(default=True)),\n                ('created_at', models.DateTimeField(auto_now_add=True)),\n                ('updated_at', models.DateTimeField(auto_now=True)),\n                ('assessment', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='questions', to='core.teacherassessment')),\n            ],\n            options={\n                'ordering': ['order', 'id'],\n            },\n        ),\n        migrations.CreateModel(\n            name='TeacherQuestionOption',\n            fields=[\n                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),\n                ('option_text', models.CharField(max_length=500)),\n                ('option_image', models.ImageField(blank=True, null=True, upload_to='assessment_options/%Y/%m/')),\n                ('is_correct', models.BooleanField(default=False)),\n                ('order', models.IntegerField(default=0)),\n                ('match_pair', models.CharField(blank=True, help_text='For matching questions - the paired answer', max_length=500)),\n                ('question', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='options', to='core.teacherquestion')),\n            ],\n            options={\n                'ordering': ['order', 'id'],\n            },\n        ),\n        migrations.AddIndex(\n            model_name='teacherassessment',\n            index=models.Index(fields=['teacher', 'category'], name='core_teache_teacher_95cfdd_idx'),\n        ),\n        migrations.AddIndex(\n            model_name='teacherassessment',\n            index=models.Index(fields=['status'], name='core_teache_status_a7e033_idx'),\n        ),\n    ]\n","path":null,"size_bytes":4996,"size_tokens":null},"core/migrations/0021_add_content_share.py":{"content":"# Generated by Django 5.0.2 on 2025-11-28 21:59\n\nimport core.models\nimport django.db.models.deletion\nfrom django.conf import settings\nfrom django.db import migrations, models\n\n\nclass Migration(migrations.Migration):\n\n    dependencies = [\n        ('core', '0020_teacherassessment_teacherquestion_and_more'),\n        migrations.swappable_dependency(settings.AUTH_USER_MODEL),\n    ]\n\n    operations = [\n        migrations.CreateModel(\n            name='ContentShare',\n            fields=[\n                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),\n                ('token', models.CharField(default=core.models.generate_share_token, max_length=32, unique=True)),\n                ('created_at', models.DateTimeField(auto_now_add=True)),\n                ('expires_at', models.DateTimeField(blank=True, null=True)),\n                ('is_active', models.BooleanField(default=True)),\n                ('view_count', models.IntegerField(default=0)),\n                ('last_accessed', models.DateTimeField(blank=True, null=True)),\n                ('assessment', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.CASCADE, related_name='shares', to='core.teacherassessment')),\n                ('document', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.CASCADE, related_name='shares', to='core.uploadeddocument')),\n                ('teacher', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, to=settings.AUTH_USER_MODEL)),\n            ],\n            options={\n                'indexes': [models.Index(fields=['token'], name='core_conten_token_31bd91_idx')],\n            },\n        ),\n    ]\n","path":null,"size_bytes":1707,"size_tokens":null},"core/migrations/0022_add_content_share_constraint.py":{"content":"# Generated by Django 5.0.2 on 2025-11-28 22:02\n\nfrom django.conf import settings\nfrom django.db import migrations, models\n\n\nclass Migration(migrations.Migration):\n\n    dependencies = [\n        ('core', '0021_add_content_share'),\n        migrations.swappable_dependency(settings.AUTH_USER_MODEL),\n    ]\n\n    operations = [\n        migrations.AddConstraint(\n            model_name='contentshare',\n            constraint=models.CheckConstraint(check=models.Q(models.Q(('assessment__isnull', False), ('document__isnull', True)), models.Q(('assessment__isnull', True), ('document__isnull', False)), _connector='OR'), name='exactly_one_content_type'),\n        ),\n    ]\n","path":null,"size_bytes":664,"size_tokens":null},"core/migrations/0023_brilltech_admin_contact.py":{"content":"# Generated by Django 5.0.2 on 2025-11-29 21:07\n\nfrom django.db import migrations, models\n\n\nclass Migration(migrations.Migration):\n\n    dependencies = [\n        ('core', '0022_add_content_share_constraint'),\n    ]\n\n    operations = [\n        migrations.CreateModel(\n            name='BrillTechAdmin',\n            fields=[\n                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),\n                ('username', models.CharField(max_length=50, unique=True)),\n                ('password_hash', models.CharField(max_length=255)),\n                ('email', models.EmailField(blank=True, max_length=254)),\n                ('full_name', models.CharField(blank=True, max_length=100)),\n                ('is_active', models.BooleanField(default=True)),\n                ('created_at', models.DateTimeField(auto_now_add=True)),\n                ('last_login', models.DateTimeField(blank=True, null=True)),\n            ],\n            options={\n                'verbose_name': 'BrillTech Admin',\n                'verbose_name_plural': 'BrillTech Admins',\n            },\n        ),\n        migrations.CreateModel(\n            name='ContactSubmission',\n            fields=[\n                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),\n                ('name', models.CharField(max_length=100)),\n                ('email', models.EmailField(max_length=254)),\n                ('phone', models.CharField(blank=True, max_length=30)),\n                ('company', models.CharField(blank=True, max_length=100)),\n                ('subject', models.CharField(blank=True, max_length=200)),\n                ('message', models.TextField()),\n                ('status', models.CharField(choices=[('new', 'New'), ('read', 'Read'), ('replied', 'Replied'), ('archived', 'Archived')], default='new', max_length=20)),\n                ('is_read', models.BooleanField(default=False)),\n                ('created_at', models.DateTimeField(auto_now_add=True)),\n                ('read_at', models.DateTimeField(blank=True, null=True)),\n                ('replied_at', models.DateTimeField(blank=True, null=True)),\n                ('admin_notes', models.TextField(blank=True, help_text='Internal notes about this submission')),\n            ],\n            options={\n                'verbose_name': 'Contact Submission',\n                'verbose_name_plural': 'Contact Submissions',\n                'ordering': ['-created_at'],\n            },\n        ),\n    ]\n","path":null,"size_bytes":2529,"size_tokens":null},"core/management/commands/populate_dummy_data.py":{"content":"from django.core.management.base import BaseCommand\nfrom django.contrib.auth.models import User\nfrom core.models import (\n    ExamBoard, Subject, Grade, Topic, Subtopic, Concept,\n    Note, Flashcard, InteractiveQuestion, StudentQuiz,\n    UserProfile, StudentProfile, StudentExamBoard, StudentSubject,\n    SubscriptionPlan, UserSubscription\n)\nimport json\n\n\nclass Command(BaseCommand):\n    help = 'Populate database with dummy data for ZIMSEC Biology testing'\n\n    def handle(self, *args, **options):\n        self.stdout.write('Starting dummy data population...\\n')\n        \n        zimsec = self.create_exam_boards()\n        biology = self.create_subjects()\n        grades = self.create_grades()\n        topics = self.create_topics(biology)\n        self.create_subscription_plans()\n        admin_user = self.create_admin_user()\n        teacher_user = self.create_teacher_user(zimsec, biology, grades[0])\n        student_user = self.create_student_user(zimsec, biology, grades[0])\n        self.create_notes(biology, zimsec, grades[0], topics, admin_user)\n        self.create_flashcards(biology, zimsec, grades[0], topics, admin_user)\n        questions = self.create_questions(biology, zimsec, grades[0], topics, admin_user)\n        self.create_quizzes(biology, zimsec, grades[0], topics, questions, admin_user)\n        \n        self.stdout.write(self.style.SUCCESS('\\nDummy data population complete!'))\n        self.stdout.write(self.style.SUCCESS('\\nTest Accounts Created:'))\n        self.stdout.write(f'  Admin: admin / admin123 (can access all portals)')\n        self.stdout.write(f'  Teacher: test_teacher / teacher123')\n        self.stdout.write(f'  Student: test_student / student123')\n\n    def create_exam_boards(self):\n        self.stdout.write('Creating exam boards...')\n        boards_data = [\n            ('ZIMSEC', 'Zimbabwe School Examinations Council'),\n            ('Cambridge', 'Cambridge Assessment International Education'),\n            ('Edexcel', 'Edexcel International'),\n            ('AQA', 'Assessment and Qualifications Alliance'),\n            ('IEB', 'Independent Examinations Board'),\n        ]\n        zimsec = None\n        for abbr, name in boards_data:\n            board, created = ExamBoard.objects.get_or_create(\n                abbreviation=abbr,\n                defaults={'name_full': name}\n            )\n            if abbr == 'ZIMSEC':\n                zimsec = board\n            status = 'created' if created else 'exists'\n            self.stdout.write(f'  {abbr}: {status}')\n        return zimsec\n\n    def create_subjects(self):\n        self.stdout.write('Creating subjects...')\n        subjects_data = [\n            'Biology',\n            'Chemistry',\n            'Physics',\n            'Mathematics',\n            'English',\n            'Geography',\n            'History',\n            'Computer Science',\n        ]\n        biology = None\n        for name in subjects_data:\n            subject, created = Subject.objects.get_or_create(name=name)\n            if name == 'Biology':\n                biology = subject\n            status = 'created' if created else 'exists'\n            self.stdout.write(f'  {name}: {status}')\n        return biology\n\n    def create_grades(self):\n        self.stdout.write('Creating grades...')\n        grades = []\n        for num in range(8, 14):\n            grade, created = Grade.objects.get_or_create(number=num)\n            grades.append(grade)\n            status = 'created' if created else 'exists'\n            self.stdout.write(f'  Grade {num}: {status}')\n        return grades\n\n    def create_topics(self, biology):\n        self.stdout.write('Creating Biology topics and subtopics...')\n        topics_data = [\n            {\n                'name': 'Cell Biology',\n                'description': 'Study of cell structure and function',\n                'subtopics': ['Cell Structure', 'Cell Membranes', 'Cell Division', 'Transport in Cells']\n            },\n            {\n                'name': 'Human Biology',\n                'description': 'Study of the human body systems',\n                'subtopics': ['Digestive System', 'Circulatory System', 'Respiratory System', 'Nervous System']\n            },\n            {\n                'name': 'Plant Biology',\n                'description': 'Study of plant structure and processes',\n                'subtopics': ['Photosynthesis', 'Plant Transport', 'Plant Reproduction', 'Plant Hormones']\n            },\n            {\n                'name': 'Genetics',\n                'description': 'Study of heredity and variation',\n                'subtopics': ['DNA Structure', 'Inheritance', 'Genetic Variation', 'Evolution']\n            },\n            {\n                'name': 'Ecology',\n                'description': 'Study of organisms and their environment',\n                'subtopics': ['Food Chains', 'Ecosystems', 'Pollution', 'Conservation']\n            },\n        ]\n        \n        topics = []\n        for i, data in enumerate(topics_data):\n            topic, created = Topic.objects.get_or_create(\n                subject=biology,\n                name=data['name'],\n                defaults={\n                    'description': data['description'],\n                    'order': i + 1,\n                    'is_active': True\n                }\n            )\n            topics.append(topic)\n            status = 'created' if created else 'exists'\n            self.stdout.write(f'  Topic: {data[\"name\"]}: {status}')\n            \n            for j, subtopic_name in enumerate(data['subtopics']):\n                subtopic, created = Subtopic.objects.get_or_create(\n                    topic=topic,\n                    name=subtopic_name,\n                    defaults={'order': j + 1, 'is_active': True}\n                )\n                status = 'created' if created else 'exists'\n                self.stdout.write(f'    Subtopic: {subtopic_name}: {status}')\n        \n        return topics\n\n    def create_subscription_plans(self):\n        self.stdout.write('Creating subscription plans...')\n        \n        plans = [\n            {'name': 'Free', 'plan_type': 'free', 'price': 0, 'allowed_subjects_count': 1, 'monthly_ai_generations': 0, 'can_use_ai': False},\n            {'name': 'Starter', 'plan_type': 'starter', 'price': 50, 'allowed_subjects_count': 1, 'monthly_ai_generations': 10, 'can_use_ai': False},\n            {'name': 'Growth', 'plan_type': 'growth', 'price': 100, 'allowed_subjects_count': 2, 'monthly_ai_generations': 20, 'can_use_ai': True},\n            {'name': 'Premium', 'plan_type': 'premium', 'price': 250, 'allowed_subjects_count': 3, 'monthly_ai_generations': 999, 'can_use_ai': True},\n        ]\n        \n        for plan_data in plans:\n            plan, created = SubscriptionPlan.objects.get_or_create(\n                plan_type=plan_data['plan_type'],\n                defaults={\n                    'name': plan_data['name'],\n                    'price': plan_data['price'],\n                    'allowed_subjects_count': plan_data['allowed_subjects_count'],\n                    'monthly_ai_generations': plan_data['monthly_ai_generations'],\n                    'can_use_ai': plan_data['can_use_ai'],\n                    'can_upload_documents': True,\n                    'can_access_library': True,\n                    'is_active': True,\n                }\n            )\n            status = 'created' if created else 'exists'\n            self.stdout.write(f'  {plan_data[\"name\"]}: {status}')\n\n    def create_admin_user(self):\n        self.stdout.write('Creating admin user...')\n        user, created = User.objects.get_or_create(\n            username='admin',\n            defaults={\n                'email': 'admin@edutech.test',\n                'is_staff': True,\n                'is_superuser': True,\n            }\n        )\n        if created:\n            user.set_password('admin123')\n            user.save()\n        else:\n            user.is_staff = True\n            user.is_superuser = True\n            user.save()\n        \n        profile, _ = UserProfile.objects.get_or_create(\n            user=user,\n            defaults={\n                'role': 'admin',\n                'email_verified': True,\n            }\n        )\n        \n        grade = Grade.objects.first()\n        student_profile, _ = StudentProfile.objects.get_or_create(\n            user=user,\n            defaults={\n                'email_verified': True,\n                'onboarding_completed': True,\n                'subscription': 'pro',\n                'grade': grade,\n            }\n        )\n        \n        self.stdout.write(f'  Admin user: {\"created\" if created else \"exists\"}')\n        return user\n\n    def create_teacher_user(self, exam_board, subject, grade):\n        self.stdout.write('Creating test teacher...')\n        user, created = User.objects.get_or_create(\n            username='test_teacher',\n            defaults={\n                'email': 'teacher@edutech.test',\n                'first_name': 'Test',\n                'last_name': 'Teacher',\n            }\n        )\n        if created:\n            user.set_password('teacher123')\n            user.save()\n        \n        profile, _ = UserProfile.objects.get_or_create(\n            user=user,\n            defaults={\n                'role': 'teacher',\n                'email_verified': True,\n            }\n        )\n        \n        self.stdout.write(f'  Teacher user: {\"created\" if created else \"exists\"}')\n        return user\n\n    def create_student_user(self, exam_board, subject, grade):\n        self.stdout.write('Creating test student...')\n        user, created = User.objects.get_or_create(\n            username='test_student',\n            defaults={\n                'email': 'student@edutech.test',\n                'first_name': 'Test',\n                'last_name': 'Student',\n            }\n        )\n        if created:\n            user.set_password('student123')\n            user.save()\n        \n        student_profile, _ = StudentProfile.objects.get_or_create(\n            user=user,\n            defaults={\n                'grade': grade,\n                'email_verified': True,\n                'onboarding_completed': True,\n                'subscription': 'free',\n            }\n        )\n        \n        StudentExamBoard.objects.get_or_create(\n            student=student_profile,\n            exam_board=exam_board\n        )\n        \n        StudentSubject.objects.get_or_create(\n            student=student_profile,\n            subject=subject,\n            exam_board=exam_board\n        )\n        \n        self.stdout.write(f'  Student user: {\"created\" if created else \"exists\"}')\n        return user\n\n    def create_notes(self, subject, exam_board, grade, topics, user):\n        self.stdout.write('Creating notes...')\n        \n        notes_content = {\n            'Cell Biology': {\n                'title': 'Introduction to Cell Biology',\n                'full': 'Cells are the basic units of life. All living organisms are made up of cells. There are two main types: prokaryotic cells (bacteria) and eukaryotic cells (plants, animals, fungi). Key organelles include the nucleus, mitochondria, and cell membrane.',\n                'summary': 'Cells = basic life units. Types: prokaryotic (bacteria), eukaryotic (plants/animals). Key parts: nucleus, mitochondria, membrane.'\n            },\n            'Human Biology': {\n                'title': 'Human Body Systems Overview',\n                'full': 'The human body consists of multiple organ systems working together. The digestive system breaks down food, the circulatory system transports nutrients and oxygen, the respiratory system exchanges gases, and the nervous system coordinates all activities.',\n                'summary': 'Body systems: Digestive (food breakdown), Circulatory (transport), Respiratory (gas exchange), Nervous (coordination).'\n            },\n            'Plant Biology': {\n                'title': 'Photosynthesis and Plant Processes',\n                'full': 'Photosynthesis is the process by which plants convert light energy into chemical energy. The equation is: 6CO2 + 6H2O + light ‚Üí C6H12O6 + 6O2. This occurs in chloroplasts and requires chlorophyll.',\n                'summary': 'Photosynthesis: light ‚Üí chemical energy. 6CO2 + 6H2O + light ‚Üí glucose + O2. Occurs in chloroplasts.'\n            },\n            'Genetics': {\n                'title': 'DNA and Inheritance',\n                'full': 'DNA (Deoxyribonucleic Acid) is the molecule that carries genetic information. It has a double helix structure discovered by Watson and Crick. Genes are segments of DNA that code for proteins. Inheritance follows Mendelian laws.',\n                'summary': 'DNA: double helix, carries genetic info. Genes code for proteins. Follows Mendelian inheritance laws.'\n            },\n            'Ecology': {\n                'title': 'Ecosystems and Food Chains',\n                'full': 'An ecosystem includes all living organisms and their physical environment. Food chains show energy flow: producers ‚Üí primary consumers ‚Üí secondary consumers ‚Üí decomposers. Energy is lost at each trophic level.',\n                'summary': 'Ecosystem: organisms + environment. Food chain: producers ‚Üí consumers ‚Üí decomposers. Energy lost at each level.'\n            },\n        }\n        \n        for topic in topics:\n            if topic.name in notes_content:\n                content = notes_content[topic.name]\n                note, created = Note.objects.get_or_create(\n                    title=content['title'],\n                    subject=subject,\n                    defaults={\n                        'exam_board': exam_board,\n                        'grade': grade,\n                        'topic': topic,\n                        'topic_text': topic.name,\n                        'full_version_text': content['full'],\n                        'summary_version_text': content['summary'],\n                        'created_by': user,\n                    }\n                )\n                status = 'created' if created else 'exists'\n                self.stdout.write(f'  Note for {topic.name}: {status}')\n\n    def create_flashcards(self, subject, exam_board, grade, topics, user):\n        self.stdout.write('Creating flashcards...')\n        \n        flashcards_data = {\n            'Cell Biology': [\n                ('What is the powerhouse of the cell?', 'Mitochondria'),\n                ('What controls cell activities?', 'Nucleus'),\n                ('What is the function of ribosomes?', 'Protein synthesis'),\n                ('What is the cell membrane made of?', 'Phospholipid bilayer'),\n            ],\n            'Human Biology': [\n                ('What organ pumps blood?', 'Heart'),\n                ('Where does digestion mainly occur?', 'Small intestine'),\n                ('What carries oxygen in blood?', 'Red blood cells / Hemoglobin'),\n                ('What is the basic unit of the nervous system?', 'Neuron'),\n            ],\n            'Plant Biology': [\n                ('Where does photosynthesis occur?', 'Chloroplasts'),\n                ('What gas do plants absorb?', 'Carbon dioxide'),\n                ('What pigment is essential for photosynthesis?', 'Chlorophyll'),\n                ('What is the product of photosynthesis?', 'Glucose and oxygen'),\n            ],\n            'Genetics': [\n                ('What does DNA stand for?', 'Deoxyribonucleic Acid'),\n                ('What are the building blocks of DNA?', 'Nucleotides'),\n                ('How many chromosomes do humans have?', '46 (23 pairs)'),\n                ('What is a gene?', 'A segment of DNA that codes for a protein'),\n            ],\n            'Ecology': [\n                ('What is a producer?', 'An organism that makes its own food (autotroph)'),\n                ('What is biodiversity?', 'The variety of life in an ecosystem'),\n                ('What is the greenhouse effect?', 'Trapping of heat by atmospheric gases'),\n                ('What is a food web?', 'Interconnected food chains in an ecosystem'),\n            ],\n        }\n        \n        for topic in topics:\n            if topic.name in flashcards_data:\n                for front, back in flashcards_data[topic.name]:\n                    card, created = Flashcard.objects.get_or_create(\n                        front_text=front,\n                        subject=subject,\n                        defaults={\n                            'back_text': back,\n                            'exam_board': exam_board,\n                            'grade': grade,\n                            'topic': topic,\n                            'topic_text': topic.name,\n                            'created_by': user,\n                        }\n                    )\n                status = 'created' if created else 'exists'\n                self.stdout.write(f'  Flashcards for {topic.name}: {status}')\n\n    def create_questions(self, subject, exam_board, grade, topics, user):\n        self.stdout.write('Creating interactive questions...')\n        \n        questions_by_topic = {}\n        \n        mcq_questions = {\n            'Cell Biology': [\n                {\n                    'text': 'Which organelle is responsible for producing ATP?',\n                    'options': ['Nucleus', 'Mitochondria', 'Ribosome', 'Golgi apparatus'],\n                    'correct': 1,\n                    'explanation': 'Mitochondria are the powerhouse of the cell, producing ATP through cellular respiration.',\n                    'difficulty': 'easy'\n                },\n                {\n                    'text': 'What type of transport requires energy?',\n                    'options': ['Osmosis', 'Diffusion', 'Active transport', 'Facilitated diffusion'],\n                    'correct': 2,\n                    'explanation': 'Active transport moves molecules against their concentration gradient and requires ATP energy.',\n                    'difficulty': 'medium'\n                },\n                {\n                    'text': 'During which phase of mitosis do chromosomes align at the cell equator?',\n                    'options': ['Prophase', 'Metaphase', 'Anaphase', 'Telophase'],\n                    'correct': 1,\n                    'explanation': 'During metaphase, chromosomes line up at the metaphase plate (cell equator).',\n                    'difficulty': 'hard'\n                },\n            ],\n            'Human Biology': [\n                {\n                    'text': 'Which blood vessel carries blood away from the heart?',\n                    'options': ['Vein', 'Artery', 'Capillary', 'Lymph vessel'],\n                    'correct': 1,\n                    'explanation': 'Arteries carry oxygenated blood away from the heart to body tissues.',\n                    'difficulty': 'easy'\n                },\n                {\n                    'text': 'What enzyme begins protein digestion in the stomach?',\n                    'options': ['Amylase', 'Lipase', 'Pepsin', 'Trypsin'],\n                    'correct': 2,\n                    'explanation': 'Pepsin is the main enzyme in the stomach that breaks down proteins into peptides.',\n                    'difficulty': 'medium'\n                },\n            ],\n            'Genetics': [\n                {\n                    'text': 'If a parent has genotype Aa, what gametes can they produce?',\n                    'options': ['Only A', 'Only a', 'A and a', 'AA and aa'],\n                    'correct': 2,\n                    'explanation': 'Heterozygous (Aa) parents can produce gametes with either the A or a allele.',\n                    'difficulty': 'medium'\n                },\n            ],\n        }\n        \n        structured_questions = {\n            'Plant Biology': [\n                {\n                    'text': 'Explain the process of photosynthesis and describe the role of light and chlorophyll.',\n                    'model_answer': 'Photosynthesis is the process by which plants convert light energy into chemical energy stored in glucose. Light energy is absorbed by chlorophyll in the chloroplasts. The light reactions split water molecules, releasing oxygen and generating ATP and NADPH. These products are used in the Calvin cycle to fix carbon dioxide into glucose.',\n                    'marking_guide': '1 mark: Define photosynthesis. 1 mark: Role of light (energy source). 1 mark: Role of chlorophyll (absorbs light). 2 marks: Describe light reactions and Calvin cycle.',\n                    'max_marks': 5,\n                    'difficulty': 'hard'\n                },\n            ],\n            'Ecology': [\n                {\n                    'text': 'Describe how energy flows through a food chain and explain why only 10% of energy is transferred between trophic levels.',\n                    'model_answer': 'Energy flows from producers to primary consumers to secondary consumers. At each trophic level, organisms use energy for metabolism, movement, and heat production. Only about 10% of energy is passed to the next level because 90% is lost through respiration, excretion, and parts not eaten.',\n                    'marking_guide': '1 mark: Energy flow direction. 1 mark: Mention of trophic levels. 2 marks: Explain energy loss through respiration/metabolism. 1 mark: Explain 10% rule.',\n                    'max_marks': 5,\n                    'difficulty': 'medium'\n                },\n            ],\n        }\n        \n        for topic in topics:\n            questions_by_topic[topic.name] = []\n            \n            if topic.name in mcq_questions:\n                for q in mcq_questions[topic.name]:\n                    options_json = [{'text': opt, 'is_correct': i == q['correct']} for i, opt in enumerate(q['options'])]\n                    question, created = InteractiveQuestion.objects.get_or_create(\n                        question_text=q['text'],\n                        subject=subject,\n                        question_type='mcq',\n                        defaults={\n                            'exam_board': exam_board,\n                            'grade': grade,\n                            'topic': topic,\n                            'topic_text': topic.name,\n                            'difficulty': q['difficulty'],\n                            'options': options_json,\n                            'correct_answer': q['options'][q['correct']],\n                            'correct_option_index': q['correct'],\n                            'explanation': q['explanation'],\n                            'max_marks': 1,\n                            'created_by': user,\n                        }\n                    )\n                    questions_by_topic[topic.name].append(question)\n            \n            if topic.name in structured_questions:\n                for q in structured_questions[topic.name]:\n                    question, created = InteractiveQuestion.objects.get_or_create(\n                        question_text=q['text'],\n                        subject=subject,\n                        question_type='structured',\n                        defaults={\n                            'exam_board': exam_board,\n                            'grade': grade,\n                            'topic': topic,\n                            'topic_text': topic.name,\n                            'difficulty': q['difficulty'],\n                            'correct_answer': q['model_answer'],\n                            'model_answer': q['model_answer'],\n                            'marking_guide': q['marking_guide'],\n                            'max_marks': q['max_marks'],\n                            'created_by': user,\n                        }\n                    )\n                    questions_by_topic[topic.name].append(question)\n            \n            count = len(questions_by_topic[topic.name])\n            self.stdout.write(f'  Questions for {topic.name}: {count} total')\n        \n        return questions_by_topic\n\n    def create_quizzes(self, subject, exam_board, grade, topics, questions_by_topic, user):\n        self.stdout.write('Creating quizzes...')\n        \n        for topic in topics:\n            topic_questions = questions_by_topic.get(topic.name, [])\n            if not topic_questions:\n                continue\n            \n            for difficulty in ['easy', 'medium', 'hard']:\n                diff_questions = [q for q in topic_questions if q.difficulty == difficulty]\n                if not diff_questions:\n                    continue\n                \n                quiz, created = StudentQuiz.objects.get_or_create(\n                    title=f'{topic.name} - {difficulty.title()} Quiz',\n                    subject=subject,\n                    defaults={\n                        'exam_board': exam_board,\n                        'grade': grade,\n                        'topic': topic.name,\n                        'difficulty': difficulty,\n                        'length': min(len(diff_questions), 5),\n                        'is_pro_content': False,\n                        'created_by': user,\n                    }\n                )\n                if created:\n                    quiz.questions.set(diff_questions)\n                    quiz.save()\n                \n                status = 'created' if created else 'exists'\n                self.stdout.write(f'  Quiz: {topic.name} {difficulty}: {status}')\n","path":null,"size_bytes":25300,"size_tokens":null},"core/migrations/0024_video_lesson_system.py":{"content":"# Generated by Django 5.0.2 on 2025-12-06 18:01\n\nimport django.db.models.deletion\nfrom django.conf import settings\nfrom django.db import migrations, models\n\n\nclass Migration(migrations.Migration):\n\n    dependencies = [\n        ('core', '0023_brilltech_admin_contact'),\n        migrations.swappable_dependency(settings.AUTH_USER_MODEL),\n    ]\n\n    operations = [\n        migrations.CreateModel(\n            name='Subtopic',\n            fields=[\n                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),\n                ('name', models.CharField(max_length=200)),\n                ('description', models.TextField(blank=True)),\n                ('order', models.IntegerField(default=0, help_text='Display order within topic')),\n                ('is_active', models.BooleanField(default=True)),\n                ('created_at', models.DateTimeField(auto_now_add=True)),\n                ('updated_at', models.DateTimeField(auto_now=True)),\n            ],\n            options={\n                'ordering': ['topic', 'order', 'name'],\n            },\n        ),\n        migrations.CreateModel(\n            name='Concept',\n            fields=[\n                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),\n                ('name', models.CharField(max_length=200)),\n                ('description', models.TextField(blank=True)),\n                ('order', models.IntegerField(default=0, help_text='Display order within subtopic')),\n                ('is_active', models.BooleanField(default=True)),\n                ('created_at', models.DateTimeField(auto_now_add=True)),\n                ('updated_at', models.DateTimeField(auto_now=True)),\n                ('subtopic', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='concepts', to='core.subtopic')),\n            ],\n            options={\n                'ordering': ['subtopic', 'order', 'name'],\n                'unique_together': {('subtopic', 'name')},\n            },\n        ),\n        migrations.CreateModel(\n            name='Topic',\n            fields=[\n                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),\n                ('name', models.CharField(max_length=200)),\n                ('description', models.TextField(blank=True)),\n                ('order', models.IntegerField(default=0, help_text='Display order within subject')),\n                ('is_active', models.BooleanField(default=True)),\n                ('created_at', models.DateTimeField(auto_now_add=True)),\n                ('updated_at', models.DateTimeField(auto_now=True)),\n                ('subject', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='topics', to='core.subject')),\n            ],\n            options={\n                'ordering': ['subject', 'order', 'name'],\n                'unique_together': {('subject', 'name')},\n            },\n        ),\n        migrations.AddField(\n            model_name='subtopic',\n            name='topic',\n            field=models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='subtopics', to='core.topic'),\n        ),\n        migrations.CreateModel(\n            name='VideoLesson',\n            fields=[\n                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),\n                ('title', models.CharField(max_length=300)),\n                ('description', models.TextField(blank=True)),\n                ('youtube_url', models.URLField(help_text='YouTube video URL', max_length=500)),\n                ('duration_minutes', models.IntegerField(default=0, help_text='Video duration in minutes')),\n                ('thumbnail_url', models.URLField(blank=True, help_text='Custom thumbnail URL (auto-generated from YouTube if empty)', max_length=500)),\n                ('tags', models.CharField(blank=True, help_text='Comma-separated tags', max_length=500)),\n                ('order', models.IntegerField(default=0, help_text='Display order')),\n                ('is_active', models.BooleanField(default=True)),\n                ('is_featured', models.BooleanField(default=False)),\n                ('view_count', models.IntegerField(default=0)),\n                ('created_at', models.DateTimeField(auto_now_add=True)),\n                ('updated_at', models.DateTimeField(auto_now=True)),\n                ('concept', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.CASCADE, related_name='video_lessons', to='core.concept')),\n                ('created_by', models.ForeignKey(null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='created_videos', to=settings.AUTH_USER_MODEL)),\n                ('subject', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='video_lessons', to='core.subject')),\n                ('subtopic', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.CASCADE, related_name='video_lessons', to='core.subtopic')),\n                ('topic', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.CASCADE, related_name='video_lessons', to='core.topic')),\n            ],\n            options={\n                'ordering': ['subject', 'topic', 'subtopic', 'concept', 'order', '-created_at'],\n            },\n        ),\n        migrations.AlterUniqueTogether(\n            name='subtopic',\n            unique_together={('topic', 'name')},\n        ),\n        migrations.CreateModel(\n            name='StudentVideoProgress',\n            fields=[\n                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),\n                ('watched_seconds', models.IntegerField(default=0)),\n                ('is_completed', models.BooleanField(default=False)),\n                ('last_watched_at', models.DateTimeField(auto_now=True)),\n                ('student', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='video_progress', to='core.studentprofile')),\n                ('video', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='student_progress', to='core.videolesson')),\n            ],\n            options={\n                'unique_together': {('student', 'video')},\n            },\n        ),\n        migrations.CreateModel(\n            name='StudentVideoBookmark',\n            fields=[\n                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),\n                ('created_at', models.DateTimeField(auto_now_add=True)),\n                ('student', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='video_bookmarks', to='core.studentprofile')),\n                ('video', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='bookmarks', to='core.videolesson')),\n            ],\n            options={\n                'ordering': ['-created_at'],\n                'unique_together': {('student', 'video')},\n            },\n        ),\n    ]\n","path":null,"size_bytes":7136,"size_tokens":null},"core/migrations/0025_flashcard_topic_text_and_more.py":{"content":"# Generated by Django 5.0.2 on 2025-12-06 19:06\n\nimport django.db.models.deletion\nfrom django.conf import settings\nfrom django.db import migrations, models\n\n\nclass Migration(migrations.Migration):\n\n    dependencies = [\n        ('core', '0024_video_lesson_system'),\n        migrations.swappable_dependency(settings.AUTH_USER_MODEL),\n    ]\n\n    operations = [\n        migrations.AddField(\n            model_name='flashcard',\n            name='topic_text',\n            field=models.CharField(blank=True, help_text='Legacy topic text field', max_length=200),\n        ),\n        migrations.AddField(\n            model_name='interactivequestion',\n            name='correct_option_index',\n            field=models.IntegerField(blank=True, help_text='0-based index of correct MCQ option', null=True),\n        ),\n        migrations.AddField(\n            model_name='interactivequestion',\n            name='marking_guide',\n            field=models.TextField(blank=True, help_text='Marking criteria for AI grading'),\n        ),\n        migrations.AddField(\n            model_name='interactivequestion',\n            name='max_marks',\n            field=models.IntegerField(default=1, help_text='Maximum marks for this question'),\n        ),\n        migrations.AddField(\n            model_name='interactivequestion',\n            name='model_answer',\n            field=models.TextField(blank=True, help_text='Model answer for structured/essay questions'),\n        ),\n        migrations.AddField(\n            model_name='interactivequestion',\n            name='topic_text',\n            field=models.CharField(blank=True, help_text='Legacy topic text field', max_length=200),\n        ),\n        migrations.AddField(\n            model_name='note',\n            name='topic_text',\n            field=models.CharField(blank=True, help_text='Legacy topic text field', max_length=200),\n        ),\n        migrations.AlterField(\n            model_name='flashcard',\n            name='topic',\n            field=models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='flashcards', to='core.topic'),\n        ),\n        migrations.AlterField(\n            model_name='interactivequestion',\n            name='options',\n            field=models.JSONField(blank=True, help_text='[{\"text\": \"Option A\", \"is_correct\": true}, ...]', null=True),\n        ),\n        migrations.AlterField(\n            model_name='interactivequestion',\n            name='question_type',\n            field=models.CharField(choices=[('mcq', 'Multiple Choice'), ('true_false', 'True/False'), ('fill_blank', 'Fill in the Blank'), ('matching', 'Matching'), ('structured', 'Structured Question'), ('essay', 'Essay/Free Response')], max_length=20),\n        ),\n        migrations.AlterField(\n            model_name='interactivequestion',\n            name='topic',\n            field=models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='questions', to='core.topic'),\n        ),\n        migrations.AlterField(\n            model_name='note',\n            name='topic',\n            field=models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='notes', to='core.topic'),\n        ),\n        migrations.CreateModel(\n            name='Syllabus',\n            fields=[\n                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),\n                ('title', models.CharField(max_length=300)),\n                ('description', models.TextField(blank=True)),\n                ('year', models.IntegerField(blank=True, help_text='Syllabus year/version', null=True)),\n                ('file', models.FileField(blank=True, null=True, upload_to='syllabi/%Y/%m/')),\n                ('external_url', models.URLField(blank=True, help_text='Link to external syllabus', max_length=500)),\n                ('is_active', models.BooleanField(default=True)),\n                ('created_at', models.DateTimeField(auto_now_add=True)),\n                ('updated_at', models.DateTimeField(auto_now=True)),\n                ('created_by', models.ForeignKey(null=True, on_delete=django.db.models.deletion.SET_NULL, to=settings.AUTH_USER_MODEL)),\n                ('exam_board', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, to='core.examboard')),\n                ('grade', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.CASCADE, to='core.grade')),\n                ('subject', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, to='core.subject')),\n            ],\n            options={\n                'verbose_name_plural': 'Syllabi',\n                'ordering': ['exam_board', 'subject', '-year'],\n            },\n        ),\n        migrations.CreateModel(\n            name='StudentTopicProgress',\n            fields=[\n                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),\n                ('notes_read_count', models.IntegerField(default=0)),\n                ('notes_completed', models.BooleanField(default=False)),\n                ('videos_watched_count', models.IntegerField(default=0)),\n                ('videos_total', models.IntegerField(default=0)),\n                ('flashcards_reviewed_count', models.IntegerField(default=0)),\n                ('flashcards_mastered_count', models.IntegerField(default=0)),\n                ('quizzes_easy_completed', models.IntegerField(default=0)),\n                ('quizzes_easy_passed', models.IntegerField(default=0)),\n                ('quizzes_medium_completed', models.IntegerField(default=0)),\n                ('quizzes_medium_passed', models.IntegerField(default=0)),\n                ('quizzes_hard_completed', models.IntegerField(default=0)),\n                ('quizzes_hard_passed', models.IntegerField(default=0)),\n                ('average_quiz_score', models.DecimalField(decimal_places=2, default=0, max_digits=5)),\n                ('total_time_spent_minutes', models.IntegerField(default=0)),\n                ('last_activity', models.DateTimeField(auto_now=True)),\n                ('student', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='topic_progress', to='core.studentprofile')),\n                ('subject', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, to='core.subject')),\n                ('topic', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, to='core.topic')),\n            ],\n            options={\n                'ordering': ['-last_activity'],\n                'unique_together': {('student', 'subject', 'topic')},\n            },\n        ),\n    ]\n","path":null,"size_bytes":6686,"size_tokens":null},"core/admin_signup_urls.py":{"content":"from django.urls import path\nfrom . import admin_signup_views\n\nurlpatterns = [\n    path('', admin_signup_views.admin_signup, name='admin_signup'),\n]\n","path":null,"size_bytes":149,"size_tokens":null},"core/admin_signup_views.py":{"content":"from django.shortcuts import render, redirect\nfrom django.contrib.auth import get_user_model\nfrom django.contrib import messages\n\nUser = get_user_model()\n\ndef admin_signup(request):\n    if request.method == 'POST':\n        username = request.POST.get('username', '').strip()\n        email = request.POST.get('email', '').strip()\n        password = request.POST.get('password', '')\n        password2 = request.POST.get('password2', '')\n        \n        errors = []\n        \n        if not username:\n            errors.append('Username is required')\n        if not email:\n            errors.append('Email is required')\n        if not password:\n            errors.append('Password is required')\n        if password != password2:\n            errors.append('Passwords do not match')\n        if len(password) < 8:\n            errors.append('Password must be at least 8 characters')\n        \n        if User.objects.filter(username=username).exists():\n            errors.append('Username already exists')\n        if User.objects.filter(email=email).exists():\n            errors.append('Email already exists')\n        \n        if errors:\n            return render(request, 'core/admin_signup.html', {'errors': errors})\n        \n        try:\n            user = User.objects.create_superuser(username, email, password)\n            messages.success(request, f'Admin account \"{username}\" created successfully! Please log in.')\n            return redirect('/brilltech/admin/login/')\n        except Exception as e:\n            return render(request, 'core/admin_signup.html', {'errors': [str(e)]})\n    \n    return render(request, 'core/admin_signup.html')\n","path":null,"size_bytes":1642,"size_tokens":null},"core/migrations/0026_studentsubscriptionpricing_studentsubscription_and_more.py":{"content":"# Generated by Django 5.0.2 on 2025-12-06 22:13\n\nimport django.db.models.deletion\nfrom django.conf import settings\nfrom django.db import migrations, models\n\n\nclass Migration(migrations.Migration):\n\n    dependencies = [\n        ('core', '0025_flashcard_topic_text_and_more'),\n        migrations.swappable_dependency(settings.AUTH_USER_MODEL),\n    ]\n\n    operations = [\n        migrations.CreateModel(\n            name='StudentSubscriptionPricing',\n            fields=[\n                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),\n                ('per_subject_price', models.DecimalField(decimal_places=2, default=100.0, help_text='Price per subject (R100 default)', max_digits=10)),\n                ('multi_subject_price', models.DecimalField(decimal_places=2, default=200.0, help_text='Price for 4-5 subjects (R200 default)', max_digits=10)),\n                ('all_access_price', models.DecimalField(decimal_places=2, default=300.0, help_text='Price for all subjects (R300 default)', max_digits=10)),\n                ('tutor_addon_price', models.DecimalField(decimal_places=2, default=500.0, help_text='Tutor email support add-on (R500 default)', max_digits=10)),\n                ('per_subject_max', models.IntegerField(default=3, help_text='Max subjects for per-subject pricing')),\n                ('multi_subject_min', models.IntegerField(default=4, help_text='Min subjects for multi-subject tier')),\n                ('multi_subject_max', models.IntegerField(default=5, help_text='Max subjects for multi-subject tier')),\n                ('is_active', models.BooleanField(default=True)),\n                ('updated_at', models.DateTimeField(auto_now=True)),\n            ],\n            options={\n                'verbose_name': 'Student Subscription Pricing',\n                'verbose_name_plural': 'Student Subscription Pricing',\n            },\n        ),\n        migrations.CreateModel(\n            name='StudentSubscription',\n            fields=[\n                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),\n                ('plan', models.CharField(choices=[('free', 'Free'), ('per_subject', 'Per Subject (1-3)'), ('multi_subject', 'Multi Subject (4-5)'), ('all_access', 'All Access')], default='free', max_length=20)),\n                ('status', models.CharField(choices=[('free', 'Free'), ('active', 'Active'), ('expired', 'Expired'), ('cancelled', 'Cancelled')], default='free', max_length=20)),\n                ('has_tutor_support', models.BooleanField(default=False)),\n                ('subjects_count', models.IntegerField(default=0)),\n                ('amount_paid', models.DecimalField(decimal_places=2, default=0, max_digits=10)),\n                ('started_at', models.DateTimeField(blank=True, null=True)),\n                ('expires_at', models.DateTimeField(blank=True, null=True)),\n                ('created_at', models.DateTimeField(auto_now_add=True)),\n                ('updated_at', models.DateTimeField(auto_now=True)),\n                ('student', models.OneToOneField(on_delete=django.db.models.deletion.CASCADE, related_name='subscription_record', to='core.studentprofile')),\n            ],\n        ),\n        migrations.CreateModel(\n            name='SupportEnquiry',\n            fields=[\n                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),\n                ('enquiry_type', models.CharField(choices=[('tutor', 'Tutor Help'), ('system', 'System Support'), ('billing', 'Billing Query'), ('content', 'Content Issue')], default='system', max_length=20)),\n                ('subject', models.CharField(max_length=200)),\n                ('message', models.TextField()),\n                ('priority', models.CharField(choices=[('low', 'Low'), ('medium', 'Medium'), ('high', 'High')], default='medium', max_length=10)),\n                ('status', models.CharField(choices=[('open', 'Open'), ('in_progress', 'In Progress'), ('resolved', 'Resolved'), ('closed', 'Closed')], default='open', max_length=20)),\n                ('related_topic', models.CharField(blank=True, max_length=200)),\n                ('response', models.TextField(blank=True)),\n                ('responded_at', models.DateTimeField(blank=True, null=True)),\n                ('created_at', models.DateTimeField(auto_now_add=True)),\n                ('updated_at', models.DateTimeField(auto_now=True)),\n                ('related_subject', models.ForeignKey(blank=True, help_text='Related academic subject if applicable', null=True, on_delete=django.db.models.deletion.SET_NULL, to='core.subject')),\n                ('responded_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='support_responses', to=settings.AUTH_USER_MODEL)),\n                ('student', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='support_enquiries', to='core.studentprofile')),\n            ],\n            options={\n                'verbose_name_plural': 'Support Enquiries',\n                'ordering': ['-created_at'],\n            },\n        ),\n    ]\n","path":null,"size_bytes":5168,"size_tokens":null},"core/migrations/0027_crmmailinglist_crmlead_crmactivity_crmemailcampaign_and_more.py":{"content":"# Generated by Django 5.0.2 on 2025-12-06 23:45\n\nimport django.db.models.deletion\nfrom django.conf import settings\nfrom django.db import migrations, models\n\n\nclass Migration(migrations.Migration):\n\n    dependencies = [\n        ('core', '0026_studentsubscriptionpricing_studentsubscription_and_more'),\n        migrations.swappable_dependency(settings.AUTH_USER_MODEL),\n    ]\n\n    operations = [\n        migrations.CreateModel(\n            name='CRMMailingList',\n            fields=[\n                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),\n                ('name', models.CharField(max_length=100)),\n                ('description', models.TextField(blank=True)),\n                ('created_at', models.DateTimeField(auto_now_add=True)),\n            ],\n            options={\n                'verbose_name': 'Mailing List',\n                'verbose_name_plural': 'Mailing Lists',\n            },\n        ),\n        migrations.CreateModel(\n            name='CRMLead',\n            fields=[\n                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),\n                ('first_name', models.CharField(max_length=100)),\n                ('last_name', models.CharField(max_length=100)),\n                ('email', models.EmailField(max_length=254)),\n                ('phone', models.CharField(blank=True, max_length=20)),\n                ('company', models.CharField(blank=True, help_text='School or organization name', max_length=200)),\n                ('job_title', models.CharField(blank=True, max_length=100)),\n                ('lead_type', models.CharField(choices=[('school', 'School'), ('teacher', 'Individual Teacher'), ('district', 'School District'), ('publisher', 'Publisher'), ('other', 'Other')], default='school', max_length=20)),\n                ('source', models.CharField(choices=[('website', 'Website'), ('referral', 'Referral'), ('social', 'Social Media'), ('email', 'Email Campaign'), ('event', 'Event/Conference'), ('cold_call', 'Cold Call'), ('partner', 'Partner'), ('other', 'Other')], default='website', max_length=20)),\n                ('pipeline_stage', models.CharField(choices=[('new', 'New Lead'), ('contacted', 'Contacted'), ('demo', 'Demo Scheduled'), ('trial', 'Trial'), ('proposal', 'Proposal Sent'), ('won', 'Won'), ('lost', 'Lost')], default='new', max_length=20)),\n                ('notes', models.TextField(blank=True)),\n                ('estimated_value', models.DecimalField(blank=True, decimal_places=2, max_digits=10, null=True)),\n                ('created_at', models.DateTimeField(auto_now_add=True)),\n                ('updated_at', models.DateTimeField(auto_now=True)),\n                ('assigned_to', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='assigned_leads', to=settings.AUTH_USER_MODEL)),\n                ('created_by', models.ForeignKey(null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='created_leads', to=settings.AUTH_USER_MODEL)),\n            ],\n            options={\n                'verbose_name': 'CRM Lead',\n                'verbose_name_plural': 'CRM Leads',\n                'ordering': ['-created_at'],\n            },\n        ),\n        migrations.CreateModel(\n            name='CRMActivity',\n            fields=[\n                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),\n                ('activity_type', models.CharField(choices=[('call', 'Phone Call'), ('email', 'Email'), ('meeting', 'Meeting'), ('demo', 'Demo'), ('note', 'Note'), ('task', 'Task Completed'), ('stage_change', 'Stage Change')], default='note', max_length=20)),\n                ('title', models.CharField(max_length=200)),\n                ('description', models.TextField(blank=True)),\n                ('created_at', models.DateTimeField(auto_now_add=True)),\n                ('created_by', models.ForeignKey(null=True, on_delete=django.db.models.deletion.SET_NULL, to=settings.AUTH_USER_MODEL)),\n                ('lead', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='activities', to='core.crmlead')),\n            ],\n            options={\n                'verbose_name': 'CRM Activity',\n                'verbose_name_plural': 'CRM Activities',\n                'ordering': ['-created_at'],\n            },\n        ),\n        migrations.CreateModel(\n            name='CRMEmailCampaign',\n            fields=[\n                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),\n                ('name', models.CharField(max_length=200)),\n                ('subject', models.CharField(max_length=200)),\n                ('body', models.TextField()),\n                ('status', models.CharField(choices=[('draft', 'Draft'), ('scheduled', 'Scheduled'), ('sending', 'Sending'), ('sent', 'Sent'), ('failed', 'Failed')], default='draft', max_length=20)),\n                ('scheduled_at', models.DateTimeField(blank=True, null=True)),\n                ('sent_at', models.DateTimeField(blank=True, null=True)),\n                ('recipient_count', models.IntegerField(default=0)),\n                ('sent_count', models.IntegerField(default=0)),\n                ('failed_count', models.IntegerField(default=0)),\n                ('created_at', models.DateTimeField(auto_now_add=True)),\n                ('updated_at', models.DateTimeField(auto_now=True)),\n                ('created_by', models.ForeignKey(null=True, on_delete=django.db.models.deletion.SET_NULL, to=settings.AUTH_USER_MODEL)),\n                ('mailing_list', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, to='core.crmmailinglist')),\n            ],\n            options={\n                'verbose_name': 'Email Campaign',\n                'verbose_name_plural': 'Email Campaigns',\n                'ordering': ['-created_at'],\n            },\n        ),\n        migrations.CreateModel(\n            name='CRMTask',\n            fields=[\n                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),\n                ('title', models.CharField(max_length=200)),\n                ('description', models.TextField(blank=True)),\n                ('priority', models.CharField(choices=[('low', 'Low'), ('medium', 'Medium'), ('high', 'High'), ('urgent', 'Urgent')], default='medium', max_length=10)),\n                ('status', models.CharField(choices=[('pending', 'Pending'), ('in_progress', 'In Progress'), ('completed', 'Completed'), ('cancelled', 'Cancelled')], default='pending', max_length=20)),\n                ('due_date', models.DateField(blank=True, null=True)),\n                ('created_at', models.DateTimeField(auto_now_add=True)),\n                ('updated_at', models.DateTimeField(auto_now=True)),\n                ('assigned_to', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='crm_tasks', to=settings.AUTH_USER_MODEL)),\n                ('created_by', models.ForeignKey(null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='created_crm_tasks', to=settings.AUTH_USER_MODEL)),\n                ('related_lead', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='tasks', to='core.crmlead')),\n            ],\n            options={\n                'verbose_name': 'CRM Task',\n                'verbose_name_plural': 'CRM Tasks',\n                'ordering': ['-created_at'],\n            },\n        ),\n        migrations.CreateModel(\n            name='CRMMailingSubscriber',\n            fields=[\n                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),\n                ('email', models.EmailField(max_length=254)),\n                ('first_name', models.CharField(blank=True, max_length=100)),\n                ('last_name', models.CharField(blank=True, max_length=100)),\n                ('is_active', models.BooleanField(default=True)),\n                ('subscribed_at', models.DateTimeField(auto_now_add=True)),\n                ('unsubscribed_at', models.DateTimeField(blank=True, null=True)),\n                ('lead', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, to='core.crmlead')),\n                ('mailing_list', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='subscribers', to='core.crmmailinglist')),\n            ],\n            options={\n                'verbose_name': 'Mailing Subscriber',\n                'verbose_name_plural': 'Mailing Subscribers',\n                'unique_together': {('mailing_list', 'email')},\n            },\n        ),\n    ]\n","path":null,"size_bytes":8773,"size_tokens":null},"static/css/tailwind.css":{"content":"@tailwind base;\n@tailwind components;\n@tailwind utilities;\n\n@layer components {\n    .gradient-bg {\n        @apply bg-gradient-to-r from-purple-600 to-indigo-600;\n    }\n    \n    .card-shadow {\n        box-shadow: 0 4px 20px rgba(0,0,0,0.08);\n    }\n    \n    .card-shadow-hover:hover {\n        box-shadow: 0 8px 30px rgba(0,0,0,0.12);\n        transform: translateY(-2px);\n    }\n    \n    .glass-effect {\n        @apply bg-white/80 backdrop-blur-sm;\n    }\n    \n    .btn-primary {\n        @apply px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors duration-200;\n    }\n    \n    .btn-secondary {\n        @apply px-4 py-2 bg-gray-200 text-gray-800 rounded-lg hover:bg-gray-300 transition-colors duration-200;\n    }\n    \n    .input-field {\n        @apply w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent transition-all duration-200;\n    }\n}\n\n@layer utilities {\n    .animation-delay-200 {\n        animation-delay: 200ms;\n    }\n    \n    .animation-delay-400 {\n        animation-delay: 400ms;\n    }\n}\n","path":null,"size_bytes":1082,"size_tokens":null},"tailwind.config.js":{"content":"module.exports = {\n  content: [\n    './core/templates/**/*.html',\n    './static/js/**/*.js',\n  ],\n  theme: {\n    extend: {\n      colors: {\n        primary: {\n          50: '#f0f9ff',\n          100: '#e0f2fe',\n          200: '#bae6fd',\n          300: '#7dd3fc',\n          400: '#38bdf8',\n          500: '#0ea5e9',\n          600: '#0284c7',\n          700: '#0369a1',\n          800: '#075985',\n          900: '#0c4a6e',\n        }\n      },\n      fontFamily: {\n        sans: ['Inter', 'system-ui', '-apple-system', 'sans-serif'],\n      },\n      animation: {\n        'fade-in': 'fadeIn 0.3s ease-in-out',\n        'slide-up': 'slideUp 0.3s ease-out',\n        'pulse-slow': 'pulse 3s cubic-bezier(0.4, 0, 0.6, 1) infinite',\n      },\n      keyframes: {\n        fadeIn: {\n          '0%': { opacity: '0' },\n          '100%': { opacity: '1' },\n        },\n        slideUp: {\n          '0%': { opacity: '0', transform: 'translateY(10px)' },\n          '100%': { opacity: '1', transform: 'translateY(0)' },\n        },\n      },\n    },\n  },\n  plugins: [],\n}\n","path":null,"size_bytes":1040,"size_tokens":null},"static/css/styles.min.css":{"content":"*,:after,:before{--tw-border-spacing-x:0;--tw-border-spacing-y:0;--tw-translate-x:0;--tw-translate-y:0;--tw-rotate:0;--tw-skew-x:0;--tw-skew-y:0;--tw-scale-x:1;--tw-scale-y:1;--tw-pan-x: ;--tw-pan-y: ;--tw-pinch-zoom: ;--tw-scroll-snap-strictness:proximity;--tw-gradient-from-position: ;--tw-gradient-via-position: ;--tw-gradient-to-position: ;--tw-ordinal: ;--tw-slashed-zero: ;--tw-numeric-figure: ;--tw-numeric-spacing: ;--tw-numeric-fraction: ;--tw-ring-inset: ;--tw-ring-offset-width:0px;--tw-ring-offset-color:#fff;--tw-ring-color:rgba(59,130,246,.5);--tw-ring-offset-shadow:0 0 #0000;--tw-ring-shadow:0 0 #0000;--tw-shadow:0 0 #0000;--tw-shadow-colored:0 0 #0000;--tw-blur: ;--tw-brightness: ;--tw-contrast: ;--tw-grayscale: ;--tw-hue-rotate: ;--tw-invert: ;--tw-saturate: ;--tw-sepia: ;--tw-drop-shadow: ;--tw-backdrop-blur: ;--tw-backdrop-brightness: ;--tw-backdrop-contrast: ;--tw-backdrop-grayscale: ;--tw-backdrop-hue-rotate: ;--tw-backdrop-invert: ;--tw-backdrop-opacity: ;--tw-backdrop-saturate: ;--tw-backdrop-sepia: ;--tw-contain-size: ;--tw-contain-layout: ;--tw-contain-paint: ;--tw-contain-style: }::backdrop{--tw-border-spacing-x:0;--tw-border-spacing-y:0;--tw-translate-x:0;--tw-translate-y:0;--tw-rotate:0;--tw-skew-x:0;--tw-skew-y:0;--tw-scale-x:1;--tw-scale-y:1;--tw-pan-x: ;--tw-pan-y: ;--tw-pinch-zoom: ;--tw-scroll-snap-strictness:proximity;--tw-gradient-from-position: ;--tw-gradient-via-position: ;--tw-gradient-to-position: ;--tw-ordinal: ;--tw-slashed-zero: ;--tw-numeric-figure: ;--tw-numeric-spacing: ;--tw-numeric-fraction: ;--tw-ring-inset: ;--tw-ring-offset-width:0px;--tw-ring-offset-color:#fff;--tw-ring-color:rgba(59,130,246,.5);--tw-ring-offset-shadow:0 0 #0000;--tw-ring-shadow:0 0 #0000;--tw-shadow:0 0 #0000;--tw-shadow-colored:0 0 #0000;--tw-blur: ;--tw-brightness: ;--tw-contrast: ;--tw-grayscale: ;--tw-hue-rotate: ;--tw-invert: ;--tw-saturate: ;--tw-sepia: ;--tw-drop-shadow: ;--tw-backdrop-blur: ;--tw-backdrop-brightness: ;--tw-backdrop-contrast: ;--tw-backdrop-grayscale: ;--tw-backdrop-hue-rotate: ;--tw-backdrop-invert: ;--tw-backdrop-opacity: ;--tw-backdrop-saturate: ;--tw-backdrop-sepia: ;--tw-contain-size: ;--tw-contain-layout: ;--tw-contain-paint: ;--tw-contain-style: }/*! tailwindcss v3.4.18 | MIT License | https://tailwindcss.com*/*,:after,:before{box-sizing:border-box;border:0 solid #e5e7eb}:after,:before{--tw-content:\"\"}:host,html{line-height:1.5;-webkit-text-size-adjust:100%;-moz-tab-size:4;-o-tab-size:4;tab-size:4;font-family:Inter,system-ui,-apple-system,sans-serif;font-feature-settings:normal;font-variation-settings:normal;-webkit-tap-highlight-color:transparent}body{margin:0;line-height:inherit}hr{height:0;color:inherit;border-top-width:1px}abbr:where([title]){-webkit-text-decoration:underline dotted;text-decoration:underline dotted}h1,h2,h3,h4,h5,h6{font-size:inherit;font-weight:inherit}a{color:inherit;text-decoration:inherit}b,strong{font-weight:bolder}code,kbd,pre,samp{font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,Liberation Mono,Courier New,monospace;font-feature-settings:normal;font-variation-settings:normal;font-size:1em}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}table{text-indent:0;border-color:inherit;border-collapse:collapse}button,input,optgroup,select,textarea{font-family:inherit;font-feature-settings:inherit;font-variation-settings:inherit;font-size:100%;font-weight:inherit;line-height:inherit;letter-spacing:inherit;color:inherit;margin:0;padding:0}button,select{text-transform:none}button,input:where([type=button]),input:where([type=reset]),input:where([type=submit]){-webkit-appearance:button;background-color:transparent;background-image:none}:-moz-focusring{outline:auto}:-moz-ui-invalid{box-shadow:none}progress{vertical-align:baseline}::-webkit-inner-spin-button,::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}::-webkit-search-decoration{-webkit-appearance:none}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}summary{display:list-item}blockquote,dd,dl,figure,h1,h2,h3,h4,h5,h6,hr,p,pre{margin:0}fieldset{margin:0}fieldset,legend{padding:0}menu,ol,ul{list-style:none;margin:0;padding:0}dialog{padding:0}textarea{resize:vertical}input::-moz-placeholder,textarea::-moz-placeholder{opacity:1;color:#9ca3af}input::placeholder,textarea::placeholder{opacity:1;color:#9ca3af}[role=button],button{cursor:pointer}:disabled{cursor:default}audio,canvas,embed,iframe,img,object,svg,video{display:block;vertical-align:middle}img,video{max-width:100%;height:auto}[hidden]:where(:not([hidden=until-found])){display:none}.container{width:100%}@media (min-width:640px){.container{max-width:640px}}@media (min-width:768px){.container{max-width:768px}}@media (min-width:1024px){.container{max-width:1024px}}@media (min-width:1280px){.container{max-width:1280px}}@media (min-width:1536px){.container{max-width:1536px}}.gradient-bg{background-image:linear-gradient(to right,var(--tw-gradient-stops));--tw-gradient-from:#9333ea var(--tw-gradient-from-position);--tw-gradient-to:rgba(147,51,234,0) var(--tw-gradient-to-position);--tw-gradient-stops:var(--tw-gradient-from),var(--tw-gradient-to);--tw-gradient-to:#4f46e5 var(--tw-gradient-to-position)}.card-shadow{box-shadow:0 4px 20px rgba(0,0,0,.08)}.card-shadow-hover:hover{box-shadow:0 8px 30px rgba(0,0,0,.12);transform:translateY(-2px)}.btn-primary{border-radius:.5rem;--tw-bg-opacity:1;background-color:rgb(79 70 229/var(--tw-bg-opacity,1));padding:.5rem 1rem;--tw-text-opacity:1;color:rgb(255 255 255/var(--tw-text-opacity,1));transition-property:color,background-color,border-color,text-decoration-color,fill,stroke;transition-timing-function:cubic-bezier(.4,0,.2,1);transition-duration:.2s}.btn-primary:hover{--tw-bg-opacity:1;background-color:rgb(67 56 202/var(--tw-bg-opacity,1))}.btn-secondary{border-radius:.5rem;--tw-bg-opacity:1;background-color:rgb(229 231 235/var(--tw-bg-opacity,1));padding:.5rem 1rem;--tw-text-opacity:1;color:rgb(31 41 55/var(--tw-text-opacity,1));transition-property:color,background-color,border-color,text-decoration-color,fill,stroke;transition-timing-function:cubic-bezier(.4,0,.2,1);transition-duration:.2s}.btn-secondary:hover{--tw-bg-opacity:1;background-color:rgb(209 213 219/var(--tw-bg-opacity,1))}.sr-only{position:absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0,0,0,0);white-space:nowrap;border-width:0}.pointer-events-none{pointer-events:none}.invisible{visibility:hidden}.static{position:static}.fixed{position:fixed}.absolute{position:absolute}.relative{position:relative}.sticky{position:sticky}.inset-0{inset:0}.inset-y-0{top:0;bottom:0}.-bottom-10{bottom:-2.5rem}.-bottom-4{bottom:-1rem}.-left-10{left:-2.5rem}.-left-32{left:-8rem}.-left-48{left:-12rem}.-left-6{left:-1.5rem}.-right-10{right:-2.5rem}.-right-2{right:-.5rem}.-right-20{right:-5rem}.-right-40{right:-10rem}.-right-6{right:-1.5rem}.-top-10{top:-2.5rem}.-top-2{top:-.5rem}.-top-3{top:-.75rem}.-top-4{top:-1rem}.-top-48{top:-12rem}.-top-5{top:-1.25rem}.-top-6{top:-1.5rem}.bottom-0{bottom:0}.bottom-1{bottom:.25rem}.bottom-10{bottom:2.5rem}.bottom-2{bottom:.5rem}.bottom-20{bottom:5rem}.bottom-4{bottom:1rem}.bottom-6{bottom:1.5rem}.bottom-8{bottom:2rem}.bottom-full{bottom:100%}.left-0{left:0}.left-1\\/2{left:50%}.left-1\\/4{left:25%}.left-10{left:2.5rem}.left-2{left:.5rem}.left-20{left:5rem}.left-3{left:.75rem}.left-4{left:1rem}.left-6{left:1.5rem}.left-8{left:2rem}.left-full{left:100%}.right-0{right:0}.right-1{right:.25rem}.right-1\\/4{right:25%}.right-10{right:2.5rem}.right-2{right:.5rem}.right-3{right:.75rem}.right-4{right:1rem}.right-6{right:1.5rem}.right-8{right:2rem}.top-0{top:0}.top-1\\/2{top:50%}.top-10{top:2.5rem}.top-2{top:.5rem}.top-20{top:5rem}.top-24{top:6rem}.top-3{top:.75rem}.top-4{top:1rem}.top-40{top:10rem}.top-6{top:1.5rem}.top-8{top:2rem}.z-10{z-index:10}.z-30{z-index:30}.z-40{z-index:40}.z-50{z-index:50}.col-span-2{grid-column:span 2/span 2}.col-span-3{grid-column:span 3/span 3}.col-span-full{grid-column:1/-1}.-mx-4{margin-left:-1rem;margin-right:-1rem}.-mx-6{margin-left:-1.5rem;margin-right:-1.5rem}.-my-3{margin-top:-.75rem;margin-bottom:-.75rem}.mx-1{margin-left:.25rem;margin-right:.25rem}.mx-2{margin-left:.5rem;margin-right:.5rem}.mx-4{margin-left:1rem;margin-right:1rem}.mx-auto{margin-left:auto;margin-right:auto}.my-1{margin-top:.25rem;margin-bottom:.25rem}.my-4{margin-top:1rem;margin-bottom:1rem}.-mb-px{margin-bottom:-1px}.-ml-0\\.5{margin-left:-.125rem}.-mt-0\\.5{margin-top:-.125rem}.-mt-6{margin-top:-1.5rem}.mb-1{margin-bottom:.25rem}.mb-10{margin-bottom:2.5rem}.mb-12{margin-bottom:3rem}.mb-16{margin-bottom:4rem}.mb-2{margin-bottom:.5rem}.mb-3{margin-bottom:.75rem}.mb-4{margin-bottom:1rem}.mb-6{margin-bottom:1.5rem}.mb-8{margin-bottom:2rem}.ml-1{margin-left:.25rem}.ml-16{margin-left:4rem}.ml-2{margin-left:.5rem}.ml-3{margin-left:.75rem}.ml-4{margin-left:1rem}.ml-5{margin-left:1.25rem}.ml-64{margin-left:16rem}.ml-8{margin-left:2rem}.ml-auto{margin-left:auto}.mr-1{margin-right:.25rem}.mr-2{margin-right:.5rem}.mr-3{margin-right:.75rem}.mr-4{margin-right:1rem}.mr-5{margin-right:1.25rem}.mr-6{margin-right:1.5rem}.mt-0\\.5{margin-top:.125rem}.mt-1{margin-top:.25rem}.mt-10{margin-top:2.5rem}.mt-12{margin-top:3rem}.mt-2{margin-top:.5rem}.mt-3{margin-top:.75rem}.mt-4{margin-top:1rem}.mt-5{margin-top:1.25rem}.mt-6{margin-top:1.5rem}.mt-8{margin-top:2rem}.line-clamp-2{overflow:hidden;display:-webkit-box;-webkit-box-orient:vertical;-webkit-line-clamp:2}.block{display:block}.inline-block{display:inline-block}.inline{display:inline}.flex{display:flex}.inline-flex{display:inline-flex}.table{display:table}.flow-root{display:flow-root}.grid{display:grid}.contents{display:contents}.hidden{display:none}.aspect-video{aspect-ratio:16/9}.h-0\\.5{height:.125rem}.h-10{height:2.5rem}.h-11{height:2.75rem}.h-12{height:3rem}.h-14{height:3.5rem}.h-16{height:4rem}.h-2{height:.5rem}.h-20{height:5rem}.h-24{height:6rem}.h-3{height:.75rem}.h-4{height:1rem}.h-40{height:10rem}.h-48{height:12rem}.h-5{height:1.25rem}.h-56{height:14rem}.h-6{height:1.5rem}.h-64{height:16rem}.h-72{height:18rem}.h-8{height:2rem}.h-80{height:20rem}.h-96{height:24rem}.h-full{height:100%}.max-h-32{max-height:8rem}.max-h-40{max-height:10rem}.max-h-48{max-height:12rem}.max-h-64{max-height:16rem}.max-h-80{max-height:20rem}.max-h-96{max-height:24rem}.max-h-\\[600px\\]{max-height:600px}.min-h-0{min-height:0}.min-h-\\[200px\\]{min-height:200px}.min-h-full{min-height:100%}.min-h-screen{min-height:100vh}.w-0{width:0}.w-0\\.5{width:.125rem}.w-1{width:.25rem}.w-1\\/2{width:50%}.w-10{width:2.5rem}.w-11{width:2.75rem}.w-12{width:3rem}.w-14{width:3.5rem}.w-16{width:4rem}.w-2{width:.5rem}.w-20{width:5rem}.w-24{width:6rem}.w-3{width:.75rem}.w-3\\/4{width:75%}.w-32{width:8rem}.w-4{width:1rem}.w-40{width:10rem}.w-48{width:12rem}.w-5{width:1.25rem}.w-56{width:14rem}.w-6{width:1.5rem}.w-64{width:16rem}.w-72{width:18rem}.w-8{width:2rem}.w-80{width:20rem}.w-96{width:24rem}.w-full{width:100%}.w-px{width:1px}.min-w-0{min-width:0}.min-w-\\[200px\\]{min-width:200px}.min-w-full{min-width:100%}.max-w-2xl{max-width:42rem}.max-w-3xl{max-width:48rem}.max-w-4xl{max-width:56rem}.max-w-5xl{max-width:64rem}.max-w-6xl{max-width:72rem}.max-w-7xl{max-width:80rem}.max-w-full{max-width:100%}.max-w-lg{max-width:32rem}.max-w-md{max-width:28rem}.max-w-none{max-width:none}.max-w-sm{max-width:24rem}.max-w-xl{max-width:36rem}.max-w-xs{max-width:20rem}.flex-1{flex:1 1 0%}.flex-shrink-0{flex-shrink:0}.-translate-x-1\\/2{--tw-translate-x:-50%}.-translate-x-1\\/2,.-translate-x-full{transform:translate(var(--tw-translate-x),var(--tw-translate-y)) rotate(var(--tw-rotate)) skewX(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y))}.-translate-x-full{--tw-translate-x:-100%}.-translate-y-1\\/2{--tw-translate-y:-50%}.-translate-y-1\\/2,.-translate-y-4{transform:translate(var(--tw-translate-x),var(--tw-translate-y)) rotate(var(--tw-rotate)) skewX(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y))}.-translate-y-4{--tw-translate-y:-1rem}.translate-x-0{--tw-translate-x:0px}.translate-x-0,.translate-x-1\\/2{transform:translate(var(--tw-translate-x),var(--tw-translate-y)) rotate(var(--tw-rotate)) skewX(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y))}.translate-x-1\\/2{--tw-translate-x:50%}.translate-y-0{--tw-translate-y:0px}.translate-y-0,.translate-y-4{transform:translate(var(--tw-translate-x),var(--tw-translate-y)) rotate(var(--tw-rotate)) skewX(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y))}.translate-y-4{--tw-translate-y:1rem}.-rotate-3{--tw-rotate:-3deg}.-rotate-3,.-rotate-6{transform:translate(var(--tw-translate-x),var(--tw-translate-y)) rotate(var(--tw-rotate)) skewX(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y))}.-rotate-6{--tw-rotate:-6deg}.-rotate-90{--tw-rotate:-90deg}.-rotate-90,.rotate-180{transform:translate(var(--tw-translate-x),var(--tw-translate-y)) rotate(var(--tw-rotate)) skewX(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y))}.rotate-180{--tw-rotate:180deg}.rotate-2{--tw-rotate:2deg}.rotate-2,.rotate-3{transform:translate(var(--tw-translate-x),var(--tw-translate-y)) rotate(var(--tw-rotate)) skewX(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y))}.rotate-3{--tw-rotate:3deg}.rotate-6{--tw-rotate:6deg}.rotate-6,.scale-100{transform:translate(var(--tw-translate-x),var(--tw-translate-y)) rotate(var(--tw-rotate)) skewX(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y))}.scale-100{--tw-scale-x:1;--tw-scale-y:1}.scale-90{--tw-scale-x:.9;--tw-scale-y:.9}.scale-90,.transform{transform:translate(var(--tw-translate-x),var(--tw-translate-y)) rotate(var(--tw-rotate)) skewX(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y))}@keyframes bounce{0%,to{transform:translateY(-25%);animation-timing-function:cubic-bezier(.8,0,1,1)}50%{transform:none;animation-timing-function:cubic-bezier(0,0,.2,1)}}.animate-bounce{animation:bounce 1s infinite}@keyframes pulse{50%{opacity:.5}}.animate-pulse{animation:pulse 2s cubic-bezier(.4,0,.6,1) infinite}@keyframes spin{to{transform:rotate(1turn)}}.animate-spin{animation:spin 1s linear infinite}.cursor-not-allowed{cursor:not-allowed}.cursor-pointer{cursor:pointer}.resize-none{resize:none}.list-inside{list-style-position:inside}.list-decimal{list-style-type:decimal}.list-disc{list-style-type:disc}.appearance-none{-webkit-appearance:none;-moz-appearance:none;appearance:none}.grid-cols-1{grid-template-columns:repeat(1,minmax(0,1fr))}.grid-cols-2{grid-template-columns:repeat(2,minmax(0,1fr))}.grid-cols-3{grid-template-columns:repeat(3,minmax(0,1fr))}.grid-cols-4{grid-template-columns:repeat(4,minmax(0,1fr))}.grid-cols-7{grid-template-columns:repeat(7,minmax(0,1fr))}.flex-col{flex-direction:column}.flex-wrap{flex-wrap:wrap}.items-start{align-items:flex-start}.items-end{align-items:flex-end}.items-center{align-items:center}.items-baseline{align-items:baseline}.justify-end{justify-content:flex-end}.justify-center{justify-content:center}.justify-between{justify-content:space-between}.gap-1{gap:.25rem}.gap-12{gap:3rem}.gap-16{gap:4rem}.gap-2{gap:.5rem}.gap-3{gap:.75rem}.gap-4{gap:1rem}.gap-5{gap:1.25rem}.gap-6{gap:1.5rem}.gap-8{gap:2rem}.gap-x-4{-moz-column-gap:1rem;column-gap:1rem}.gap-y-6{row-gap:1.5rem}.space-x-2>:not([hidden])~:not([hidden]){--tw-space-x-reverse:0;margin-right:calc(.5rem*var(--tw-space-x-reverse));margin-left:calc(.5rem*(1 - var(--tw-space-x-reverse)))}.space-x-3>:not([hidden])~:not([hidden]){--tw-space-x-reverse:0;margin-right:calc(.75rem*var(--tw-space-x-reverse));margin-left:calc(.75rem*(1 - var(--tw-space-x-reverse)))}.space-x-4>:not([hidden])~:not([hidden]){--tw-space-x-reverse:0;margin-right:calc(1rem*var(--tw-space-x-reverse));margin-left:calc(1rem*(1 - var(--tw-space-x-reverse)))}.space-x-6>:not([hidden])~:not([hidden]){--tw-space-x-reverse:0;margin-right:calc(1.5rem*var(--tw-space-x-reverse));margin-left:calc(1.5rem*(1 - var(--tw-space-x-reverse)))}.space-x-8>:not([hidden])~:not([hidden]){--tw-space-x-reverse:0;margin-right:calc(2rem*var(--tw-space-x-reverse));margin-left:calc(2rem*(1 - var(--tw-space-x-reverse)))}.space-y-1>:not([hidden])~:not([hidden]){--tw-space-y-reverse:0;margin-top:calc(.25rem*(1 - var(--tw-space-y-reverse)));margin-bottom:calc(.25rem*var(--tw-space-y-reverse))}.space-y-12>:not([hidden])~:not([hidden]){--tw-space-y-reverse:0;margin-top:calc(3rem*(1 - var(--tw-space-y-reverse)));margin-bottom:calc(3rem*var(--tw-space-y-reverse))}.space-y-2>:not([hidden])~:not([hidden]){--tw-space-y-reverse:0;margin-top:calc(.5rem*(1 - var(--tw-space-y-reverse)));margin-bottom:calc(.5rem*var(--tw-space-y-reverse))}.space-y-3>:not([hidden])~:not([hidden]){--tw-space-y-reverse:0;margin-top:calc(.75rem*(1 - var(--tw-space-y-reverse)));margin-bottom:calc(.75rem*var(--tw-space-y-reverse))}.space-y-4>:not([hidden])~:not([hidden]){--tw-space-y-reverse:0;margin-top:calc(1rem*(1 - var(--tw-space-y-reverse)));margin-bottom:calc(1rem*var(--tw-space-y-reverse))}.space-y-5>:not([hidden])~:not([hidden]){--tw-space-y-reverse:0;margin-top:calc(1.25rem*(1 - var(--tw-space-y-reverse)));margin-bottom:calc(1.25rem*var(--tw-space-y-reverse))}.space-y-6>:not([hidden])~:not([hidden]){--tw-space-y-reverse:0;margin-top:calc(1.5rem*(1 - var(--tw-space-y-reverse)));margin-bottom:calc(1.5rem*var(--tw-space-y-reverse))}.space-y-8>:not([hidden])~:not([hidden]){--tw-space-y-reverse:0;margin-top:calc(2rem*(1 - var(--tw-space-y-reverse)));margin-bottom:calc(2rem*var(--tw-space-y-reverse))}.divide-y>:not([hidden])~:not([hidden]){--tw-divide-y-reverse:0;border-top-width:calc(1px*(1 - var(--tw-divide-y-reverse)));border-bottom-width:calc(1px*var(--tw-divide-y-reverse))}.divide-gray-100>:not([hidden])~:not([hidden]){--tw-divide-opacity:1;border-color:rgb(243 244 246/var(--tw-divide-opacity,1))}.divide-gray-200>:not([hidden])~:not([hidden]){--tw-divide-opacity:1;border-color:rgb(229 231 235/var(--tw-divide-opacity,1))}.overflow-hidden{overflow:hidden}.overflow-x-auto{overflow-x:auto}.overflow-y-auto{overflow-y:auto}.overflow-x-hidden{overflow-x:hidden}.scroll-smooth{scroll-behavior:smooth}.truncate{overflow:hidden;text-overflow:ellipsis}.truncate,.whitespace-nowrap{white-space:nowrap}.whitespace-pre-line{white-space:pre-line}.whitespace-pre-wrap{white-space:pre-wrap}.rounded{border-radius:.25rem}.rounded-2xl{border-radius:1rem}.rounded-3xl{border-radius:1.5rem}.rounded-full{border-radius:9999px}.rounded-lg{border-radius:.5rem}.rounded-md{border-radius:.375rem}.rounded-xl{border-radius:.75rem}.border{border-width:1px}.border-2{border-width:2px}.border-4{border-width:4px}.border-y{border-top-width:1px}.border-b,.border-y{border-bottom-width:1px}.border-b-2{border-bottom-width:2px}.border-b-4{border-bottom-width:4px}.border-l-2{border-left-width:2px}.border-l-4{border-left-width:4px}.border-r{border-right-width:1px}.border-t{border-top-width:1px}.border-t-2{border-top-width:2px}.border-dashed{border-style:dashed}.border-none{border-style:none}.border-amber-200{--tw-border-opacity:1;border-color:rgb(253 230 138/var(--tw-border-opacity,1))}.border-amber-300{--tw-border-opacity:1;border-color:rgb(252 211 77/var(--tw-border-opacity,1))}.border-amber-500{--tw-border-opacity:1;border-color:rgb(245 158 11/var(--tw-border-opacity,1))}.border-blue-100{--tw-border-opacity:1;border-color:rgb(219 234 254/var(--tw-border-opacity,1))}.border-blue-200{--tw-border-opacity:1;border-color:rgb(191 219 254/var(--tw-border-opacity,1))}.border-blue-300{--tw-border-opacity:1;border-color:rgb(147 197 253/var(--tw-border-opacity,1))}.border-blue-400{--tw-border-opacity:1;border-color:rgb(96 165 250/var(--tw-border-opacity,1))}.border-blue-500{--tw-border-opacity:1;border-color:rgb(59 130 246/var(--tw-border-opacity,1))}.border-emerald-200{--tw-border-opacity:1;border-color:rgb(167 243 208/var(--tw-border-opacity,1))}.border-emerald-500{--tw-border-opacity:1;border-color:rgb(16 185 129/var(--tw-border-opacity,1))}.border-gray-100{--tw-border-opacity:1;border-color:rgb(243 244 246/var(--tw-border-opacity,1))}.border-gray-200{--tw-border-opacity:1;border-color:rgb(229 231 235/var(--tw-border-opacity,1))}.border-gray-300{--tw-border-opacity:1;border-color:rgb(209 213 219/var(--tw-border-opacity,1))}.border-gray-400{--tw-border-opacity:1;border-color:rgb(156 163 175/var(--tw-border-opacity,1))}.border-gray-700{--tw-border-opacity:1;border-color:rgb(55 65 81/var(--tw-border-opacity,1))}.border-gray-800{--tw-border-opacity:1;border-color:rgb(31 41 55/var(--tw-border-opacity,1))}.border-green-100{--tw-border-opacity:1;border-color:rgb(220 252 231/var(--tw-border-opacity,1))}.border-green-200{--tw-border-opacity:1;border-color:rgb(187 247 208/var(--tw-border-opacity,1))}.border-green-300{--tw-border-opacity:1;border-color:rgb(134 239 172/var(--tw-border-opacity,1))}.border-green-400{--tw-border-opacity:1;border-color:rgb(74 222 128/var(--tw-border-opacity,1))}.border-green-500{--tw-border-opacity:1;border-color:rgb(34 197 94/var(--tw-border-opacity,1))}.border-green-500\\/30{border-color:rgba(34,197,94,.3)}.border-indigo-100{--tw-border-opacity:1;border-color:rgb(224 231 255/var(--tw-border-opacity,1))}.border-indigo-500{--tw-border-opacity:1;border-color:rgb(99 102 241/var(--tw-border-opacity,1))}.border-indigo-600{--tw-border-opacity:1;border-color:rgb(79 70 229/var(--tw-border-opacity,1))}.border-indigo-700{--tw-border-opacity:1;border-color:rgb(67 56 202/var(--tw-border-opacity,1))}.border-orange-100{--tw-border-opacity:1;border-color:rgb(255 237 213/var(--tw-border-opacity,1))}.border-orange-200{--tw-border-opacity:1;border-color:rgb(254 215 170/var(--tw-border-opacity,1))}.border-orange-300{--tw-border-opacity:1;border-color:rgb(253 186 116/var(--tw-border-opacity,1))}.border-orange-500{--tw-border-opacity:1;border-color:rgb(249 115 22/var(--tw-border-opacity,1))}.border-pink-100{--tw-border-opacity:1;border-color:rgb(252 231 243/var(--tw-border-opacity,1))}.border-pink-500{--tw-border-opacity:1;border-color:rgb(236 72 153/var(--tw-border-opacity,1))}.border-pink-500\\/30{border-color:rgba(236,72,153,.3)}.border-pink-500\\/50{border-color:rgba(236,72,153,.5)}.border-purple-100{--tw-border-opacity:1;border-color:rgb(243 232 255/var(--tw-border-opacity,1))}.border-purple-200{--tw-border-opacity:1;border-color:rgb(233 213 255/var(--tw-border-opacity,1))}.border-purple-300{--tw-border-opacity:1;border-color:rgb(216 180 254/var(--tw-border-opacity,1))}.border-purple-400{--tw-border-opacity:1;border-color:rgb(192 132 252/var(--tw-border-opacity,1))}.border-purple-500{--tw-border-opacity:1;border-color:rgb(168 85 247/var(--tw-border-opacity,1))}.border-purple-500\\/20{border-color:rgba(168,85,247,.2)}.border-purple-500\\/30{border-color:rgba(168,85,247,.3)}.border-purple-500\\/50{border-color:rgba(168,85,247,.5)}.border-purple-600{--tw-border-opacity:1;border-color:rgb(147 51 234/var(--tw-border-opacity,1))}.border-red-200{--tw-border-opacity:1;border-color:rgb(254 202 202/var(--tw-border-opacity,1))}.border-red-400{--tw-border-opacity:1;border-color:rgb(248 113 113/var(--tw-border-opacity,1))}.border-red-500\\/30{border-color:rgba(239,68,68,.3)}.border-red-500\\/50{border-color:rgba(239,68,68,.5)}.border-transparent{border-color:transparent}.border-white{--tw-border-opacity:1;border-color:rgb(255 255 255/var(--tw-border-opacity,1))}.border-white\\/20{border-color:hsla(0,0%,100%,.2)}.border-white\\/30{border-color:hsla(0,0%,100%,.3)}.border-yellow-100{--tw-border-opacity:1;border-color:rgb(254 249 195/var(--tw-border-opacity,1))}.border-yellow-200{--tw-border-opacity:1;border-color:rgb(254 240 138/var(--tw-border-opacity,1))}.border-yellow-400{--tw-border-opacity:1;border-color:rgb(250 204 21/var(--tw-border-opacity,1))}.border-t-transparent{border-top-color:transparent}.bg-amber-100{--tw-bg-opacity:1;background-color:rgb(254 243 199/var(--tw-bg-opacity,1))}.bg-amber-400{--tw-bg-opacity:1;background-color:rgb(251 191 36/var(--tw-bg-opacity,1))}.bg-amber-50{--tw-bg-opacity:1;background-color:rgb(255 251 235/var(--tw-bg-opacity,1))}.bg-amber-500{--tw-bg-opacity:1;background-color:rgb(245 158 11/var(--tw-bg-opacity,1))}.bg-black{--tw-bg-opacity:1;background-color:rgb(0 0 0/var(--tw-bg-opacity,1))}.bg-black\\/50{background-color:rgba(0,0,0,.5)}.bg-black\\/60{background-color:rgba(0,0,0,.6)}.bg-blue-100{--tw-bg-opacity:1;background-color:rgb(219 234 254/var(--tw-bg-opacity,1))}.bg-blue-400{--tw-bg-opacity:1;background-color:rgb(96 165 250/var(--tw-bg-opacity,1))}.bg-blue-50{--tw-bg-opacity:1;background-color:rgb(239 246 255/var(--tw-bg-opacity,1))}.bg-blue-500{--tw-bg-opacity:1;background-color:rgb(59 130 246/var(--tw-bg-opacity,1))}.bg-blue-600{--tw-bg-opacity:1;background-color:rgb(37 99 235/var(--tw-bg-opacity,1))}.bg-cyan-400{--tw-bg-opacity:1;background-color:rgb(34 211 238/var(--tw-bg-opacity,1))}.bg-emerald-100{--tw-bg-opacity:1;background-color:rgb(209 250 229/var(--tw-bg-opacity,1))}.bg-emerald-400{--tw-bg-opacity:1;background-color:rgb(52 211 153/var(--tw-bg-opacity,1))}.bg-emerald-50{--tw-bg-opacity:1;background-color:rgb(236 253 245/var(--tw-bg-opacity,1))}.bg-emerald-500{--tw-bg-opacity:1;background-color:rgb(16 185 129/var(--tw-bg-opacity,1))}.bg-emerald-600{--tw-bg-opacity:1;background-color:rgb(5 150 105/var(--tw-bg-opacity,1))}.bg-fuchsia-500{--tw-bg-opacity:1;background-color:rgb(217 70 239/var(--tw-bg-opacity,1))}.bg-gray-100{--tw-bg-opacity:1;background-color:rgb(243 244 246/var(--tw-bg-opacity,1))}.bg-gray-200{--tw-bg-opacity:1;background-color:rgb(229 231 235/var(--tw-bg-opacity,1))}.bg-gray-300{--tw-bg-opacity:1;background-color:rgb(209 213 219/var(--tw-bg-opacity,1))}.bg-gray-50{--tw-bg-opacity:1;background-color:rgb(249 250 251/var(--tw-bg-opacity,1))}.bg-gray-500{--tw-bg-opacity:1;background-color:rgb(107 114 128/var(--tw-bg-opacity,1))}.bg-gray-600{--tw-bg-opacity:1;background-color:rgb(75 85 99/var(--tw-bg-opacity,1))}.bg-gray-700{--tw-bg-opacity:1;background-color:rgb(55 65 81/var(--tw-bg-opacity,1))}.bg-gray-800{--tw-bg-opacity:1;background-color:rgb(31 41 55/var(--tw-bg-opacity,1))}.bg-gray-900{--tw-bg-opacity:1;background-color:rgb(17 24 39/var(--tw-bg-opacity,1))}.bg-green-100{--tw-bg-opacity:1;background-color:rgb(220 252 231/var(--tw-bg-opacity,1))}.bg-green-400{--tw-bg-opacity:1;background-color:rgb(74 222 128/var(--tw-bg-opacity,1))}.bg-green-50{--tw-bg-opacity:1;background-color:rgb(240 253 244/var(--tw-bg-opacity,1))}.bg-green-500{--tw-bg-opacity:1;background-color:rgb(34 197 94/var(--tw-bg-opacity,1))}.bg-green-500\\/20{background-color:rgba(34,197,94,.2)}.bg-green-600{--tw-bg-opacity:1;background-color:rgb(22 163 74/var(--tw-bg-opacity,1))}.bg-indigo-100{--tw-bg-opacity:1;background-color:rgb(224 231 255/var(--tw-bg-opacity,1))}.bg-indigo-400{--tw-bg-opacity:1;background-color:rgb(129 140 248/var(--tw-bg-opacity,1))}.bg-indigo-50{--tw-bg-opacity:1;background-color:rgb(238 242 255/var(--tw-bg-opacity,1))}.bg-indigo-500{--tw-bg-opacity:1;background-color:rgb(99 102 241/var(--tw-bg-opacity,1))}.bg-indigo-600{--tw-bg-opacity:1;background-color:rgb(79 70 229/var(--tw-bg-opacity,1))}.bg-indigo-900{--tw-bg-opacity:1;background-color:rgb(49 46 129/var(--tw-bg-opacity,1))}.bg-orange-100{--tw-bg-opacity:1;background-color:rgb(255 237 213/var(--tw-bg-opacity,1))}.bg-orange-400{--tw-bg-opacity:1;background-color:rgb(251 146 60/var(--tw-bg-opacity,1))}.bg-orange-50{--tw-bg-opacity:1;background-color:rgb(255 247 237/var(--tw-bg-opacity,1))}.bg-orange-500{--tw-bg-opacity:1;background-color:rgb(249 115 22/var(--tw-bg-opacity,1))}.bg-orange-600{--tw-bg-opacity:1;background-color:rgb(234 88 12/var(--tw-bg-opacity,1))}.bg-pink-100{--tw-bg-opacity:1;background-color:rgb(252 231 243/var(--tw-bg-opacity,1))}.bg-pink-400{--tw-bg-opacity:1;background-color:rgb(244 114 182/var(--tw-bg-opacity,1))}.bg-pink-500{--tw-bg-opacity:1;background-color:rgb(236 72 153/var(--tw-bg-opacity,1))}.bg-pink-500\\/20{background-color:rgba(236,72,153,.2)}.bg-pink-500\\/30{background-color:rgba(236,72,153,.3)}.bg-pink-600{--tw-bg-opacity:1;background-color:rgb(219 39 119/var(--tw-bg-opacity,1))}.bg-purple-100{--tw-bg-opacity:1;background-color:rgb(243 232 255/var(--tw-bg-opacity,1))}.bg-purple-400{--tw-bg-opacity:1;background-color:rgb(192 132 252/var(--tw-bg-opacity,1))}.bg-purple-50{--tw-bg-opacity:1;background-color:rgb(250 245 255/var(--tw-bg-opacity,1))}.bg-purple-500{--tw-bg-opacity:1;background-color:rgb(168 85 247/var(--tw-bg-opacity,1))}.bg-purple-500\\/30{background-color:rgba(168,85,247,.3)}.bg-purple-600{--tw-bg-opacity:1;background-color:rgb(147 51 234/var(--tw-bg-opacity,1))}.bg-purple-900\\/50{background-color:rgba(88,28,135,.5)}.bg-red-100{--tw-bg-opacity:1;background-color:rgb(254 226 226/var(--tw-bg-opacity,1))}.bg-red-400{--tw-bg-opacity:1;background-color:rgb(248 113 113/var(--tw-bg-opacity,1))}.bg-red-50{--tw-bg-opacity:1;background-color:rgb(254 242 242/var(--tw-bg-opacity,1))}.bg-red-500{--tw-bg-opacity:1;background-color:rgb(239 68 68/var(--tw-bg-opacity,1))}.bg-red-500\\/20{background-color:rgba(239,68,68,.2)}.bg-red-600{--tw-bg-opacity:1;background-color:rgb(220 38 38/var(--tw-bg-opacity,1))}.bg-teal-100{--tw-bg-opacity:1;background-color:rgb(204 251 241/var(--tw-bg-opacity,1))}.bg-teal-50{--tw-bg-opacity:1;background-color:rgb(240 253 250/var(--tw-bg-opacity,1))}.bg-teal-600{--tw-bg-opacity:1;background-color:rgb(13 148 136/var(--tw-bg-opacity,1))}.bg-transparent{background-color:transparent}.bg-violet-500{--tw-bg-opacity:1;background-color:rgb(139 92 246/var(--tw-bg-opacity,1))}.bg-white{--tw-bg-opacity:1;background-color:rgb(255 255 255/var(--tw-bg-opacity,1))}.bg-white\\/10{background-color:hsla(0,0%,100%,.1)}.bg-white\\/20{background-color:hsla(0,0%,100%,.2)}.bg-white\\/5{background-color:hsla(0,0%,100%,.05)}.bg-white\\/80{background-color:hsla(0,0%,100%,.8)}.bg-white\\/90{background-color:hsla(0,0%,100%,.9)}.bg-yellow-100{--tw-bg-opacity:1;background-color:rgb(254 249 195/var(--tw-bg-opacity,1))}.bg-yellow-400{--tw-bg-opacity:1;background-color:rgb(250 204 21/var(--tw-bg-opacity,1))}.bg-yellow-50{--tw-bg-opacity:1;background-color:rgb(254 252 232/var(--tw-bg-opacity,1))}.bg-yellow-500{--tw-bg-opacity:1;background-color:rgb(234 179 8/var(--tw-bg-opacity,1))}.bg-yellow-600{--tw-bg-opacity:1;background-color:rgb(202 138 4/var(--tw-bg-opacity,1))}.bg-opacity-20{--tw-bg-opacity:0.2}.bg-opacity-40{--tw-bg-opacity:0.4}.bg-opacity-50{--tw-bg-opacity:0.5}.bg-opacity-75{--tw-bg-opacity:0.75}.bg-gradient-to-b{background-image:linear-gradient(to bottom,var(--tw-gradient-stops))}.bg-gradient-to-br{background-image:linear-gradient(to bottom right,var(--tw-gradient-stops))}.bg-gradient-to-r{background-image:linear-gradient(to right,var(--tw-gradient-stops))}.from-amber-50{--tw-gradient-from:#fffbeb var(--tw-gradient-from-position);--tw-gradient-to:rgba(255,251,235,0) var(--tw-gradient-to-position);--tw-gradient-stops:var(--tw-gradient-from),var(--tw-gradient-to)}.from-amber-500{--tw-gradient-from:#f59e0b var(--tw-gradient-from-position);--tw-gradient-to:rgba(245,158,11,0) var(--tw-gradient-to-position);--tw-gradient-stops:var(--tw-gradient-from),var(--tw-gradient-to)}.from-blue-100{--tw-gradient-from:#dbeafe var(--tw-gradient-from-position);--tw-gradient-to:rgba(219,234,254,0) var(--tw-gradient-to-position);--tw-gradient-stops:var(--tw-gradient-from),var(--tw-gradient-to)}.from-blue-400{--tw-gradient-from:#60a5fa var(--tw-gradient-from-position);--tw-gradient-to:rgba(96,165,250,0) var(--tw-gradient-to-position);--tw-gradient-stops:var(--tw-gradient-from),var(--tw-gradient-to)}.from-blue-50{--tw-gradient-from:#eff6ff var(--tw-gradient-from-position);--tw-gradient-to:rgba(239,246,255,0) var(--tw-gradient-to-position);--tw-gradient-stops:var(--tw-gradient-from),var(--tw-gradient-to)}.from-blue-500{--tw-gradient-from:#3b82f6 var(--tw-gradient-from-position);--tw-gradient-to:rgba(59,130,246,0) var(--tw-gradient-to-position);--tw-gradient-stops:var(--tw-gradient-from),var(--tw-gradient-to)}.from-blue-600{--tw-gradient-from:#2563eb var(--tw-gradient-from-position);--tw-gradient-to:rgba(37,99,235,0) var(--tw-gradient-to-position);--tw-gradient-stops:var(--tw-gradient-from),var(--tw-gradient-to)}.from-cyan-100{--tw-gradient-from:#cffafe var(--tw-gradient-from-position);--tw-gradient-to:rgba(207,250,254,0) var(--tw-gradient-to-position);--tw-gradient-stops:var(--tw-gradient-from),var(--tw-gradient-to)}.from-emerald-100{--tw-gradient-from:#d1fae5 var(--tw-gradient-from-position);--tw-gradient-to:rgba(209,250,229,0) var(--tw-gradient-to-position);--tw-gradient-stops:var(--tw-gradient-from),var(--tw-gradient-to)}.from-emerald-400{--tw-gradient-from:#34d399 var(--tw-gradient-from-position);--tw-gradient-to:rgba(52,211,153,0) var(--tw-gradient-to-position);--tw-gradient-stops:var(--tw-gradient-from),var(--tw-gradient-to)}.from-emerald-50{--tw-gradient-from:#ecfdf5 var(--tw-gradient-from-position);--tw-gradient-to:rgba(236,253,245,0) var(--tw-gradient-to-position);--tw-gradient-stops:var(--tw-gradient-from),var(--tw-gradient-to)}.from-emerald-500{--tw-gradient-from:#10b981 var(--tw-gradient-from-position);--tw-gradient-to:rgba(16,185,129,0) var(--tw-gradient-to-position);--tw-gradient-stops:var(--tw-gradient-from),var(--tw-gradient-to)}.from-fuchsia-500{--tw-gradient-from:#d946ef var(--tw-gradient-from-position);--tw-gradient-to:rgba(217,70,239,0) var(--tw-gradient-to-position);--tw-gradient-stops:var(--tw-gradient-from),var(--tw-gradient-to)}.from-gray-100{--tw-gradient-from:#f3f4f6 var(--tw-gradient-from-position);--tw-gradient-to:rgba(243,244,246,0) var(--tw-gradient-to-position);--tw-gradient-stops:var(--tw-gradient-from),var(--tw-gradient-to)}.from-gray-200{--tw-gradient-from:#e5e7eb var(--tw-gradient-from-position);--tw-gradient-to:rgba(229,231,235,0) var(--tw-gradient-to-position);--tw-gradient-stops:var(--tw-gradient-from),var(--tw-gradient-to)}.from-gray-50{--tw-gradient-from:#f9fafb var(--tw-gradient-from-position);--tw-gradient-to:rgba(249,250,251,0) var(--tw-gradient-to-position);--tw-gradient-stops:var(--tw-gradient-from),var(--tw-gradient-to)}.from-gray-900{--tw-gradient-from:#111827 var(--tw-gradient-from-position);--tw-gradient-to:rgba(17,24,39,0) var(--tw-gradient-to-position);--tw-gradient-stops:var(--tw-gradient-from),var(--tw-gradient-to)}.from-green-100{--tw-gradient-from:#dcfce7 var(--tw-gradient-from-position);--tw-gradient-to:rgba(220,252,231,0) var(--tw-gradient-to-position);--tw-gradient-stops:var(--tw-gradient-from),var(--tw-gradient-to)}.from-green-400{--tw-gradient-from:#4ade80 var(--tw-gradient-from-position);--tw-gradient-to:rgba(74,222,128,0) var(--tw-gradient-to-position);--tw-gradient-stops:var(--tw-gradient-from),var(--tw-gradient-to)}.from-green-50{--tw-gradient-from:#f0fdf4 var(--tw-gradient-from-position);--tw-gradient-to:rgba(240,253,244,0) var(--tw-gradient-to-position);--tw-gradient-stops:var(--tw-gradient-from),var(--tw-gradient-to)}.from-green-500{--tw-gradient-from:#22c55e var(--tw-gradient-from-position);--tw-gradient-to:rgba(34,197,94,0) var(--tw-gradient-to-position);--tw-gradient-stops:var(--tw-gradient-from),var(--tw-gradient-to)}.from-green-600{--tw-gradient-from:#16a34a var(--tw-gradient-from-position);--tw-gradient-to:rgba(22,163,74,0) var(--tw-gradient-to-position);--tw-gradient-stops:var(--tw-gradient-from),var(--tw-gradient-to)}.from-indigo-100{--tw-gradient-from:#e0e7ff var(--tw-gradient-from-position);--tw-gradient-to:rgba(224,231,255,0) var(--tw-gradient-to-position);--tw-gradient-stops:var(--tw-gradient-from),var(--tw-gradient-to)}.from-indigo-50{--tw-gradient-from:#eef2ff var(--tw-gradient-from-position);--tw-gradient-to:rgba(238,242,255,0) var(--tw-gradient-to-position);--tw-gradient-stops:var(--tw-gradient-from),var(--tw-gradient-to)}.from-indigo-500{--tw-gradient-from:#6366f1 var(--tw-gradient-from-position);--tw-gradient-to:rgba(99,102,241,0) var(--tw-gradient-to-position);--tw-gradient-stops:var(--tw-gradient-from),var(--tw-gradient-to)}.from-indigo-600{--tw-gradient-from:#4f46e5 var(--tw-gradient-from-position);--tw-gradient-to:rgba(79,70,229,0) var(--tw-gradient-to-position);--tw-gradient-stops:var(--tw-gradient-from),var(--tw-gradient-to)}.from-orange-100{--tw-gradient-from:#ffedd5 var(--tw-gradient-from-position);--tw-gradient-to:rgba(255,237,213,0) var(--tw-gradient-to-position);--tw-gradient-stops:var(--tw-gradient-from),var(--tw-gradient-to)}.from-orange-400{--tw-gradient-from:#fb923c var(--tw-gradient-from-position);--tw-gradient-to:rgba(251,146,60,0) var(--tw-gradient-to-position);--tw-gradient-stops:var(--tw-gradient-from),var(--tw-gradient-to)}.from-orange-50{--tw-gradient-from:#fff7ed var(--tw-gradient-from-position);--tw-gradient-to:rgba(255,247,237,0) var(--tw-gradient-to-position);--tw-gradient-stops:var(--tw-gradient-from),var(--tw-gradient-to)}.from-orange-500{--tw-gradient-from:#f97316 var(--tw-gradient-from-position);--tw-gradient-to:rgba(249,115,22,0) var(--tw-gradient-to-position);--tw-gradient-stops:var(--tw-gradient-from),var(--tw-gradient-to)}.from-pink-100{--tw-gradient-from:#fce7f3 var(--tw-gradient-from-position);--tw-gradient-to:rgba(252,231,243,0) var(--tw-gradient-to-position);--tw-gradient-stops:var(--tw-gradient-from),var(--tw-gradient-to)}.from-pink-50{--tw-gradient-from:#fdf2f8 var(--tw-gradient-from-position);--tw-gradient-to:rgba(253,242,248,0) var(--tw-gradient-to-position);--tw-gradient-stops:var(--tw-gradient-from),var(--tw-gradient-to)}.from-pink-500{--tw-gradient-from:#ec4899 var(--tw-gradient-from-position);--tw-gradient-to:rgba(236,72,153,0) var(--tw-gradient-to-position);--tw-gradient-stops:var(--tw-gradient-from),var(--tw-gradient-to)}.from-pink-600{--tw-gradient-from:#db2777 var(--tw-gradient-from-position);--tw-gradient-to:rgba(219,39,119,0) var(--tw-gradient-to-position);--tw-gradient-stops:var(--tw-gradient-from),var(--tw-gradient-to)}.from-purple-100{--tw-gradient-from:#f3e8ff var(--tw-gradient-from-position);--tw-gradient-to:rgba(243,232,255,0) var(--tw-gradient-to-position);--tw-gradient-stops:var(--tw-gradient-from),var(--tw-gradient-to)}.from-purple-400{--tw-gradient-from:#c084fc var(--tw-gradient-from-position);--tw-gradient-to:rgba(192,132,252,0) var(--tw-gradient-to-position);--tw-gradient-stops:var(--tw-gradient-from),var(--tw-gradient-to)}.from-purple-50{--tw-gradient-from:#faf5ff var(--tw-gradient-from-position);--tw-gradient-to:rgba(250,245,255,0) var(--tw-gradient-to-position);--tw-gradient-stops:var(--tw-gradient-from),var(--tw-gradient-to)}.from-purple-500{--tw-gradient-from:#a855f7 var(--tw-gradient-from-position);--tw-gradient-to:rgba(168,85,247,0) var(--tw-gradient-to-position);--tw-gradient-stops:var(--tw-gradient-from),var(--tw-gradient-to)}.from-purple-600{--tw-gradient-from:#9333ea var(--tw-gradient-from-position);--tw-gradient-to:rgba(147,51,234,0) var(--tw-gradient-to-position);--tw-gradient-stops:var(--tw-gradient-from),var(--tw-gradient-to)}.from-red-100{--tw-gradient-from:#fee2e2 var(--tw-gradient-from-position);--tw-gradient-to:hsla(0,93%,94%,0) var(--tw-gradient-to-position);--tw-gradient-stops:var(--tw-gradient-from),var(--tw-gradient-to)}.from-red-50{--tw-gradient-from:#fef2f2 var(--tw-gradient-from-position);--tw-gradient-to:hsla(0,86%,97%,0) var(--tw-gradient-to-position);--tw-gradient-stops:var(--tw-gradient-from),var(--tw-gradient-to)}.from-red-500{--tw-gradient-from:#ef4444 var(--tw-gradient-from-position);--tw-gradient-to:rgba(239,68,68,0) var(--tw-gradient-to-position);--tw-gradient-stops:var(--tw-gradient-from),var(--tw-gradient-to)}.from-slate-900{--tw-gradient-from:#0f172a var(--tw-gradient-from-position);--tw-gradient-to:rgba(15,23,42,0) var(--tw-gradient-to-position);--tw-gradient-stops:var(--tw-gradient-from),var(--tw-gradient-to)}.from-violet-500{--tw-gradient-from:#8b5cf6 var(--tw-gradient-from-position);--tw-gradient-to:rgba(139,92,246,0) var(--tw-gradient-to-position);--tw-gradient-stops:var(--tw-gradient-from),var(--tw-gradient-to)}.from-yellow-100{--tw-gradient-from:#fef9c3 var(--tw-gradient-from-position);--tw-gradient-to:hsla(55,97%,88%,0) var(--tw-gradient-to-position);--tw-gradient-stops:var(--tw-gradient-from),var(--tw-gradient-to)}.from-yellow-400{--tw-gradient-from:#facc15 var(--tw-gradient-from-position);--tw-gradient-to:rgba(250,204,21,0) var(--tw-gradient-to-position);--tw-gradient-stops:var(--tw-gradient-from),var(--tw-gradient-to)}.from-yellow-50{--tw-gradient-from:#fefce8 var(--tw-gradient-from-position);--tw-gradient-to:hsla(55,92%,95%,0) var(--tw-gradient-to-position);--tw-gradient-stops:var(--tw-gradient-from),var(--tw-gradient-to)}.via-blue-50{--tw-gradient-to:rgba(239,246,255,0) var(--tw-gradient-to-position);--tw-gradient-stops:var(--tw-gradient-from),#eff6ff var(--tw-gradient-via-position),var(--tw-gradient-to)}.via-blue-600{--tw-gradient-to:rgba(37,99,235,0) var(--tw-gradient-to-position);--tw-gradient-stops:var(--tw-gradient-from),#2563eb var(--tw-gradient-via-position),var(--tw-gradient-to)}.via-blue-700{--tw-gradient-to:rgba(29,78,216,0) var(--tw-gradient-to-position);--tw-gradient-stops:var(--tw-gradient-from),#1d4ed8 var(--tw-gradient-via-position),var(--tw-gradient-to)}.via-purple-500{--tw-gradient-to:rgba(168,85,247,0) var(--tw-gradient-to-position);--tw-gradient-stops:var(--tw-gradient-from),#a855f7 var(--tw-gradient-via-position),var(--tw-gradient-to)}.via-purple-700{--tw-gradient-to:rgba(126,34,206,0) var(--tw-gradient-to-position);--tw-gradient-stops:var(--tw-gradient-from),#7e22ce var(--tw-gradient-via-position),var(--tw-gradient-to)}.via-purple-900{--tw-gradient-to:rgba(88,28,135,0) var(--tw-gradient-to-position);--tw-gradient-stops:var(--tw-gradient-from),#581c87 var(--tw-gradient-via-position),var(--tw-gradient-to)}.via-white{--tw-gradient-to:hsla(0,0%,100%,0) var(--tw-gradient-to-position);--tw-gradient-stops:var(--tw-gradient-from),#fff var(--tw-gradient-via-position),var(--tw-gradient-to)}.to-amber-100{--tw-gradient-to:#fef3c7 var(--tw-gradient-to-position)}.to-amber-400{--tw-gradient-to:#fbbf24 var(--tw-gradient-to-position)}.to-amber-50{--tw-gradient-to:#fffbeb var(--tw-gradient-to-position)}.to-amber-500{--tw-gradient-to:#f59e0b var(--tw-gradient-to-position)}.to-amber-600{--tw-gradient-to:#d97706 var(--tw-gradient-to-position)}.to-blue-100{--tw-gradient-to:#dbeafe var(--tw-gradient-to-position)}.to-blue-200{--tw-gradient-to:#bfdbfe var(--tw-gradient-to-position)}.to-blue-50{--tw-gradient-to:#eff6ff var(--tw-gradient-to-position)}.to-blue-500{--tw-gradient-to:#3b82f6 var(--tw-gradient-to-position)}.to-blue-600{--tw-gradient-to:#2563eb var(--tw-gradient-to-position)}.to-blue-700{--tw-gradient-to:#1d4ed8 var(--tw-gradient-to-position)}.to-cyan-100{--tw-gradient-to:#cffafe var(--tw-gradient-to-position)}.to-cyan-200{--tw-gradient-to:#a5f3fc var(--tw-gradient-to-position)}.to-cyan-400{--tw-gradient-to:#22d3ee var(--tw-gradient-to-position)}.to-cyan-50{--tw-gradient-to:#ecfeff var(--tw-gradient-to-position)}.to-cyan-500{--tw-gradient-to:#06b6d4 var(--tw-gradient-to-position)}.to-cyan-600{--tw-gradient-to:#0891b2 var(--tw-gradient-to-position)}.to-emerald-100{--tw-gradient-to:#d1fae5 var(--tw-gradient-to-position)}.to-emerald-400{--tw-gradient-to:#34d399 var(--tw-gradient-to-position)}.to-emerald-50{--tw-gradient-to:#ecfdf5 var(--tw-gradient-to-position)}.to-emerald-500{--tw-gradient-to:#10b981 var(--tw-gradient-to-position)}.to-emerald-600{--tw-gradient-to:#059669 var(--tw-gradient-to-position)}.to-emerald-700{--tw-gradient-to:#047857 var(--tw-gradient-to-position)}.to-fuchsia-500{--tw-gradient-to:#d946ef var(--tw-gradient-to-position)}.to-fuchsia-600{--tw-gradient-to:#c026d3 var(--tw-gradient-to-position)}.to-gray-200{--tw-gradient-to:#e5e7eb var(--tw-gradient-to-position)}.to-gray-300{--tw-gradient-to:#d1d5db var(--tw-gradient-to-position)}.to-green-200{--tw-gradient-to:#bbf7d0 var(--tw-gradient-to-position)}.to-green-600{--tw-gradient-to:#16a34a var(--tw-gradient-to-position)}.to-indigo-100{--tw-gradient-to:#e0e7ff var(--tw-gradient-to-position)}.to-indigo-200{--tw-gradient-to:#c7d2fe var(--tw-gradient-to-position)}.to-indigo-400{--tw-gradient-to:#818cf8 var(--tw-gradient-to-position)}.to-indigo-50{--tw-gradient-to:#eef2ff var(--tw-gradient-to-position)}.to-indigo-600{--tw-gradient-to:#4f46e5 var(--tw-gradient-to-position)}.to-indigo-700{--tw-gradient-to:#4338ca var(--tw-gradient-to-position)}.to-indigo-800{--tw-gradient-to:#3730a3 var(--tw-gradient-to-position)}.to-orange-100{--tw-gradient-to:#ffedd5 var(--tw-gradient-to-position)}.to-orange-200{--tw-gradient-to:#fed7aa var(--tw-gradient-to-position)}.to-orange-400{--tw-gradient-to:#fb923c var(--tw-gradient-to-position)}.to-orange-50{--tw-gradient-to:#fff7ed var(--tw-gradient-to-position)}.to-orange-500{--tw-gradient-to:#f97316 var(--tw-gradient-to-position)}.to-orange-600{--tw-gradient-to:#ea580c var(--tw-gradient-to-position)}.to-pink-100{--tw-gradient-to:#fce7f3 var(--tw-gradient-to-position)}.to-pink-200{--tw-gradient-to:#fbcfe8 var(--tw-gradient-to-position)}.to-pink-400{--tw-gradient-to:#f472b6 var(--tw-gradient-to-position)}.to-pink-50{--tw-gradient-to:#fdf2f8 var(--tw-gradient-to-position)}.to-pink-500{--tw-gradient-to:#ec4899 var(--tw-gradient-to-position)}.to-pink-600{--tw-gradient-to:#db2777 var(--tw-gradient-to-position)}.to-purple-100{--tw-gradient-to:#f3e8ff var(--tw-gradient-to-position)}.to-purple-200{--tw-gradient-to:#e9d5ff var(--tw-gradient-to-position)}.to-purple-400{--tw-gradient-to:#c084fc var(--tw-gradient-to-position)}.to-purple-50{--tw-gradient-to:#faf5ff var(--tw-gradient-to-position)}.to-purple-500{--tw-gradient-to:#a855f7 var(--tw-gradient-to-position)}.to-purple-600{--tw-gradient-to:#9333ea var(--tw-gradient-to-position)}.to-purple-700{--tw-gradient-to:#7e22ce var(--tw-gradient-to-position)}.to-purple-900{--tw-gradient-to:#581c87 var(--tw-gradient-to-position)}.to-red-100{--tw-gradient-to:#fee2e2 var(--tw-gradient-to-position)}.to-red-200{--tw-gradient-to:#fecaca var(--tw-gradient-to-position)}.to-red-50{--tw-gradient-to:#fef2f2 var(--tw-gradient-to-position)}.to-red-500{--tw-gradient-to:#ef4444 var(--tw-gradient-to-position)}.to-red-600{--tw-gradient-to:#dc2626 var(--tw-gradient-to-position)}.to-rose-400{--tw-gradient-to:#fb7185 var(--tw-gradient-to-position)}.to-rose-50{--tw-gradient-to:#fff1f2 var(--tw-gradient-to-position)}.to-slate-900{--tw-gradient-to:#0f172a var(--tw-gradient-to-position)}.to-slate-950{--tw-gradient-to:#020617 var(--tw-gradient-to-position)}.to-teal-500{--tw-gradient-to:#14b8a6 var(--tw-gradient-to-position)}.to-transparent{--tw-gradient-to:transparent var(--tw-gradient-to-position)}.to-violet-400{--tw-gradient-to:#a78bfa var(--tw-gradient-to-position)}.to-violet-50{--tw-gradient-to:#f5f3ff var(--tw-gradient-to-position)}.to-violet-600{--tw-gradient-to:#7c3aed var(--tw-gradient-to-position)}.to-white{--tw-gradient-to:#fff var(--tw-gradient-to-position)}.object-cover{-o-object-fit:cover;object-fit:cover}.p-10{padding:2.5rem}.p-12{padding:3rem}.p-2{padding:.5rem}.p-2\\.5{padding:.625rem}.p-3{padding:.75rem}.p-4{padding:1rem}.p-5{padding:1.25rem}.p-6{padding:1.5rem}.p-8{padding:2rem}.px-1{padding-left:.25rem;padding-right:.25rem}.px-1\\.5{padding-left:.375rem;padding-right:.375rem}.px-10{padding-left:2.5rem;padding-right:2.5rem}.px-12{padding-left:3rem;padding-right:3rem}.px-2{padding-left:.5rem;padding-right:.5rem}.px-2\\.5{padding-left:.625rem;padding-right:.625rem}.px-3{padding-left:.75rem;padding-right:.75rem}.px-4{padding-left:1rem;padding-right:1rem}.px-5{padding-left:1.25rem;padding-right:1.25rem}.px-6{padding-left:1.5rem;padding-right:1.5rem}.px-7{padding-left:1.75rem;padding-right:1.75rem}.px-8{padding-left:2rem;padding-right:2rem}.py-0\\.5{padding-top:.125rem;padding-bottom:.125rem}.py-1{padding-top:.25rem;padding-bottom:.25rem}.py-1\\.5{padding-top:.375rem;padding-bottom:.375rem}.py-12{padding-top:3rem;padding-bottom:3rem}.py-16{padding-top:4rem;padding-bottom:4rem}.py-2{padding-top:.5rem;padding-bottom:.5rem}.py-2\\.5{padding-top:.625rem;padding-bottom:.625rem}.py-20{padding-top:5rem;padding-bottom:5rem}.py-24{padding-top:6rem;padding-bottom:6rem}.py-3{padding-top:.75rem;padding-bottom:.75rem}.py-4{padding-top:1rem;padding-bottom:1rem}.py-5{padding-top:1.25rem;padding-bottom:1.25rem}.py-6{padding-top:1.5rem;padding-bottom:1.5rem}.py-8{padding-top:2rem;padding-bottom:2rem}.pb-16{padding-bottom:4rem}.pb-2{padding-bottom:.5rem}.pb-20{padding-bottom:5rem}.pb-24{padding-bottom:6rem}.pb-3{padding-bottom:.75rem}.pb-4{padding-bottom:1rem}.pb-8{padding-bottom:2rem}.pl-1{padding-left:.25rem}.pl-10{padding-left:2.5rem}.pl-12{padding-left:3rem}.pl-3{padding-left:.75rem}.pl-4{padding-left:1rem}.pl-5{padding-left:1.25rem}.pl-8{padding-left:2rem}.pr-10{padding-right:2.5rem}.pr-12{padding-right:3rem}.pr-16{padding-right:4rem}.pr-3{padding-right:.75rem}.pr-4{padding-right:1rem}.pt-0{padding-top:0}.pt-1{padding-top:.25rem}.pt-12{padding-top:3rem}.pt-16{padding-top:4rem}.pt-2{padding-top:.5rem}.pt-20{padding-top:5rem}.pt-3{padding-top:.75rem}.pt-32{padding-top:8rem}.pt-4{padding-top:1rem}.pt-5{padding-top:1.25rem}.pt-6{padding-top:1.5rem}.pt-8{padding-top:2rem}.text-left{text-align:left}.text-center{text-align:center}.text-right{text-align:right}.align-bottom{vertical-align:bottom}.font-mono{font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,Liberation Mono,Courier New,monospace}.text-2xl{font-size:1.5rem;line-height:2rem}.text-3xl{font-size:1.875rem;line-height:2.25rem}.text-4xl{font-size:2.25rem;line-height:2.5rem}.text-5xl{font-size:3rem;line-height:1}.text-6xl{font-size:3.75rem;line-height:1}.text-\\[6px\\]{font-size:6px}.text-base{font-size:1rem;line-height:1.5rem}.text-lg{font-size:1.125rem;line-height:1.75rem}.text-sm{font-size:.875rem;line-height:1.25rem}.text-xl{font-size:1.25rem;line-height:1.75rem}.text-xs{font-size:.75rem;line-height:1rem}.font-bold{font-weight:700}.font-extrabold{font-weight:800}.font-medium{font-weight:500}.font-semibold{font-weight:600}.uppercase{text-transform:uppercase}.capitalize{text-transform:capitalize}.italic{font-style:italic}.leading-5{line-height:1.25rem}.leading-relaxed{line-height:1.625}.leading-tight{line-height:1.25}.tracking-tight{letter-spacing:-.025em}.tracking-wide{letter-spacing:.025em}.tracking-wider{letter-spacing:.05em}.tracking-widest{letter-spacing:.1em}.text-amber-100{--tw-text-opacity:1;color:rgb(254 243 199/var(--tw-text-opacity,1))}.text-amber-500{--tw-text-opacity:1;color:rgb(245 158 11/var(--tw-text-opacity,1))}.text-amber-600{--tw-text-opacity:1;color:rgb(217 119 6/var(--tw-text-opacity,1))}.text-amber-700{--tw-text-opacity:1;color:rgb(180 83 9/var(--tw-text-opacity,1))}.text-amber-800{--tw-text-opacity:1;color:rgb(146 64 14/var(--tw-text-opacity,1))}.text-amber-900{--tw-text-opacity:1;color:rgb(120 53 15/var(--tw-text-opacity,1))}.text-blue-100{--tw-text-opacity:1;color:rgb(219 234 254/var(--tw-text-opacity,1))}.text-blue-300{--tw-text-opacity:1;color:rgb(147 197 253/var(--tw-text-opacity,1))}.text-blue-400{--tw-text-opacity:1;color:rgb(96 165 250/var(--tw-text-opacity,1))}.text-blue-500{--tw-text-opacity:1;color:rgb(59 130 246/var(--tw-text-opacity,1))}.text-blue-600{--tw-text-opacity:1;color:rgb(37 99 235/var(--tw-text-opacity,1))}.text-blue-700{--tw-text-opacity:1;color:rgb(29 78 216/var(--tw-text-opacity,1))}.text-blue-800{--tw-text-opacity:1;color:rgb(30 64 175/var(--tw-text-opacity,1))}.text-blue-900{--tw-text-opacity:1;color:rgb(30 58 138/var(--tw-text-opacity,1))}.text-cyan-400{--tw-text-opacity:1;color:rgb(34 211 238/var(--tw-text-opacity,1))}.text-cyan-600{--tw-text-opacity:1;color:rgb(8 145 178/var(--tw-text-opacity,1))}.text-emerald-100{--tw-text-opacity:1;color:rgb(209 250 229/var(--tw-text-opacity,1))}.text-emerald-400{--tw-text-opacity:1;color:rgb(52 211 153/var(--tw-text-opacity,1))}.text-emerald-500{--tw-text-opacity:1;color:rgb(16 185 129/var(--tw-text-opacity,1))}.text-emerald-600{--tw-text-opacity:1;color:rgb(5 150 105/var(--tw-text-opacity,1))}.text-emerald-700{--tw-text-opacity:1;color:rgb(4 120 87/var(--tw-text-opacity,1))}.text-fuchsia-400{--tw-text-opacity:1;color:rgb(232 121 249/var(--tw-text-opacity,1))}.text-fuchsia-500{--tw-text-opacity:1;color:rgb(217 70 239/var(--tw-text-opacity,1))}.text-fuchsia-600{--tw-text-opacity:1;color:rgb(192 38 211/var(--tw-text-opacity,1))}.text-gray-300{--tw-text-opacity:1;color:rgb(209 213 219/var(--tw-text-opacity,1))}.text-gray-400{--tw-text-opacity:1;color:rgb(156 163 175/var(--tw-text-opacity,1))}.text-gray-500{--tw-text-opacity:1;color:rgb(107 114 128/var(--tw-text-opacity,1))}.text-gray-600{--tw-text-opacity:1;color:rgb(75 85 99/var(--tw-text-opacity,1))}.text-gray-700{--tw-text-opacity:1;color:rgb(55 65 81/var(--tw-text-opacity,1))}.text-gray-800{--tw-text-opacity:1;color:rgb(31 41 55/var(--tw-text-opacity,1))}.text-gray-900{--tw-text-opacity:1;color:rgb(17 24 39/var(--tw-text-opacity,1))}.text-green-100{--tw-text-opacity:1;color:rgb(220 252 231/var(--tw-text-opacity,1))}.text-green-300{--tw-text-opacity:1;color:rgb(134 239 172/var(--tw-text-opacity,1))}.text-green-400{--tw-text-opacity:1;color:rgb(74 222 128/var(--tw-text-opacity,1))}.text-green-500{--tw-text-opacity:1;color:rgb(34 197 94/var(--tw-text-opacity,1))}.text-green-600{--tw-text-opacity:1;color:rgb(22 163 74/var(--tw-text-opacity,1))}.text-green-700{--tw-text-opacity:1;color:rgb(21 128 61/var(--tw-text-opacity,1))}.text-green-800{--tw-text-opacity:1;color:rgb(22 101 52/var(--tw-text-opacity,1))}.text-green-900{--tw-text-opacity:1;color:rgb(20 83 45/var(--tw-text-opacity,1))}.text-indigo-100{--tw-text-opacity:1;color:rgb(224 231 255/var(--tw-text-opacity,1))}.text-indigo-300{--tw-text-opacity:1;color:rgb(165 180 252/var(--tw-text-opacity,1))}.text-indigo-400{--tw-text-opacity:1;color:rgb(129 140 248/var(--tw-text-opacity,1))}.text-indigo-500{--tw-text-opacity:1;color:rgb(99 102 241/var(--tw-text-opacity,1))}.text-indigo-600{--tw-text-opacity:1;color:rgb(79 70 229/var(--tw-text-opacity,1))}.text-indigo-700{--tw-text-opacity:1;color:rgb(67 56 202/var(--tw-text-opacity,1))}.text-indigo-800{--tw-text-opacity:1;color:rgb(55 48 163/var(--tw-text-opacity,1))}.text-orange-400{--tw-text-opacity:1;color:rgb(251 146 60/var(--tw-text-opacity,1))}.text-orange-500{--tw-text-opacity:1;color:rgb(249 115 22/var(--tw-text-opacity,1))}.text-orange-600{--tw-text-opacity:1;color:rgb(234 88 12/var(--tw-text-opacity,1))}.text-orange-700{--tw-text-opacity:1;color:rgb(194 65 12/var(--tw-text-opacity,1))}.text-orange-800{--tw-text-opacity:1;color:rgb(154 52 18/var(--tw-text-opacity,1))}.text-pink-100{--tw-text-opacity:1;color:rgb(252 231 243/var(--tw-text-opacity,1))}.text-pink-300{--tw-text-opacity:1;color:rgb(249 168 212/var(--tw-text-opacity,1))}.text-pink-400{--tw-text-opacity:1;color:rgb(244 114 182/var(--tw-text-opacity,1))}.text-pink-500{--tw-text-opacity:1;color:rgb(236 72 153/var(--tw-text-opacity,1))}.text-pink-600{--tw-text-opacity:1;color:rgb(219 39 119/var(--tw-text-opacity,1))}.text-pink-700{--tw-text-opacity:1;color:rgb(190 24 93/var(--tw-text-opacity,1))}.text-purple-100{--tw-text-opacity:1;color:rgb(243 232 255/var(--tw-text-opacity,1))}.text-purple-200{--tw-text-opacity:1;color:rgb(233 213 255/var(--tw-text-opacity,1))}.text-purple-300{--tw-text-opacity:1;color:rgb(216 180 254/var(--tw-text-opacity,1))}.text-purple-400{--tw-text-opacity:1;color:rgb(192 132 252/var(--tw-text-opacity,1))}.text-purple-500{--tw-text-opacity:1;color:rgb(168 85 247/var(--tw-text-opacity,1))}.text-purple-600{--tw-text-opacity:1;color:rgb(147 51 234/var(--tw-text-opacity,1))}.text-purple-700{--tw-text-opacity:1;color:rgb(126 34 206/var(--tw-text-opacity,1))}.text-purple-800{--tw-text-opacity:1;color:rgb(107 33 168/var(--tw-text-opacity,1))}.text-purple-900{--tw-text-opacity:1;color:rgb(88 28 135/var(--tw-text-opacity,1))}.text-red-200{--tw-text-opacity:1;color:rgb(254 202 202/var(--tw-text-opacity,1))}.text-red-400{--tw-text-opacity:1;color:rgb(248 113 113/var(--tw-text-opacity,1))}.text-red-500{--tw-text-opacity:1;color:rgb(239 68 68/var(--tw-text-opacity,1))}.text-red-600{--tw-text-opacity:1;color:rgb(220 38 38/var(--tw-text-opacity,1))}.text-red-700{--tw-text-opacity:1;color:rgb(185 28 28/var(--tw-text-opacity,1))}.text-red-800{--tw-text-opacity:1;color:rgb(153 27 27/var(--tw-text-opacity,1))}.text-teal-600{--tw-text-opacity:1;color:rgb(13 148 136/var(--tw-text-opacity,1))}.text-teal-700{--tw-text-opacity:1;color:rgb(15 118 110/var(--tw-text-opacity,1))}.text-teal-800{--tw-text-opacity:1;color:rgb(17 94 89/var(--tw-text-opacity,1))}.text-violet-500{--tw-text-opacity:1;color:rgb(139 92 246/var(--tw-text-opacity,1))}.text-violet-600{--tw-text-opacity:1;color:rgb(124 58 237/var(--tw-text-opacity,1))}.text-white{--tw-text-opacity:1;color:rgb(255 255 255/var(--tw-text-opacity,1))}.text-white\\/70{color:hsla(0,0%,100%,.7)}.text-white\\/80{color:hsla(0,0%,100%,.8)}.text-white\\/90{color:hsla(0,0%,100%,.9)}.text-yellow-100{--tw-text-opacity:1;color:rgb(254 249 195/var(--tw-text-opacity,1))}.text-yellow-300{--tw-text-opacity:1;color:rgb(253 224 71/var(--tw-text-opacity,1))}.text-yellow-400{--tw-text-opacity:1;color:rgb(250 204 21/var(--tw-text-opacity,1))}.text-yellow-500{--tw-text-opacity:1;color:rgb(234 179 8/var(--tw-text-opacity,1))}.text-yellow-600{--tw-text-opacity:1;color:rgb(202 138 4/var(--tw-text-opacity,1))}.text-yellow-700{--tw-text-opacity:1;color:rgb(161 98 7/var(--tw-text-opacity,1))}.text-yellow-800{--tw-text-opacity:1;color:rgb(133 77 14/var(--tw-text-opacity,1))}.text-yellow-900{--tw-text-opacity:1;color:rgb(113 63 18/var(--tw-text-opacity,1))}.underline{text-decoration-line:underline}.antialiased{-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}.placeholder-gray-400::-moz-placeholder{--tw-placeholder-opacity:1;color:rgb(156 163 175/var(--tw-placeholder-opacity,1))}.placeholder-gray-400::placeholder{--tw-placeholder-opacity:1;color:rgb(156 163 175/var(--tw-placeholder-opacity,1))}.placeholder-gray-500::-moz-placeholder{--tw-placeholder-opacity:1;color:rgb(107 114 128/var(--tw-placeholder-opacity,1))}.placeholder-gray-500::placeholder{--tw-placeholder-opacity:1;color:rgb(107 114 128/var(--tw-placeholder-opacity,1))}.placeholder-white\\/50::-moz-placeholder{color:hsla(0,0%,100%,.5)}.placeholder-white\\/50::placeholder{color:hsla(0,0%,100%,.5)}.opacity-0{opacity:0}.opacity-10{opacity:.1}.opacity-100{opacity:1}.opacity-20{opacity:.2}.opacity-30{opacity:.3}.opacity-50{opacity:.5}.opacity-70{opacity:.7}.opacity-75{opacity:.75}.opacity-80{opacity:.8}.opacity-90{opacity:.9}.shadow{--tw-shadow:0 1px 3px 0 rgba(0,0,0,.1),0 1px 2px -1px rgba(0,0,0,.1);--tw-shadow-colored:0 1px 3px 0 var(--tw-shadow-color),0 1px 2px -1px var(--tw-shadow-color)}.shadow,.shadow-2xl{box-shadow:var(--tw-ring-offset-shadow,0 0 #0000),var(--tw-ring-shadow,0 0 #0000),var(--tw-shadow)}.shadow-2xl{--tw-shadow:0 25px 50px -12px rgba(0,0,0,.25);--tw-shadow-colored:0 25px 50px -12px var(--tw-shadow-color)}.shadow-lg{--tw-shadow:0 10px 15px -3px rgba(0,0,0,.1),0 4px 6px -4px rgba(0,0,0,.1);--tw-shadow-colored:0 10px 15px -3px var(--tw-shadow-color),0 4px 6px -4px var(--tw-shadow-color)}.shadow-lg,.shadow-md{box-shadow:var(--tw-ring-offset-shadow,0 0 #0000),var(--tw-ring-shadow,0 0 #0000),var(--tw-shadow)}.shadow-md{--tw-shadow:0 4px 6px -1px rgba(0,0,0,.1),0 2px 4px -2px rgba(0,0,0,.1);--tw-shadow-colored:0 4px 6px -1px var(--tw-shadow-color),0 2px 4px -2px var(--tw-shadow-color)}.shadow-sm{--tw-shadow:0 1px 2px 0 rgba(0,0,0,.05);--tw-shadow-colored:0 1px 2px 0 var(--tw-shadow-color)}.shadow-sm,.shadow-xl{box-shadow:var(--tw-ring-offset-shadow,0 0 #0000),var(--tw-ring-shadow,0 0 #0000),var(--tw-shadow)}.shadow-xl{--tw-shadow:0 20px 25px -5px rgba(0,0,0,.1),0 8px 10px -6px rgba(0,0,0,.1);--tw-shadow-colored:0 20px 25px -5px var(--tw-shadow-color),0 8px 10px -6px var(--tw-shadow-color)}.shadow-blue-200{--tw-shadow-color:#bfdbfe;--tw-shadow:var(--tw-shadow-colored)}.shadow-fuchsia-500\\/30{--tw-shadow-color:rgba(217,70,239,.3);--tw-shadow:var(--tw-shadow-colored)}.shadow-fuchsia-500\\/50{--tw-shadow-color:rgba(217,70,239,.5);--tw-shadow:var(--tw-shadow-colored)}.shadow-green-200{--tw-shadow-color:#bbf7d0;--tw-shadow:var(--tw-shadow-colored)}.shadow-orange-200{--tw-shadow-color:#fed7aa;--tw-shadow:var(--tw-shadow-colored)}.shadow-pink-500\\/30{--tw-shadow-color:rgba(236,72,153,.3);--tw-shadow:var(--tw-shadow-colored)}.shadow-pink-500\\/50{--tw-shadow-color:rgba(236,72,153,.5);--tw-shadow:var(--tw-shadow-colored)}.shadow-purple-200{--tw-shadow-color:#e9d5ff;--tw-shadow:var(--tw-shadow-colored)}.shadow-purple-500\\/30{--tw-shadow-color:rgba(168,85,247,.3);--tw-shadow:var(--tw-shadow-colored)}.shadow-purple-500\\/50{--tw-shadow-color:rgba(168,85,247,.5);--tw-shadow:var(--tw-shadow-colored)}.shadow-violet-500\\/30{--tw-shadow-color:rgba(139,92,246,.3);--tw-shadow:var(--tw-shadow-colored)}.shadow-violet-500\\/50{--tw-shadow-color:rgba(139,92,246,.5);--tw-shadow:var(--tw-shadow-colored)}.shadow-white\\/20{--tw-shadow-color:hsla(0,0%,100%,.2);--tw-shadow:var(--tw-shadow-colored)}.outline-none{outline:2px solid transparent;outline-offset:2px}.outline{outline-style:solid}.ring-1{--tw-ring-offset-shadow:var(--tw-ring-inset) 0 0 0 var(--tw-ring-offset-width) var(--tw-ring-offset-color);--tw-ring-shadow:var(--tw-ring-inset) 0 0 0 calc(1px + var(--tw-ring-offset-width)) var(--tw-ring-color)}.ring-1,.ring-2{box-shadow:var(--tw-ring-offset-shadow),var(--tw-ring-shadow),var(--tw-shadow,0 0 #0000)}.ring-2{--tw-ring-offset-shadow:var(--tw-ring-inset) 0 0 0 var(--tw-ring-offset-width) var(--tw-ring-offset-color);--tw-ring-shadow:var(--tw-ring-inset) 0 0 0 calc(2px + var(--tw-ring-offset-width)) var(--tw-ring-color)}.ring-black{--tw-ring-opacity:1;--tw-ring-color:rgb(0 0 0/var(--tw-ring-opacity,1))}.ring-blue-400{--tw-ring-opacity:1;--tw-ring-color:rgb(96 165 250/var(--tw-ring-opacity,1))}.ring-emerald-400{--tw-ring-opacity:1;--tw-ring-color:rgb(52 211 153/var(--tw-ring-opacity,1))}.ring-indigo-500{--tw-ring-opacity:1;--tw-ring-color:rgb(99 102 241/var(--tw-ring-opacity,1))}.ring-orange-500{--tw-ring-opacity:1;--tw-ring-color:rgb(249 115 22/var(--tw-ring-opacity,1))}.ring-purple-400{--tw-ring-opacity:1;--tw-ring-color:rgb(192 132 252/var(--tw-ring-opacity,1))}.ring-opacity-5{--tw-ring-opacity:0.05}.blur{--tw-blur:blur(8px)}.blur,.grayscale{filter:var(--tw-blur) var(--tw-brightness) var(--tw-contrast) var(--tw-grayscale) var(--tw-hue-rotate) var(--tw-invert) var(--tw-saturate) var(--tw-sepia) var(--tw-drop-shadow)}.grayscale{--tw-grayscale:grayscale(100%)}.filter{filter:var(--tw-blur) var(--tw-brightness) var(--tw-contrast) var(--tw-grayscale) var(--tw-hue-rotate) var(--tw-invert) var(--tw-saturate) var(--tw-sepia) var(--tw-drop-shadow)}.backdrop-blur-lg{--tw-backdrop-blur:blur(16px)}.backdrop-blur-lg,.backdrop-blur-md{-webkit-backdrop-filter:var(--tw-backdrop-blur) var(--tw-backdrop-brightness) var(--tw-backdrop-contrast) var(--tw-backdrop-grayscale) var(--tw-backdrop-hue-rotate) var(--tw-backdrop-invert) var(--tw-backdrop-opacity) var(--tw-backdrop-saturate) var(--tw-backdrop-sepia);backdrop-filter:var(--tw-backdrop-blur) var(--tw-backdrop-brightness) var(--tw-backdrop-contrast) var(--tw-backdrop-grayscale) var(--tw-backdrop-hue-rotate) var(--tw-backdrop-invert) var(--tw-backdrop-opacity) var(--tw-backdrop-saturate) var(--tw-backdrop-sepia)}.backdrop-blur-md{--tw-backdrop-blur:blur(12px)}.backdrop-blur-sm{--tw-backdrop-blur:blur(4px)}.backdrop-blur-sm,.backdrop-filter{-webkit-backdrop-filter:var(--tw-backdrop-blur) var(--tw-backdrop-brightness) var(--tw-backdrop-contrast) var(--tw-backdrop-grayscale) var(--tw-backdrop-hue-rotate) var(--tw-backdrop-invert) var(--tw-backdrop-opacity) var(--tw-backdrop-saturate) var(--tw-backdrop-sepia);backdrop-filter:var(--tw-backdrop-blur) var(--tw-backdrop-brightness) var(--tw-backdrop-contrast) var(--tw-backdrop-grayscale) var(--tw-backdrop-hue-rotate) var(--tw-backdrop-invert) var(--tw-backdrop-opacity) var(--tw-backdrop-saturate) var(--tw-backdrop-sepia)}.transition{transition-property:color,background-color,border-color,text-decoration-color,fill,stroke,opacity,box-shadow,transform,filter,-webkit-backdrop-filter;transition-property:color,background-color,border-color,text-decoration-color,fill,stroke,opacity,box-shadow,transform,filter,backdrop-filter;transition-property:color,background-color,border-color,text-decoration-color,fill,stroke,opacity,box-shadow,transform,filter,backdrop-filter,-webkit-backdrop-filter;transition-timing-function:cubic-bezier(.4,0,.2,1);transition-duration:.15s}.transition-all{transition-property:all;transition-timing-function:cubic-bezier(.4,0,.2,1);transition-duration:.15s}.transition-colors{transition-property:color,background-color,border-color,text-decoration-color,fill,stroke;transition-timing-function:cubic-bezier(.4,0,.2,1);transition-duration:.15s}.transition-opacity{transition-property:opacity;transition-timing-function:cubic-bezier(.4,0,.2,1);transition-duration:.15s}.transition-shadow{transition-property:box-shadow;transition-timing-function:cubic-bezier(.4,0,.2,1);transition-duration:.15s}.transition-transform{transition-property:transform;transition-timing-function:cubic-bezier(.4,0,.2,1);transition-duration:.15s}.delay-100{transition-delay:.1s}.delay-200{transition-delay:.2s}.delay-300{transition-delay:.3s}.duration-1000{transition-duration:1s}.duration-150{transition-duration:.15s}.duration-200{transition-duration:.2s}.duration-300{transition-duration:.3s}.duration-500{transition-duration:.5s}.ease-in{transition-timing-function:cubic-bezier(.4,0,1,1)}.ease-in-out{transition-timing-function:cubic-bezier(.4,0,.2,1)}.ease-out{transition-timing-function:cubic-bezier(0,0,.2,1)}.file\\:mr-4::file-selector-button{margin-right:1rem}.file\\:rounded-lg::file-selector-button{border-radius:.5rem}.file\\:border-0::file-selector-button{border-width:0}.file\\:bg-indigo-50::file-selector-button{--tw-bg-opacity:1;background-color:rgb(238 242 255/var(--tw-bg-opacity,1))}.file\\:bg-orange-50::file-selector-button{--tw-bg-opacity:1;background-color:rgb(255 247 237/var(--tw-bg-opacity,1))}.file\\:px-4::file-selector-button{padding-left:1rem;padding-right:1rem}.file\\:py-2::file-selector-button{padding-top:.5rem;padding-bottom:.5rem}.file\\:text-sm::file-selector-button{font-size:.875rem;line-height:1.25rem}.file\\:font-medium::file-selector-button{font-weight:500}.file\\:font-semibold::file-selector-button{font-weight:600}.file\\:text-indigo-700::file-selector-button{--tw-text-opacity:1;color:rgb(67 56 202/var(--tw-text-opacity,1))}.file\\:text-orange-700::file-selector-button{--tw-text-opacity:1;color:rgb(194 65 12/var(--tw-text-opacity,1))}.after\\:absolute:after{content:var(--tw-content);position:absolute}.after\\:left-\\[2px\\]:after{content:var(--tw-content);left:2px}.after\\:top-\\[2px\\]:after{content:var(--tw-content);top:2px}.after\\:h-5:after{content:var(--tw-content);height:1.25rem}.after\\:w-5:after{content:var(--tw-content);width:1.25rem}.after\\:rounded-full:after{content:var(--tw-content);border-radius:9999px}.after\\:border:after{content:var(--tw-content);border-width:1px}.after\\:border-gray-300:after{content:var(--tw-content);--tw-border-opacity:1;border-color:rgb(209 213 219/var(--tw-border-opacity,1))}.after\\:bg-white:after{content:var(--tw-content);--tw-bg-opacity:1;background-color:rgb(255 255 255/var(--tw-bg-opacity,1))}.after\\:transition-all:after{content:var(--tw-content);transition-property:all;transition-timing-function:cubic-bezier(.4,0,.2,1);transition-duration:.15s}.after\\:content-\\[\\'\\'\\]:after{--tw-content:\"\";content:var(--tw-content)}.last\\:border-0:last-child{border-width:0}.hover\\:-translate-y-0\\.5:hover{--tw-translate-y:-0.125rem}.hover\\:-translate-y-0\\.5:hover,.hover\\:rotate-0:hover{transform:translate(var(--tw-translate-x),var(--tw-translate-y)) rotate(var(--tw-rotate)) skewX(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y))}.hover\\:rotate-0:hover{--tw-rotate:0deg}.hover\\:scale-105:hover{--tw-scale-x:1.05;--tw-scale-y:1.05}.hover\\:scale-105:hover,.hover\\:scale-110:hover{transform:translate(var(--tw-translate-x),var(--tw-translate-y)) rotate(var(--tw-rotate)) skewX(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y))}.hover\\:scale-110:hover{--tw-scale-x:1.1;--tw-scale-y:1.1}.hover\\:scale-\\[1\\.02\\]:hover{--tw-scale-x:1.02;--tw-scale-y:1.02;transform:translate(var(--tw-translate-x),var(--tw-translate-y)) rotate(var(--tw-rotate)) skewX(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y))}.hover\\:border-amber-300:hover{--tw-border-opacity:1;border-color:rgb(252 211 77/var(--tw-border-opacity,1))}.hover\\:border-blue-300:hover{--tw-border-opacity:1;border-color:rgb(147 197 253/var(--tw-border-opacity,1))}.hover\\:border-blue-500:hover{--tw-border-opacity:1;border-color:rgb(59 130 246/var(--tw-border-opacity,1))}.hover\\:border-emerald-200:hover{--tw-border-opacity:1;border-color:rgb(167 243 208/var(--tw-border-opacity,1))}.hover\\:border-emerald-300:hover{--tw-border-opacity:1;border-color:rgb(110 231 183/var(--tw-border-opacity,1))}.hover\\:border-emerald-500:hover{--tw-border-opacity:1;border-color:rgb(16 185 129/var(--tw-border-opacity,1))}.hover\\:border-gray-300:hover{--tw-border-opacity:1;border-color:rgb(209 213 219/var(--tw-border-opacity,1))}.hover\\:border-gray-400:hover{--tw-border-opacity:1;border-color:rgb(156 163 175/var(--tw-border-opacity,1))}.hover\\:border-green-300:hover{--tw-border-opacity:1;border-color:rgb(134 239 172/var(--tw-border-opacity,1))}.hover\\:border-green-500:hover{--tw-border-opacity:1;border-color:rgb(34 197 94/var(--tw-border-opacity,1))}.hover\\:border-indigo-300:hover{--tw-border-opacity:1;border-color:rgb(165 180 252/var(--tw-border-opacity,1))}.hover\\:border-indigo-400:hover{--tw-border-opacity:1;border-color:rgb(129 140 248/var(--tw-border-opacity,1))}.hover\\:border-orange-400:hover{--tw-border-opacity:1;border-color:rgb(251 146 60/var(--tw-border-opacity,1))}.hover\\:border-orange-500:hover{--tw-border-opacity:1;border-color:rgb(249 115 22/var(--tw-border-opacity,1))}.hover\\:border-pink-300:hover{--tw-border-opacity:1;border-color:rgb(249 168 212/var(--tw-border-opacity,1))}.hover\\:border-pink-500:hover{--tw-border-opacity:1;border-color:rgb(236 72 153/var(--tw-border-opacity,1))}.hover\\:border-purple-300:hover{--tw-border-opacity:1;border-color:rgb(216 180 254/var(--tw-border-opacity,1))}.hover\\:border-purple-400:hover{--tw-border-opacity:1;border-color:rgb(192 132 252/var(--tw-border-opacity,1))}.hover\\:border-purple-500:hover{--tw-border-opacity:1;border-color:rgb(168 85 247/var(--tw-border-opacity,1))}.hover\\:border-red-500:hover{--tw-border-opacity:1;border-color:rgb(239 68 68/var(--tw-border-opacity,1))}.hover\\:bg-amber-50:hover{--tw-bg-opacity:1;background-color:rgb(255 251 235/var(--tw-bg-opacity,1))}.hover\\:bg-blue-100:hover{--tw-bg-opacity:1;background-color:rgb(219 234 254/var(--tw-bg-opacity,1))}.hover\\:bg-blue-50:hover{--tw-bg-opacity:1;background-color:rgb(239 246 255/var(--tw-bg-opacity,1))}.hover\\:bg-blue-600:hover{--tw-bg-opacity:1;background-color:rgb(37 99 235/var(--tw-bg-opacity,1))}.hover\\:bg-blue-700:hover{--tw-bg-opacity:1;background-color:rgb(29 78 216/var(--tw-bg-opacity,1))}.hover\\:bg-emerald-100:hover{--tw-bg-opacity:1;background-color:rgb(209 250 229/var(--tw-bg-opacity,1))}.hover\\:bg-emerald-50:hover{--tw-bg-opacity:1;background-color:rgb(236 253 245/var(--tw-bg-opacity,1))}.hover\\:bg-emerald-500:hover{--tw-bg-opacity:1;background-color:rgb(16 185 129/var(--tw-bg-opacity,1))}.hover\\:bg-emerald-600:hover{--tw-bg-opacity:1;background-color:rgb(5 150 105/var(--tw-bg-opacity,1))}.hover\\:bg-emerald-700:hover{--tw-bg-opacity:1;background-color:rgb(4 120 87/var(--tw-bg-opacity,1))}.hover\\:bg-gray-100:hover{--tw-bg-opacity:1;background-color:rgb(243 244 246/var(--tw-bg-opacity,1))}.hover\\:bg-gray-200:hover{--tw-bg-opacity:1;background-color:rgb(229 231 235/var(--tw-bg-opacity,1))}.hover\\:bg-gray-300:hover{--tw-bg-opacity:1;background-color:rgb(209 213 219/var(--tw-bg-opacity,1))}.hover\\:bg-gray-50:hover{--tw-bg-opacity:1;background-color:rgb(249 250 251/var(--tw-bg-opacity,1))}.hover\\:bg-gray-700:hover{--tw-bg-opacity:1;background-color:rgb(55 65 81/var(--tw-bg-opacity,1))}.hover\\:bg-gray-800:hover{--tw-bg-opacity:1;background-color:rgb(31 41 55/var(--tw-bg-opacity,1))}.hover\\:bg-green-100:hover{--tw-bg-opacity:1;background-color:rgb(220 252 231/var(--tw-bg-opacity,1))}.hover\\:bg-green-200:hover{--tw-bg-opacity:1;background-color:rgb(187 247 208/var(--tw-bg-opacity,1))}.hover\\:bg-green-50:hover{--tw-bg-opacity:1;background-color:rgb(240 253 244/var(--tw-bg-opacity,1))}.hover\\:bg-green-600:hover{--tw-bg-opacity:1;background-color:rgb(22 163 74/var(--tw-bg-opacity,1))}.hover\\:bg-green-700:hover{--tw-bg-opacity:1;background-color:rgb(21 128 61/var(--tw-bg-opacity,1))}.hover\\:bg-indigo-100:hover{--tw-bg-opacity:1;background-color:rgb(224 231 255/var(--tw-bg-opacity,1))}.hover\\:bg-indigo-50:hover{--tw-bg-opacity:1;background-color:rgb(238 242 255/var(--tw-bg-opacity,1))}.hover\\:bg-indigo-700:hover{--tw-bg-opacity:1;background-color:rgb(67 56 202/var(--tw-bg-opacity,1))}.hover\\:bg-orange-100:hover{--tw-bg-opacity:1;background-color:rgb(255 237 213/var(--tw-bg-opacity,1))}.hover\\:bg-orange-50:hover{--tw-bg-opacity:1;background-color:rgb(255 247 237/var(--tw-bg-opacity,1))}.hover\\:bg-orange-600:hover{--tw-bg-opacity:1;background-color:rgb(234 88 12/var(--tw-bg-opacity,1))}.hover\\:bg-orange-700:hover{--tw-bg-opacity:1;background-color:rgb(194 65 12/var(--tw-bg-opacity,1))}.hover\\:bg-pink-50:hover{--tw-bg-opacity:1;background-color:rgb(253 242 248/var(--tw-bg-opacity,1))}.hover\\:bg-pink-500:hover{--tw-bg-opacity:1;background-color:rgb(236 72 153/var(--tw-bg-opacity,1))}.hover\\:bg-pink-500\\/10:hover{background-color:rgba(236,72,153,.1)}.hover\\:bg-pink-600:hover{--tw-bg-opacity:1;background-color:rgb(219 39 119/var(--tw-bg-opacity,1))}.hover\\:bg-purple-100:hover{--tw-bg-opacity:1;background-color:rgb(243 232 255/var(--tw-bg-opacity,1))}.hover\\:bg-purple-200:hover{--tw-bg-opacity:1;background-color:rgb(233 213 255/var(--tw-bg-opacity,1))}.hover\\:bg-purple-50:hover{--tw-bg-opacity:1;background-color:rgb(250 245 255/var(--tw-bg-opacity,1))}.hover\\:bg-purple-600:hover{--tw-bg-opacity:1;background-color:rgb(147 51 234/var(--tw-bg-opacity,1))}.hover\\:bg-purple-700:hover{--tw-bg-opacity:1;background-color:rgb(126 34 206/var(--tw-bg-opacity,1))}.hover\\:bg-red-100:hover{--tw-bg-opacity:1;background-color:rgb(254 226 226/var(--tw-bg-opacity,1))}.hover\\:bg-red-50:hover{--tw-bg-opacity:1;background-color:rgb(254 242 242/var(--tw-bg-opacity,1))}.hover\\:bg-red-500\\/20:hover{background-color:rgba(239,68,68,.2)}.hover\\:bg-red-600:hover{--tw-bg-opacity:1;background-color:rgb(220 38 38/var(--tw-bg-opacity,1))}.hover\\:bg-red-700:hover{--tw-bg-opacity:1;background-color:rgb(185 28 28/var(--tw-bg-opacity,1))}.hover\\:bg-teal-700:hover{--tw-bg-opacity:1;background-color:rgb(15 118 110/var(--tw-bg-opacity,1))}.hover\\:bg-white:hover{--tw-bg-opacity:1;background-color:rgb(255 255 255/var(--tw-bg-opacity,1))}.hover\\:bg-white\\/10:hover{background-color:hsla(0,0%,100%,.1)}.hover\\:bg-white\\/30:hover{background-color:hsla(0,0%,100%,.3)}.hover\\:bg-white\\/5:hover{background-color:hsla(0,0%,100%,.05)}.hover\\:bg-yellow-100:hover{--tw-bg-opacity:1;background-color:rgb(254 249 195/var(--tw-bg-opacity,1))}.hover\\:bg-gradient-to-r:hover{background-image:linear-gradient(to right,var(--tw-gradient-stops))}.hover\\:from-blue-600:hover{--tw-gradient-from:#2563eb var(--tw-gradient-from-position);--tw-gradient-to:rgba(37,99,235,0) var(--tw-gradient-to-position);--tw-gradient-stops:var(--tw-gradient-from),var(--tw-gradient-to)}.hover\\:from-emerald-600:hover{--tw-gradient-from:#059669 var(--tw-gradient-from-position);--tw-gradient-to:rgba(5,150,105,0) var(--tw-gradient-to-position);--tw-gradient-stops:var(--tw-gradient-from),var(--tw-gradient-to)}.hover\\:from-orange-600:hover{--tw-gradient-from:#ea580c var(--tw-gradient-from-position);--tw-gradient-to:rgba(234,88,12,0) var(--tw-gradient-to-position);--tw-gradient-stops:var(--tw-gradient-from),var(--tw-gradient-to)}.hover\\:from-pink-500:hover{--tw-gradient-from:#ec4899 var(--tw-gradient-from-position);--tw-gradient-to:rgba(236,72,153,0) var(--tw-gradient-to-position);--tw-gradient-stops:var(--tw-gradient-from),var(--tw-gradient-to)}.hover\\:from-purple-600:hover{--tw-gradient-from:#9333ea var(--tw-gradient-from-position);--tw-gradient-to:rgba(147,51,234,0) var(--tw-gradient-to-position);--tw-gradient-stops:var(--tw-gradient-from),var(--tw-gradient-to)}.hover\\:from-purple-700:hover{--tw-gradient-from:#7e22ce var(--tw-gradient-from-position);--tw-gradient-to:rgba(126,34,206,0) var(--tw-gradient-to-position);--tw-gradient-stops:var(--tw-gradient-from),var(--tw-gradient-to)}.hover\\:from-yellow-500:hover{--tw-gradient-from:#eab308 var(--tw-gradient-from-position);--tw-gradient-to:rgba(234,179,8,0) var(--tw-gradient-to-position);--tw-gradient-stops:var(--tw-gradient-from),var(--tw-gradient-to)}.hover\\:to-blue-600:hover{--tw-gradient-to:#2563eb var(--tw-gradient-to-position)}.hover\\:to-blue-800:hover{--tw-gradient-to:#1e40af var(--tw-gradient-to-position)}.hover\\:to-indigo-700:hover{--tw-gradient-to:#4338ca var(--tw-gradient-to-position)}.hover\\:to-orange-500:hover{--tw-gradient-to:#f97316 var(--tw-gradient-to-position)}.hover\\:to-pink-600:hover{--tw-gradient-to:#db2777 var(--tw-gradient-to-position)}.hover\\:to-purple-500:hover{--tw-gradient-to:#a855f7 var(--tw-gradient-to-position)}.hover\\:to-teal-600:hover{--tw-gradient-to:#0d9488 var(--tw-gradient-to-position)}.hover\\:text-blue-600:hover{--tw-text-opacity:1;color:rgb(37 99 235/var(--tw-text-opacity,1))}.hover\\:text-blue-700:hover{--tw-text-opacity:1;color:rgb(29 78 216/var(--tw-text-opacity,1))}.hover\\:text-blue-800:hover{--tw-text-opacity:1;color:rgb(30 64 175/var(--tw-text-opacity,1))}.hover\\:text-blue-900:hover{--tw-text-opacity:1;color:rgb(30 58 138/var(--tw-text-opacity,1))}.hover\\:text-emerald-600:hover{--tw-text-opacity:1;color:rgb(5 150 105/var(--tw-text-opacity,1))}.hover\\:text-emerald-700:hover{--tw-text-opacity:1;color:rgb(4 120 87/var(--tw-text-opacity,1))}.hover\\:text-emerald-900:hover{--tw-text-opacity:1;color:rgb(6 78 59/var(--tw-text-opacity,1))}.hover\\:text-fuchsia-700:hover{--tw-text-opacity:1;color:rgb(162 28 175/var(--tw-text-opacity,1))}.hover\\:text-gray-200:hover{--tw-text-opacity:1;color:rgb(229 231 235/var(--tw-text-opacity,1))}.hover\\:text-gray-500:hover{--tw-text-opacity:1;color:rgb(107 114 128/var(--tw-text-opacity,1))}.hover\\:text-gray-600:hover{--tw-text-opacity:1;color:rgb(75 85 99/var(--tw-text-opacity,1))}.hover\\:text-gray-700:hover{--tw-text-opacity:1;color:rgb(55 65 81/var(--tw-text-opacity,1))}.hover\\:text-gray-900:hover{--tw-text-opacity:1;color:rgb(17 24 39/var(--tw-text-opacity,1))}.hover\\:text-green-600:hover{--tw-text-opacity:1;color:rgb(22 163 74/var(--tw-text-opacity,1))}.hover\\:text-green-700:hover{--tw-text-opacity:1;color:rgb(21 128 61/var(--tw-text-opacity,1))}.hover\\:text-green-800:hover{--tw-text-opacity:1;color:rgb(22 101 52/var(--tw-text-opacity,1))}.hover\\:text-indigo-500:hover{--tw-text-opacity:1;color:rgb(99 102 241/var(--tw-text-opacity,1))}.hover\\:text-indigo-600:hover{--tw-text-opacity:1;color:rgb(79 70 229/var(--tw-text-opacity,1))}.hover\\:text-indigo-700:hover{--tw-text-opacity:1;color:rgb(67 56 202/var(--tw-text-opacity,1))}.hover\\:text-indigo-800:hover{--tw-text-opacity:1;color:rgb(55 48 163/var(--tw-text-opacity,1))}.hover\\:text-indigo-900:hover{--tw-text-opacity:1;color:rgb(49 46 129/var(--tw-text-opacity,1))}.hover\\:text-orange-600:hover{--tw-text-opacity:1;color:rgb(234 88 12/var(--tw-text-opacity,1))}.hover\\:text-orange-700:hover{--tw-text-opacity:1;color:rgb(194 65 12/var(--tw-text-opacity,1))}.hover\\:text-orange-900:hover{--tw-text-opacity:1;color:rgb(124 45 18/var(--tw-text-opacity,1))}.hover\\:text-pink-400:hover{--tw-text-opacity:1;color:rgb(244 114 182/var(--tw-text-opacity,1))}.hover\\:text-pink-600:hover{--tw-text-opacity:1;color:rgb(219 39 119/var(--tw-text-opacity,1))}.hover\\:text-pink-700:hover{--tw-text-opacity:1;color:rgb(190 24 93/var(--tw-text-opacity,1))}.hover\\:text-purple-500:hover{--tw-text-opacity:1;color:rgb(168 85 247/var(--tw-text-opacity,1))}.hover\\:text-purple-600:hover{--tw-text-opacity:1;color:rgb(147 51 234/var(--tw-text-opacity,1))}.hover\\:text-purple-700:hover{--tw-text-opacity:1;color:rgb(126 34 206/var(--tw-text-opacity,1))}.hover\\:text-red-400:hover{--tw-text-opacity:1;color:rgb(248 113 113/var(--tw-text-opacity,1))}.hover\\:text-red-500:hover{--tw-text-opacity:1;color:rgb(239 68 68/var(--tw-text-opacity,1))}.hover\\:text-red-600:hover{--tw-text-opacity:1;color:rgb(220 38 38/var(--tw-text-opacity,1))}.hover\\:text-red-700:hover{--tw-text-opacity:1;color:rgb(185 28 28/var(--tw-text-opacity,1))}.hover\\:text-red-800:hover{--tw-text-opacity:1;color:rgb(153 27 27/var(--tw-text-opacity,1))}.hover\\:text-red-900:hover{--tw-text-opacity:1;color:rgb(127 29 29/var(--tw-text-opacity,1))}.hover\\:text-teal-700:hover{--tw-text-opacity:1;color:rgb(15 118 110/var(--tw-text-opacity,1))}.hover\\:text-violet-700:hover{--tw-text-opacity:1;color:rgb(109 40 217/var(--tw-text-opacity,1))}.hover\\:text-white:hover{--tw-text-opacity:1;color:rgb(255 255 255/var(--tw-text-opacity,1))}.hover\\:text-yellow-700:hover{--tw-text-opacity:1;color:rgb(161 98 7/var(--tw-text-opacity,1))}.hover\\:underline:hover{text-decoration-line:underline}.hover\\:opacity-80:hover{opacity:.8}.hover\\:opacity-90:hover{opacity:.9}.hover\\:shadow-2xl:hover{--tw-shadow:0 25px 50px -12px rgba(0,0,0,.25);--tw-shadow-colored:0 25px 50px -12px var(--tw-shadow-color)}.hover\\:shadow-2xl:hover,.hover\\:shadow-lg:hover{box-shadow:var(--tw-ring-offset-shadow,0 0 #0000),var(--tw-ring-shadow,0 0 #0000),var(--tw-shadow)}.hover\\:shadow-lg:hover{--tw-shadow:0 10px 15px -3px rgba(0,0,0,.1),0 4px 6px -4px rgba(0,0,0,.1);--tw-shadow-colored:0 10px 15px -3px var(--tw-shadow-color),0 4px 6px -4px var(--tw-shadow-color)}.hover\\:shadow-md:hover{--tw-shadow:0 4px 6px -1px rgba(0,0,0,.1),0 2px 4px -2px rgba(0,0,0,.1);--tw-shadow-colored:0 4px 6px -1px var(--tw-shadow-color),0 2px 4px -2px var(--tw-shadow-color)}.hover\\:shadow-md:hover,.hover\\:shadow-sm:hover{box-shadow:var(--tw-ring-offset-shadow,0 0 #0000),var(--tw-ring-shadow,0 0 #0000),var(--tw-shadow)}.hover\\:shadow-sm:hover{--tw-shadow:0 1px 2px 0 rgba(0,0,0,.05);--tw-shadow-colored:0 1px 2px 0 var(--tw-shadow-color)}.hover\\:shadow-xl:hover{--tw-shadow:0 20px 25px -5px rgba(0,0,0,.1),0 8px 10px -6px rgba(0,0,0,.1);--tw-shadow-colored:0 20px 25px -5px var(--tw-shadow-color),0 8px 10px -6px var(--tw-shadow-color);box-shadow:var(--tw-ring-offset-shadow,0 0 #0000),var(--tw-ring-shadow,0 0 #0000),var(--tw-shadow)}.hover\\:file\\:bg-indigo-100::file-selector-button:hover{--tw-bg-opacity:1;background-color:rgb(224 231 255/var(--tw-bg-opacity,1))}.hover\\:file\\:bg-orange-100::file-selector-button:hover{--tw-bg-opacity:1;background-color:rgb(255 237 213/var(--tw-bg-opacity,1))}.focus\\:border-blue-500:focus{--tw-border-opacity:1;border-color:rgb(59 130 246/var(--tw-border-opacity,1))}.focus\\:border-emerald-500:focus{--tw-border-opacity:1;border-color:rgb(16 185 129/var(--tw-border-opacity,1))}.focus\\:border-green-500:focus{--tw-border-opacity:1;border-color:rgb(34 197 94/var(--tw-border-opacity,1))}.focus\\:border-indigo-500:focus{--tw-border-opacity:1;border-color:rgb(99 102 241/var(--tw-border-opacity,1))}.focus\\:border-orange-500:focus{--tw-border-opacity:1;border-color:rgb(249 115 22/var(--tw-border-opacity,1))}.focus\\:border-pink-500:focus{--tw-border-opacity:1;border-color:rgb(236 72 153/var(--tw-border-opacity,1))}.focus\\:border-purple-500:focus{--tw-border-opacity:1;border-color:rgb(168 85 247/var(--tw-border-opacity,1))}.focus\\:border-transparent:focus{border-color:transparent}.focus\\:outline-none:focus{outline:2px solid transparent;outline-offset:2px}.focus\\:ring-1:focus{--tw-ring-offset-shadow:var(--tw-ring-inset) 0 0 0 var(--tw-ring-offset-width) var(--tw-ring-offset-color);--tw-ring-shadow:var(--tw-ring-inset) 0 0 0 calc(1px + var(--tw-ring-offset-width)) var(--tw-ring-color)}.focus\\:ring-1:focus,.focus\\:ring-2:focus{box-shadow:var(--tw-ring-offset-shadow),var(--tw-ring-shadow),var(--tw-shadow,0 0 #0000)}.focus\\:ring-2:focus{--tw-ring-offset-shadow:var(--tw-ring-inset) 0 0 0 var(--tw-ring-offset-width) var(--tw-ring-offset-color);--tw-ring-shadow:var(--tw-ring-inset) 0 0 0 calc(2px + var(--tw-ring-offset-width)) var(--tw-ring-color)}.focus\\:ring-inset:focus{--tw-ring-inset:inset}.focus\\:ring-blue-500:focus{--tw-ring-opacity:1;--tw-ring-color:rgb(59 130 246/var(--tw-ring-opacity,1))}.focus\\:ring-emerald-500:focus{--tw-ring-opacity:1;--tw-ring-color:rgb(16 185 129/var(--tw-ring-opacity,1))}.focus\\:ring-green-200:focus{--tw-ring-opacity:1;--tw-ring-color:rgb(187 247 208/var(--tw-ring-opacity,1))}.focus\\:ring-green-500:focus{--tw-ring-opacity:1;--tw-ring-color:rgb(34 197 94/var(--tw-ring-opacity,1))}.focus\\:ring-indigo-500:focus{--tw-ring-opacity:1;--tw-ring-color:rgb(99 102 241/var(--tw-ring-opacity,1))}.focus\\:ring-orange-500:focus{--tw-ring-opacity:1;--tw-ring-color:rgb(249 115 22/var(--tw-ring-opacity,1))}.focus\\:ring-pink-500:focus{--tw-ring-opacity:1;--tw-ring-color:rgb(236 72 153/var(--tw-ring-opacity,1))}.focus\\:ring-pink-500\\/20:focus{--tw-ring-color:rgba(236,72,153,.2)}.focus\\:ring-purple-200:focus{--tw-ring-opacity:1;--tw-ring-color:rgb(233 213 255/var(--tw-ring-opacity,1))}.focus\\:ring-purple-500:focus{--tw-ring-opacity:1;--tw-ring-color:rgb(168 85 247/var(--tw-ring-opacity,1))}.focus\\:ring-purple-600:focus{--tw-ring-opacity:1;--tw-ring-color:rgb(147 51 234/var(--tw-ring-opacity,1))}.focus\\:ring-yellow-500:focus{--tw-ring-opacity:1;--tw-ring-color:rgb(234 179 8/var(--tw-ring-opacity,1))}.focus\\:ring-offset-2:focus{--tw-ring-offset-width:2px}.disabled\\:cursor-not-allowed:disabled{cursor:not-allowed}.disabled\\:bg-gray-100:disabled{--tw-bg-opacity:1;background-color:rgb(243 244 246/var(--tw-bg-opacity,1))}.disabled\\:opacity-50:disabled{opacity:.5}.group:hover .group-hover\\:translate-x-1{--tw-translate-x:0.25rem}.group:hover .group-hover\\:translate-x-1,.group:hover .group-hover\\:translate-x-2{transform:translate(var(--tw-translate-x),var(--tw-translate-y)) rotate(var(--tw-rotate)) skewX(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y))}.group:hover .group-hover\\:translate-x-2{--tw-translate-x:0.5rem}.group:hover .group-hover\\:rotate-3{--tw-rotate:3deg}.group:hover .group-hover\\:rotate-3,.group:hover .group-hover\\:scale-105{transform:translate(var(--tw-translate-x),var(--tw-translate-y)) rotate(var(--tw-rotate)) skewX(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y))}.group:hover .group-hover\\:scale-105{--tw-scale-x:1.05;--tw-scale-y:1.05}.group:hover .group-hover\\:scale-110{--tw-scale-x:1.1;--tw-scale-y:1.1}.group:hover .group-hover\\:scale-110,.group:hover .group-hover\\:scale-150{transform:translate(var(--tw-translate-x),var(--tw-translate-y)) rotate(var(--tw-rotate)) skewX(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y))}.group:hover .group-hover\\:scale-150{--tw-scale-x:1.5;--tw-scale-y:1.5}.group:hover .group-hover\\:border-pink-500{--tw-border-opacity:1;border-color:rgb(236 72 153/var(--tw-border-opacity,1))}.group:hover .group-hover\\:from-emerald-200{--tw-gradient-from:#a7f3d0 var(--tw-gradient-from-position);--tw-gradient-to:rgba(167,243,208,0) var(--tw-gradient-to-position);--tw-gradient-stops:var(--tw-gradient-from),var(--tw-gradient-to)}.group:hover .group-hover\\:to-blue-200{--tw-gradient-to:#bfdbfe var(--tw-gradient-to-position)}.group:hover .group-hover\\:text-blue-600{--tw-text-opacity:1;color:rgb(37 99 235/var(--tw-text-opacity,1))}.group:hover .group-hover\\:text-blue-700{--tw-text-opacity:1;color:rgb(29 78 216/var(--tw-text-opacity,1))}.group:hover .group-hover\\:text-emerald-500{--tw-text-opacity:1;color:rgb(16 185 129/var(--tw-text-opacity,1))}.group:hover .group-hover\\:text-emerald-600{--tw-text-opacity:1;color:rgb(5 150 105/var(--tw-text-opacity,1))}.group:hover .group-hover\\:text-green-600{--tw-text-opacity:1;color:rgb(22 163 74/var(--tw-text-opacity,1))}.group:hover .group-hover\\:text-indigo-600{--tw-text-opacity:1;color:rgb(79 70 229/var(--tw-text-opacity,1))}.group:hover .group-hover\\:text-indigo-700{--tw-text-opacity:1;color:rgb(67 56 202/var(--tw-text-opacity,1))}.group:hover .group-hover\\:text-orange-600{--tw-text-opacity:1;color:rgb(234 88 12/var(--tw-text-opacity,1))}.group:hover .group-hover\\:text-pink-600{--tw-text-opacity:1;color:rgb(219 39 119/var(--tw-text-opacity,1))}.group:hover .group-hover\\:text-purple-600{--tw-text-opacity:1;color:rgb(147 51 234/var(--tw-text-opacity,1))}.group:hover .group-hover\\:text-teal-600{--tw-text-opacity:1;color:rgb(13 148 136/var(--tw-text-opacity,1))}.group:hover .group-hover\\:opacity-100{opacity:1}.peer:checked~.peer-checked\\:border-amber-500{--tw-border-opacity:1;border-color:rgb(245 158 11/var(--tw-border-opacity,1))}.peer:checked~.peer-checked\\:border-blue-500{--tw-border-opacity:1;border-color:rgb(59 130 246/var(--tw-border-opacity,1))}.peer:checked~.peer-checked\\:border-green-500{--tw-border-opacity:1;border-color:rgb(34 197 94/var(--tw-border-opacity,1))}.peer:checked~.peer-checked\\:border-purple-500{--tw-border-opacity:1;border-color:rgb(168 85 247/var(--tw-border-opacity,1))}.peer:checked~.peer-checked\\:border-purple-600{--tw-border-opacity:1;border-color:rgb(147 51 234/var(--tw-border-opacity,1))}.peer:checked~.peer-checked\\:bg-amber-50{--tw-bg-opacity:1;background-color:rgb(255 251 235/var(--tw-bg-opacity,1))}.peer:checked~.peer-checked\\:bg-blue-50{--tw-bg-opacity:1;background-color:rgb(239 246 255/var(--tw-bg-opacity,1))}.peer:checked~.peer-checked\\:bg-green-50{--tw-bg-opacity:1;background-color:rgb(240 253 244/var(--tw-bg-opacity,1))}.peer:checked~.peer-checked\\:bg-indigo-600{--tw-bg-opacity:1;background-color:rgb(79 70 229/var(--tw-bg-opacity,1))}.peer:checked~.peer-checked\\:bg-purple-50{--tw-bg-opacity:1;background-color:rgb(250 245 255/var(--tw-bg-opacity,1))}.peer:checked~.peer-checked\\:after\\:translate-x-full:after{content:var(--tw-content);--tw-translate-x:100%;transform:translate(var(--tw-translate-x),var(--tw-translate-y)) rotate(var(--tw-rotate)) skewX(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y))}.peer:checked~.peer-checked\\:after\\:border-white:after{content:var(--tw-content);--tw-border-opacity:1;border-color:rgb(255 255 255/var(--tw-border-opacity,1))}.peer:focus~.peer-focus\\:outline-none{outline:2px solid transparent;outline-offset:2px}.peer:focus~.peer-focus\\:ring-4{--tw-ring-offset-shadow:var(--tw-ring-inset) 0 0 0 var(--tw-ring-offset-width) var(--tw-ring-offset-color);--tw-ring-shadow:var(--tw-ring-inset) 0 0 0 calc(4px + var(--tw-ring-offset-width)) var(--tw-ring-color);box-shadow:var(--tw-ring-offset-shadow),var(--tw-ring-shadow),var(--tw-shadow,0 0 #0000)}.peer:focus~.peer-focus\\:ring-indigo-300{--tw-ring-opacity:1;--tw-ring-color:rgb(165 180 252/var(--tw-ring-opacity,1))}.peer:disabled~.peer-disabled\\:cursor-not-allowed{cursor:not-allowed}.peer:disabled~.peer-disabled\\:opacity-50{opacity:.5}@media (min-width:640px){.sm\\:col-span-2{grid-column:span 2/span 2}.sm\\:mx-auto{margin-left:auto;margin-right:auto}.sm\\:my-8{margin-top:2rem;margin-bottom:2rem}.sm\\:ml-3{margin-left:.75rem}.sm\\:mt-0{margin-top:0}.sm\\:mt-6{margin-top:1.5rem}.sm\\:block{display:block}.sm\\:inline-block{display:inline-block}.sm\\:inline{display:inline}.sm\\:flex{display:flex}.sm\\:h-12{height:3rem}.sm\\:h-screen{height:100vh}.sm\\:w-12{width:3rem}.sm\\:w-auto{width:auto}.sm\\:w-full{width:100%}.sm\\:max-w-lg{max-width:32rem}.sm\\:max-w-md{max-width:28rem}.sm\\:translate-y-0{--tw-translate-y:0px}.sm\\:scale-100,.sm\\:translate-y-0{transform:translate(var(--tw-translate-x),var(--tw-translate-y)) rotate(var(--tw-rotate)) skewX(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y))}.sm\\:scale-100{--tw-scale-x:1;--tw-scale-y:1}.sm\\:scale-95{--tw-scale-x:.95;--tw-scale-y:.95;transform:translate(var(--tw-translate-x),var(--tw-translate-y)) rotate(var(--tw-rotate)) skewX(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y))}.sm\\:grid-cols-2{grid-template-columns:repeat(2,minmax(0,1fr))}.sm\\:grid-cols-3{grid-template-columns:repeat(3,minmax(0,1fr))}.sm\\:grid-cols-4{grid-template-columns:repeat(4,minmax(0,1fr))}.sm\\:flex-row{flex-direction:row}.sm\\:flex-row-reverse{flex-direction:row-reverse}.sm\\:items-center{align-items:center}.sm\\:justify-between{justify-content:space-between}.sm\\:gap-4{gap:1rem}.sm\\:rounded-lg{border-radius:.5rem}.sm\\:p-0{padding:0}.sm\\:p-6{padding:1.5rem}.sm\\:p-8{padding:2rem}.sm\\:px-10{padding-left:2.5rem;padding-right:2.5rem}.sm\\:px-6{padding-left:1.5rem;padding-right:1.5rem}.sm\\:pb-4{padding-bottom:1rem}.sm\\:pl-3{padding-left:.75rem}.sm\\:pt-3{padding-top:.75rem}.sm\\:align-middle{vertical-align:middle}.sm\\:text-3xl{font-size:1.875rem;line-height:2.25rem}.sm\\:text-4xl{font-size:2.25rem;line-height:2.5rem}.sm\\:text-5xl{font-size:3rem;line-height:1}.sm\\:text-base{font-size:1rem;line-height:1.5rem}.sm\\:text-sm{font-size:.875rem;line-height:1.25rem}.sm\\:text-xl{font-size:1.25rem;line-height:1.75rem}}@media (min-width:768px){.md\\:fixed{position:fixed}.md\\:inset-y-0{top:0;bottom:0}.md\\:left-1\\/2{left:50%}.md\\:col-span-2{grid-column:span 2/span 2}.md\\:mb-0{margin-bottom:0}.md\\:ml-0{margin-left:0}.md\\:block{display:block}.md\\:flex{display:flex}.md\\:hidden{display:none}.md\\:w-1\\/2{width:50%}.md\\:w-64{width:16rem}.md\\:grid-cols-2{grid-template-columns:repeat(2,minmax(0,1fr))}.md\\:grid-cols-3{grid-template-columns:repeat(3,minmax(0,1fr))}.md\\:grid-cols-4{grid-template-columns:repeat(4,minmax(0,1fr))}.md\\:grid-cols-5{grid-template-columns:repeat(5,minmax(0,1fr))}.md\\:grid-cols-6{grid-template-columns:repeat(6,minmax(0,1fr))}.md\\:flex-row{flex-direction:row}.md\\:flex-row-reverse{flex-direction:row-reverse}.md\\:flex-col{flex-direction:column}.md\\:px-8{padding-left:2rem;padding-right:2rem}.md\\:py-12{padding-top:3rem;padding-bottom:3rem}.md\\:pl-12{padding-left:3rem}.md\\:pl-64{padding-left:16rem}.md\\:pr-12{padding-right:3rem}.md\\:text-right{text-align:right}.md\\:text-2xl{font-size:1.5rem;line-height:2rem}.md\\:text-3xl{font-size:1.875rem;line-height:2.25rem}.md\\:text-4xl{font-size:2.25rem;line-height:2.5rem}.md\\:text-5xl{font-size:3rem;line-height:1}.md\\:text-7xl{font-size:4.5rem;line-height:1}}@media (min-width:1024px){.lg\\:static{position:static}.lg\\:z-auto{z-index:auto}.lg\\:col-span-1{grid-column:span 1/span 1}.lg\\:col-span-2{grid-column:span 2/span 2}.lg\\:mb-0{margin-bottom:0}.lg\\:block{display:block}.lg\\:flex{display:flex}.lg\\:hidden{display:none}.lg\\:h-20{height:5rem}.lg\\:w-1\\/2{width:50%}.lg\\:w-72{width:18rem}.lg\\:w-80{width:20rem}.lg\\:translate-x-0{--tw-translate-x:0px;transform:translate(var(--tw-translate-x),var(--tw-translate-y)) rotate(var(--tw-rotate)) skewX(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y))}.lg\\:grid-cols-2{grid-template-columns:repeat(2,minmax(0,1fr))}.lg\\:grid-cols-3{grid-template-columns:repeat(3,minmax(0,1fr))}.lg\\:grid-cols-4{grid-template-columns:repeat(4,minmax(0,1fr))}.lg\\:grid-cols-5{grid-template-columns:repeat(5,minmax(0,1fr))}.lg\\:grid-cols-6{grid-template-columns:repeat(6,minmax(0,1fr))}.lg\\:grid-cols-8{grid-template-columns:repeat(8,minmax(0,1fr))}.lg\\:flex-row{flex-direction:row}.lg\\:gap-10{gap:2.5rem}.lg\\:gap-20{gap:5rem}.lg\\:space-y-0>:not([hidden])~:not([hidden]){--tw-space-y-reverse:0;margin-top:calc(0px*(1 - var(--tw-space-y-reverse)));margin-bottom:calc(0px*var(--tw-space-y-reverse))}.lg\\:p-10{padding:2.5rem}.lg\\:p-12{padding:3rem}.lg\\:px-6{padding-left:1.5rem;padding-right:1.5rem}.lg\\:px-8{padding-left:2rem;padding-right:2rem}.lg\\:py-32{padding-top:8rem;padding-bottom:8rem}.lg\\:pl-16{padding-left:4rem}.lg\\:pr-16{padding-right:4rem}.lg\\:pt-0{padding-top:0}.lg\\:pt-32{padding-top:8rem}.lg\\:text-right{text-align:right}.lg\\:text-4xl{font-size:2.25rem;line-height:2.5rem}.lg\\:text-5xl{font-size:3rem;line-height:1}.lg\\:text-6xl{font-size:3.75rem;line-height:1}}@media (min-width:1280px){.xl\\:grid-cols-4{grid-template-columns:repeat(4,minmax(0,1fr))}}@media (prefers-color-scheme:dark){.dark\\:border-gray-700{--tw-border-opacity:1;border-color:rgb(55 65 81/var(--tw-border-opacity,1))}.dark\\:border-purple-500\\/20{border-color:rgba(168,85,247,.2)}.dark\\:border-slate-900{--tw-border-opacity:1;border-color:rgb(15 23 42/var(--tw-border-opacity,1))}.dark\\:bg-gray-700{--tw-bg-opacity:1;background-color:rgb(55 65 81/var(--tw-bg-opacity,1))}.dark\\:bg-gray-800{--tw-bg-opacity:1;background-color:rgb(31 41 55/var(--tw-bg-opacity,1))}.dark\\:bg-green-900\\/30{background-color:rgba(20,83,45,.3)}.dark\\:bg-purple-900\\/30{background-color:rgba(88,28,135,.3)}.dark\\:bg-red-900\\/30{background-color:rgba(127,29,29,.3)}.dark\\:bg-slate-800{--tw-bg-opacity:1;background-color:rgb(30 41 59/var(--tw-bg-opacity,1))}.dark\\:bg-slate-900{--tw-bg-opacity:1;background-color:rgb(15 23 42/var(--tw-bg-opacity,1))}.dark\\:bg-slate-950{--tw-bg-opacity:1;background-color:rgb(2 6 23/var(--tw-bg-opacity,1))}.dark\\:bg-yellow-900\\/30{background-color:rgba(113,63,18,.3)}.dark\\:text-fuchsia-400{--tw-text-opacity:1;color:rgb(232 121 249/var(--tw-text-opacity,1))}.dark\\:text-gray-300{--tw-text-opacity:1;color:rgb(209 213 219/var(--tw-text-opacity,1))}.dark\\:text-gray-400{--tw-text-opacity:1;color:rgb(156 163 175/var(--tw-text-opacity,1))}.dark\\:text-green-400{--tw-text-opacity:1;color:rgb(74 222 128/var(--tw-text-opacity,1))}.dark\\:text-pink-400{--tw-text-opacity:1;color:rgb(244 114 182/var(--tw-text-opacity,1))}.dark\\:text-purple-400{--tw-text-opacity:1;color:rgb(192 132 252/var(--tw-text-opacity,1))}.dark\\:text-red-400{--tw-text-opacity:1;color:rgb(248 113 113/var(--tw-text-opacity,1))}.dark\\:text-violet-400{--tw-text-opacity:1;color:rgb(167 139 250/var(--tw-text-opacity,1))}.dark\\:text-white{--tw-text-opacity:1;color:rgb(255 255 255/var(--tw-text-opacity,1))}.dark\\:text-yellow-400{--tw-text-opacity:1;color:rgb(250 204 21/var(--tw-text-opacity,1))}.dark\\:hover\\:bg-pink-500\\/20:hover{background-color:rgba(236,72,153,.2)}.dark\\:hover\\:bg-purple-900\\/50:hover{background-color:rgba(88,28,135,.5)}.dark\\:hover\\:text-fuchsia-300:hover{--tw-text-opacity:1;color:rgb(240 171 252/var(--tw-text-opacity,1))}.dark\\:hover\\:text-pink-300:hover{--tw-text-opacity:1;color:rgb(249 168 212/var(--tw-text-opacity,1))}.dark\\:hover\\:text-pink-400:hover{--tw-text-opacity:1;color:rgb(244 114 182/var(--tw-text-opacity,1))}.dark\\:hover\\:text-purple-300:hover{--tw-text-opacity:1;color:rgb(216 180 254/var(--tw-text-opacity,1))}.dark\\:hover\\:text-violet-300:hover{--tw-text-opacity:1;color:rgb(196 181 253/var(--tw-text-opacity,1))}.group:hover .dark\\:group-hover\\:text-pink-400{--tw-text-opacity:1;color:rgb(244 114 182/var(--tw-text-opacity,1))}}","path":null,"size_bytes":99289,"size_tokens":null}},"version":2}