<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Free Exam Papers - Past Papers Download</title>
    <meta name="description" content="Download free official exam papers from Cambridge, Edexcel, AQA, OCR, CAPS, ZIMSEC, and IEB. Past papers, marking schemes, and examiner reports.">
    <script src="https://cdn.tailwindcss.com"></script>
    <script defer src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        .gradient-text {
            background: linear-gradient(135deg, #10b981 0%, #3b82f6 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        .glass-card {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        .paper-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
        }
        .ad-placeholder {
            background: linear-gradient(135deg, #f3f4f6 0%, #e5e7eb 100%);
            border: 2px dashed #d1d5db;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #9ca3af;
            font-size: 0.875rem;
        }
        .loading-skeleton {
            background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
            background-size: 200% 100%;
            animation: skeleton 1.5s infinite;
        }
        @keyframes skeleton {
            0% { background-position: 200% 0; }
            100% { background-position: -200% 0; }
        }
    </style>
</head>
<body class="bg-gradient-to-br from-emerald-50 via-white to-blue-50 min-h-screen">
    <div x-data="papersApp()" x-init="init()">
        <!-- Header -->
        <header class="bg-white/80 backdrop-blur-md shadow-sm sticky top-0 z-50">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <div class="flex items-center justify-between h-16">
                    <div class="flex items-center space-x-3">
                        <div class="w-10 h-10 bg-gradient-to-br from-emerald-500 to-blue-500 rounded-xl flex items-center justify-center">
                            <i class="fas fa-graduation-cap text-white text-lg"></i>
                        </div>
                        <div>
                            <h1 class="text-xl font-bold text-gray-900">EduTech Papers</h1>
                            <p class="text-xs text-gray-500">Free Exam Resources</p>
                        </div>
                    </div>
                    <nav class="hidden md:flex items-center space-x-6">
                        <a href="{% url 'student_landing' %}" class="text-gray-600 hover:text-emerald-600 transition-colors">
                            <i class="fas fa-user-graduate mr-1"></i> Students
                        </a>
                        <a href="{% url 'teacher_landing' %}" class="text-gray-600 hover:text-emerald-600 transition-colors">
                            <i class="fas fa-chalkboard-teacher mr-1"></i> Teachers
                        </a>
                        <a href="{% url 'login' %}" class="px-4 py-2 bg-gradient-to-r from-emerald-500 to-blue-500 text-white rounded-lg hover:shadow-lg transition-all">
                            Sign In
                        </a>
                    </nav>
                </div>
            </div>
        </header>

        <!-- Top Banner Ad Placeholder -->
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 mt-4">
            <div class="ad-placeholder h-24 rounded-lg" id="ad-top-banner">
                <span><i class="fas fa-ad mr-2"></i>Advertisement (728x90)</span>
            </div>
        </div>

        <!-- Hero Section -->
        <section class="py-8 md:py-12">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 text-center">
                <h1 class="text-3xl md:text-4xl font-bold text-gray-900 mb-4">
                    Free <span class="gradient-text">Exam Papers</span> Download
                </h1>
                <p class="text-lg text-gray-600 max-w-2xl mx-auto">
                    Access thousands of official past papers, marking schemes, and examiner reports from leading exam boards worldwide.
                </p>
            </div>
        </section>

        <!-- Main Content -->
        <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 pb-16">
            <div class="flex flex-col lg:flex-row gap-6">
                <!-- Sidebar with Filters -->
                <aside class="lg:w-72 flex-shrink-0">
                    <div class="glass-card rounded-2xl p-6 sticky top-24 space-y-6">
                        <h2 class="text-lg font-semibold text-gray-900 flex items-center">
                            <i class="fas fa-filter mr-2 text-emerald-500"></i>
                            Filter Papers
                        </h2>

                        <!-- Exam Board Filter -->
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Exam Board</label>
                            <select x-model="filters.board" @change="onBoardChange()" 
                                    class="w-full px-4 py-2.5 bg-white border border-gray-200 rounded-xl focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500 transition-all">
                                <option value="">All Boards</option>
                                {% for board in exam_boards %}
                                <option value="{{ board.id }}">{{ board.name_full }}</option>
                                {% endfor %}
                            </select>
                        </div>

                        <!-- Subject Filter -->
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Subject</label>
                            <select x-model="filters.subject" @change="onSubjectChange()" 
                                    :disabled="!filters.board || subjects.length === 0"
                                    class="w-full px-4 py-2.5 bg-white border border-gray-200 rounded-xl focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500 transition-all disabled:bg-gray-100 disabled:cursor-not-allowed">
                                <option value="">All Subjects</option>
                                <template x-for="subject in subjects" :key="subject.code">
                                    <option :value="subject.code" x-text="subject.name + ' (' + subject.code + ')'"></option>
                                </template>
                            </select>
                        </div>

                        <!-- Year Filter -->
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Year</label>
                            <select x-model="filters.year" @change="loadPapers()" 
                                    :disabled="years.length === 0"
                                    class="w-full px-4 py-2.5 bg-white border border-gray-200 rounded-xl focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500 transition-all disabled:bg-gray-100 disabled:cursor-not-allowed">
                                <option value="">All Years</option>
                                <template x-for="year in years" :key="year">
                                    <option :value="year" x-text="year"></option>
                                </template>
                            </select>
                        </div>

                        <!-- Session Filter -->
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Session</label>
                            <select x-model="filters.session" @change="loadPapers()"
                                    class="w-full px-4 py-2.5 bg-white border border-gray-200 rounded-xl focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500 transition-all">
                                <option value="">All Sessions</option>
                                <template x-for="session in sessions" :key="session.code">
                                    <option :value="session.code" x-text="session.name"></option>
                                </template>
                            </select>
                        </div>

                        <!-- Paper Type Filter -->
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Paper Type</label>
                            <select x-model="filters.paper_type" @change="loadPapers()"
                                    class="w-full px-4 py-2.5 bg-white border border-gray-200 rounded-xl focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500 transition-all">
                                <option value="">All Types</option>
                                <template x-for="type in paperTypes" :key="type.code">
                                    <option :value="type.code" x-text="type.name"></option>
                                </template>
                            </select>
                        </div>

                        <!-- Clear Filters -->
                        <button @click="clearFilters()" 
                                class="w-full py-2.5 text-gray-600 border border-gray-200 rounded-xl hover:bg-gray-50 transition-all flex items-center justify-center">
                            <i class="fas fa-times-circle mr-2"></i>
                            Clear All Filters
                        </button>

                        <!-- Sidebar Ad Placeholder -->
                        <div class="ad-placeholder h-64 rounded-lg mt-6" id="ad-sidebar">
                            <span class="text-center"><i class="fas fa-ad mr-1"></i><br>Ad (300x250)</span>
                        </div>
                    </div>
                </aside>

                <!-- Papers List -->
                <div class="flex-1">
                    <!-- Results Summary -->
                    <div class="glass-card rounded-2xl p-4 mb-6 flex flex-col sm:flex-row items-center justify-between gap-4">
                        <div class="flex items-center space-x-4">
                            <span class="text-gray-600">
                                <span class="font-semibold text-gray-900" x-text="totalPapers"></span> papers found
                            </span>
                            <template x-if="loading">
                                <span class="text-emerald-600 flex items-center">
                                    <i class="fas fa-spinner fa-spin mr-2"></i> Loading...
                                </span>
                            </template>
                        </div>
                        <div class="flex items-center space-x-3">
                            <span class="text-sm text-gray-500">Per page:</span>
                            <select x-model="perPage" @change="loadPapers()" 
                                    class="px-3 py-1.5 bg-white border border-gray-200 rounded-lg text-sm focus:ring-2 focus:ring-emerald-500">
                                <option value="20">20</option>
                                <option value="50">50</option>
                                <option value="100">100</option>
                            </select>
                        </div>
                    </div>

                    <!-- In-Content Ad Placeholder -->
                    <div class="ad-placeholder h-20 rounded-lg mb-6" id="ad-in-content">
                        <span><i class="fas fa-ad mr-2"></i>In-Content Advertisement (Responsive)</span>
                    </div>

                    <!-- Papers Grid -->
                    <div class="space-y-3">
                        <!-- Loading Skeleton -->
                        <template x-if="loading && papers.length === 0">
                            <div class="space-y-3">
                                <template x-for="i in 5" :key="i">
                                    <div class="glass-card rounded-xl p-4">
                                        <div class="flex items-center justify-between">
                                            <div class="flex-1 space-y-2">
                                                <div class="loading-skeleton h-5 w-3/4 rounded"></div>
                                                <div class="loading-skeleton h-4 w-1/2 rounded"></div>
                                            </div>
                                            <div class="loading-skeleton h-10 w-24 rounded-lg"></div>
                                        </div>
                                    </div>
                                </template>
                            </div>
                        </template>

                        <!-- No Results -->
                        <template x-if="!loading && papers.length === 0">
                            <div class="glass-card rounded-2xl p-12 text-center">
                                <div class="w-20 h-20 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-4">
                                    <i class="fas fa-file-search text-3xl text-gray-400"></i>
                                </div>
                                <h3 class="text-xl font-semibold text-gray-900 mb-2">No Papers Found</h3>
                                <p class="text-gray-600 mb-6">Try adjusting your filters or select a different exam board.</p>
                                <button @click="clearFilters()" 
                                        class="px-6 py-2.5 bg-gradient-to-r from-emerald-500 to-blue-500 text-white rounded-xl hover:shadow-lg transition-all">
                                    Clear Filters
                                </button>
                            </div>
                        </template>

                        <!-- Paper Cards -->
                        <template x-for="paper in papers" :key="paper.id">
                            <div class="glass-card rounded-xl p-4 paper-card transition-all duration-200 cursor-pointer hover:border-emerald-200"
                                 @click="viewPaper(paper.id)">
                                <div class="flex flex-col sm:flex-row sm:items-center justify-between gap-4">
                                    <div class="flex-1">
                                        <div class="flex items-center space-x-3 mb-2">
                                            <!-- Paper Type Icon -->
                                            <span class="w-10 h-10 rounded-lg flex items-center justify-center text-white text-sm font-bold"
                                                  :class="{
                                                      'bg-blue-500': paper.paper_type_code === 'qp',
                                                      'bg-green-500': paper.paper_type_code === 'ms',
                                                      'bg-purple-500': paper.paper_type_code === 'er',
                                                      'bg-orange-500': paper.paper_type_code === 'gt',
                                                      'bg-gray-500': !['qp','ms','er','gt'].includes(paper.paper_type_code)
                                                  }">
                                                <i class="fas" :class="{
                                                    'fa-file-alt': paper.paper_type_code === 'qp',
                                                    'fa-check-circle': paper.paper_type_code === 'ms',
                                                    'fa-clipboard': paper.paper_type_code === 'er',
                                                    'fa-chart-bar': paper.paper_type_code === 'gt',
                                                    'fa-file': !['qp','ms','er','gt'].includes(paper.paper_type_code)
                                                }"></i>
                                            </span>
                                            <div>
                                                <h3 class="font-semibold text-gray-900" x-text="paper.display_name"></h3>
                                                <p class="text-sm text-gray-500">
                                                    <span x-text="paper.subject_name || paper.subject_code"></span>
                                                    <span class="mx-1">•</span>
                                                    <span x-text="paper.year"></span>
                                                    <span class="mx-1">•</span>
                                                    <span x-text="paper.session"></span>
                                                </p>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="flex items-center space-x-2">
                                        <span class="px-3 py-1 text-xs font-medium rounded-full"
                                              :class="{
                                                  'bg-blue-100 text-blue-700': paper.paper_type_code === 'qp',
                                                  'bg-green-100 text-green-700': paper.paper_type_code === 'ms',
                                                  'bg-purple-100 text-purple-700': paper.paper_type_code === 'er',
                                                  'bg-orange-100 text-orange-700': paper.paper_type_code === 'gt',
                                                  'bg-gray-100 text-gray-700': !['qp','ms','er','gt'].includes(paper.paper_type_code)
                                              }"
                                              x-text="paper.paper_type"></span>
                                        <a :href="'/papers/download/' + paper.id + '/'" 
                                           @click.stop
                                           class="px-4 py-2 bg-gradient-to-r from-emerald-500 to-blue-500 text-white rounded-lg hover:shadow-md transition-all text-sm font-medium">
                                            <i class="fas fa-download mr-1"></i> Download
                                        </a>
                                    </div>
                                </div>
                            </div>
                        </template>
                    </div>

                    <!-- Pagination -->
                    <template x-if="totalPages > 1">
                        <div class="mt-8 flex flex-col sm:flex-row items-center justify-between gap-4">
                            <p class="text-sm text-gray-600">
                                Page <span class="font-semibold" x-text="currentPage"></span> of <span class="font-semibold" x-text="totalPages"></span>
                            </p>
                            <div class="flex items-center space-x-2">
                                <button @click="prevPage()" :disabled="!hasPrev" 
                                        class="px-4 py-2 border border-gray-200 rounded-lg hover:bg-gray-50 transition-all disabled:opacity-50 disabled:cursor-not-allowed">
                                    <i class="fas fa-chevron-left mr-1"></i> Previous
                                </button>
                                
                                <!-- Page Numbers -->
                                <template x-for="page in visiblePages" :key="page">
                                    <button @click="goToPage(page)" 
                                            class="w-10 h-10 rounded-lg transition-all"
                                            :class="page === currentPage ? 'bg-gradient-to-r from-emerald-500 to-blue-500 text-white' : 'border border-gray-200 hover:bg-gray-50'"
                                            x-text="page"></button>
                                </template>
                                
                                <button @click="nextPage()" :disabled="!hasNext"
                                        class="px-4 py-2 border border-gray-200 rounded-lg hover:bg-gray-50 transition-all disabled:opacity-50 disabled:cursor-not-allowed">
                                    Next <i class="fas fa-chevron-right ml-1"></i>
                                </button>
                            </div>
                        </div>
                    </template>

                    <!-- Bottom Ad Placeholder -->
                    <div class="ad-placeholder h-24 rounded-lg mt-8" id="ad-bottom-banner">
                        <span><i class="fas fa-ad mr-2"></i>Advertisement (728x90)</span>
                    </div>
                </div>
            </div>
        </main>

        <!-- Footer -->
        <footer class="bg-gray-900 text-white py-12">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <div class="grid md:grid-cols-4 gap-8">
                    <div>
                        <div class="flex items-center space-x-3 mb-4">
                            <div class="w-10 h-10 bg-gradient-to-br from-emerald-500 to-blue-500 rounded-xl flex items-center justify-center">
                                <i class="fas fa-graduation-cap text-white"></i>
                            </div>
                            <span class="text-xl font-bold">EduTech</span>
                        </div>
                        <p class="text-gray-400 text-sm">Free access to official exam papers from leading exam boards worldwide.</p>
                    </div>
                    <div>
                        <h4 class="font-semibold mb-4">Exam Boards</h4>
                        <ul class="space-y-2 text-gray-400 text-sm">
                            <li>Cambridge (CAIE)</li>
                            <li>Edexcel</li>
                            <li>AQA</li>
                            <li>OCR</li>
                        </ul>
                    </div>
                    <div>
                        <h4 class="font-semibold mb-4">Resources</h4>
                        <ul class="space-y-2 text-gray-400 text-sm">
                            <li><a href="{% url 'student_landing' %}" class="hover:text-white transition-colors">Student Portal</a></li>
                            <li><a href="{% url 'teacher_landing' %}" class="hover:text-white transition-colors">Teacher Portal</a></li>
                            <li><a href="#" class="hover:text-white transition-colors">Study Tips</a></li>
                        </ul>
                    </div>
                    <div>
                        <h4 class="font-semibold mb-4">Legal</h4>
                        <ul class="space-y-2 text-gray-400 text-sm">
                            <li><a href="#" class="hover:text-white transition-colors">Privacy Policy</a></li>
                            <li><a href="#" class="hover:text-white transition-colors">Terms of Use</a></li>
                            <li><a href="#" class="hover:text-white transition-colors">Copyright Notice</a></li>
                        </ul>
                    </div>
                </div>
                <div class="border-t border-gray-800 mt-8 pt-8 text-center text-gray-400 text-sm">
                    <p>&copy; 2024 EduTech. All rights reserved. Past papers are provided for educational purposes.</p>
                </div>
            </div>
        </footer>
    </div>

    <script>
        function papersApp() {
            return {
                filters: {
                    board: '',
                    subject: '',
                    year: '',
                    session: '',
                    paper_type: ''
                },
                subjects: [],
                years: [],
                sessions: [],
                paperTypes: [],
                papers: [],
                loading: false,
                totalPapers: 0,
                currentPage: 1,
                totalPages: 1,
                perPage: 20,
                hasNext: false,
                hasPrev: false,

                async init() {
                    await this.loadFilters();
                    await this.loadPapers();
                },

                async loadFilters() {
                    try {
                        // Load sessions and paper types (static)
                        const sessionRes = await fetch('/papers/filters/?filter_type=sessions');
                        const sessionData = await sessionRes.json();
                        if (sessionData.success) this.sessions = sessionData.options;

                        const typeRes = await fetch('/papers/filters/?filter_type=paper_types');
                        const typeData = await typeRes.json();
                        if (typeData.success) this.paperTypes = typeData.options;
                    } catch (error) {
                        console.error('Error loading filters:', error);
                    }
                },

                async onBoardChange() {
                    this.filters.subject = '';
                    this.filters.year = '';
                    this.subjects = [];
                    this.years = [];
                    
                    if (this.filters.board) {
                        try {
                            const res = await fetch(`/papers/filters/?filter_type=subjects&board=${this.filters.board}`);
                            const data = await res.json();
                            if (data.success) this.subjects = data.options;
                        } catch (error) {
                            console.error('Error loading subjects:', error);
                        }
                    }
                    
                    await this.loadPapers();
                },

                async onSubjectChange() {
                    this.filters.year = '';
                    this.years = [];
                    
                    if (this.filters.board) {
                        try {
                            let url = `/papers/filters/?filter_type=years&board=${this.filters.board}`;
                            if (this.filters.subject) url += `&subject=${this.filters.subject}`;
                            
                            const res = await fetch(url);
                            const data = await res.json();
                            if (data.success) this.years = data.options;
                        } catch (error) {
                            console.error('Error loading years:', error);
                        }
                    }
                    
                    await this.loadPapers();
                },

                async loadPapers() {
                    this.loading = true;
                    
                    try {
                        let url = `/papers/api/?page=${this.currentPage}&per_page=${this.perPage}`;
                        if (this.filters.board) url += `&board=${this.filters.board}`;
                        if (this.filters.subject) url += `&subject=${this.filters.subject}`;
                        if (this.filters.year) url += `&year=${this.filters.year}`;
                        if (this.filters.session) url += `&session=${this.filters.session}`;
                        if (this.filters.paper_type) url += `&paper_type=${this.filters.paper_type}`;
                        
                        const res = await fetch(url);
                        const data = await res.json();
                        
                        if (data.success) {
                            this.papers = data.papers;
                            this.totalPapers = data.total;
                            this.totalPages = data.pages;
                            this.hasNext = data.has_next;
                            this.hasPrev = data.has_prev;
                        }
                    } catch (error) {
                        console.error('Error loading papers:', error);
                    } finally {
                        this.loading = false;
                    }
                },

                clearFilters() {
                    this.filters = { board: '', subject: '', year: '', session: '', paper_type: '' };
                    this.subjects = [];
                    this.years = [];
                    this.currentPage = 1;
                    this.loadPapers();
                },

                viewPaper(id) {
                    window.location.href = `/papers/view/${id}/`;
                },

                get visiblePages() {
                    const pages = [];
                    const start = Math.max(1, this.currentPage - 2);
                    const end = Math.min(this.totalPages, this.currentPage + 2);
                    for (let i = start; i <= end; i++) {
                        pages.push(i);
                    }
                    return pages;
                },

                goToPage(page) {
                    this.currentPage = page;
                    this.loadPapers();
                    window.scrollTo({ top: 0, behavior: 'smooth' });
                },

                nextPage() {
                    if (this.hasNext) {
                        this.currentPage++;
                        this.loadPapers();
                        window.scrollTo({ top: 0, behavior: 'smooth' });
                    }
                },

                prevPage() {
                    if (this.hasPrev) {
                        this.currentPage--;
                        this.loadPapers();
                        window.scrollTo({ top: 0, behavior: 'smooth' });
                    }
                }
            };
        }
    </script>
</body>
</html>
