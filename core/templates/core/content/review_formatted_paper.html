{% extends 'core/content/base.html' %}

{% block title %}Review Formatted Paper - Content Portal{% endblock %}

{% block content %}
<div class="mb-8">
    <a href="{% url 'content_formatted_papers' %}" class="text-indigo-600 hover:text-indigo-900 text-sm">
        <i class="fas fa-arrow-left mr-2"></i>Back to Formatted Papers
    </a>
    <h1 class="text-2xl font-bold text-gray-900 mt-4">Review & Edit Formatted Paper</h1>
    <p class="mt-1 text-sm text-gray-600">Review AI-extracted questions and memo before publishing</p>
</div>

<!-- Paper Info -->
<div class="bg-white shadow rounded-lg mb-6">
    <div class="px-6 py-4 border-b border-gray-200">
        <div class="flex items-center justify-between">
            <div>
                <h3 class="text-lg font-medium text-gray-900">{{ formatted_paper.title }}</h3>
                <p class="text-sm text-gray-500">{{ formatted_paper.exam_board }} | {{ formatted_paper.subject.name }} | Grade {{ formatted_paper.grade.number }} | {{ formatted_paper.year }}</p>
            </div>
            <div class="text-right">
                <p class="text-sm font-medium text-gray-900">{{ formatted_paper.total_questions }} Questions</p>
                <p class="text-sm text-gray-500">{{ formatted_paper.total_marks }} Total Marks</p>
            </div>
        </div>
    </div>
</div>

<form method="post" x-data="{ activeTab: 'questions' }">
    {% csrf_token %}
    
    <!-- Tabs -->
    <div class="bg-white shadow rounded-lg mb-6">
        <div class="border-b border-gray-200">
            <nav class="-mb-px flex space-x-8 px-6" aria-label="Tabs">
                <button type="button" @click="activeTab = 'questions'" 
                        :class="activeTab === 'questions' ? 'border-indigo-500 text-indigo-600' : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'"
                        class="whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm">
                    <i class="fas fa-list-ol mr-2"></i>Questions
                </button>
                <button type="button" @click="activeTab = 'memo'" 
                        :class="activeTab === 'memo' ? 'border-indigo-500 text-indigo-600' : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'"
                        class="whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm">
                    <i class="fas fa-clipboard-check mr-2"></i>Marking Memo
                </button>
            </nav>
        </div>
        
        <!-- Questions Tab -->
        <div x-show="activeTab === 'questions'" class="px-6 py-4">
            <label class="block text-sm font-medium text-gray-700 mb-2">Questions JSON</label>
            <p class="text-xs text-gray-500 mb-2">Edit the questions structure. Ensure valid JSON format.</p>
            <textarea name="questions_json" rows="20" class="w-full font-mono text-sm border-gray-300 rounded-md shadow-sm focus:border-indigo-500 focus:ring-indigo-500">{{ questions_json_str }}</textarea>
        </div>
        
        <!-- Memo Tab -->
        <div x-show="activeTab === 'memo'" class="px-6 py-4">
            <label class="block text-sm font-medium text-gray-700 mb-2">Marking Memo JSON</label>
            <p class="text-xs text-gray-500 mb-2">Edit the marking memo structure. Ensure valid JSON format.</p>
            <textarea name="memo_json" rows="20" class="w-full font-mono text-sm border-gray-300 rounded-md shadow-sm focus:border-indigo-500 focus:ring-indigo-500">{{ memo_json_str }}</textarea>
        </div>
    </div>
    
    <!-- Actions -->
    <div class="flex justify-between">
        <a href="{% url 'content_formatted_papers' %}" class="px-4 py-2 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50">
            Cancel
        </a>
        <div class="flex space-x-3">
            <button type="submit" name="action" value="save" class="px-4 py-2 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50">
                <i class="fas fa-save mr-2"></i>Save Changes
            </button>
            <button type="submit" name="action" value="publish" class="px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-green-600 hover:bg-green-700">
                <i class="fas fa-check-circle mr-2"></i>Save & Publish
            </button>
        </div>
    </div>
</form>

<!-- Source Paper Link -->
<div class="mt-6 bg-gray-50 border border-gray-200 rounded-lg p-4">
    <h4 class="text-sm font-medium text-gray-900 mb-2">Source Paper</h4>
    <a href="{{ source_paper.file.url }}" target="_blank" class="text-sm text-indigo-600 hover:text-indigo-900">
        <i class="fas fa-file-pdf mr-2"></i>View Original PDF
    </a>
</div>

{% endblock %}
