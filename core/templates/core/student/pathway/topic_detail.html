{% extends 'core/student/base.html' %}

{% block title %}{{ topic.name }} - {{ subject.name }}{% endblock %}

{% block extra_css %}
<style>
    .tab-btn.active {
        color: #10b981;
        border-bottom-color: #10b981;
    }
    .tab-content { display: none; }
    .tab-content.active { display: block; }
</style>
{% endblock %}

{% block content %}
<div class="min-h-screen py-8" style="background: linear-gradient(135deg, #f0fdf4 0%, #ecfeff 100%);">
    <div class="max-w-6xl mx-auto px-4">
        <div class="mb-6">
            <a href="{% url 'student_study_pathway' subject.id %}" class="inline-flex items-center text-gray-600 hover:text-emerald-600 transition-colors">
                <i class="fas fa-arrow-left mr-2"></i>Back to Topics
            </a>
        </div>
        
        <div class="bg-white rounded-2xl shadow-lg p-6 mb-6">
            <div class="flex items-center">
                <div class="w-14 h-14 bg-gradient-to-br from-emerald-500 to-blue-500 rounded-xl flex items-center justify-center mr-5">
                    <i class="fas fa-folder-open text-white text-xl"></i>
                </div>
                <div>
                    <h1 class="text-2xl font-bold text-gray-900">{{ topic.name }}</h1>
                    <p class="text-gray-600">{{ subject.name }} | {{ exam_board.abbreviation }}</p>
                </div>
            </div>
        </div>
        
        <div class="bg-white rounded-2xl shadow-lg overflow-hidden" x-data="{ activeTab: '{{ active_tab }}' }">
            <div class="border-b border-gray-200">
                <nav class="flex overflow-x-auto">
                    <button @click="activeTab = 'notes'" :class="activeTab === 'notes' ? 'active' : ''" class="tab-btn flex-shrink-0 px-6 py-4 text-sm font-medium text-gray-600 hover:text-emerald-600 border-b-2 border-transparent transition-colors">
                        <i class="fas fa-book mr-2"></i>Notes ({{ notes|length }})
                    </button>
                    <button @click="activeTab = 'videos'" :class="activeTab === 'videos' ? 'active' : ''" class="tab-btn flex-shrink-0 px-6 py-4 text-sm font-medium text-gray-600 hover:text-emerald-600 border-b-2 border-transparent transition-colors">
                        <i class="fas fa-video mr-2"></i>Videos ({{ videos|length }})
                    </button>
                    <button @click="activeTab = 'flashcards'" :class="activeTab === 'flashcards' ? 'active' : ''" class="tab-btn flex-shrink-0 px-6 py-4 text-sm font-medium text-gray-600 hover:text-emerald-600 border-b-2 border-transparent transition-colors">
                        <i class="fas fa-layer-group mr-2"></i>Flashcards ({{ flashcards|length }})
                    </button>
                    <button @click="activeTab = 'quizzes'" :class="activeTab === 'quizzes' ? 'active' : ''" class="tab-btn flex-shrink-0 px-6 py-4 text-sm font-medium text-gray-600 hover:text-emerald-600 border-b-2 border-transparent transition-colors">
                        <i class="fas fa-clipboard-list mr-2"></i>Quizzes
                    </button>
                    <button @click="activeTab = 'questions'" :class="activeTab === 'questions' ? 'active' : ''" class="tab-btn flex-shrink-0 px-6 py-4 text-sm font-medium text-gray-600 hover:text-emerald-600 border-b-2 border-transparent transition-colors">
                        <i class="fas fa-edit mr-2"></i>Questions ({{ structured_questions|length }})
                    </button>
                </nav>
            </div>
            
            <div class="p-6">
                <div x-show="activeTab === 'notes'" class="tab-content" :class="activeTab === 'notes' ? 'active' : ''">
                    {% if notes %}
                        <div class="grid gap-4">
                            {% for note in notes %}
                                <a href="{% url 'student_note_view' note.id %}" class="flex items-center p-4 bg-gray-50 rounded-xl hover:bg-emerald-50 transition-colors group">
                                    <div class="w-12 h-12 bg-emerald-100 rounded-lg flex items-center justify-center mr-4">
                                        <i class="fas fa-file-alt text-emerald-600"></i>
                                    </div>
                                    <div class="flex-1">
                                        <h4 class="font-medium text-gray-900 group-hover:text-emerald-600">{{ note.title }}</h4>
                                        <p class="text-sm text-gray-500">{{ note.created_at|date:"M d, Y" }}</p>
                                    </div>
                                    <i class="fas fa-chevron-right text-gray-400 group-hover:text-emerald-600"></i>
                                </a>
                            {% endfor %}
                        </div>
                    {% else %}
                        <div class="text-center py-8 text-gray-500">
                            <i class="fas fa-book text-4xl mb-3 text-gray-300"></i>
                            <p>No notes available for this topic yet.</p>
                        </div>
                    {% endif %}
                </div>
                
                <div x-show="activeTab === 'videos'" class="tab-content" :class="activeTab === 'videos' ? 'active' : ''">
                    {% if videos %}
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            {% for video in videos %}
                                <a href="{% url 'student_video_player' video.id %}" class="bg-gray-50 rounded-xl overflow-hidden hover:shadow-md transition-shadow group">
                                    <div class="aspect-video bg-gray-200 relative">
                                        <img src="{{ video.get_thumbnail }}" alt="{{ video.title }}" class="w-full h-full object-cover">
                                        <div class="absolute inset-0 bg-black bg-opacity-40 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity">
                                            <i class="fas fa-play-circle text-white text-5xl"></i>
                                        </div>
                                        {% if video.duration_minutes %}
                                            <span class="absolute bottom-2 right-2 bg-black bg-opacity-75 text-white text-xs px-2 py-1 rounded">{{ video.duration_minutes }} min</span>
                                        {% endif %}
                                    </div>
                                    <div class="p-4">
                                        <h4 class="font-medium text-gray-900 group-hover:text-emerald-600">{{ video.title }}</h4>
                                    </div>
                                </a>
                            {% endfor %}
                        </div>
                    {% else %}
                        <div class="text-center py-8 text-gray-500">
                            <i class="fas fa-video text-4xl mb-3 text-gray-300"></i>
                            <p>No videos available for this topic yet.</p>
                        </div>
                    {% endif %}
                </div>
                
                <div x-show="activeTab === 'flashcards'" class="tab-content" :class="activeTab === 'flashcards' ? 'active' : ''">
                    {% if flashcards %}
                        <div class="text-center mb-6">
                            <a href="{% url 'student_flashcard_study' subject.id %}?topic={{ topic.name }}" class="inline-flex items-center px-6 py-3 bg-gradient-to-r from-emerald-500 to-blue-500 text-white rounded-xl hover:from-emerald-600 hover:to-blue-600 shadow-md">
                                <i class="fas fa-play mr-2"></i>Start Flashcard Study ({{ flashcards|length }} cards)
                            </a>
                        </div>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            {% for flashcard in flashcards|slice:":6" %}
                                <div class="bg-gray-50 rounded-xl p-4">
                                    <div class="text-sm text-gray-500 mb-2">Front</div>
                                    <p class="text-gray-900">{{ flashcard.front_text|truncatewords:20 }}</p>
                                </div>
                            {% endfor %}
                        </div>
                    {% else %}
                        <div class="text-center py-8 text-gray-500">
                            <i class="fas fa-layer-group text-4xl mb-3 text-gray-300"></i>
                            <p>No flashcards available for this topic yet.</p>
                        </div>
                    {% endif %}
                </div>
                
                <div x-show="activeTab === 'quizzes'" class="tab-content" :class="activeTab === 'quizzes' ? 'active' : ''">
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                        <div class="bg-green-50 rounded-xl p-6">
                            <div class="flex items-center mb-4">
                                <div class="w-10 h-10 bg-green-500 rounded-lg flex items-center justify-center mr-3">
                                    <i class="fas fa-smile text-white"></i>
                                </div>
                                <h3 class="font-semibold text-gray-900">Easy</h3>
                            </div>
                            {% if quizzes_easy %}
                                <div class="space-y-2">
                                    {% for quiz in quizzes_easy %}
                                        <a href="{% url 'student_quiz_start' quiz.id %}" class="block p-3 bg-white rounded-lg hover:shadow-sm transition-shadow">
                                            <span class="text-sm font-medium text-gray-900">{{ quiz.title }}</span>
                                        </a>
                                    {% endfor %}
                                </div>
                            {% else %}
                                <p class="text-sm text-gray-500">No easy quizzes yet</p>
                            {% endif %}
                        </div>
                        
                        <div class="bg-yellow-50 rounded-xl p-6">
                            <div class="flex items-center mb-4">
                                <div class="w-10 h-10 bg-yellow-500 rounded-lg flex items-center justify-center mr-3">
                                    <i class="fas fa-meh text-white"></i>
                                </div>
                                <h3 class="font-semibold text-gray-900">Medium</h3>
                            </div>
                            {% if quizzes_medium %}
                                <div class="space-y-2">
                                    {% for quiz in quizzes_medium %}
                                        <a href="{% url 'student_quiz_start' quiz.id %}" class="block p-3 bg-white rounded-lg hover:shadow-sm transition-shadow">
                                            <span class="text-sm font-medium text-gray-900">{{ quiz.title }}</span>
                                        </a>
                                    {% endfor %}
                                </div>
                            {% else %}
                                <p class="text-sm text-gray-500">No medium quizzes yet</p>
                            {% endif %}
                        </div>
                        
                        <div class="bg-red-50 rounded-xl p-6">
                            <div class="flex items-center mb-4">
                                <div class="w-10 h-10 bg-red-500 rounded-lg flex items-center justify-center mr-3">
                                    <i class="fas fa-fire text-white"></i>
                                </div>
                                <h3 class="font-semibold text-gray-900">Hard</h3>
                            </div>
                            {% if quizzes_hard %}
                                <div class="space-y-2">
                                    {% for quiz in quizzes_hard %}
                                        <a href="{% url 'student_quiz_start' quiz.id %}" class="block p-3 bg-white rounded-lg hover:shadow-sm transition-shadow">
                                            <span class="text-sm font-medium text-gray-900">{{ quiz.title }}</span>
                                        </a>
                                    {% endfor %}
                                </div>
                            {% else %}
                                <p class="text-sm text-gray-500">No hard quizzes yet</p>
                            {% endif %}
                        </div>
                    </div>
                </div>
                
                <div x-show="activeTab === 'questions'" class="tab-content" :class="activeTab === 'questions' ? 'active' : ''">
                    {% if structured_questions %}
                        <div class="space-y-4">
                            {% for question in structured_questions %}
                                <div class="bg-gray-50 rounded-xl p-4">
                                    <div class="flex items-center gap-2 mb-2">
                                        <span class="px-2 py-1 text-xs font-medium rounded-full {% if question.difficulty == 'easy' %}bg-green-100 text-green-700{% elif question.difficulty == 'medium' %}bg-yellow-100 text-yellow-700{% else %}bg-red-100 text-red-700{% endif %}">{{ question.get_difficulty_display }}</span>
                                        <span class="text-sm text-gray-500">{{ question.max_marks }} marks</span>
                                    </div>
                                    <p class="text-gray-900">{{ question.question_text }}</p>
                                </div>
                            {% endfor %}
                        </div>
                    {% else %}
                        <div class="text-center py-8 text-gray-500">
                            <i class="fas fa-edit text-4xl mb-3 text-gray-300"></i>
                            <p>No structured questions available for this topic yet.</p>
                        </div>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}
